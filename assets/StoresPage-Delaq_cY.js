import{r as x,j as e,b as y,c as T,d as L,e as A,g as N,f as v,a as R,T as b,B as h,s as D,h as O}from"./index-ca60C8Ex.js";import{P}from"./PageHeader-L384JM_x.js";import{u as p,S as C,f as $,E as k,T as s}from"./ExportButton-DJbPAtbm.js";import{D as f,u as q}from"./Dialog-BEgjFVpa.js";import{a as w,F as H,u as I,I as E,b as F}from"./schemas-C9-uV1IB.js";import{C as m}from"./Choice-Cynndokp.js";import{S as K}from"./index-ChK4FANK.js";import{u as B}from"./useDialogContext-C-qe08Vp.js";import"./useIsFetching-DDtOVjy5.js";import"./index-BqtrbC3K.js";const M=x.createContext(null);function Q({children:a}){const[n,t]=x.useState("");function i(c){t(c)}const r=x.useMemo(()=>({example:n,handleExample:i}),[n]);return e.jsx(M.Provider,{value:r,children:a})}function V({storeId:a,storeName:n,...t}){const{safeFetch:i}=y(),{showSuccessSnackbar:r}=T(),c=L(),{handleStoresFilter:j}=p();async function S(){await i(`${v}/store/${a}`,{method:"DELETE",body:{archivedAt:new Date().toISOString()},resource:"STORES",action:"DELETE"})}const{mutate:d,isPending:u}=A({mutationFn:S,onSuccess:()=>{j({page:1}),c.invalidateQueries({queryKey:["stores"]}),r({title:`Loja ${n} desativada com sucesso`}),t.closeDialog()}});return e.jsxs(f,{...t,children:[e.jsx(f.Header,{title:"Desativar loja"}),e.jsx(f.Body,{children:e.jsxs("span",{className:"text-body-medium text-neutral-700",children:["Tem certeza que deseja desativar a loja",e.jsxs("span",{className:"font-bold",children:[N,n]}),"? Ao desativar os registros relacionados a ela não serão mais acessíveis"]})}),e.jsx(f.Footer,{labelPrimaryBtn:"Desativar",onClickPrimaryBtn:d,primaryBtnState:u?"loading":void 0,primaryBtnColor:"red",primaryBtResource:"STORES",primaryBtnAction:"DELETE"})]})}function z(a){const n=[];for(const t of a.data)n.push({...t,phone:w(t==null?void 0:t.phone,"phone")});return{total:a.total,data:n}}function U({storeId:a,name:n,isActive:t,handleDisableStoreInfo:i}){const r=R(),{safeFetch:c}=y(),{showSuccessSnackbar:j}=T(),S=L();async function d(){await c(`${v}/store/${a}`,{method:"DELETE",body:{archivedAt:null},resource:"STORES",action:"DELETE"})}const{mutate:u,isPending:l}=A({mutationFn:d,onSuccess:()=>{S.invalidateQueries({queryKey:["stores"]}),j({title:`Loja ${n} ativada com sucesso`})}});return t?e.jsxs(e.Fragment,{children:[e.jsx(b,{content:"Editar",children:e.jsx(h,{variant:"quaternary",iconLeft:"Edit",onClick:()=>r(`/stores/edit/${a}`),resource:"STORES",action:"UPDATE",padding:"none","data-cy":`button-edit-store-${a}`})}),e.jsx(b,{content:"Desativar",children:e.jsx(h,{variant:"primary",iconLeft:"Delete",color:"red",padding:"none",onClick:()=>i({storeName:n,storeId:a}),resource:"STORES",action:"DELETE","data-cy":`button-disable-store-${a}`})})]}):e.jsx(b,{content:"Ativar",children:e.jsx(h,{variant:"quaternary",onClick:u,state:l?"loading":void 0,resource:"STORES",action:"DELETE",padding:"none",iconLeft:"ToggleOn","data-cy":`button-enable-store-${a}`})})}function _(){const{storesFilter:a,handleStoresFilter:n}=p(),{closeDialog:t}=B();function i(r){n({page:1,...r}),t()}return e.jsx(H,{schema:K,onSubmit:i,className:"flex-1 flex flex-col",defaultValues:{name:(a==null?void 0:a.name)||"",orderBy:(a==null?void 0:a.orderBy)||"name",status:(a==null?void 0:a.status)||"active",startDate:(a==null?void 0:a.startDate)||"",endDate:(a==null?void 0:a.endDate)||""},replaceEmptyStringToNull:!1,children:e.jsx(G,{})})}function G(){const{reset:a}=I(),{handleStoresFilter:n}=p(),{closeDialog:t}=B();function i(){n(D),a(D),t()}return e.jsxs(e.Fragment,{children:[e.jsxs(C.Body,{className:"flex flex-col gap-4",children:[e.jsx(E,{name:"name",label:"Nome"}),e.jsx(F,{label:"Status"}),e.jsx("div",{className:"flex flex-col gap-2",children:e.jsxs(m,{hideErrorLabel:!0,children:[e.jsx(m.Radio,{name:"status",label:"Ativo",value:"active"}),e.jsx(m.Radio,{name:"status",label:"Inativo",value:"inactive"})]})}),e.jsx(E,{name:"startDate",label:"Data inicial",type:"date"}),e.jsx(E,{name:"endDate",label:"Data final",type:"date"}),e.jsx(F,{label:"Ordenar por"}),e.jsx("div",{className:"flex flex-col gap-2",children:e.jsxs(m,{hideErrorLabel:!0,children:[e.jsx(m.Radio,{name:"orderBy",label:"Nome",value:"name"}),e.jsx(m.Radio,{name:"orderBy",label:"Email",value:"email"})]})})]}),e.jsx(C.Footer,{primaryLabel:"Aplicar",secondaryLabel:"Limpar",onSecondaryCallback:i,dirty:!0})]})}const J=x.memo(_);function W(){const[a,n]=x.useState({storeName:"",storeId:""}),t=q(),{safeFetch:i}=y(),{storesFilter:r,handleStoresFilter:c}=p();function j(o){t.openDialog(),n(o)}function S(o){c({page:o})}const d=x.useMemo(()=>r?$(r):"",[r]);async function u(o){return await i(`${v}/store?${o}`,{resource:"STORES",action:"READ"})}const{data:l,isFetching:g}=O({queryKey:["stores",d],queryFn:({queryKey:o})=>u(o[1]),select:z});return e.jsxs(e.Fragment,{children:[e.jsx(V,{...a,...t}),e.jsxs("div",{className:"flex gap-4 justify-end",children:[e.jsx(k,{fileName:"Relatório Lojas",resource:"STORES",queryKey:["stores",d],queryFn:u,formatFilters:{name:"Nome completo",orderBy:"Ordenar por",status:"Status",endDate:"Data final",startDate:"Data inicial"},formatFiltersValues:{orderBy:{email:"Email",name:"Nome"},status:{active:"Ativo",inactive:"Inativo"}},formatColumns:{id:"ID",name:"Nome",email:"Email",phone:"Celular",archivedAt:"Ativo"}}),e.jsx(s.Filter,{form:e.jsx(J,{})})]}),e.jsxs(s,{children:[e.jsxs(s.Header,{children:[e.jsx(s.Head,{label:"ID"}),e.jsx(s.Head,{label:"Nome"}),e.jsx(s.Head,{label:"Email"}),e.jsx(s.Head,{label:"Celular"}),e.jsx(s.Head,{label:"Status"}),e.jsx(s.Head,{action:!0})]}),e.jsx(s.Body,{isLoading:g,isEmpty:!(l!=null&&l.total),resource:"STORES",action:"READ",children:l==null?void 0:l.data.map(o=>e.jsxs(s.Row,{children:[e.jsx(s.Cell,{label:String(o.id)}),e.jsx(s.Cell,{label:o.name}),e.jsx(s.Cell,{label:o.email}),e.jsx(s.Cell,{label:o.phone}),e.jsx(s.Cell,{label:o.archivedAt?"Inativo":"Ativo"}),e.jsx(s.Action,{children:e.jsx(U,{isActive:!o.archivedAt,storeId:String(o.id),name:o.name,handleDisableStoreInfo:j})})]},o.id))}),e.jsx(s.Footer,{currentStartItem:r==null?void 0:r.page,totalItems:l==null?void 0:l.total,onClickNavigateBtn:S,isLoading:g})]})]})}function X(){const a=R();return e.jsxs("div",{className:"flex flex-col gap-4 h-full w-full",children:[e.jsx(P,{title:"Lojas",children:e.jsx(h,{label:"Adicionar loja",iconLeft:"AddBusiness",onClick:()=>a("/stores/new"),resource:"STORES",action:"CREATE",color:"green","data-cy":"new-store-button"})}),e.jsx(W,{})]})}function le(){return e.jsx(Q,{children:e.jsx(X,{})})}export{le as default};
