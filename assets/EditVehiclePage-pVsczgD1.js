import{l as g,u as C,b as j,c as E,p as y,f as F,d as P,r as b,j as e,S as w,m,e as p}from"./index-qW6Jgc2x.js";import{F as N}from"./schemas-DhckABRc.js";import{P as q}from"./FieldArray-B1248Sy6.js";import{P as A}from"./PageHeader-Duldp10i.js";import{a as R}from"./index-CGkwpitV.js";import{s as T}from"./selectVehicleInfo-BksJfRaS.js";import{V as $}from"./VehicleTabs-CkS8BFIQ.js";import"./useButtonState-D4P9Pwdl.js";import"./index-CImUiWf5.js";import"./ColorPreview-Bd9aKzTE.js";import"./Section--reUab6O.js";import"./PaymentForm-DXcpSWPI.js";import"./Select-C7MuPilF.js";import"./dialog-D5XMW0Vt.js";import"./DataField-ChWFe_Y0.js";import"./Choice-RetwyA5o.js";import"./selectStoresInfo-BETvLGyR.js";import"./selectBrandsInfo-VDxn_10s.js";function B(){const n=g(),{safeFetch:u}=C(),{showSuccessSnackbar:d}=j(),r=E(),{vehicleId:t}=y();async function f(){const c=await u(`${p}/vehicles/${t}`,{resource:"VEHICLES",action:"READ"}),{payment:s,vehicleCharacteristicValues:o,...l}=c;return{payment:{...s,value:"7000000"},vehicle:{...l,vehicleCharacteristicValues:o.map(a=>a==null?void 0:a.characteristic)}}}const{data:i,isFetching:v}=F({queryKey:["vehicle",t],queryFn:f,select:T});async function x({characteristics:c,payment:s,vehicle:o}){const l=[...c.commonCharacteristics,...c.newCharacteristics.map(a=>a.description)];await u(`${p}/vehicles/${t}`,{method:"PATCH",body:{...o,characteristics:l,payment:{purchaseDate:(s==null?void 0:s.purchaseDate)??"",paidTo:(s==null?void 0:s.paidTo)??""}},resource:"VEHICLES",action:"UPDATE"})}const{mutate:V,isPending:S,isSuccess:h}=P({mutationFn:x,onSuccess:()=>{d({title:`Veículo ${i==null?void 0:i.vehicle.modelName} atualizado com sucesso`}),n("/vehicles"),r.invalidateQueries({queryKey:["vehicles"]})}});return b.useEffect(()=>()=>{h&&r.invalidateQueries({queryKey:["vehicle",t]})},[h,r,t]),v?e.jsx("div",{className:"flex justify-center items-center h-full w-full",children:e.jsx(w,{})}):i&&e.jsx("div",{className:"flex flex-col gap-4 w-full",children:e.jsxs(N,{onSubmit:V,className:"flex-1 flex flex-col gap-4",schema:R,defaultValues:{characteristics:i.characteristics,payment:i.payment,vehicle:i.vehicle},children:[e.jsx(A,{title:"Alterar veículo"}),e.jsx($,{isEdit:!0,purchaseValue:i.purchaseValue}),e.jsxs(q,{dirty:!0,primaryBtnState:S?"loading":void 0,children:[e.jsx(m,{color:"lightBlue",iconRight:"Save",label:"Salvar"}),e.jsx(m,{color:"red",iconRight:"Close",label:"Cancelar",onClick:()=>n("/vehicles")})]})]})})}function ee(){return e.jsx(B,{})}export{ee as default};
