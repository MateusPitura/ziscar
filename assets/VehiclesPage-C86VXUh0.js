import{r as d,j as e,a as j,V as v,u as S,b as A,c as P,d as N,B as H,e as g,v as C,f as T,T as b,g as x,h as k,i as l,I as q}from"./index-CDuUmDit.js";import{P as R}from"./PageHeader-B5SIBKuZ.js";import{S as D,T as r}from"./Table-DGenUfom.js";import{u as w}from"./DialogContext-28MRl5PT.js";import{u as y,f as I}from"./react-pdf.browser-BH4xx2Am.js";import{E as M}from"./ExportButton-cBBOA7--.js";import{D as E}from"./Dialog-BW0_p7Tw.js";import{F as K,I as F}from"./schemas-CxmGnStq.js";import{u as _}from"./useButtonState-DJFFoANO.js";import{S as Q}from"./index-i8uBxv0L.js";import{u as $}from"./useDialogContext-cToDCl1e.js";import"./dialog-3JPZnGOG.js";import"./useIsFetching-CQOvAVOi.js";import"./index-Bov_tmPN.js";const Y=d.createContext(null);function z({children:a}){const[n,t]=d.useState("");function c(u){t(u)}const i=d.useMemo(()=>({example:n,handleExample:c}),[n]);return e.jsx(Y.Provider,{value:i,children:a})}function G(a){const n=[];for(const t of a.data)n.push({...t,announcedPrice:j(t.announcedPrice,"money")??"",plateNumber:j(t.plateNumber,"plateNumber")??"",modelYear:t.modelYear?String(t.modelYear):""});return{total:a.total,data:n}}function U(a){const n=[];for(const t of a.data)n.push({...t,announcedPrice:j(t.announcedPrice,"money")??"",plateNumber:j(t.plateNumber,"plateNumber")??"",status:v[t.status]});return n}function O({vehicleId:a,plateNumber:n,...t}){const{safeFetch:c}=S(),{showSuccessSnackbar:i}=A(),u=P(),{handleVehiclesFilter:h}=y();async function f(){await c(`${g}/vehicles/${a}/archive`,{method:"PATCH",resource:"VEHICLES",action:"DELETE"})}const{mutate:m,isPending:p}=N({mutationFn:f,onSuccess:()=>{h({page:1}),u.invalidateQueries({queryKey:["vehicles"]}),i({title:`Veículo ${n} desativado com sucesso`}),t.closeDialog()}});return e.jsxs(E,{...t,children:[e.jsx(E.Header,{title:"Desativar veículo"}),e.jsx(E.Body,{children:e.jsxs("span",{className:"text-body-medium text-neutral-700",children:["Tem certeza que deseja desativar o veículo",e.jsxs("span",{className:"font-bold",children:[H,n]}),"? Ao desativar os registros relacionados a ele não serão mais acessíveis"]})}),e.jsx(E.Footer,{labelPrimaryBtn:"Desativar",onClickPrimaryBtn:m,primaryBtnState:p?"loading":void 0,primaryBtnColor:"red",primaryBtnResource:"VEHICLES",primaryBtnAction:"DELETE"})]})}function X(){const{vehiclesFilter:a,handleVehiclesFilter:n}=y(),{closeDialog:t}=$();function c(i){n({page:1,...i}),t()}return e.jsx(K,{schema:Q,onSubmit:c,className:"flex-1 flex flex-col min-h-0",defaultValues:{startDate:(a==null?void 0:a.startDate)||"",endDate:(a==null?void 0:a.endDate)||""},replaceEmptyStringToNull:!1,children:e.jsx(J,{})})}function J(){const{reset:a}=_(),{handleVehiclesFilter:n}=y(),{closeDialog:t}=$();function c(){n(C),a(C),t()}return e.jsxs(e.Fragment,{children:[e.jsxs(D.Body,{className:"flex flex-col gap-4",children:[e.jsx(F,{name:"startDate",label:"Data inicial de criação",type:"date"}),e.jsx(F,{name:"endDate",label:"Data final de criação",type:"date"})]}),e.jsx(D.Footer,{primaryLabel:"Aplicar",secondaryLabel:"Limpar",onSecondaryCallback:c,dirty:!0})]})}const W=d.memo(X);function Z({vehicleId:a,plateNumber:n,isActive:t,handleDisableVehicleInfo:c}){const i=T(),{safeFetch:u}=S(),{showSuccessSnackbar:h}=A(),f=P();async function m(){await u(`${g}/vehicles/${a}/unarchive`,{method:"PATCH",resource:"VEHICLES",action:"DELETE"})}const{mutate:p,isPending:s}=N({mutationFn:m,onSuccess:()=>{f.invalidateQueries({queryKey:["vehicles"]}),h({title:`Veículo ${n} ativado com sucesso`})}});return t?e.jsxs(e.Fragment,{children:[e.jsx(b,{content:"Vender",children:e.jsx(x,{variant:"quaternary",iconLeft:"CurrencyExchange",onClick:()=>i(`/vehicle-sale/new/${a}`),resource:"VEHICLE_SALE",action:"CREATE",padding:"none","data-cy":`button-vehicleSale-${a}`})}),e.jsx(b,{content:"Editar",children:e.jsx(x,{variant:"quaternary",iconLeft:"Edit",onClick:()=>i(`/vehicles/edit/${a}`),resource:"VEHICLES",action:"UPDATE",padding:"none","data-cy":`button-edit-vehicle-${a}`})}),e.jsx(b,{content:"Gastos",children:e.jsx(x,{variant:"quaternary",iconLeft:"History",onClick:()=>i(`/vehicles/expense/${a}`),resource:"VEHICLE_EXPENSE",action:"READ",padding:"none","data-cy":`button-vehicle-expense-${a}`})}),e.jsx(b,{content:"Desativar",children:e.jsx(x,{variant:"primary",iconLeft:"Delete",color:"red",padding:"none",onClick:()=>c({plateNumber:n,vehicleId:a}),resource:"VEHICLES",action:"DELETE","data-cy":`button-disable-vehicle-${a}`})})]}):e.jsx(b,{content:"Ativar",children:e.jsx(x,{variant:"quaternary",onClick:p,state:s?"loading":void 0,resource:"VEHICLES",action:"DELETE",padding:"none",iconLeft:"ToggleOn","data-cy":`button-enable-vehicle-${a}`})})}const L=7;function ee(){const[a,n]=d.useState({plateNumber:"",vehicleId:""}),t=w(),{safeFetch:c}=S(),{vehiclesFilter:i,handleVehiclesFilter:u}=y();function h(o){t.openDialog(),n(o)}function f(o){u({page:o})}const m=d.useMemo(()=>i?I(i):"",[i]);async function p(o){return await c(`${g}/vehicles?${o}&limit=${q}`,{resource:"VEHICLES",action:"READ"})}const{data:s,isFetching:V}=k({queryKey:["vehicles",m],queryFn:({queryKey:o})=>p(o[1]),select:G}),B=d.useMemo(()=>s!=null&&s.data.length?Math.max(...s.data.map(o=>o.announcedPrice.length)):0,[s==null?void 0:s.data]);return e.jsxs(e.Fragment,{children:[e.jsx(O,{...a,...t}),e.jsxs("div",{className:"flex gap-4 justify-end",children:[e.jsx(M,{fileName:"Relatório Veículos",queryKey:["vehicles",m],queryFn:p,selectQueryFn:U,formatFilters:{endDate:"Data final",startDate:"Data inicial"},formatFiltersValues:{},formatColumns:{announcedPrice:"Preço anunciado",modelName:"Modelo",plateNumber:"Placa",modelYear:"Ano do modelo",status:"Status",archivedAt:"Ativo"}}),e.jsx(r.Filter,{form:e.jsx(W,{})})]}),e.jsxs(r,{children:[e.jsxs(r.Header,{gridColumns:L,children:[e.jsx(r.Head,{label:l.model.label}),e.jsx(r.Head,{label:l.plate.label,colSpan:l.plate.colSpan}),e.jsx(r.Head,{label:l.year.label,colSpan:l.year.colSpan}),e.jsx(r.Head,{label:l.price.label,colSpan:l.price.colSpan}),e.jsx(r.Head,{label:l.status.label,colSpan:l.status.colSpan}),e.jsx(r.Head,{action:!0})]}),e.jsx(r.Body,{isLoading:V,isEmpty:!(s!=null&&s.total),resource:"VEHICLES",action:"READ",children:s==null?void 0:s.data.map(o=>e.jsxs(r.Row,{gridColumns:L,children:[e.jsx(r.Cell,{label:o.modelName,columnLabel:l.model.label}),e.jsx(r.Cell,{label:o.plateNumber,colSpan:l.plate.colSpan,columnLabel:l.plate.label}),e.jsx(r.Cell,{label:o.modelYear,colSpan:l.year.colSpan,columnLabel:l.year.label}),e.jsx(r.Cell,{label:o.announcedPrice.padStart(B,H),columnLabel:l.price.label,className:"font-mono xl:whitespace-pre",colSpan:l.price.colSpan}),e.jsx(r.Cell,{columnLabel:l.status.label,label:o.archivedAt?"Inativo":v[o.status],colSpan:l.status.colSpan}),e.jsx(r.Action,{children:e.jsx(Z,{isActive:!o.archivedAt,vehicleId:String(o.id),plateNumber:o.plateNumber,handleDisableVehicleInfo:h})})]},o.id))}),e.jsx(r.Footer,{currentStartItem:i==null?void 0:i.page,totalItems:s==null?void 0:s.total,onClickNavigateBtn:f,isLoading:V})]})]})}function ae(){const a=T();return e.jsxs("div",{className:"flex flex-col gap-4 h-full w-full",children:[e.jsx(R,{title:"Veículos Disponíveis",children:e.jsx(x,{label:"Adicionar veículo",iconLeft:"Add",onClick:()=>a("/vehicles/new"),resource:"VEHICLES",action:"CREATE",color:"green","data-cy":"new-vehicle-button"})}),e.jsx(ee,{})]})}function fe(){return e.jsx(z,{children:e.jsx(ae,{})})}export{fe as default};
