import{i as g,u as C,b as E,c as j,n as y,f as F,d as b,r as P,j as e,S as N,k as m,e as p}from"./index-C8Hi2I9-.js";import{F as w}from"./schemas-ARZMo_di.js";import{P as T}from"./FieldArray-CybTVLLQ.js";import{P as q}from"./PageHeader-C3bsmlao.js";import{b as A}from"./index-CziveuU3.js";import{s as R}from"./selectVehicleInfo-6C27XIza.js";import{V as $}from"./VehicleTabs-D6nlTzvn.js";import"./useButtonState-D8nv53KZ.js";import"./index-Bn3msv5N.js";import"./ColorPreview-ffavdapq.js";import"./Section-BPNV-L4z.js";import"./PaymentForm-7RTJENqF.js";import"./Select-DaT4dAtZ.js";import"./dialog-DBF6ydzz.js";import"./DataField-CDqrsgkO.js";import"./Choice-DK2qdk0A.js";import"./selectStoresInfo-wIZFmsaX.js";import"./selectBrandsInfo-VDxn_10s.js";function k(){const n=g(),{safeFetch:u}=C(),{showSuccessSnackbar:d}=E(),c=j(),{vehicleId:t}=y();async function f(){const r=await u(`${p}/vehicles/${t}`,{resource:"VEHICLES",action:"READ"}),{payment:s,vehicleCharacteristicValues:o,...l}=r;return{payment:s,vehicle:{...l,vehicleCharacteristicValues:o.map(a=>a==null?void 0:a.characteristic)}}}const{data:i,isFetching:v}=F({queryKey:["vehicle",t],queryFn:f,select:R});async function x({characteristics:r,payment:s,vehicle:o}){const l=[...r.commonCharacteristics,...r.newCharacteristics.map(a=>a.description)];await u(`${p}/vehicles/${t}`,{method:"PATCH",body:{...o,characteristics:l,payment:{purchaseDate:s==null?void 0:s.purchaseDate,paidTo:s==null?void 0:s.paidTo}},resource:"VEHICLES",action:"UPDATE"})}const{mutate:S,isPending:V,isSuccess:h}=b({mutationFn:x,onSuccess:()=>{d({title:`Veículo ${i==null?void 0:i.vehicle.modelName} atualizado com sucesso`}),n("/vehicles"),c.invalidateQueries({queryKey:["vehicles"]})}});return P.useEffect(()=>()=>{h&&c.invalidateQueries({queryKey:["vehicle",t]})},[h,c,t]),v?e.jsx("div",{className:"flex justify-center items-center h-full w-full",children:e.jsx(N,{})}):i&&e.jsx("div",{className:"flex flex-col gap-4 w-full",children:e.jsxs(w,{onSubmit:S,className:"flex-1 flex flex-col gap-4",schema:A,replaceEmptyStringToNull:!0,defaultValues:{characteristics:i.characteristics,payment:i.payment,vehicle:i.vehicle},children:[e.jsx(q,{title:"Alterar veículo"}),e.jsx($,{isEdit:!0,purchaseValue:i.purchaseValue}),e.jsxs(T,{dirty:!0,primaryBtnState:V?"loading":void 0,children:[e.jsx(m,{color:"lightBlue",iconRight:"Save",label:"Salvar"}),e.jsx(m,{color:"red",iconRight:"Close",label:"Cancelar",onClick:()=>n("/vehicles")})]})]})})}function ee(){return e.jsx(k,{})}export{ee as default};
