import{r as l,b as A,c as v,h as m,C as g,j as s,D as V,E as w}from"./index-CV0TP6Xw.js";import{u as I,I as n}from"./index-D0UprIr6.js";import{F as k,a as h}from"./PageFooter-wK_25X2U.js";function L(){const[u,y]=l.useState(""),{setValue:a,trigger:C,getValues:x,watch:c}=I(),{safeFetch:p}=A(),{showErrorSnackbar:b}=v();async function F(e){return await p(`https://viacep.com.br/ws/${e}/json/`,{enableCookie:!1})}const{data:r,isFetching:t}=m({queryKey:["cepApi",u],queryFn:({queryKey:e})=>F(e[1]),enabled:!!u});l.useEffect(()=>{if(r!=null&&r.erro){b({description:"CEP não encontrado"});return}r&&(a("address.0.street",r.logradouro,{shouldDirty:!0}),a("address.0.neighborhood",r.bairro,{shouldDirty:!0}),a("address.0.cityIbgeCode",r.ibge,{shouldDirty:!0}),a("address.0.state",r.uf,{shouldDirty:!0}))},[r,a,b]);async function E(e){return e?await p(`https://servicodados.ibge.gov.br/api/v1/localidades/estados/${e}/municipios`,{enableCookie:!1}):[]}const o=c("address.0.state"),{data:j,isFetching:S}=m({queryKey:["ibgeApi",o],queryFn:({queryKey:e})=>E(e[1]),enabled:!!o,select:e=>e==null?void 0:e.map(i=>({value:String(i.id),label:i.nome}))});async function f(){if(await C("address.0.cep")){const i=x("address.0.cep");y(i)}}const d=c("address.0.cep");l.useEffect(()=>{(d==null?void 0:d.length)===g&&f()},[d]);function D(e){e.key==="Enter"&&(e.preventDefault(),f())}return s.jsx(k,{name:"address",appendText:"Adicionar endereço",removeText:"Remover endereço",maxLength:1,appendDefaultValues:V,render:()=>s.jsxs(s.Fragment,{children:[s.jsx("div",{onKeyDown:D,children:s.jsx(n,{label:"CEP",name:"address.0.cep",mask:"cep",maxLength:g,required:!0,forceUnselect:!0,disabled:t})}),s.jsx(n,{label:"Número",name:"address.0.number",required:!0}),s.jsx(n,{label:"Rua",name:"address.0.street",disabled:t}),s.jsx(n,{label:"Bairro",name:"address.0.neighborhood",disabled:t}),s.jsx(h,{label:"Estado",name:"address.0.state",options:w,onChange:()=>a("address.0.cityIbgeCode","",{shouldDirty:!0}),disabled:t}),s.jsx(h,{label:"Cidade",name:"address.0.cityIbgeCode",options:j||[],loading:S,disabled:!o})]})})}export{L as A};
