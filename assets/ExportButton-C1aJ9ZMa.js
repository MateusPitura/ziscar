import{j as e,w as R,c as N,b as O,l as k,I as z}from"./index-PgcJxcI8.js";import{V as s,S as C,I,T as u,D as P,P as T,p as M}from"./react-pdf.browser-C5RSsOmp.js";import{u as V}from"./useIsFetching-D-bzNACg.js";function W({formatFilters:t,formatFiltersValues:r,queryKey:o}){const i={};for(const d of o[1].split("&")){const[c,h]=d.split("=");if(c==="page")continue;const x=t[c],y=r[c];y?i[x]=y[h]:i[x]=G(h,c)}return i}function G(t,r){if(r.toLowerCase().includes("price")||r.toLowerCase().includes("value")){const o=parseInt(t);if(!isNaN(o))return`R$ ${(o/100).toLocaleString("pt-BR",{minimumFractionDigits:2,maximumFractionDigits:2})}`}if(r.toLowerCase().includes("date")){const o=new Date(t);if(!isNaN(o.getTime()))return o.toLocaleDateString("pt-BR")}return t}function U(t){return[/price/i,/value/i,/amount/i,/cost/i,/total/i,/^r\$/i].some(o=>o.test(t))}const g=C.create({header:{height:40,flexDirection:"row",marginBottom:10,paddingBottom:10,backgroundColor:"#FFFFFF"},gridColumn:{flex:1,minHeight:40},centerContainer:{alignItems:"center",justifyContent:"center"},title:{fontSize:14,fontWeight:"bold",marginBottom:2,textAlign:"center"},subtitle:{fontSize:9,color:"#666666",textAlign:"center"},logoContainer:{marginBottom:"-20px",marginTop:"-20px",marginLeft:"-10px"}});function A({title:t}){return e.jsxs(s,{style:g.header,fixed:!0,children:[e.jsx(s,{style:g.gridColumn,children:e.jsx(s,{style:g.logoContainer,children:e.jsx(I,{src:"/FullLogo.png",style:{width:160,height:90}})})}),e.jsx(s,{style:g.gridColumn,children:e.jsxs(s,{style:g.centerContainer,children:[e.jsx(u,{style:g.title,children:t}),e.jsxs(u,{style:g.subtitle,children:["Gerado em"," ",R({date:new Date,format:"dd/MM/yyyy HH:mm"})]})]})}),e.jsx(s,{style:g.gridColumn})]})}const D=C.create({tableRow:{flexDirection:"row",minHeight:20,marginTop:3,backgroundColor:"#F8F9FA"},tableColHeader:{borderStyle:"solid",borderLeftWidth:.5,borderBottomWidth:.5,borderColor:"#DDDDDD",padding:4,justifyContent:"center",alignItems:"center"},tableCellHeader:{fontSize:11,fontWeight:"bold"}});function Q({keys:t,formatColumns:r,columnWidth:o}){return e.jsx(s,{style:D.tableRow,fixed:!0,children:t.map(i=>e.jsx(s,{style:[D.tableColHeader,{width:o}],children:e.jsx(u,{style:D.tableCellHeader,children:r[i]})},i))})}const S=C.create({footer:{position:"absolute",bottom:15,left:15,right:15,flexDirection:"row",justifyContent:"space-between",alignItems:"center",paddingTop:8},recordsCounter:{fontSize:10,color:"#666666",flex:1,textAlign:"center"},pageNumber:{fontSize:10,color:"#666666"}});function E({totalRecords:t,itemsPerPage:r}){return e.jsxs(s,{style:S.footer,fixed:!0,children:[e.jsx(s,{style:{width:50}}),e.jsx(u,{style:S.recordsCounter,render:({pageNumber:o})=>{if(!t)return;const i=(o-1)*r,d=Math.min(i+r,t);return`${i+1} a ${d} de ${t} itens`}}),e.jsx(u,{style:S.pageNumber,render:({pageNumber:o,totalPages:i})=>`Página ${o}/${i}`})]})}const l=C.create({page:{flexDirection:"column",backgroundColor:"#FFFFFF",padding:15,paddingBottom:25},content:{flex:1},emptyState:{textAlign:"center",marginTop:30},emptyText:{fontSize:16,color:"#666666"},tableContainer:{marginTop:0},tableRow:{flexDirection:"row",minHeight:20},tableRowAlternate:{backgroundColor:"#F0F0F0"},tableCol:{borderStyle:"solid",borderLeftWidth:.25,borderColor:"#DDDDDD",padding:4,justifyContent:"center"},tableColNumeric:{alignItems:"flex-end"},tableCell:{fontSize:10,color:"#000000"},filtersSection:{paddingBottom:8},filtersText:{fontSize:9,color:"#374151",lineHeight:1.4}});function _({data:t,formatColumns:r,title:o,appliedFilters:i}){const d=i&&Object.keys(i).length>0;if(!t||t.length===0)return e.jsx(P,{children:e.jsxs(T,{size:"A4",orientation:"landscape",style:l.page,children:[e.jsx(A,{title:o}),d&&e.jsx(s,{style:l.filtersSection,children:e.jsxs(u,{style:l.filtersText,children:["Filtros aplicados:"," ",Object.entries(i).map(([n,a])=>`${n}: ${a}`).join("; ")]})}),e.jsx(s,{style:l.content,children:e.jsx(s,{style:l.emptyState,children:e.jsx(u,{style:l.emptyText,children:"Nenhum dado encontrado"})})}),e.jsx(E,{totalRecords:0,itemsPerPage:16})]})});const c=Object.keys(r).filter(n=>{var a;return r[n]&&((a=t[0])==null?void 0:a[n])!==void 0}),h=`${100/c.length}%`,x=d?20:22,y=(n,a)=>a==="archivedAt"?n?"Não":"Sim":n==null?"-":typeof n=="boolean"?n?"Sim":"Não":typeof n=="object"?JSON.stringify(n):String(n);return e.jsx(P,{children:e.jsxs(T,{size:"A4",orientation:"landscape",style:l.page,children:[e.jsx(A,{title:o}),d&&e.jsx(s,{style:l.filtersSection,children:e.jsxs(u,{style:l.filtersText,children:["Filtros aplicados:"," ",Object.entries(i).map(([n,a])=>`${n}: ${a}`).join("; ")]})}),e.jsx(Q,{keys:c,formatColumns:r,columnWidth:h}),e.jsx(s,{style:l.content,children:e.jsx(s,{style:l.tableContainer,children:t.map((n,a)=>e.jsx(s,{style:[l.tableRow,...a%2===1?[l.tableRowAlternate]:[]],wrap:!1,minPresenceAhead:8,children:c.map(b=>{const m=U(b);return e.jsx(s,{style:[l.tableCol,{width:h},...m?[l.tableColNumeric]:[]],children:e.jsx(u,{style:l.tableCell,children:y(n[b],b)})},b)})},`row-${a}`))})}),e.jsx(E,{totalRecords:t.length,itemsPerPage:x})]})})}function X({fileName:t,queryKey:r,queryFn:o,selectQueryFn:i,formatColumns:d,formatFilters:c,formatFiltersValues:h}){const x=N(),{showErrorSnackbar:y,showSuccessSnackbar:n}=O(),a=V({queryKey:[r[0]]});async function b(){if(!r)throw new Error;const m=x.getQueryData(r);if(!m)throw new Error;const F=Math.ceil((m==null?void 0:m.total)/z),j=[];for(let f=1;f<=F;f++){const p=r[1],w=/page=\d+/,B=p==null?void 0:p.replace(w,`page=${f}`),H=x.fetchQuery({queryKey:[r[0],B],queryFn:({queryKey:L})=>o(L[1])});j.push(H)}return(await Promise.all(j)).flatMap(f=>i(f))}return e.jsx(k,{variant:"primary",color:"darkBlue",tooltipMessage:"Gerar relatório PDF",label:"Gerar relatório PDF",iconRight:"FileDownload",state:a?"loading":void 0,resource:"REPORTS",action:"CREATE","data-cy":"export-button",onClick:async()=>{const m=n({title:"O PDF está sendo gerado",actionBtnAction:"CREATE",actionBtnResource:"REPORTS"});try{const F=await b(),j=W({queryKey:r,formatFilters:c,formatFiltersValues:h}),$=await M(e.jsx(_,{data:F,formatColumns:d,title:t,appliedFilters:j})).toBlob();m.dismiss();const f=URL.createObjectURL($),p=document.createElement("a");p.href=f;const w=`${t} ${R({date:new Date,format:"dd-MM-yyyy"})} ${R({date:new Date,format:"HH-mm"})}.pdf`;p.download=w,p.click(),URL.revokeObjectURL(f)}catch{m.dismiss(),y({description:"Ocorreu um erro ao gerar o PDF"})}}})}export{X as E};
