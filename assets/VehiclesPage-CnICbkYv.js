import{r as b,j as e,a as C,V,u as L,b as F,c as M,d as I,B as H,e as j,f as D,g as R,h as k,M as q,Y as w,v as N,i as v,T as g,k as E,l as r,I as O}from"./index-C8Hi2I9-.js";import{P as _}from"./PageHeader-C3bsmlao.js";import{S as A,T as c}from"./Table-DwjZzqAC.js";import{u as Y}from"./DialogContext-DTkaQtxz.js";import{u as P,f as K}from"./react-pdf.browser-BXhLJome.js";import{E as Q}from"./ExportButton-zBvyv4kA.js";import{V as U,S as z,a as G}from"./index-CziveuU3.js";import{D as S}from"./Dialog-BSVWjxlV.js";import{F as X,I as f}from"./schemas-ARZMo_di.js";import{S as y}from"./Select-DaT4dAtZ.js";import{u as J}from"./useButtonState-D8nv53KZ.js";import{u as $}from"./useDialogContext-C__WYHYu.js";import{s as W}from"./selectStoresInfo-wIZFmsaX.js";import{s as Z}from"./selectBrandsInfo-VDxn_10s.js";import"./dialog-DBF6ydzz.js";import"./useIsFetching-B7K5de3P.js";import"./index-Bn3msv5N.js";const ee=b.createContext(null);function ae({children:a}){const[n,t]=b.useState("");function u(d){t(d)}const l=b.useMemo(()=>({example:n,handleExample:u}),[n]);return e.jsx(ee.Provider,{value:l,children:a})}function te(a){const n=[];for(const t of a.data)n.push({...t,announcedPrice:C(t.announcedPrice,"money")??"",plateNumber:C(t.plateNumber,"plateNumber")??"",modelYear:t.modelYear?String(t.modelYear):""});return{total:a.total,data:n}}function ne(a){const n=[];for(const t of a.data)n.push({...t,announcedPrice:C(t.announcedPrice,"money")??"",plateNumber:C(t.plateNumber,"plateNumber")??"",status:t.archivedAt?V[U]:V[t.status]});return n}function oe({vehicleId:a,plateNumber:n,...t}){const{safeFetch:u}=L(),{showSuccessSnackbar:l}=F(),d=M(),{handleVehiclesFilter:m}=P();async function p(){await u(`${j}/vehicles/${a}/archive`,{method:"PATCH",resource:"VEHICLES",action:"DELETE"})}const{mutate:i,isPending:x}=I({mutationFn:p,onSuccess:()=>{m({page:1}),d.invalidateQueries({queryKey:["vehicles"]}),l({title:`Veículo ${n} desativado com sucesso`}),t.closeDialog()}});return e.jsxs(S,{...t,children:[e.jsx(S.Header,{title:"Desativar veículo"}),e.jsx(S.Body,{children:e.jsxs("span",{className:"text-body-medium text-neutral-700",children:["Tem certeza que deseja desativar o veículo",e.jsxs("span",{className:"font-bold",children:[H,n]}),"? Ao desativar os registros relacionados a ele não serão mais acessíveis"]})}),e.jsx(S.Footer,{labelPrimaryBtn:"Desativar",onClickPrimaryBtn:i,primaryBtnState:x?"loading":void 0,primaryBtnColor:"red",primaryBtnResource:"VEHICLES",primaryBtnAction:"DELETE"})]})}function se(){const{vehiclesFilter:a,handleVehiclesFilter:n}=P(),{closeDialog:t}=$(),{safeFetch:u}=L();async function l(){return await u(`${j}/store?orderBy=name`,{resource:"STORES",action:"READ"})}const{data:d,isFetching:m}=D({queryKey:["stores"],queryFn:l,select:W});async function p(){return await u(`${j}/vehicles/brands`)}const{data:i,isFetching:x}=D({queryKey:["brands"],queryFn:p,select:Z});function o(h){n({page:1,...h}),t()}return e.jsx(X,{schema:z,onSubmit:o,className:"flex-1 flex flex-col min-h-0",defaultValues:{startDate:(a==null?void 0:a.startDate)||"",endDate:(a==null?void 0:a.endDate)||"",storeId:(a==null?void 0:a.storeId)||"",brandId:(a==null?void 0:a.brandId)||"",status:(a==null?void 0:a.status)||"",category:(a==null?void 0:a.category)||"",modelYear:(a==null?void 0:a.modelYear)||"",yearOfManufacture:(a==null?void 0:a.yearOfManufacture)||"",modelName:(a==null?void 0:a.modelName)||"",plateNumber:(a==null?void 0:a.plateNumber)||"",announcedPriceMin:(a==null?void 0:a.announcedPriceMin)||"",announcedPriceMax:(a==null?void 0:a.announcedPriceMax)||""},replaceEmptyStringToNull:!1,children:e.jsx(le,{storesInfo:d,isFetchingStoresInfo:m,brandsInfo:i,isFetchingBrandsInfo:x})})}function le({storesInfo:a,isFetchingStoresInfo:n,brandsInfo:t,isFetchingBrandsInfo:u}){const{reset:l}=J(),{handleVehiclesFilter:d}=P(),{closeDialog:m}=$();function p(){d(N),l(N),m()}return e.jsxs(e.Fragment,{children:[e.jsxs(A.Body,{className:"flex flex-col gap-4 max-h-[82vh] overflow-y-auto",children:[e.jsx(f,{name:"modelName",label:"Modelo",placeholder:"Nome do modelo"}),e.jsx(f,{name:"plateNumber",label:"Placa",placeholder:"ABC-1234",mask:"plateNumber",maxLength:8}),e.jsx(y,{name:"storeId",label:"Loja",options:[{value:"",label:"Todas as lojas"},...(a==null?void 0:a.data.map(i=>({value:String(i.id),label:String(i.name)})))??[]],loading:n}),e.jsx(y,{name:"status",label:"Status",options:[{value:"",label:"Todos os status"},...Object.values(G).map(i=>({value:i,label:V[i]}))]}),e.jsx(y,{name:"brandId",label:"Marca",options:[{value:"",label:"Todas as marcas"},...t??[]],loading:u}),e.jsx(y,{name:"category",label:"Categoria",options:[{value:"",label:"Todas as categorias"},...Object.values(R).map(i=>({value:i,label:k[i]}))]}),e.jsx(y,{name:"modelYear",label:"Ano do modelo",options:[{value:"",label:"Todos os anos"},...q]}),e.jsx(y,{name:"yearOfManufacture",label:"Ano de fabricação",options:[{value:"",label:"Todos os anos"},...w]}),e.jsx(f,{name:"announcedPriceMin",label:"Preço anunciado mínimo",mask:"money",placeholder:"R$ 0,00"}),e.jsx(f,{name:"announcedPriceMax",label:"Preço anunciado máximo",mask:"money",placeholder:"R$ 0,00"}),e.jsx(f,{name:"startDate",label:"Data inicial de criação",type:"date"}),e.jsx(f,{name:"endDate",label:"Data final de criação",type:"date"})]}),e.jsx(A.Footer,{primaryLabel:"Aplicar",secondaryLabel:"Limpar",onSecondaryCallback:p,dirty:!0})]})}const re=b.memo(se);function ce({vehicleId:a,plateNumber:n,isActive:t,handleDisableVehicleInfo:u}){const l=v(),{safeFetch:d}=L(),{showSuccessSnackbar:m}=F(),p=M();async function i(){await d(`${j}/vehicles/${a}/unarchive`,{method:"PATCH",resource:"VEHICLES",action:"DELETE"})}const{mutate:x,isPending:o}=I({mutationFn:i,onSuccess:()=>{p.invalidateQueries({queryKey:["vehicles"]}),m({title:`Veículo ${n} ativado com sucesso`})}});return t?e.jsxs(e.Fragment,{children:[e.jsx(g,{content:"Vender",children:e.jsx(E,{variant:"quaternary",iconLeft:"CurrencyExchange",onClick:()=>l(`/vehicle-sale/new/${a}`),resource:"VEHICLE_SALE",action:"CREATE",padding:"none","data-cy":`button-vehicleSale-${a}`})}),e.jsx(g,{content:"Editar",children:e.jsx(E,{variant:"quaternary",iconLeft:"Edit",onClick:()=>l(`/vehicles/edit/${a}`),resource:"VEHICLES",action:"UPDATE",padding:"none","data-cy":`button-edit-vehicle-${a}`})}),e.jsx(g,{content:"Gastos",children:e.jsx(E,{variant:"quaternary",iconLeft:"History",onClick:()=>l(`/vehicles/expense/${a}`),resource:"VEHICLE_EXPENSE",action:"READ",padding:"none","data-cy":`button-vehicle-expense-${a}`})}),e.jsx(g,{content:"Desativar",children:e.jsx(E,{variant:"primary",iconLeft:"Delete",color:"red",padding:"none",onClick:()=>u({plateNumber:n,vehicleId:a}),resource:"VEHICLES",action:"DELETE","data-cy":`button-disable-vehicle-${a}`})})]}):e.jsx(g,{content:"Ativar",children:e.jsx(E,{variant:"quaternary",onClick:x,state:o?"loading":void 0,resource:"VEHICLES",action:"DELETE",padding:"none",iconLeft:"ToggleOn","data-cy":`button-enable-vehicle-${a}`})})}const T=7;function ie(){const[a,n]=b.useState({plateNumber:"",vehicleId:""}),t=Y(),{safeFetch:u}=L(),{vehiclesFilter:l,handleVehiclesFilter:d}=P();function m(s){t.openDialog(),n(s)}function p(s){d({page:s})}const i=b.useMemo(()=>l?K(l):"",[l]);async function x(s){return await u(`${j}/vehicles?${s}&limit=${O}`,{resource:"VEHICLES",action:"READ"})}const{data:o,isFetching:h}=D({queryKey:["vehicles",i],queryFn:({queryKey:s})=>x(s[1]),select:te}),B=b.useMemo(()=>o!=null&&o.data.length?Math.max(...o.data.map(s=>s.announcedPrice.length)):0,[o==null?void 0:o.data]);return e.jsxs(e.Fragment,{children:[e.jsx(oe,{...a,...t}),e.jsxs("div",{className:"flex gap-4 justify-end",children:[e.jsx(Q,{fileName:"Relatório Veículos",queryKey:["vehicles",i],queryFn:x,selectQueryFn:ne,formatFilters:{endDate:"Data final",startDate:"Data inicial",storeId:"Loja",brandId:"Marca",status:"Status",category:"Categoria",modelYear:"Ano do modelo",yearOfManufacture:"Ano de fabricação",modelName:"Modelo",plateNumber:"Placa",announcedPriceMin:"Preço mínimo",announcedPriceMax:"Preço máximo"},formatFiltersValues:{},formatColumns:{modelName:"Modelo",plateNumber:"Placa",modelYear:"Ano do modelo",status:"Status"}}),e.jsx(c.Filter,{form:e.jsx(re,{})})]}),e.jsxs(c,{children:[e.jsxs(c.Header,{gridColumns:T,children:[e.jsx(c.Head,{label:r.model.label}),e.jsx(c.Head,{label:r.plate.label,colSpan:r.plate.colSpan}),e.jsx(c.Head,{label:r.year.label,colSpan:r.year.colSpan}),e.jsx(c.Head,{label:r.price.label,colSpan:r.price.colSpan}),e.jsx(c.Head,{label:r.status.label,colSpan:r.status.colSpan}),e.jsx(c.Head,{action:!0})]}),e.jsx(c.Body,{isLoading:h,isEmpty:!(o!=null&&o.total),resource:"VEHICLES",action:"READ",children:o==null?void 0:o.data.map(s=>e.jsxs(c.Row,{gridColumns:T,children:[e.jsx(c.Cell,{label:s.modelName,columnLabel:r.model.label}),e.jsx(c.Cell,{label:s.plateNumber,colSpan:r.plate.colSpan,columnLabel:r.plate.label}),e.jsx(c.Cell,{label:s.modelYear,colSpan:r.year.colSpan,columnLabel:r.year.label}),e.jsx(c.Cell,{label:s.announcedPrice.padStart(B,H),columnLabel:r.price.label,className:"font-mono xl:whitespace-pre",colSpan:r.price.colSpan}),e.jsx(c.Cell,{columnLabel:r.status.label,label:s.archivedAt?"Inativo":V[s.status],colSpan:r.status.colSpan}),e.jsx(c.Action,{children:e.jsx(ce,{isActive:!s.archivedAt,vehicleId:String(s.id),plateNumber:s.plateNumber,handleDisableVehicleInfo:m})})]},s.id))}),e.jsx(c.Footer,{currentStartItem:l==null?void 0:l.page,totalItems:o==null?void 0:o.total,onClickNavigateBtn:p,isLoading:h})]})]})}function ue(){const a=v();return e.jsxs("div",{className:"flex flex-col gap-4 h-full w-full",children:[e.jsx(_,{title:"Veículos",children:e.jsx(E,{label:"Adicionar veículo",iconLeft:"Add",onClick:()=>a("/vehicles/new"),resource:"VEHICLES",action:"CREATE",color:"green","data-cy":"new-vehicle-button"})}),e.jsx(ie,{})]})}function Ne(){return e.jsx(ae,{children:e.jsx(ue,{})})}export{Ne as default};
