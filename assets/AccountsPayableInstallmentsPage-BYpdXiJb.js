import{a as P,i as O,o as v,u as A,f as T,j as e,l as q,e as g,t as D,b as w,c as H,d as R,aF as I,a4 as U,aG as E,S as B,r as C,x as F,aH as c,B as _}from"./index-LO79eavt.js";import{u as $}from"./useIsFetching-DT0DLOnX.js";import{P as K}from"./PageHeader-C8ixiw9T.js";import{T as s}from"./Table-DGlZs8M8.js";import{A as Y}from"./AccountStatus-Cejzuycb.js";import{D as j}from"./DataField-DvGceO3C.js";import{D as b,b as k}from"./useDialog-pT-Uqh-i.js";import{F as V,I as Q,u as G}from"./schemas-C0aL5P6j.js";import{C as N}from"./Choice-BGWichA8.js";import{a as z}from"./index-DeIpTkq7.js";import"./Tag-CDvwg207.js";function J(a){return{...a,totalValue:P(a.totalValue,"money")??""}}function W({contextHelper:a}){const l=O(),{accountPayableId:u}=v(),{safeFetch:d}=A();async function n(){return await d(`${g}/account-payable/${u}`,{resource:"ACCOUNTS_PAYABLE",action:"READ"})}const{data:r}=T({queryKey:["account-payable",u],queryFn:n,select:J});return e.jsx(K,{title:r!=null&&r.description?`Detalhes do Pagamento "${r.description}"`:"Detalhes do Pagamento",contextHelper:a,children:e.jsx(q,{variant:"quaternary",label:"Voltar",tooltipMessage:"Página anterior",iconLeft:"ArrowBack",onClick:()=>l("/accounts-payable"),action:"READ",resource:"ACCOUNTS_PAYABLE","data-cy":"back-accounts-payable-button"})})}function X(a){var u,d;const l=[];for(const n of a){const r=[];for(const i of n.paymentMethodPayables)r.push({...i,paymentDate:i.paymentDate?D({date:(u=i.paymentDate)==null?void 0:u.split("T")[0],format:"dd/MM/yyyy"}):""});l.push({...n,dueDate:n.dueDate?D({date:(d=n.dueDate)==null?void 0:d.split("T")[0],format:"dd/MM/yyyy"}):"",value:P(n.value,"money")??"",paymentMethodPayables:r})}return l}function Z({installment:a,handleInstallmentToPaymentMethodInfo:l}){if(!a.paymentMethodPayables.length)return e.jsx(q,{variant:"quaternary",tooltipMessage:"Adicionar método de pagamento",iconLeft:"AddCard",onClick:()=>l(a),resource:"ACCOUNTS_PAYABLE",action:"READ",padding:"none","data-cy":`button-edit-addPaymentMethod-${a.id}`})}function ee({installment:a,...l}){const{safeFetch:u}=A(),{showSuccessSnackbar:d}=w(),n=H(),{accountPayableId:r}=v();async function i(p){await u(`${g}/account-payable-installments/payment-method/${a.id}`,{method:"POST",body:p,resource:"ACCOUNTS_PAYABLE",action:"CREATE"})}const{mutate:t,isPending:M}=R({mutationFn:i,onSuccess:()=>{d({title:"Método de pagamento adicionado"}),n.invalidateQueries({queryKey:["accounts-payable-installments",r]}),n.invalidateQueries({queryKey:["accounts-payable-payment-method",String(a.id)]}),n.invalidateQueries({queryKey:["accounts-payable"]}),l.closeDialog()}});return e.jsxs(b,{...l,children:[e.jsx(b.Header,{title:"Adicionar Método de Pagamento"}),e.jsx(b.Body,{children:e.jsxs(V,{schema:z,defaultValues:I,onSubmit:t,className:"flex flex-col gap-4",children:[e.jsx(Q,{name:"paymentDate",label:"Data do pagamento",required:!0,type:"date"}),e.jsx(G,{label:"Forma de pagamento",required:!0}),e.jsx("div",{className:"flex flex-col gap-2",children:e.jsx(N,{required:!0,children:Object.values(U).map(p=>e.jsx(N.Radio,{label:E[p],name:"type",value:p},p))})}),e.jsx(b.Footer,{labelPrimaryBtn:"Adicionar",className:"px-0",dirty:!1,primaryBtnState:M?"loading":void 0,primaryBtnResource:"ACCOUNTS_PAYABLE",primaryBtnAction:"CREATE"})]})})]})}function ae(a){return{...a,paymentDate:D({date:a.paymentDate,format:"dd/MM/yyyy"})??""}}function te({installment:a,...l}){const{safeFetch:u}=A();async function d(){var t;const i=await u(`${g}/account-payable-installments/payment-method/${a==null?void 0:a.id}`,{resource:"ACCOUNTS_PAYABLE",action:"READ"});return(t=i==null?void 0:i.paymentMethodPayables)==null?void 0:t[0]}const{data:n,isFetching:r}=T({queryKey:["accounts-payable-payment-method",a.id],queryFn:d,select:ae});return e.jsxs(b,{...l,children:[e.jsx(b.Header,{title:"Detalhes do Método de Pagamento"}),e.jsx(b.Body,{children:e.jsx("div",{className:"flex flex-col gap-4 h-36 mb-8",children:r?e.jsx("div",{className:"flex justify-center items-center h-full w-full",children:e.jsx(B,{})}):e.jsxs(e.Fragment,{children:[e.jsx(j,{label:"Data do pagamento",value:n==null?void 0:n.paymentDate}),e.jsx(j,{label:"Forma de pagamento",value:n&&E[n==null?void 0:n.type]})]})})})]})}function ne({installment:a,...l}){if(a)return a.paymentMethodPayables.length?e.jsx(te,{installment:a,...l}):e.jsx(ee,{installment:a,...l})}const L=11;function le(){const{safeFetch:a}=A(),{accountPayableId:l}=v(),[u,d]=C.useState(null),n=k();function r(o){n.openDialog(),d(o)}async function i(){return await a(`${g}/account-payable-installments/by-account-payable/${l}`,{resource:"ACCOUNTS_PAYABLE",action:"READ"})}const{data:t,isFetching:M}=T({queryKey:["accounts-payable-installments",l],queryFn:i,select:X}),p=C.useMemo(()=>t!=null&&t.length?Math.max(...t.map(o=>o.value.length)):0,[t]),y=C.useMemo(()=>{var f,x;if(!(t!=null&&t.length))return{totalOverall:0,totalPaid:0,totalPending:0};const o=((f=t.filter(m=>m.status==="PAID"))==null?void 0:f.reduce((m,S)=>m+Number(F(S.value)),0))??0,h=((x=t.filter(m=>m.status==="PENDING"))==null?void 0:x.reduce((m,S)=>m+Number(F(S.value)),0))??0;return{totalOverall:o+h,totalPaid:o,totalPending:h}},[t]);return e.jsxs(e.Fragment,{children:[e.jsx(ne,{installment:u,...n}),e.jsxs("div",{className:"w-fit flex gap-4",children:[e.jsx(j,{label:"Total",value:P(y==null?void 0:y.totalOverall,"money")}),e.jsx(j,{label:"Total Pago",value:P(y==null?void 0:y.totalPaid,"money")}),e.jsx(j,{label:"Total Pendente",value:P(y==null?void 0:y.totalPending,"money")})]}),e.jsxs(s,{children:[e.jsxs(s.Header,{gridColumns:L,children:[e.jsx(s.Head,{label:c.installmentSequence.label,colSpan:c.installmentSequence.colSpan}),e.jsx(s.Head,{label:c.dueDate.label}),e.jsx(s.Head,{label:c.paymentDate.label}),e.jsx(s.Head,{label:c.paymentMethod.label}),e.jsx(s.Head,{label:c.status.label}),e.jsx(s.Head,{label:c.value.label,colSpan:c.installmentSequence.colSpan}),e.jsx(s.Head,{action:!0})]}),e.jsx(s.Body,{isLoading:M,isEmpty:!(t!=null&&t.length),resource:"ACCOUNTS_PAYABLE",action:"READ",children:t==null?void 0:t.map(o=>{var h,f,x;return e.jsxs(s.Row,{gridColumns:L,children:[e.jsx(s.Cell,{columnLabel:c.installmentSequence.label,colSpan:c.installmentSequence.colSpan,label:o.isUpfront?"Entrada":`${o.installmentSequence}/${(h=t.filter(m=>!m.isUpfront))==null?void 0:h.length}`}),e.jsx(s.Cell,{columnLabel:c.dueDate.label,label:o.dueDate}),e.jsx(s.Cell,{columnLabel:c.paymentDate.label,label:(f=o.paymentMethodPayables)!=null&&f.length?o.paymentMethodPayables[0].paymentDate:""}),e.jsx(s.Cell,{columnLabel:c.paymentMethod.label,label:(x=o.paymentMethodPayables)!=null&&x.length?E[o.paymentMethodPayables[0].type]:""}),e.jsx(s.Cell,{columnLabel:c.status.label,label:e.jsx(Y,{status:o.status})}),e.jsx(s.Cell,{columnLabel:c.value.label,label:o.value.padStart(p,_),className:"font-mono whitespace-pre",colSpan:c.value.colSpan}),e.jsx(s.Action,{children:e.jsx(Z,{installment:o,handleInstallmentToPaymentMethodInfo:r})})]},o.id)})})]})]})}function he({contextHelper:a}){return $({queryKey:["account-payable"]})?e.jsx("div",{className:"flex justify-center items-center h-full w-full",children:e.jsx(B,{})}):e.jsxs("div",{className:"flex flex-col gap-4 h-full w-full",children:[e.jsx(W,{contextHelper:a}),e.jsx(le,{})]})}export{he as default};
