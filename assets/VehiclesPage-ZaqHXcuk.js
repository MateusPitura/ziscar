import{r as f,j as e,a as C,V as A,u as V,b as v,c as M,d as F,B as I,e as g,f as L,A as H,g as q,h as O,i as w,k as $,M as Y,Y as _,v as D,l as B,T as j,m as S,n as c,I as K}from"./index-qW6Jgc2x.js";import{P as Q}from"./PageHeader-Duldp10i.js";import{S as N,T as i}from"./Table-BA_YUflV.js";import{u as U}from"./DialogContext-CCY72MLl.js";import{u as P,f as z}from"./react-pdf.browser-DEW3ltMk.js";import{E as G}from"./ExportButton-BKXomDU2.js";import{D as h}from"./Dialog-CraqqAPp.js";import{F as X,I as y}from"./schemas-DhckABRc.js";import{S as x}from"./Select-C7MuPilF.js";import{u as J}from"./useButtonState-D4P9Pwdl.js";import{S as W}from"./index-CGkwpitV.js";import{u as R}from"./useDialogContext-DbYsvN72.js";import{s as Z}from"./selectStoresInfo-BETvLGyR.js";import{s as ee}from"./selectBrandsInfo-VDxn_10s.js";import"./dialog-D5XMW0Vt.js";import"./useIsFetching-BuLOKJUG.js";import"./index-CImUiWf5.js";const ae=f.createContext(null);function te({children:a}){const[n,t]=f.useState("");function u(d){t(d)}const r=f.useMemo(()=>({example:n,handleExample:u}),[n]);return e.jsx(ae.Provider,{value:r,children:a})}function ne(a){const n=[];for(const t of a.data)n.push({...t,announcedPrice:C(t.announcedPrice,"money")??"",plateNumber:C(t.plateNumber,"plateNumber")??"",modelYear:t.modelYear?String(t.modelYear):""});return{total:a.total,data:n}}function oe(a){const n=[];for(const t of a.data)n.push({...t,announcedPrice:C(t.announcedPrice,"money")??"",plateNumber:C(t.plateNumber,"plateNumber")??"",status:A[t.status]});return n}function se({vehicleId:a,plateNumber:n,...t}){const{safeFetch:u}=V(),{showSuccessSnackbar:r}=v(),d=M(),{handleVehiclesFilter:m}=P();async function p(){await u(`${g}/vehicles/${a}/archive`,{method:"PATCH",resource:"VEHICLES",action:"DELETE"})}const{mutate:o,isPending:b}=F({mutationFn:p,onSuccess:()=>{m({page:1}),d.invalidateQueries({queryKey:["vehicles"]}),r({title:`Veículo ${n} desativado com sucesso`}),t.closeDialog()}});return e.jsxs(h,{...t,children:[e.jsx(h.Header,{title:"Desativar veículo"}),e.jsx(h.Body,{children:e.jsxs("span",{className:"text-body-medium text-neutral-700",children:["Tem certeza que deseja desativar o veículo",e.jsxs("span",{className:"font-bold",children:[I,n]}),"? Ao desativar os registros relacionados a ele não serão mais acessíveis"]})}),e.jsx(h.Footer,{labelPrimaryBtn:"Desativar",onClickPrimaryBtn:o,primaryBtnState:b?"loading":void 0,primaryBtnColor:"red",primaryBtnResource:"VEHICLES",primaryBtnAction:"DELETE"})]})}function le(){const{vehiclesFilter:a,handleVehiclesFilter:n}=P(),{closeDialog:t}=R(),{safeFetch:u}=V();async function r(){return await u(`${g}/store?orderBy=name`,{resource:"STORES",action:"READ"})}const{data:d,isFetching:m}=L({queryKey:["stores"],queryFn:r,select:Z});async function p(){return await u(`${g}/vehicles/brands`)}const{data:o,isFetching:b}=L({queryKey:["brands"],queryFn:p,select:ee});function s(E){n({page:1,...E}),t()}return e.jsx(X,{schema:W,onSubmit:s,className:"flex-1 flex flex-col min-h-0",defaultValues:{startDate:(a==null?void 0:a.startDate)||"",endDate:(a==null?void 0:a.endDate)||"",storeId:(a==null?void 0:a.storeId)||"",brandId:(a==null?void 0:a.brandId)||"",status:(a==null?void 0:a.status)||"",category:(a==null?void 0:a.category)||"",modelYear:(a==null?void 0:a.modelYear)||"",yearOfManufacture:(a==null?void 0:a.yearOfManufacture)||"",modelName:(a==null?void 0:a.modelName)||"",plateNumber:(a==null?void 0:a.plateNumber)||"",announcedPriceMin:(a==null?void 0:a.announcedPriceMin)||"",announcedPriceMax:(a==null?void 0:a.announcedPriceMax)||"",activityStatus:(a==null?void 0:a.activityStatus)||H.ACTIVE},replaceEmptyStringToNull:!1,children:e.jsx(re,{storesInfo:d,isFetchingStoresInfo:m,brandsInfo:o,isFetchingBrandsInfo:b})})}function re({storesInfo:a,isFetchingStoresInfo:n,brandsInfo:t,isFetchingBrandsInfo:u}){const{reset:r}=J(),{handleVehiclesFilter:d}=P(),{closeDialog:m}=R();function p(){d(D),r(D),m()}return e.jsxs(e.Fragment,{children:[e.jsxs(N.Body,{className:"flex flex-col gap-4 max-h-[82vh] overflow-y-auto",children:[e.jsx(y,{name:"modelName",label:"Modelo",placeholder:"Nome do modelo"}),e.jsx(y,{name:"plateNumber",label:"Placa",placeholder:"ABC-1234",mask:"plateNumber",maxLength:8}),e.jsx(x,{name:"storeId",label:"Loja",options:[{value:"",label:"Todas as lojas"},...(a==null?void 0:a.data.map(o=>({value:String(o.id),label:String(o.name)})))??[]],loading:n}),e.jsx(x,{name:"status",label:"Status",options:[{value:"",label:"Todos os status"},...Object.values(q).map(o=>({value:o,label:A[o]}))]}),e.jsx(x,{name:"brandId",label:"Marca",options:[{value:"",label:"Todas as marcas"},...t??[]],loading:u}),e.jsx(x,{name:"category",label:"Categoria",options:[{value:"",label:"Todas as categorias"},...Object.values(O).map(o=>({value:o,label:w[o]}))]}),e.jsx(x,{name:"activityStatus",label:"Status de atividade",options:Object.values(H).map(o=>({value:o,label:$[o]}))}),e.jsx(x,{name:"modelYear",label:"Ano do modelo",options:[{value:"",label:"Todos os anos"},...Y]}),e.jsx(x,{name:"yearOfManufacture",label:"Ano de fabricação",options:[{value:"",label:"Todos os anos"},..._]}),e.jsx(y,{name:"announcedPriceMin",label:"Preço anunciado mínimo",mask:"money",placeholder:"R$ 0,00"}),e.jsx(y,{name:"announcedPriceMax",label:"Preço anunciado máximo",mask:"money",placeholder:"R$ 0,00"}),e.jsx(y,{name:"startDate",label:"Data inicial de criação",type:"date"}),e.jsx(y,{name:"endDate",label:"Data final de criação",type:"date"})]}),e.jsx(N.Footer,{primaryLabel:"Aplicar",secondaryLabel:"Limpar",onSecondaryCallback:p,dirty:!0})]})}const ce=f.memo(le);function ie({vehicleId:a,plateNumber:n,isActive:t,handleDisableVehicleInfo:u}){const r=B(),{safeFetch:d}=V(),{showSuccessSnackbar:m}=v(),p=M();async function o(){await d(`${g}/vehicles/${a}/unarchive`,{method:"PATCH",resource:"VEHICLES",action:"DELETE"})}const{mutate:b,isPending:s}=F({mutationFn:o,onSuccess:()=>{p.invalidateQueries({queryKey:["vehicles"]}),m({title:`Veículo ${n} ativado com sucesso`})}});return t?e.jsxs(e.Fragment,{children:[e.jsx(j,{content:"Vender",children:e.jsx(S,{variant:"quaternary",iconLeft:"CurrencyExchange",onClick:()=>r(`/vehicle-sale/new/${a}`),resource:"VEHICLE_SALE",action:"CREATE",padding:"none","data-cy":`button-vehicleSale-${a}`})}),e.jsx(j,{content:"Editar",children:e.jsx(S,{variant:"quaternary",iconLeft:"Edit",onClick:()=>r(`/vehicles/edit/${a}`),resource:"VEHICLES",action:"UPDATE",padding:"none","data-cy":`button-edit-vehicle-${a}`})}),e.jsx(j,{content:"Gastos",children:e.jsx(S,{variant:"quaternary",iconLeft:"History",onClick:()=>r(`/vehicles/expense/${a}`),resource:"VEHICLE_EXPENSE",action:"READ",padding:"none","data-cy":`button-vehicle-expense-${a}`})}),e.jsx(j,{content:"Desativar",children:e.jsx(S,{variant:"primary",iconLeft:"Delete",color:"red",padding:"none",onClick:()=>u({plateNumber:n,vehicleId:a}),resource:"VEHICLES",action:"DELETE","data-cy":`button-disable-vehicle-${a}`})})]}):e.jsx(j,{content:"Ativar",children:e.jsx(S,{variant:"quaternary",onClick:b,state:s?"loading":void 0,resource:"VEHICLES",action:"DELETE",padding:"none",iconLeft:"ToggleOn","data-cy":`button-enable-vehicle-${a}`})})}const T=7;function ue(){const[a,n]=f.useState({plateNumber:"",vehicleId:""}),t=U(),{safeFetch:u}=V(),{vehiclesFilter:r,handleVehiclesFilter:d}=P();function m(l){t.openDialog(),n(l)}function p(l){d({page:l})}const o=f.useMemo(()=>r?z(r):"",[r]);async function b(l){return await u(`${g}/vehicles?${l}&limit=${K}`,{resource:"VEHICLES",action:"READ"})}const{data:s,isFetching:E}=L({queryKey:["vehicles",o],queryFn:({queryKey:l})=>b(l[1]),select:ne}),k=f.useMemo(()=>s!=null&&s.data.length?Math.max(...s.data.map(l=>l.announcedPrice.length)):0,[s==null?void 0:s.data]);return e.jsxs(e.Fragment,{children:[e.jsx(se,{...a,...t}),e.jsxs("div",{className:"flex gap-4 justify-end",children:[e.jsx(G,{fileName:"Relatório Veículos",queryKey:["vehicles",o],queryFn:b,selectQueryFn:oe,formatFilters:{endDate:"Data final",startDate:"Data inicial",storeId:"Loja",brandId:"Marca",status:"Status",category:"Categoria",modelYear:"Ano do modelo",yearOfManufacture:"Ano de fabricação",modelName:"Modelo",plateNumber:"Placa",announcedPriceMin:"Preço mínimo",announcedPriceMax:"Preço máximo",activityStatus:"Status de atividade"},formatFiltersValues:{activityStatus:$},formatColumns:{announcedPrice:"Preço anunciado",modelName:"Modelo",plateNumber:"Placa",modelYear:"Ano do modelo",status:"Status",archivedAt:"Ativo"}}),e.jsx(i.Filter,{form:e.jsx(ce,{})})]}),e.jsxs(i,{children:[e.jsxs(i.Header,{gridColumns:T,children:[e.jsx(i.Head,{label:c.model.label}),e.jsx(i.Head,{label:c.plate.label,colSpan:c.plate.colSpan}),e.jsx(i.Head,{label:c.year.label,colSpan:c.year.colSpan}),e.jsx(i.Head,{label:c.price.label,colSpan:c.price.colSpan}),e.jsx(i.Head,{label:c.status.label,colSpan:c.status.colSpan}),e.jsx(i.Head,{action:!0})]}),e.jsx(i.Body,{isLoading:E,isEmpty:!(s!=null&&s.total),resource:"VEHICLES",action:"READ",children:s==null?void 0:s.data.map(l=>e.jsxs(i.Row,{gridColumns:T,children:[e.jsx(i.Cell,{label:l.modelName,columnLabel:c.model.label}),e.jsx(i.Cell,{label:l.plateNumber,colSpan:c.plate.colSpan,columnLabel:c.plate.label}),e.jsx(i.Cell,{label:l.modelYear,colSpan:c.year.colSpan,columnLabel:c.year.label}),e.jsx(i.Cell,{label:l.announcedPrice.padStart(k,I),columnLabel:c.price.label,className:"font-mono xl:whitespace-pre",colSpan:c.price.colSpan}),e.jsx(i.Cell,{columnLabel:c.status.label,label:l.archivedAt?"Inativo":A[l.status],colSpan:c.status.colSpan}),e.jsx(i.Action,{children:e.jsx(ie,{isActive:!l.archivedAt,vehicleId:String(l.id),plateNumber:l.plateNumber,handleDisableVehicleInfo:m})})]},l.id))}),e.jsx(i.Footer,{currentStartItem:r==null?void 0:r.page,totalItems:s==null?void 0:s.total,onClickNavigateBtn:p,isLoading:E})]})]})}function de(){const a=B();return e.jsxs("div",{className:"flex flex-col gap-4 h-full w-full",children:[e.jsx(Q,{title:"Veículos",children:e.jsx(S,{label:"Adicionar veículo",iconLeft:"Add",onClick:()=>a("/vehicles/new"),resource:"VEHICLES",action:"CREATE",color:"green","data-cy":"new-vehicle-button"})}),e.jsx(ue,{})]})}function Ne(){return e.jsx(te,{children:e.jsx(de,{})})}export{Ne as default};
