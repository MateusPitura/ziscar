import{r as u,W as w,j as e,B as p,h as x,i as b,g as I,l as h,m as f,d as k,Y as E,Z as B,_ as q}from"./index-aVBDU0Ve.js";import{u as U,I as l,F as S,o as _,n as A,h as m,e as D,p as N,s as P,q as F,r as O,t as R}from"./Dialog-DJzmwurf.js";import{u as G}from"./useDialogContext-xhCSAYNE.js";const v=u.createContext(null);function T({children:a}){const[s]=w();let r=null;s.has("token")&&(r=s.get("token"));const[t,n]=u.useState(r?"NEW_PASSWORD":"SIGN_IN");function o(d){n(d)}const i=u.useMemo(()=>({step:t,handleStep:o}),[t]);return e.jsx(v.Provider,{value:i,children:a})}function M({title:a,children:s}){return e.jsxs("div",{className:"w-[23rem] h-[41rem] bg-neutral-50 shadow-md px-4 py-8 flex flex-col gap-8 rounded-md",children:[e.jsx("span",{className:"text-headline-large text-neutral-700 text-center",children:a}),s]})}function V({label:a,variant:s="primary",primaryBtnState:r,secondaryBtnLabel:t,onClickSecondaryBtn:n}){const o=U({buttonState:r});return e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx(p,{label:a,textAlign:"center",variant:s,state:o,fullWidth:!0,type:"submit"}),t&&e.jsx("div",{className:"flex-1 flex justify-center",children:e.jsx(p,{label:t,textAlign:"center",variant:"quaternary",onClick:n})})]})}const c=Object.assign(M,{Footer:V});function j({label:a,required:s,name:r,autoFocus:t=!1}){const[n,o]=u.useState(!1);return e.jsx(l,{name:r,label:a,required:s,iconRight:n?"Visibility":"VisibilityOff",onClickIconRight:()=>o(i=>!i),type:n?"text":"password",autoFocus:t})}function g(){const a=u.useContext(v);if(!a)throw new Error("useSignPageContext must be used within a SignPageProvider");return a}function W(){const{safeFetch:a}=x(),{showSuccessSnackbar:s}=b(),{handleStep:r}=g(),t=I(),[n]=w();let o=null;n.has("token")&&(o=n.get("token"));async function i(C){await a(`${f}/auth/reset-password`,{method:"POST",body:{password:C.newPassword,token:o}})}const{mutate:d,isPending:y}=h({mutationFn:i,onSuccess:()=>{t("/"),r("SIGN_IN"),s({title:"Senha definida com sucesso",description:"Acesse com a nova senha"})}});return e.jsxs(S,{defaultValues:{confirmPassword:"",newPassword:""},schema:_,onSubmit:d,className:"flex-1 flex flex-col",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx(j,{label:"Nova senha",name:"newPassword",required:!0,autoFocus:!0}),e.jsx(j,{label:"Confirmar senha",name:"confirmPassword",required:!0})]}),e.jsx(c.Footer,{label:"Salvar",primaryBtnState:y?"loading":void 0})]})}const L=A.pick({email:!0});function $(){const{safeFetch:a}=x(),{showSuccessSnackbar:s}=b(),{closeDialog:r}=G();async function t(i){await a(`${f}/auth/forget-password`,{method:"POST",body:i})}const{mutate:n,isPending:o}=h({mutationFn:t,onSuccess:()=>{s({title:"Um email será enviado",description:"Confira também a caixa de spam"}),r()}});return e.jsxs(S,{defaultValues:{email:""},schema:L,onSubmit:n,children:[e.jsx(m.Body,{children:e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsx("span",{className:"text-body-large text-neutral-700",children:"Insira seu email para enviarmos as instruções para recuperar sua senha"}),e.jsx(l,{name:"email",label:"Email",required:!0})]})}),e.jsx(m.Footer,{labelPrimaryBtn:"Enviar",dirty:!0,primaryBtnState:o?"loading":void 0})]})}function H({...a}){return e.jsxs(m,{...a,children:[e.jsx(m.Header,{title:"Recuperar senha"}),e.jsx($,{})]})}const Z=N({email:F(),password:P()});function z(){const{handleStep:a}=g(),s=D(),{safeFetch:r}=x(),{authChannel:t}=k();async function n(d){await r(`${f}/auth/sign-in`,{method:"POST",body:d})}const{mutate:o,isPending:i}=h({mutationFn:n,onSuccess:()=>{E(B),t.postMessage({type:q.SIGNIN})}});return e.jsxs(e.Fragment,{children:[e.jsx(H,{...s}),e.jsxs(S,{schema:Z,defaultValues:{email:"",password:""},onSubmit:o,className:"flex-1 flex flex-col",children:[e.jsxs("div",{className:"flex-1 flex flex-col gap-2",children:[e.jsx(l,{name:"email",label:"Email",required:!0,autoFocus:!0}),e.jsx(j,{label:"Senha",name:"password",required:!0}),e.jsx("div",{className:"flex items-end justify-end",children:e.jsx(p,{label:"Esqueci a senha",variant:"quaternary",onClick:s.openDialog})})]}),e.jsx(c.Footer,{label:"Entrar",secondaryBtnLabel:"Criar conta",onClickSecondaryBtn:()=>a("SIGN_UP"),primaryBtnState:i?"loading":void 0})]})]})}const J=N({name:P(),cnpj:R(),fullName:O(),email:F()});function K(){const{handleStep:a}=g(),{safeFetch:s}=x(),{showSuccessSnackbar:r}=b();async function t(i){await s(`${f}/auth/sign-up`,{method:"POST",body:i})}const{mutate:n,isPending:o}=h({mutationFn:t,onSuccess:()=>{r({title:"Um email será enviado",description:"Confira também a caixa de spam"})}});return e.jsxs(S,{schema:J,defaultValues:{name:"",cnpj:"",fullName:"",email:""},onSubmit:n,className:"flex-1 flex flex-col",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx(l,{name:"name",label:"Nome da filial",required:!0,autoFocus:!0}),e.jsx(l,{name:"cnpj",label:"CNPJ",required:!0,mask:"cnpj"}),e.jsx(l,{name:"fullName",label:"Nome do usuário",required:!0}),e.jsx(l,{name:"email",label:"Email do usuário",required:!0})]}),e.jsx(c.Footer,{label:"Criar",secondaryBtnLabel:"Cancelar",onClickSecondaryBtn:()=>a("SIGN_IN"),primaryBtnState:o?"loading":void 0})]})}function Y(){const{step:a}=g(),s=u.useMemo(()=>{switch(a){case"NEW_PASSWORD":return e.jsx(c,{title:"Criar nova senha",children:e.jsx(W,{})});case"SIGN_UP":return e.jsx(c,{title:"Criar conta",children:e.jsx(K,{})});default:return e.jsx(c,{title:"Login",children:e.jsx(z,{})})}},[a]);return e.jsxs("div",{className:"bg-slate-800 w-full h-screen flex justify-center items-center flex-col gap-4",children:[e.jsx("span",{className:"text-headline-large text-neutral-100",children:"Ziscar"}),e.jsx("div",{className:"border-b border-neutral-300 w-96"}),s]})}function ae(){return e.jsx(T,{children:e.jsx(Y,{})})}export{ae as default};
