import{r as b,j as e,a as D,V as L,u as N,b as $,c as B,d as R,B as q,e as f,f as V,g as z,h as k,M as G,Y as X,v as I,i as w,T as C,k as E,l as r,I as J}from"./index-CrVTpVTI.js";import{P as W}from"./PageHeader-DARJqnt5.js";import{S as v,T as l}from"./Table-CQjU_dFI.js";import{u as Z}from"./DialogContext-3LqbYYdn.js";import{u as A,f as ee}from"./react-pdf.browser-DHIQ3vjp.js";import{E as ae}from"./ExportButton-C84t7uml.js";import{V as te,S as ne,a as oe}from"./index-uyprc1Rk.js";import{s as O}from"./selectBrandsInfo-VDxn_10s.js";import{s as _}from"./selectStoresInfo-36oKAABV.js";import{D as P}from"./Dialog-BHTFXl4K.js";import{F as se,I as y}from"./schemas-B7gcU9vp.js";import{S as g}from"./Select-CB-6jpCF.js";import{u as re}from"./useButtonState-C7TXS9Jx.js";import{u as Y}from"./useDialogContext-BkmWcj_q.js";import"./dialog-Ct9-qcrh.js";import"./useIsFetching-Dh2N-bBa.js";import"./index-CLx72V5J.js";const le=b.createContext(null);function ce({children:a}){const[o,n]=b.useState("");function u(d){n(d)}const s=b.useMemo(()=>({example:o,handleExample:u}),[o]);return e.jsx(le.Provider,{value:s,children:a})}function ie(a){const o=[];for(const n of a.data)o.push({...n,announcedPrice:D(n.announcedPrice,"money")??"",plateNumber:D(n.plateNumber,"plateNumber")??"",modelYear:n.modelYear?String(n.modelYear):""});return{total:a.total,data:o}}function ue(a){const o=[];for(const n of a.data)o.push({...n,announcedPrice:D(n.announcedPrice,"money")??"",plateNumber:D(n.plateNumber,"plateNumber")??"",status:n.archivedAt?L[te]:L[n.status]});return o}function de({vehicleId:a,plateNumber:o,...n}){const{safeFetch:u}=N(),{showSuccessSnackbar:s}=$(),d=B(),{handleVehiclesFilter:m}=A();async function p(){await u(`${f}/vehicles/${a}/archive`,{method:"PATCH",resource:"VEHICLES",action:"DELETE"})}const{mutate:c,isPending:x}=R({mutationFn:p,onSuccess:()=>{m({page:1}),d.invalidateQueries({queryKey:["vehicles"]}),s({title:`Veículo ${o} desativado com sucesso`}),n.closeDialog()}});return e.jsxs(P,{...n,children:[e.jsx(P.Header,{title:"Desativar veículo"}),e.jsx(P.Body,{children:e.jsxs("span",{className:"text-body-medium text-neutral-700",children:["Tem certeza que deseja desativar o veículo",e.jsxs("span",{className:"font-bold",children:[q,o]}),"? Ao desativar os registros relacionados a ele não serão mais acessíveis"]})}),e.jsx(P.Footer,{labelPrimaryBtn:"Desativar",onClickPrimaryBtn:c,primaryBtnState:x?"loading":void 0,primaryBtnColor:"red",primaryBtnResource:"VEHICLES",primaryBtnAction:"DELETE"})]})}function me(){const{vehiclesFilter:a,handleVehiclesFilter:o}=A(),{closeDialog:n}=Y(),{safeFetch:u}=N();async function s(){return await u(`${f}/store?orderBy=name`,{resource:"STORES",action:"READ"})}const{data:d,isFetching:m}=V({queryKey:["stores"],queryFn:s,select:_});async function p(){return await u(`${f}/vehicles/brands`)}const{data:c,isFetching:x}=V({queryKey:["brands"],queryFn:p,select:O});function S(T){o({page:1,...T}),n()}return e.jsx(se,{schema:ne,onSubmit:S,className:"flex-1 flex flex-col min-h-0",defaultValues:{startDate:(a==null?void 0:a.startDate)||"",endDate:(a==null?void 0:a.endDate)||"",storeId:(a==null?void 0:a.storeId)||"",brandId:(a==null?void 0:a.brandId)||"",status:(a==null?void 0:a.status)||"",category:(a==null?void 0:a.category)||"",modelYear:(a==null?void 0:a.modelYear)||"",yearOfManufacture:(a==null?void 0:a.yearOfManufacture)||"",modelName:(a==null?void 0:a.modelName)||"",plateNumber:(a==null?void 0:a.plateNumber)||"",announcedPriceMin:(a==null?void 0:a.announcedPriceMin)||"",announcedPriceMax:(a==null?void 0:a.announcedPriceMax)||""},replaceEmptyStringToNull:!1,children:e.jsx(pe,{storesInfo:d,isFetchingStoresInfo:m,brandsInfo:c,isFetchingBrandsInfo:x})})}function pe({storesInfo:a,isFetchingStoresInfo:o,brandsInfo:n,isFetchingBrandsInfo:u}){const{reset:s}=re(),{handleVehiclesFilter:d}=A(),{closeDialog:m}=Y();function p(){d(I),s(I),m()}return e.jsxs(e.Fragment,{children:[e.jsxs(v.Body,{className:"flex flex-col gap-4 max-h-[82vh] overflow-y-auto",children:[e.jsx(y,{name:"modelName",label:"Modelo",placeholder:"Nome do modelo"}),e.jsx(y,{name:"plateNumber",label:"Placa",placeholder:"ABC-1234",mask:"plateNumber",maxLength:8}),e.jsx(g,{name:"storeId",label:"Loja",options:[{value:"",label:"Todas as lojas"},...(a==null?void 0:a.data.map(c=>({value:String(c.id),label:String(c.name)})))??[]],loading:o}),e.jsx(g,{name:"status",label:"Status",options:[{value:"",label:"Todos os ativos"},...Object.values(oe).map(c=>({value:c,label:L[c]}))]}),e.jsx(g,{name:"brandId",label:"Marca",options:[{value:"",label:"Todas as marcas"},...n??[]],loading:u}),e.jsx(g,{name:"category",label:"Categoria",options:[{value:"",label:"Todas as categorias"},...Object.values(z).map(c=>({value:c,label:k[c]}))]}),e.jsx(g,{name:"modelYear",label:"Ano do modelo",options:[{value:"",label:"Todos os anos"},...G]}),e.jsx(g,{name:"yearOfManufacture",label:"Ano de fabricação",options:[{value:"",label:"Todos os anos"},...X]}),e.jsx(y,{name:"announcedPriceMin",label:"Preço anunciado mínimo",mask:"money",placeholder:"R$ 0,00"}),e.jsx(y,{name:"announcedPriceMax",label:"Preço anunciado máximo",mask:"money",placeholder:"R$ 0,00"}),e.jsx(y,{name:"startDate",label:"Data inicial de criação",type:"date"}),e.jsx(y,{name:"endDate",label:"Data final de criação",type:"date"})]}),e.jsx(v.Footer,{primaryLabel:"Aplicar",secondaryLabel:"Limpar",onSecondaryCallback:p,dirty:!0})]})}const be=b.memo(me);function xe({vehicleId:a,plateNumber:o,isActive:n,handleDisableVehicleInfo:u}){const s=w(),{safeFetch:d}=N(),{showSuccessSnackbar:m}=$(),p=B();async function c(){await d(`${f}/vehicles/${a}/unarchive`,{method:"PATCH",resource:"VEHICLES",action:"DELETE"})}const{mutate:x,isPending:S}=R({mutationFn:c,onSuccess:()=>{p.invalidateQueries({queryKey:["vehicles"]}),m({title:`Veículo ${o} ativado com sucesso`})}});return n?e.jsxs(e.Fragment,{children:[e.jsx(C,{content:"Vender",children:e.jsx(E,{variant:"quaternary",iconLeft:"CurrencyExchange",onClick:()=>s(`/vehicle-sale/new/${a}`),resource:"VEHICLE_SALE",action:"CREATE",padding:"none","data-cy":`button-vehicleSale-${a}`})}),e.jsx(C,{content:"Editar",children:e.jsx(E,{variant:"quaternary",iconLeft:"Edit",onClick:()=>s(`/vehicles/edit/${a}`),resource:"VEHICLES",action:"UPDATE",padding:"none","data-cy":`button-edit-vehicle-${a}`})}),e.jsx(C,{content:"Gastos",children:e.jsx(E,{variant:"quaternary",iconLeft:"History",onClick:()=>s(`/vehicles/expense/${a}`),resource:"VEHICLE_EXPENSE",action:"READ",padding:"none","data-cy":`button-vehicle-expense-${a}`})}),e.jsx(C,{content:"Desativar",children:e.jsx(E,{variant:"primary",iconLeft:"Delete",color:"red",padding:"none",onClick:()=>u({plateNumber:o,vehicleId:a}),resource:"VEHICLES",action:"DELETE","data-cy":`button-disable-vehicle-${a}`})})]}):e.jsx(C,{content:"Ativar",children:e.jsx(E,{variant:"quaternary",onClick:x,state:S?"loading":void 0,resource:"VEHICLES",action:"DELETE",padding:"none",iconLeft:"ToggleOn","data-cy":`button-enable-vehicle-${a}`})})}const H=7;function fe(){const[a,o]=b.useState({plateNumber:"",vehicleId:""}),n=Z(),{safeFetch:u}=N(),{vehiclesFilter:s,handleVehiclesFilter:d}=A();function m(t){n.openDialog(),o(t)}function p(t){d({page:t})}const c=b.useMemo(()=>s?ee(s):"",[s]);async function x(t){return await u(`${f}/vehicles?${t}&limit=${J}`,{resource:"VEHICLES",action:"READ"})}async function S(){return await u(`${f}/vehicles/brands`)}async function T(){return await u(`${f}/store?orderBy=name`,{resource:"STORES",action:"READ"})}const{data:i,isFetching:F}=V({queryKey:["vehicles",c],queryFn:({queryKey:t})=>x(t[1]),select:ie}),{data:M}=V({queryKey:["brands"],queryFn:S,select:O}),{data:h}=V({queryKey:["stores"],queryFn:T,select:_}),K=b.useMemo(()=>M?M.reduce((t,j)=>(t[j.value]=j.label,t),{}):{},[M]),Q=b.useMemo(()=>h!=null&&h.data?h.data.reduce((t,j)=>(t[String(j.id)]=j.name,t),{}):{},[h]),U=b.useMemo(()=>i!=null&&i.data.length?Math.max(...i.data.map(t=>t.announcedPrice.length)):0,[i==null?void 0:i.data]);return e.jsxs(e.Fragment,{children:[e.jsx(de,{...a,...n}),e.jsxs("div",{className:"flex gap-4 justify-end",children:[e.jsx(ae,{fileName:"Relatório Veículos",queryKey:["vehicles",c],queryFn:x,selectQueryFn:ue,formatFilters:{endDate:"Data final",startDate:"Data inicial",storeId:"Loja",brandId:"Marca",status:"Status",category:"Categoria",modelYear:"Ano do modelo",yearOfManufacture:"Ano de fabricação",modelName:"Modelo",plateNumber:"Placa",announcedPriceMin:"Preço mínimo",announcedPriceMax:"Preço máximo"},formatFiltersValues:{status:L,category:{...k,"":"Todas"},brandId:K,storeId:Q},formatColumns:{modelName:"Modelo",plateNumber:"Placa",modelYear:"Ano do modelo",status:"Status",announcedPrice:"Preço anunciado"}}),e.jsx(l.Filter,{form:e.jsx(be,{})})]}),e.jsxs(l,{children:[e.jsxs(l.Header,{gridColumns:H,children:[e.jsx(l.Head,{label:r.model.label}),e.jsx(l.Head,{label:r.plate.label,colSpan:r.plate.colSpan}),e.jsx(l.Head,{label:r.year.label,colSpan:r.year.colSpan}),e.jsx(l.Head,{label:r.price.label,colSpan:r.price.colSpan}),e.jsx(l.Head,{label:r.status.label,colSpan:r.status.colSpan}),e.jsx(l.Head,{action:!0})]}),e.jsx(l.Body,{isLoading:F,isEmpty:!(i!=null&&i.total),resource:"VEHICLES",action:"READ",children:i==null?void 0:i.data.map(t=>e.jsxs(l.Row,{gridColumns:H,children:[e.jsx(l.Cell,{label:t.modelName,columnLabel:r.model.label}),e.jsx(l.Cell,{label:t.plateNumber,colSpan:r.plate.colSpan,columnLabel:r.plate.label}),e.jsx(l.Cell,{label:t.modelYear,colSpan:r.year.colSpan,columnLabel:r.year.label}),e.jsx(l.Cell,{label:t.announcedPrice.padStart(U,q),columnLabel:r.price.label,className:"font-mono xl:whitespace-pre",colSpan:r.price.colSpan}),e.jsx(l.Cell,{columnLabel:r.status.label,label:t.archivedAt?"Inativo":L[t.status],colSpan:r.status.colSpan}),e.jsx(l.Action,{children:e.jsx(xe,{isActive:!t.archivedAt,vehicleId:String(t.id),plateNumber:t.plateNumber,handleDisableVehicleInfo:m})})]},t.id))}),e.jsx(l.Footer,{currentStartItem:s==null?void 0:s.page,totalItems:i==null?void 0:i.total,onClickNavigateBtn:p,isLoading:F})]})]})}function ye(){const a=w();return e.jsxs("div",{className:"flex flex-col gap-4 h-full w-full",children:[e.jsx(W,{title:"Veículos",children:e.jsx(E,{label:"Adicionar veículo",iconLeft:"Add",onClick:()=>a("/vehicles/new"),resource:"VEHICLES",action:"CREATE",color:"green","data-cy":"new-vehicle-button"})}),e.jsx(fe,{})]})}function He(){return e.jsx(ce,{children:e.jsx(ye,{})})}export{He as default};
