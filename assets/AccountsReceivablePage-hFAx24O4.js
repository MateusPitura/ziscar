import{r as c,j as e,a as S,y as m,ay as p,f as v,T as j,g,u as F,h as y,B as D,e as E}from"./index-DLLA1f-v.js";import{P as N}from"./PageHeader-Bs9TDp09.js";import{S as h,T as l}from"./Table-By5z5vhx.js";import{S as P,A as V}from"./index-Bn4EDnu-.js";import{u as x,f as L}from"./react-pdf.browser-s4H9466t.js";import{E as R}from"./ExportButton-CgGi4N55.js";import{F as B,I as A,u as I}from"./schemas-Bhi0Dh6I.js";import{u as T}from"./useButtonState-3b0McXTU.js";import{u as b}from"./useDialogContext-BXiPHqkt.js";import{C as d}from"./Choice-BxW3kVCA.js";import"./dialog-BH6A_dKB.js";import"./useDialog-DlT6EUiq.js";import"./useIsFetching-Ce26lW8Z.js";const H=c.createContext(null);function $({children:t}){const[a,s]=c.useState("");function n(u){s(u)}const i=c.useMemo(()=>({example:a,handleExample:n}),[a]);return e.jsx(H.Provider,{value:i,children:t})}function q(t){const a=[];for(const s of t.data)a.push({...s,totalValue:S(s.totalValue,"money")??""});return{total:t.total,data:a}}function w(t){const a=[];for(const s of t.data)a.push({...s,totalValue:S(s.totalValue,"money")??"",overallStatus:s.overallStatus==="PAID"?"Pago":"Pendente"});return a}function M(){const{accountsReceivableFilter:t,handleAccountsReceivableFilter:a}=x(),{closeDialog:s}=b();function n(i){a({page:1,...i}),s()}return e.jsx(B,{schema:P,onSubmit:n,className:"flex-1 flex flex-col",defaultValues:{startDate:(t==null?void 0:t.startDate)||"",endDate:(t==null?void 0:t.endDate)||"",overallStatus:(t==null?void 0:t.overallStatus)||m.PAID},replaceEmptyStringToNull:!1,children:e.jsx(k,{})})}function k(){const{reset:t}=T(),{handleAccountsReceivableFilter:a}=x(),{closeDialog:s}=b();function n(){a(p),t(p),s()}return e.jsxs(e.Fragment,{children:[e.jsxs(h.Body,{className:"flex flex-col gap-4",children:[e.jsx(A,{name:"startDate",label:"Data inicial de criação",type:"date"}),e.jsx(A,{name:"endDate",label:"Data final de criação",type:"date"}),e.jsx(I,{label:"Status geral"}),e.jsx("div",{className:"flex flex-col gap-2",children:e.jsxs(d,{hideErrorLabel:!0,children:[e.jsx(d.Radio,{name:"overallStatus",label:"Pago",value:m.PAID}),e.jsx(d.Radio,{name:"overallStatus",label:"Pendente",value:m.PENDING})]})})]}),e.jsx(h.Footer,{primaryLabel:"Aplicar",secondaryLabel:"Limpar",onSecondaryCallback:n,dirty:!0})]})}const _=c.memo(M);function K({accountReceivableId:t,vehicleSaleId:a}){const s=v();return e.jsxs(e.Fragment,{children:[e.jsx(j,{content:"Veículo",children:e.jsx(g,{variant:"quaternary",iconLeft:"DirectionsCar",onClick:()=>s(`/vehicle-sale/view/${a}`),resource:"VEHICLE_SALE",action:"READ",padding:"none","data-cy":`button-view-vehicleSale-${a}`})}),e.jsx(j,{content:"Pagamento",children:e.jsx(g,{variant:"quaternary",iconLeft:"Visibility",onClick:()=>s(`/accounts-receivable/${t}/installments`),resource:"ACCOUNTS_RECEIVABLE",action:"READ",padding:"none","data-cy":`button-edit-accountReceivable-${t}`})})]})}function U(){const{safeFetch:t}=F(),{accountsReceivableFilter:a,handleAccountsReceivableFilter:s}=x();function n(o){s({page:o})}const i=c.useMemo(()=>a?L(a):"",[a]);async function u(o){return await t(`${E}/account-receivable/search?${o}&orderBy=description`,{resource:"ACCOUNTS_RECEIVABLE",action:"READ"})}const{data:r,isFetching:f}=y({queryKey:["accounts-receivable",i],queryFn:({queryKey:o})=>u(o[1]),select:q}),C=c.useMemo(()=>r!=null&&r.data.length?Math.max(...r.data.map(o=>o.totalValue.length)):0,[r==null?void 0:r.data]);return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex gap-4 justify-end",children:[e.jsx(R,{fileName:"Relatório Contas a Receber",queryKey:["accounts-receivable",i],queryFn:u,selectQueryFn:w,formatFilters:{endDate:"Data final",startDate:"Data inicial",overallStatus:"Status geral"},formatFiltersValues:{overallStatus:{PAID:"Pago",PENDING:"Pendente"}},formatColumns:{installmentsNumber:"Número de parcelas",description:"Descrição",receivedFrom:"Recebido de",totalValue:"Valor total",overallStatus:"Status geral"}}),e.jsx(l.Filter,{form:e.jsx(_,{})})]}),e.jsxs(l,{children:[e.jsxs(l.Header,{gridColumns:10,children:[e.jsx(l.Head,{label:"Descrição"}),e.jsx(l.Head,{label:"Número de parcelas"}),e.jsx(l.Head,{label:"Recebido de"}),e.jsx(l.Head,{label:"Status geral do pagamento"}),e.jsx(l.Head,{label:"Valor total",colSpan:1}),e.jsx(l.Head,{action:!0})]}),e.jsx(l.Body,{isLoading:f,isEmpty:!(r!=null&&r.total),resource:"ACCOUNTS_RECEIVABLE",action:"READ",children:r==null?void 0:r.data.map(o=>e.jsxs(l.Row,{gridColumns:10,children:[e.jsx(l.Cell,{label:o.description}),e.jsx(l.Cell,{label:o.installmentsNumber}),e.jsx(l.Cell,{label:o.receivedFrom}),e.jsx(l.Cell,{label:e.jsx(V,{status:o.overallStatus})}),e.jsx(l.Cell,{label:o.totalValue.padStart(C,D),className:"font-mono whitespace-pre",colSpan:1}),e.jsx(l.Action,{children:e.jsx(K,{accountReceivableId:String(o.id),vehicleSaleId:String(o.vehicleSaleId)})})]},o.id))}),e.jsx(l.Footer,{currentStartItem:a==null?void 0:a.page,totalItems:r==null?void 0:r.total,onClickNavigateBtn:n,isLoading:f})]})]})}function O(){return e.jsxs("div",{className:"flex flex-col gap-4 h-full w-full",children:[e.jsx(N,{title:"Vendas"}),e.jsx(U,{})]})}function re(){return e.jsx($,{children:e.jsx(O,{})})}export{re as default};
