import{r as d,j as a,v as U,w as g,t as b,x as v,G as A,a as j,y as F,p as C,z as p}from"./index-Bk1-U1gT.js";import{u as q,U as R}from"./UserForm-XkM6XIrM.js";import{a as l}from"./index-DIBAWhTZ.js";import{s as w,p as K}from"./parseAddressPayload-DEOBBegZ.js";import"./Choice-D-eKCops.js";import"./useButtonState-B12HSnGx.js";import"./Loading-Dzwhq4Sl.js";import"./Section-BLbuff5n.js";const M=d.createContext(null);function N({children:e}){const[n,o]=d.useState(!1);function i(r){o(r)}const t=d.useMemo(()=>({example:n,handleExample:i}),[n]);return a.jsx(M.Provider,{value:t,children:e})}function D(e){var n,o,i,t,r,u,s,c;return{fullName:e.fullName,email:e.email,cellPhone:l(e.cellPhone,"cellphone")??"",cpf:l(e.cpf,"cpf")??"",code:e.code??"",birthDate:e.birthDate?w({date:e.birthDate,format:"yyyy-MM-dd"}):"",roleId:((n=e.roleId)==null?void 0:n.toString())??"",address:e.address?{cep:l((o=e.address)==null?void 0:o.cep,"cep")??"",number:((i=e.address)==null?void 0:i.number)??"",street:((t=e.address)==null?void 0:t.street)??"",complement:((r=e.address)==null?void 0:r.complement)??"",neighborhood:((u=e.address)==null?void 0:u.neighborhood)??"",city:((s=e.address)==null?void 0:s.city)??"",state:((c=e.address)==null?void 0:c.state)??""}:null}}function I(){const{safeFetch:e}=U(),{showSuccessSnackbar:n}=g(),o=q({queryKey:["cepApi"]}),i=b(),t=v(),{userId:r}=A();async function u(){return await e(`${p}/user/${r}`,{resource:"USERS",action:"READ"})}const{data:s,isFetching:c}=j({queryKey:["user",r],queryFn:u,select:D});async function y(x){const{address:P,...S}=x,f=K({newAddress:P,oldAddress:s==null?void 0:s.address});await e(`${p}/user/${r}`,{method:"PATCH",body:{...S,...f&&{address:f}},resource:"USERS",action:"UPDATE"})}const{mutate:h,isPending:E,isSuccess:m}=F({mutationFn:y,onSuccess:async()=>{n({title:`Usuário ${s==null?void 0:s.fullName} atualizado com sucesso`}),t.invalidateQueries({queryKey:["usersDashboard"]}),t.invalidateQueries({queryKey:["users"]}),i("/users")}});return d.useEffect(()=>()=>{m&&t.invalidateQueries({queryKey:["user",r]})},[m,t,r]),c?a.jsx("div",{className:"flex justify-center items-center h-full",children:a.jsx(C,{})}):s&&a.jsx(R,{defaultValues:s,onSubmit:h,isPending:E||!!o,headerPrimaryBtnLabel:"Alterar",headerTitle:"Alterar usuário",isEdit:!0,resource:"USERS",action:"UPDATE",allowEditRole:!0})}function H(){return a.jsx(N,{children:a.jsx(I,{})})}export{H as default};
