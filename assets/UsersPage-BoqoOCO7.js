import{r as d,j as e,a as U,N as D,i as C,u as S,b as L,c as A,d as N,l as h,e as y,B as T,f as B,U as c}from"./index-LO79eavt.js";import{P}from"./PageHeader-C8ixiw9T.js";import{S as F,T as n}from"./Table-DGlZs8M8.js";import{F as $,I as g,u as k}from"./schemas-C0aL5P6j.js";import{C as E}from"./Choice-BGWichA8.js";import{u as w,D as b,b as M}from"./useDialog-pT-Uqh-i.js";import{S as q}from"./index-D_CRHVj8.js";import{u as R}from"./useDialogContext-oL-r0D91.js";import{u as j,f as H}from"./react-pdf.browser-BkjHwKfS.js";import"./index-DfarobFx.js";const I=d.createContext(null);function K({children:a}){const[t,s]=d.useState("");function i(u){s(u)}const l=d.useMemo(()=>({example:t,handleExample:i}),[t]);return e.jsx(I.Provider,{value:l,children:a})}function Q(a){const t=[];for(const s of a.data)t.push({...s,phone:U(s==null?void 0:s.phone,"phone")??"",cpf:U(s==null?void 0:s.cpf,"cpf")??""});return{total:a.total,data:t}}function z(){const{usersFilter:a,handleUsersFilter:t}=j(),{closeDialog:s}=R();function i(l){t({page:1,...l}),s()}return e.jsx($,{schema:q,onSubmit:i,className:"flex-1 flex flex-col min-h-0",defaultValues:{fullName:(a==null?void 0:a.fullName)||"",status:(a==null?void 0:a.status)||"active",startDate:(a==null?void 0:a.startDate)||"",endDate:(a==null?void 0:a.endDate)||""},replaceEmptyStringToNull:!1,children:e.jsx(O,{})})}function O(){const{reset:a}=w(),{handleUsersFilter:t}=j(),{closeDialog:s}=R();function i(){t(D),a(D),s()}return e.jsxs(e.Fragment,{children:[e.jsxs(F.Body,{className:"flex flex-col gap-4",children:[e.jsx(g,{name:"fullName",label:"Nome completo"}),e.jsx(k,{label:"Status"}),e.jsx("div",{className:"flex flex-col gap-2",children:e.jsxs(E,{hideErrorLabel:!0,children:[e.jsx(E.Radio,{name:"status",label:"Ativo",value:"active"}),e.jsx(E.Radio,{name:"status",label:"Inativo",value:"inactive"})]})}),e.jsx(g,{name:"startDate",label:"Data inicial de criação",type:"date"}),e.jsx(g,{name:"endDate",label:"Data final de criação",type:"date"})]}),e.jsx(F.Footer,{primaryLabel:"Aplicar",secondaryLabel:"Limpar",onSecondaryCallback:i,dirty:!0})]})}const V=d.memo(z);function _({fullName:a,userId:t,isActive:s,handleDisableUserInfo:i}){const l=C(),{safeFetch:u}=S(),{showSuccessSnackbar:m}=L(),x=A();async function f(){await u(`${y}/user/${t}`,{method:"DELETE",body:{archivedAt:null},resource:"USERS",action:"DELETE"})}const{mutate:p,isPending:r}=N({mutationFn:f,onSuccess:()=>{x.invalidateQueries({queryKey:["users"]}),m({title:`Usuário ${a} ativado com sucesso`})}});return s?e.jsxs(e.Fragment,{children:[e.jsx(h,{tooltipMessage:"Editar",variant:"quaternary",iconLeft:"Edit",onClick:()=>l(`/users/edit/${t}`),resource:"USERS",action:"UPDATE",padding:"none","data-cy":`button-edit-user-${t}`}),e.jsx(h,{tooltipMessage:"Desativar",variant:"primary",iconLeft:"Delete",color:"red",padding:"none",onClick:()=>i({userName:a,userId:t}),resource:"USERS",action:"DELETE","data-cy":`button-disable-user-${t}`})]}):e.jsx(h,{tooltipMessage:"Ativar",variant:"quaternary",onClick:p,state:r?"loading":void 0,resource:"USERS",action:"DELETE",padding:"none",iconLeft:"ToggleOn","data-cy":`button-enable-user-${t}`})}function G({userId:a,userName:t,...s}){const{safeFetch:i}=S(),{showSuccessSnackbar:l}=L(),u=A(),{handleUsersFilter:m}=j();async function x(){await i(`${y}/user/${a}`,{method:"DELETE",body:{archivedAt:new Date().toISOString()},resource:"USERS",action:"DELETE"})}const{mutate:f,isPending:p}=N({mutationFn:x,onSuccess:()=>{m({page:1}),u.invalidateQueries({queryKey:["users"]}),l({title:`Usuário ${t} desativado com sucesso`}),s.closeDialog()}});return e.jsxs(b,{...s,children:[e.jsx(b.Header,{title:"Desativar usuário"}),e.jsx(b.Body,{children:e.jsxs("span",{className:"text-body-medium text-neutral-700",children:["Tem certeza que deseja desativar o usuário",e.jsxs("span",{className:"font-bold",children:[T,t]}),"? Ao desativar ele não poderá mais acessar o sistema"]})}),e.jsx(b.Footer,{labelPrimaryBtn:"Desativar",onClickPrimaryBtn:f,primaryBtnState:p?"loading":void 0,primaryBtnColor:"red",primaryBtnResource:"USERS",primaryBtnAction:"DELETE"})]})}const J=!1;function W(){const[a,t]=d.useState({userName:"",userId:""}),s=M(),{safeFetch:i}=S(),{usersFilter:l,handleUsersFilter:u}=j();function m(o){s.openDialog(),t(o)}function x(o){u({page:o})}const f=d.useMemo(()=>l?H(l):"",[l]);async function p(o){return await i(`${y}/user?${o}&orderBy=fullName`,{resource:"USERS",action:"READ"})}const{data:r,isFetching:v}=B({queryKey:["users",f],queryFn:({queryKey:o})=>p(o[1]),select:Q});return e.jsxs(e.Fragment,{children:[e.jsx(G,{...a,...s}),e.jsxs("div",{className:"flex gap-4 justify-end",children:[J,e.jsx(n.Filter,{form:e.jsx(V,{})})]}),e.jsxs(n,{children:[e.jsxs(n.Header,{children:[e.jsx(n.Head,{label:c.name.label}),e.jsx(n.Head,{label:c.cpf.label}),e.jsx(n.Head,{label:c.email.label}),e.jsx(n.Head,{label:c.phone.label}),e.jsx(n.Head,{label:c.status.label}),e.jsx(n.Head,{action:!0})]}),e.jsx(n.Body,{isLoading:v,isEmpty:!(r!=null&&r.total),resource:"USERS",action:"READ",children:r==null?void 0:r.data.map(o=>e.jsxs(n.Row,{children:[e.jsx(n.Cell,{label:o.fullName,columnLabel:c.name.label}),e.jsx(n.Cell,{label:o.cpf,columnLabel:c.cpf.label}),e.jsx(n.Cell,{label:o.email,columnLabel:c.email.label}),e.jsx(n.Cell,{label:o.phone,columnLabel:c.phone.label}),e.jsx(n.Cell,{label:o.archivedAt?"Inativo":"Ativo",columnLabel:c.status.label}),e.jsx(n.Action,{children:e.jsx(_,{isActive:!o.archivedAt,userId:String(o.id),fullName:o.fullName,handleDisableUserInfo:m})})]},o.id))}),e.jsx(n.Footer,{currentStartItem:l==null?void 0:l.page,totalItems:r==null?void 0:r.total,onClickNavigateBtn:x,isLoading:v})]})]})}function ie({contextHelper:a}){const t=C();return e.jsx(K,{children:e.jsxs("div",{className:"flex flex-col gap-4 h-full w-full",children:[e.jsx(P,{title:"Usuários",contextHelper:a,children:e.jsx(h,{label:"Adicionar usuário",iconLeft:"Add",onClick:()=>t("/users/new"),resource:"USERS",action:"CREATE",color:"green","data-cy":"new-user-button",tooltipMessage:"Adicionar novo usuário"})}),e.jsx(W,{})]})})}export{ie as default};
