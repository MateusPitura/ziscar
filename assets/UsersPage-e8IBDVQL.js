import{r as x,j as e,u as D,a as C,b as v,c as N,d as A,e as R,T as E,B as j,f as g,g as T,h as P}from"./index-B_iWEUUC.js";import{P as $}from"./PageHeader-DfUmqkU2.js";import{S as U,T as o}from"./Table-D_1FooX_.js";import{a as B,F as k,u as q,I as y,b as F}from"./schemas-D1jfyf81.js";import{C as m}from"./Choice-B-eajStn.js";import{S as w}from"./index-jdHX1-O2.js";import{u as L}from"./useDialogContext-BID4jU4R.js";import{u as b,f as I}from"./react-pdf.browser-BCQg-I2E.js";import{D as h}from"./Dialog-CGi7XIRs.js";import{u as H}from"./useDialog-C-b4l8WV.js";import{E as K}from"./ExportButton-Cy4AqN82.js";import"./index-CS_UDAGd.js";import"./useIsFetching-DqnnrfEG.js";const M=x.createContext(null);function Q({children:a}){const[t,s]=x.useState("");function l(c){s(c)}const r=x.useMemo(()=>({example:t,handleExample:l}),[t]);return e.jsx(M.Provider,{value:r,children:a})}function O(a){const t=[];for(const s of a.data)t.push({...s,phone:B(s==null?void 0:s.phone,"phone")});return{total:a.total,data:t}}function V(){const{usersFilter:a,handleUsersFilter:t}=b(),{closeDialog:s}=L();function l(r){t({page:1,...r}),s()}return e.jsx(k,{schema:w,onSubmit:l,className:"flex-1 flex flex-col",defaultValues:{fullName:(a==null?void 0:a.fullName)||"",orderBy:(a==null?void 0:a.orderBy)||"fullName",status:(a==null?void 0:a.status)||"active",startDate:(a==null?void 0:a.startDate)||"",endDate:(a==null?void 0:a.endDate)||""},replaceEmptyStringToNull:!1,children:e.jsx(z,{})})}function z(){const{reset:a}=q(),{handleUsersFilter:t}=b(),{closeDialog:s}=L();function l(){t(D),a(D),s()}return e.jsxs(e.Fragment,{children:[e.jsxs(U.Body,{className:"flex flex-col gap-4",children:[e.jsx(y,{name:"fullName",label:"Nome completo"}),e.jsx(F,{label:"Status"}),e.jsx("div",{className:"flex flex-col gap-2",children:e.jsxs(m,{hideErrorLabel:!0,children:[e.jsx(m.Radio,{name:"status",label:"Ativo",value:"active"}),e.jsx(m.Radio,{name:"status",label:"Inativo",value:"inactive"})]})}),e.jsx(y,{name:"startDate",label:"Data inicial",type:"date"}),e.jsx(y,{name:"endDate",label:"Data final",type:"date"}),e.jsx(F,{label:"Ordenar por"}),e.jsx("div",{className:"flex flex-col gap-2",children:e.jsxs(m,{hideErrorLabel:!0,children:[e.jsx(m.Radio,{name:"orderBy",label:"Nome",value:"fullName"}),e.jsx(m.Radio,{name:"orderBy",label:"Email",value:"email"})]})})]}),e.jsx(U.Footer,{primaryLabel:"Aplicar",secondaryLabel:"Limpar",onSecondaryCallback:l,dirty:!0})]})}const _=x.memo(V);function G({fullName:a,userId:t,isActive:s,handleDisableUserInfo:l}){const r=C(),{safeFetch:c}=v(),{showSuccessSnackbar:f}=N(),p=A();async function u(){await c(`${g}/user/${t}`,{method:"DELETE",body:{archivedAt:null},resource:"USERS",action:"DELETE"})}const{mutate:d,isPending:i}=R({mutationFn:u,onSuccess:()=>{p.invalidateQueries({queryKey:["users"]}),f({title:`Usuário ${a} ativado com sucesso`})}});return s?e.jsxs(e.Fragment,{children:[e.jsx(E,{content:"Editar",children:e.jsx(j,{variant:"quaternary",iconLeft:"Edit",onClick:()=>r(`/users/edit/${t}`),resource:"USERS",action:"UPDATE",padding:"none","data-cy":`button-edit-user-${t}`})}),e.jsx(E,{content:"Desativar",children:e.jsx(j,{variant:"primary",iconLeft:"Delete",color:"red",padding:"none",onClick:()=>l({userName:a,userId:t}),resource:"USERS",action:"DELETE","data-cy":`button-disable-user-${t}`})})]}):e.jsx(E,{content:"Ativar",children:e.jsx(j,{variant:"quaternary",onClick:d,state:i?"loading":void 0,resource:"USERS",action:"DELETE",padding:"none",iconLeft:"ToggleOn","data-cy":`button-enable-user-${t}`})})}function J({userId:a,userName:t,...s}){const{safeFetch:l}=v(),{showSuccessSnackbar:r}=N(),c=A(),{handleUsersFilter:f}=b();async function p(){await l(`${g}/user/${a}`,{method:"DELETE",body:{archivedAt:new Date().toISOString()},resource:"USERS",action:"DELETE"})}const{mutate:u,isPending:d}=R({mutationFn:p,onSuccess:()=>{f({page:1}),c.invalidateQueries({queryKey:["users"]}),r({title:`Usuário ${t} desativado com sucesso`}),s.closeDialog()}});return e.jsxs(h,{...s,children:[e.jsx(h.Header,{title:"Desativar usuário"}),e.jsx(h.Body,{children:e.jsxs("span",{className:"text-body-medium text-neutral-700",children:["Tem certeza que deseja desativar o usuário",e.jsxs("span",{className:"font-bold",children:[T,t]}),"? Ao desativar ele não poderá mais acessar o sistema"]})}),e.jsx(h.Footer,{labelPrimaryBtn:"Desativar",onClickPrimaryBtn:u,primaryBtnState:d?"loading":void 0,primaryBtnColor:"red",primaryBtnResource:"USERS",primaryBtnAction:"DELETE"})]})}function W(a){const t=[];for(const s of a.data)t.push({...s,phone:B(s==null?void 0:s.phone,"phone")});return t}function X(){const[a,t]=x.useState({userName:"",userId:""}),s=H(),{safeFetch:l}=v(),{usersFilter:r,handleUsersFilter:c}=b();function f(n){s.openDialog(),t(n)}function p(n){c({page:n})}const u=x.useMemo(()=>r?I(r):"",[r]);async function d(n){return await l(`${g}/user?${n}`,{resource:"USERS",action:"READ"})}const{data:i,isFetching:S}=P({queryKey:["users",u],queryFn:({queryKey:n})=>d(n[1]),select:O});return e.jsxs(e.Fragment,{children:[e.jsx(J,{...a,...s}),e.jsxs("div",{className:"flex gap-4 justify-end",children:[e.jsx(K,{fileName:"Relatório Usuários",resource:"USERS",queryKey:["users",u],queryFn:d,selectQueryFn:W,formatFilters:{fullName:"Nome completo",orderBy:"Ordenar por",status:"Status",startDate:"Data inicial",endDate:"Data final"},formatFiltersValues:{orderBy:{email:"Email",fullName:"Nome completo"},status:{active:"Ativo",inactive:"Inativo"}},formatColumns:{id:"ID",fullName:"Nome",email:"Email",phone:"Celular",archivedAt:"Ativo"}}),e.jsx(o.Filter,{form:e.jsx(_,{})})]}),e.jsxs(o,{children:[e.jsxs(o.Header,{children:[e.jsx(o.Head,{label:"ID"}),e.jsx(o.Head,{label:"Nome completo"}),e.jsx(o.Head,{label:"Email"}),e.jsx(o.Head,{label:"Celular"}),e.jsx(o.Head,{label:"Status"}),e.jsx(o.Head,{action:!0})]}),e.jsx(o.Body,{isLoading:S,isEmpty:!(i!=null&&i.total),resource:"USERS",action:"READ",children:i==null?void 0:i.data.map(n=>e.jsxs(o.Row,{children:[e.jsx(o.Cell,{label:String(n.id)}),e.jsx(o.Cell,{label:n.fullName}),e.jsx(o.Cell,{label:n.email}),e.jsx(o.Cell,{label:n.phone}),e.jsx(o.Cell,{label:n.archivedAt?"Inativo":"Ativo"}),e.jsx(o.Action,{children:e.jsx(G,{isActive:!n.archivedAt,userId:String(n.id),fullName:n.fullName,handleDisableUserInfo:f})})]},n.id))}),e.jsx(o.Footer,{currentStartItem:r==null?void 0:r.page,totalItems:i==null?void 0:i.total,onClickNavigateBtn:p,isLoading:S})]})]})}function Y(){const a=C();return e.jsxs("div",{className:"flex flex-col gap-4 h-full w-full",children:[e.jsx($,{title:"Usuários",children:e.jsx(j,{label:"Adicionar usuário",iconLeft:"Add",onClick:()=>a("/users/new"),resource:"USERS",action:"CREATE",color:"green","data-cy":"new-user-button"})}),e.jsx(X,{})]})}function me(){return e.jsx(Q,{children:e.jsx(Y,{})})}export{me as default};
