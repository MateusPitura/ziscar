import{r as m,j as e,u as v,b as C,c as F,d as A,B as N,e as g,i as R,T as p,k as f,W as L,f as P,X as c}from"./index-CrVTpVTI.js";import{P as $}from"./PageHeader-DARJqnt5.js";import{S as T,T as t}from"./Table-CQjU_dFI.js";import{u as h,f as O}from"./react-pdf.browser-DHIQ3vjp.js";import{u as k}from"./DialogContext-3LqbYYdn.js";import{D as b}from"./Dialog-BHTFXl4K.js";import{s as q}from"./selectStoresInfo-36oKAABV.js";import{F as w,I as y,u as H}from"./schemas-B7gcU9vp.js";import{C as E}from"./Choice-LKCp7m0f.js";import{u as K}from"./useButtonState-C7TXS9Jx.js";import{S as I}from"./index-hFX5y6l5.js";import{u as B}from"./useDialogContext-BkmWcj_q.js";import"./dialog-Ct9-qcrh.js";import"./index-CLx72V5J.js";const Q=m.createContext(null);function M({children:a}){const[s,l]=m.useState("");function i(u){l(u)}const o=m.useMemo(()=>({example:s,handleExample:i}),[s]);return e.jsx(Q.Provider,{value:o,children:a})}function z({storeId:a,storeName:s,...l}){const{safeFetch:i}=v(),{showSuccessSnackbar:o}=C(),u=F(),{handleStoresFilter:x}=h();async function d(){await i(`${g}/store/${a}`,{method:"DELETE",body:{archivedAt:new Date().toISOString()},resource:"STORES",action:"DELETE"})}const{mutate:j,isPending:S}=A({mutationFn:d,onSuccess:()=>{x({page:1}),u.invalidateQueries({queryKey:["stores"]}),u.invalidateQueries({queryKey:["vehicles"]}),o({title:`Loja ${s} desativada com sucesso`}),l.closeDialog()}});return e.jsxs(b,{...l,children:[e.jsx(b.Header,{title:"Desativar loja"}),e.jsx(b.Body,{children:e.jsxs("span",{className:"text-body-medium text-neutral-700",children:["Tem certeza que deseja desativar a loja",e.jsxs("span",{className:"font-bold",children:[N,s]}),"? Ao desativar os veículos dessa loja não serão mais acessíveis"]})}),e.jsx(b.Footer,{labelPrimaryBtn:"Desativar",onClickPrimaryBtn:j,primaryBtnState:S?"loading":void 0,primaryBtnColor:"red",primaryBtnResource:"STORES",primaryBtnAction:"DELETE"})]})}function U({storeId:a,name:s,isActive:l,handleDisableStoreInfo:i}){const o=R(),{safeFetch:u}=v(),{showSuccessSnackbar:x}=C(),d=F();async function j(){await u(`${g}/store/${a}`,{method:"DELETE",body:{archivedAt:null},resource:"STORES",action:"DELETE"})}const{mutate:S,isPending:r}=A({mutationFn:j,onSuccess:()=>{d.invalidateQueries({queryKey:["stores"]}),d.invalidateQueries({queryKey:["vehicles"]}),x({title:`Loja ${s} ativada com sucesso`})}});return l?e.jsxs(e.Fragment,{children:[e.jsx(p,{content:"Editar",children:e.jsx(f,{variant:"quaternary",iconLeft:"Edit",onClick:()=>o(`/stores/edit/${a}`),resource:"STORES",action:"UPDATE",padding:"none","data-cy":`button-edit-store-${a}`})}),e.jsx(p,{content:"Desativar",children:e.jsx(f,{variant:"primary",iconLeft:"Delete",color:"red",padding:"none",onClick:()=>i({storeName:s,storeId:a}),resource:"STORES",action:"DELETE","data-cy":`button-disable-store-${a}`})})]}):e.jsx(p,{content:"Ativar",children:e.jsx(f,{variant:"quaternary",onClick:S,state:r?"loading":void 0,resource:"STORES",action:"DELETE",padding:"none",iconLeft:"ToggleOn","data-cy":`button-enable-store-${a}`})})}function V(){const{storesFilter:a,handleStoresFilter:s}=h(),{closeDialog:l}=B();function i(o){s({page:1,...o}),l()}return e.jsx(w,{schema:I,onSubmit:i,className:"flex-1 flex flex-col min-h-0",defaultValues:{name:(a==null?void 0:a.name)||"",status:(a==null?void 0:a.status)||"active",startDate:(a==null?void 0:a.startDate)||"",endDate:(a==null?void 0:a.endDate)||""},replaceEmptyStringToNull:!1,children:e.jsx(_,{})})}function _(){const{reset:a}=K(),{handleStoresFilter:s}=h(),{closeDialog:l}=B();function i(){s(L),a(L),l()}return e.jsxs(e.Fragment,{children:[e.jsxs(T.Body,{className:"flex flex-col gap-4",children:[e.jsx(y,{name:"name",label:"Nome"}),e.jsx(H,{label:"Status"}),e.jsx("div",{className:"flex flex-col gap-2",children:e.jsxs(E,{hideErrorLabel:!0,children:[e.jsx(E.Radio,{name:"status",label:"Ativo",value:"active"}),e.jsx(E.Radio,{name:"status",label:"Inativo",value:"inactive"})]})}),e.jsx(y,{name:"startDate",label:"Data inicial de criação",type:"date"}),e.jsx(y,{name:"endDate",label:"Data final de criação",type:"date"})]}),e.jsx(T.Footer,{primaryLabel:"Aplicar",secondaryLabel:"Limpar",onSecondaryCallback:i,dirty:!0})]})}const W=m.memo(V),X=!1;function G(){const[a,s]=m.useState({storeName:"",storeId:""}),l=k(),{safeFetch:i}=v(),{storesFilter:o,handleStoresFilter:u}=h();function x(n){l.openDialog(),s(n)}function d(n){u({page:n})}const j=m.useMemo(()=>o?O(o):"",[o]);async function S(n){return await i(`${g}/store?${n}&orderBy=name`,{resource:"STORES",action:"READ"})}const{data:r,isFetching:D}=P({queryKey:["stores",j],queryFn:({queryKey:n})=>S(n[1]),select:q});return e.jsxs(e.Fragment,{children:[e.jsx(z,{...a,...l}),e.jsxs("div",{className:"flex gap-4 justify-end",children:[X,e.jsx(t.Filter,{form:e.jsx(W,{})})]}),e.jsxs(t,{children:[e.jsxs(t.Header,{children:[e.jsx(t.Head,{label:c.name.label}),e.jsx(t.Head,{label:c.cnpj.label}),e.jsx(t.Head,{label:c.email.label}),e.jsx(t.Head,{label:c.phone.label}),e.jsx(t.Head,{label:c.status.label}),e.jsx(t.Head,{action:!0})]}),e.jsx(t.Body,{isLoading:D,isEmpty:!(r!=null&&r.total),resource:"STORES",action:"READ",children:r==null?void 0:r.data.map(n=>e.jsxs(t.Row,{children:[e.jsx(t.Cell,{label:n.name,columnLabel:c.name.label}),e.jsx(t.Cell,{label:n.cnpj,columnLabel:c.cnpj.label}),e.jsx(t.Cell,{label:n.email,columnLabel:c.email.label}),e.jsx(t.Cell,{label:n.phone,columnLabel:c.phone.label}),e.jsx(t.Cell,{label:n.archivedAt?"Inativo":"Ativo",columnLabel:c.status.label}),e.jsx(t.Action,{children:e.jsx(U,{isActive:!n.archivedAt,storeId:String(n.id),name:n.name,handleDisableStoreInfo:x})})]},n.id))}),e.jsx(t.Footer,{currentStartItem:o==null?void 0:o.page,totalItems:r==null?void 0:r.total,onClickNavigateBtn:d,isLoading:D})]})]})}function J(){const a=R();return e.jsxs("div",{className:"flex flex-col gap-4 h-full w-full",children:[e.jsx($,{title:"Lojas",children:e.jsx(f,{label:"Adicionar loja",iconLeft:"Add",onClick:()=>a("/stores/new"),resource:"STORES",action:"CREATE",color:"green","data-cy":"new-store-button"})}),e.jsx(G,{})]})}function me(){return e.jsx(M,{children:e.jsx(J,{})})}export{me as default};
