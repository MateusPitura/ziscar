import{r as m,j as e,u as v,b as T,c as C,d as F,B,e as y,i as A,l as f,T as D,f as N,W as c}from"./index-BaodxefT.js";import{P}from"./PageHeader-BvWMz3kB.js";import{S as L,T as t}from"./Table-BxNCMX2w.js";import{u as p,f as $}from"./react-pdf.browser-1tYw-4Ca.js";import{D as b,u as O,b as q}from"./useDialog-B00w_pfZ.js";import{s as k}from"./selectStoresInfo-CBcDPhIi.js";import{F as w,I as h,u as H}from"./schemas-C9qoDM_Y.js";import{C as g}from"./Choice-DG1qq5-b.js";import{S as M}from"./index-BVVzb0mX.js";import{u as R}from"./useDialogContext-DcEUxhEZ.js";import"./index-CZBX8443.js";const K=m.createContext(null);function I({children:a}){const[n,l]=m.useState("");function i(u){l(u)}const o=m.useMemo(()=>({example:n,handleExample:i}),[n]);return e.jsx(K.Provider,{value:o,children:a})}function Q({storeId:a,storeName:n,...l}){const{safeFetch:i}=v(),{showSuccessSnackbar:o}=T(),u=C(),{handleStoresFilter:x}=p();async function d(){await i(`${y}/store/${a}`,{method:"DELETE",body:{archivedAt:new Date().toISOString()},resource:"STORES",action:"DELETE"})}const{mutate:j,isPending:S}=F({mutationFn:d,onSuccess:()=>{x({page:1}),u.invalidateQueries({queryKey:["stores"]}),u.invalidateQueries({queryKey:["vehicles"]}),o({title:`Loja ${n} desativada com sucesso`}),l.closeDialog()}});return e.jsxs(b,{...l,children:[e.jsx(b.Header,{title:"Desativar loja"}),e.jsx(b.Body,{children:e.jsxs("span",{className:"text-body-medium text-neutral-700",children:["Tem certeza que deseja desativar a loja",e.jsxs("span",{className:"font-bold",children:[B,n]}),"? Ao desativar os veículos dessa loja não serão mais acessíveis"]})}),e.jsx(b.Footer,{labelPrimaryBtn:"Desativar",onClickPrimaryBtn:j,primaryBtnState:S?"loading":void 0,primaryBtnColor:"red",primaryBtnResource:"STORES",primaryBtnAction:"DELETE"})]})}function z({storeId:a,name:n,isActive:l,handleDisableStoreInfo:i}){const o=A(),{safeFetch:u}=v(),{showSuccessSnackbar:x}=T(),d=C();async function j(){await u(`${y}/store/${a}`,{method:"DELETE",body:{archivedAt:null},resource:"STORES",action:"DELETE"})}const{mutate:S,isPending:r}=F({mutationFn:j,onSuccess:()=>{d.invalidateQueries({queryKey:["stores"]}),d.invalidateQueries({queryKey:["vehicles"]}),x({title:`Loja ${n} ativada com sucesso`})}});return l?e.jsxs(e.Fragment,{children:[e.jsx(f,{tooltipMessage:"Editar",variant:"quaternary",iconLeft:"Edit",onClick:()=>o(`/stores/edit/${a}`),resource:"STORES",action:"UPDATE",padding:"none","data-cy":`button-edit-store-${a}`}),e.jsx(f,{tooltipMessage:"Desativar",variant:"primary",iconLeft:"Delete",color:"red",padding:"none",onClick:()=>i({storeName:n,storeId:a}),resource:"STORES",action:"DELETE","data-cy":`button-disable-store-${a}`})]}):e.jsx(f,{tooltipMessage:"Ativar",variant:"quaternary",onClick:S,state:r?"loading":void 0,resource:"STORES",action:"DELETE",padding:"none",iconLeft:"ToggleOn","data-cy":`button-enable-store-${a}`})}function U(){const{storesFilter:a,handleStoresFilter:n}=p(),{closeDialog:l}=R();function i(o){n({page:1,...o}),l()}return e.jsx(w,{schema:M,onSubmit:i,className:"flex-1 flex flex-col min-h-0",defaultValues:{name:(a==null?void 0:a.name)||"",status:(a==null?void 0:a.status)||"active",startDate:(a==null?void 0:a.startDate)||"",endDate:(a==null?void 0:a.endDate)||""},replaceEmptyStringToNull:!1,children:e.jsx(V,{})})}function V(){const{reset:a}=O(),{handleStoresFilter:n}=p(),{closeDialog:l}=R();function i(){n(D),a(D),l()}return e.jsxs(e.Fragment,{children:[e.jsxs(L.Body,{className:"flex flex-col gap-4",children:[e.jsx(h,{name:"name",label:"Nome"}),e.jsx(H,{label:"Status"}),e.jsx("div",{className:"flex flex-col gap-2",children:e.jsxs(g,{hideErrorLabel:!0,children:[e.jsx(g.Radio,{name:"status",label:"Ativo",value:"active"}),e.jsx(g.Radio,{name:"status",label:"Inativo",value:"inactive"})]})}),e.jsx(h,{name:"startDate",label:"Data inicial de criação",type:"date"}),e.jsx(h,{name:"endDate",label:"Data final de criação",type:"date"})]}),e.jsx(L.Footer,{primaryLabel:"Aplicar",secondaryLabel:"Limpar",onSecondaryCallback:i,dirty:!0})]})}const _=m.memo(U),W=!1;function G(){const[a,n]=m.useState({storeName:"",storeId:""}),l=q(),{safeFetch:i}=v(),{storesFilter:o,handleStoresFilter:u}=p();function x(s){l.openDialog(),n(s)}function d(s){u({page:s})}const j=m.useMemo(()=>o?$(o):"",[o]);async function S(s){return await i(`${y}/store?${s}&orderBy=name`,{resource:"STORES",action:"READ"})}const{data:r,isFetching:E}=N({queryKey:["stores",j],queryFn:({queryKey:s})=>S(s[1]),select:k});return e.jsxs(e.Fragment,{children:[e.jsx(Q,{...a,...l}),e.jsxs("div",{className:"flex gap-4 justify-end",children:[W,e.jsx(t.Filter,{form:e.jsx(_,{})})]}),e.jsxs(t,{children:[e.jsxs(t.Header,{children:[e.jsx(t.Head,{label:c.name.label}),e.jsx(t.Head,{label:c.cnpj.label}),e.jsx(t.Head,{label:c.email.label}),e.jsx(t.Head,{label:c.phone.label}),e.jsx(t.Head,{label:c.status.label}),e.jsx(t.Head,{action:!0})]}),e.jsx(t.Body,{isLoading:E,isEmpty:!(r!=null&&r.total),resource:"STORES",action:"READ",children:r==null?void 0:r.data.map(s=>e.jsxs(t.Row,{children:[e.jsx(t.Cell,{label:s.name,columnLabel:c.name.label}),e.jsx(t.Cell,{label:s.cnpj,columnLabel:c.cnpj.label}),e.jsx(t.Cell,{label:s.email,columnLabel:c.email.label}),e.jsx(t.Cell,{label:s.phone,columnLabel:c.phone.label}),e.jsx(t.Cell,{label:s.archivedAt?"Inativo":"Ativo",columnLabel:c.status.label}),e.jsx(t.Action,{children:e.jsx(z,{isActive:!s.archivedAt,storeId:String(s.id),name:s.name,handleDisableStoreInfo:x})})]},s.id))}),e.jsx(t.Footer,{currentStartItem:o==null?void 0:o.page,totalItems:r==null?void 0:r.total,onClickNavigateBtn:d,isLoading:E})]})]})}function ie({contextHelper:a}){const n=A();return e.jsx(I,{children:e.jsxs("div",{className:"flex flex-col gap-4 h-full w-full",children:[e.jsx(P,{title:"Lojas",contextHelper:a,children:e.jsx(f,{label:"Adicionar loja",iconLeft:"Add",onClick:()=>n("/stores/new"),resource:"STORES",action:"CREATE",color:"green","data-cy":"new-store-button",tooltipMessage:"Adicionar nova loja"})}),e.jsx(G,{})]})})}export{ie as default};
