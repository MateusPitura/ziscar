import{t as H,a as v,u as g,b as S,c as D,d as C,j as e,B as L,e as b,i as N,w as F,l as x,r as y,o as P,f as T,x as A,y as c,E as j,S as B}from"./index-LO79eavt.js";import{u as w}from"./useIsFetching-DT0DLOnX.js";import{V as M}from"./VehicleExpenseHeader-nSecEM2x.js";import{T as n}from"./Table-DGlZs8M8.js";import{D as $}from"./DataField-DvGceO3C.js";import{D as m,b as _}from"./useDialog-pT-Uqh-i.js";import"./PageHeader-C8ixiw9T.js";import"./formatVehicleCharacteristics-BEECkIz-.js";import"./selectVehicleInfo-C2onKQ51.js";function q(s){var l,r;const o=[];for(const i of s)o.push({...i,totalValue:v(i.totalValue,"money")??"",competencyDate:H({date:(r=(l=i.competencyDate)==null?void 0:l.split("T"))==null?void 0:r[0],format:"dd/MM/yyyy"})});return o}function k({vehicleExpenseId:s,vehicleCategory:o,...l}){const{safeFetch:r}=g(),{showSuccessSnackbar:i}=S(),u=D();async function d(){await r(`${b}/vehicle-expense/${s}/archive`,{method:"PATCH",resource:"VEHICLE_EXPENSE",action:"DELETE"})}const{mutate:a,isPending:E}=C({mutationFn:d,onSuccess:()=>{u.invalidateQueries({queryKey:["vehicle-expenses"]}),i({title:"Gasto desativado com sucesso"}),l.closeDialog()}});return e.jsxs(m,{...l,children:[e.jsx(m.Header,{title:"Desativar gasto"}),e.jsx(m.Body,{children:e.jsxs("span",{className:"text-body-medium text-neutral-700",children:["Tem certeza que deseja desativar o gasto de",e.jsxs("span",{className:"font-bold",children:[L,o]}),"? Ao desativar ele não será mais acessível"]})}),e.jsx(m.Footer,{labelPrimaryBtn:"Desativar",onClickPrimaryBtn:a,primaryBtnState:E?"loading":void 0,primaryBtnColor:"red",primaryBtnResource:"VEHICLE_EXPENSE",primaryBtnAction:"DELETE"})]})}function X({vehicleExpenseId:s,vehicleCategory:o,isActive:l,handleDisableVehicleExpenseInfo:r}){const i=N(),{pathname:u}=F(),{safeFetch:d}=g(),a=D(),{showSuccessSnackbar:E}=S();async function h(){await d(`${b}/vehicle-expense/${s}/unarchive`,{method:"PATCH",resource:"VEHICLE_EXPENSE",action:"DELETE"})}const{mutate:p,isPending:t}=C({mutationFn:h,onSuccess:()=>{a.invalidateQueries({queryKey:["vehicle-expenses"]}),E({title:`Gasto de ${o} ativado com sucesso`})}});return l?e.jsxs(e.Fragment,{children:[e.jsx(x,{variant:"quaternary",tooltipMessage:"Editar",iconLeft:"Edit",onClick:()=>i(`${u}/edit/${s}`),resource:"VEHICLE_EXPENSE",action:"UPDATE",padding:"none","data-cy":`button-edit-vehicle-expense-${s}`}),e.jsx(x,{tooltipMessage:"Desativar",variant:"primary",iconLeft:"Delete",color:"red",padding:"none",onClick:()=>{r({vehicleExpenseId:s,vehicleCategory:o})},resource:"VEHICLE_EXPENSE",action:"DELETE","data-cy":`button-disable-vehicle-expense-${s}`})]}):e.jsx(x,{tooltipMessage:"Ativar",variant:"quaternary",onClick:p,state:t?"loading":void 0,resource:"VEHICLE_EXPENSE",action:"DELETE",padding:"none",iconLeft:"ToggleOn","data-cy":`button-enable-vehicle-expense-${s}`})}const V=8;function I(){const[s,o]=y.useState({vehicleExpenseId:"",vehicleCategory:""}),l=_(),{safeFetch:r}=g(),{vehicleId:i}=P();function u(t){l.openDialog(),o(t)}async function d(){return await r(`${b}/vehicle-expense/${i}`,{resource:"VEHICLE_EXPENSE",action:"READ"})}const{data:a,isFetching:E}=T({queryKey:["vehicle-expenses",i],queryFn:d,select:q}),h=y.useMemo(()=>a!=null&&a.length?Math.max(...a.map(t=>String(t.totalValue).length)):0,[a]),p=y.useMemo(()=>{if(!(a!=null&&a.length))return"0";let t=0;for(const f of a)f.archivedAt||(t+=Number(A(f.totalValue)));return String(t)},[a]);return e.jsxs(e.Fragment,{children:[e.jsx(k,{...s,...l}),e.jsx("div",{className:"w-fit",children:e.jsx($,{label:"Total de gastos",value:v(p,"money")})}),e.jsxs(n,{children:[e.jsxs(n.Header,{gridColumns:V,children:[e.jsx(n.Head,{label:c.competencyDate.label}),e.jsx(n.Head,{label:c.observations.label}),e.jsx(n.Head,{label:c.category.label}),e.jsx(n.Head,{label:c.totalValue.label,colSpan:c.totalValue.colSpan}),e.jsx(n.Head,{action:!0})]}),e.jsx(n.Body,{isLoading:E,isEmpty:!(a!=null&&a.length),resource:"VEHICLE_EXPENSE",action:"READ",children:a==null?void 0:a.map(t=>e.jsxs(n.Row,{gridColumns:V,children:[e.jsx(n.Cell,{label:t.competencyDate,columnLabel:c.competencyDate.label}),e.jsx(n.Cell,{label:t.observations,columnLabel:c.observations.label}),e.jsx(n.Cell,{label:j[t.category],columnLabel:c.category.label}),e.jsx(n.Cell,{id:String(t.id),label:t.totalValue.padStart(h,L),className:"font-mono whitespace-pre",colSpan:c.totalValue.colSpan,columnLabel:c.totalValue.label}),e.jsx(n.Action,{children:e.jsx(X,{vehicleExpenseId:String(t.id),vehicleCategory:j[t.category],handleDisableVehicleExpenseInfo:u,isActive:!t.archivedAt})})]},t.id))})]})]})}function Y({contextHelper:s}){return w({queryKey:["vehicle"]})?e.jsx("div",{className:"flex justify-center items-center h-full w-full",children:e.jsx(B,{})}):e.jsxs("div",{className:"flex flex-col gap-4 h-full w-full",children:[e.jsx(M,{title:"Gastos do Veículo",showActions:!0,contextHelper:s}),e.jsx(I,{})]})}export{Y as default};
