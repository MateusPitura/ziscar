import{r as x,j as e,b as y,c as F,d as T,e as A,g as L,f as v,o as S,a as R,T as b,B as h,h as M}from"./index-CV0TP6Xw.js";import{P as O}from"./PageHeader-CYamZWWv.js";import{u as p,S as D,f as P,T as s}from"./react-pdf.browser-2V5tEcKa.js";import{D as j,u as $}from"./Dialog-D3LjZ4tr.js";import{E as U}from"./ExportButton-rVWrpUeV.js";import{a as k,F as q,u as w,I as E,b as N}from"./index-D0UprIr6.js";import{u as B}from"./useDialogContext-CHrmIBbS.js";import{C as m}from"./Choice-CIb13fO6.js";import{S as H}from"./index-DUPOCjG2.js";import"./useIsFetching-DbePOVqm.js";const I=x.createContext(null);function K({children:a}){const[o,t]=x.useState("");function r(c){t(c)}const l=x.useMemo(()=>({example:o,handleExample:r}),[o]);return e.jsx(I.Provider,{value:l,children:a})}function Q(a){const o=[];for(const t of a.data)o.push({...t,phone:k(t==null?void 0:t.phone,"phone")??""});return{total:a.total,data:o}}function V({customerId:a,customerFullName:o,...t}){const{safeFetch:r}=y(),{showSuccessSnackbar:l}=F(),c=T(),{handleCustomersFilter:f}=p();async function C(){await r(`${v}/customer/${a}`,{method:"DELETE",body:{archivedAt:new Date().toISOString()},resource:"CUSTOMERS",action:"DELETE"})}const{mutate:u,isPending:d}=A({mutationFn:C,onSuccess:()=>{f({page:1}),c.invalidateQueries({queryKey:["customers"]}),l({title:`Cliente ${o} desativado com sucesso`}),t.closeDialog()}});return e.jsxs(j,{...t,children:[e.jsx(j.Header,{title:"Desativar cliente"}),e.jsx(j.Body,{children:e.jsxs("span",{className:"text-body-medium text-neutral-700",children:["Tem certeza que deseja desativar o cliente",e.jsxs("span",{className:"font-bold",children:[L,o]}),"? Ao desativar os registros relacionados a ele não serão mais acessíveis"]})}),e.jsx(j.Footer,{labelPrimaryBtn:"Desativar",onClickPrimaryBtn:u,primaryBtnState:d?"loading":void 0,primaryBtnColor:"red",primaryBtResource:"CUSTOMERS",primaryBtnAction:"DELETE"})]})}function z(){const{customersFilter:a,handleCustomersFilter:o}=p(),{closeDialog:t}=B();function r(l){o({page:1,...l}),t()}return e.jsx(q,{schema:H,onSubmit:r,className:"flex-1 flex flex-col",defaultValues:{fullName:(a==null?void 0:a.fullName)||"",orderBy:(a==null?void 0:a.orderBy)||"fullName",status:(a==null?void 0:a.status)||"active",startDate:(a==null?void 0:a.startDate)||"",endDate:(a==null?void 0:a.endDate)||""},replaceEmptyStringToNull:!1,children:e.jsx(_,{})})}function _(){const{reset:a}=w(),{handleCustomersFilter:o}=p(),{closeDialog:t}=B();function r(){o(S),a(S),t()}return e.jsxs(e.Fragment,{children:[e.jsxs(D.Body,{className:"flex flex-col gap-4",children:[e.jsx(E,{name:"fullName",label:"Nome completo"}),e.jsx(N,{label:"Status"}),e.jsx("div",{className:"flex flex-col gap-2",children:e.jsxs(m,{hideErrorLabel:!0,children:[e.jsx(m.Radio,{name:"status",label:"Ativo",value:"active"}),e.jsx(m.Radio,{name:"status",label:"Inativo",value:"inactive"})]})}),e.jsx(E,{name:"startDate",label:"Data inicial",type:"date"}),e.jsx(E,{name:"endDate",label:"Data final",type:"date"}),e.jsx(N,{label:"Ordenar por"}),e.jsx("div",{className:"flex flex-col gap-2",children:e.jsxs(m,{hideErrorLabel:!0,children:[e.jsx(m.Radio,{name:"orderBy",label:"Nome",value:"fullName"}),e.jsx(m.Radio,{name:"orderBy",label:"Email",value:"email"})]})})]}),e.jsx(D.Footer,{primaryLabel:"Aplicar",secondaryLabel:"Limpar",onSecondaryCallback:r,dirty:!0})]})}const G=x.memo(z);function J({customerId:a,fullName:o,isActive:t,handleDisableCustomerInfo:r}){const l=R(),{safeFetch:c}=y(),{showSuccessSnackbar:f}=F(),C=T();async function u(){await c(`${v}/customer/${a}`,{method:"DELETE",body:{archivedAt:null},resource:"CUSTOMERS",action:"DELETE"})}const{mutate:d,isPending:i}=A({mutationFn:u,onSuccess:()=>{C.invalidateQueries({queryKey:["customers"]}),f({title:`Cliente ${o} ativado com sucesso`})}});return t?e.jsxs(e.Fragment,{children:[e.jsx(b,{content:"Editar",children:e.jsx(h,{variant:"quaternary",iconLeft:"Edit",onClick:()=>l(`/customers/edit/${a}`),resource:"CUSTOMERS",action:"UPDATE",padding:"none","data-cy":`button-edit-customer-${a}`})}),e.jsx(b,{content:"Desativar",children:e.jsx(h,{variant:"primary",iconLeft:"Delete",color:"red",padding:"none",onClick:()=>r({customerFullName:o,customerId:a}),resource:"CUSTOMERS",action:"DELETE","data-cy":`button-disable-customer-${a}`})})]}):e.jsx(b,{content:"Ativar",children:e.jsx(h,{variant:"quaternary",onClick:d,state:i?"loading":void 0,resource:"CUSTOMERS",action:"DELETE",padding:"none",iconLeft:"ToggleOn","data-cy":`button-enable-customer-${a}`})})}function W(){const[a,o]=x.useState({customerFullName:"",customerId:""}),t=$(),{safeFetch:r}=y(),{customersFilter:l,handleCustomersFilter:c}=p();function f(n){t.openDialog(),o(n)}function C(n){c({page:n})}const u=x.useMemo(()=>l?P(l):"",[l]);async function d(n){return await r(`${v}/customer?${n}`,{resource:"CUSTOMERS",action:"READ"})}const{data:i,isFetching:g}=M({queryKey:["customers",u],queryFn:({queryKey:n})=>d(n[1]),select:Q});return e.jsxs(e.Fragment,{children:[e.jsx(V,{...a,...t}),e.jsxs("div",{className:"flex gap-4 justify-end",children:[e.jsx(U,{fileName:"Relatório Clientes",resource:"CUSTOMERS",queryKey:["customers",u],queryFn:d,formatFilters:{fullName:"Nome completo",orderBy:"Ordenar por",status:"Status",endDate:"Data final",startDate:"Data inicial"},formatFiltersValues:{orderBy:{email:"Email",fullName:"Nome completo"},status:{active:"Ativo",inactive:"Inativo"}},formatColumns:{id:"ID",fullName:"Nome completo",email:"Email",phone:"Celular",archivedAt:"Ativo"}}),e.jsx(s.Filter,{form:e.jsx(G,{})})]}),e.jsxs(s,{children:[e.jsxs(s.Header,{children:[e.jsx(s.Head,{label:"ID"}),e.jsx(s.Head,{label:"Nome completo"}),e.jsx(s.Head,{label:"Email"}),e.jsx(s.Head,{label:"Celular"}),e.jsx(s.Head,{label:"Status"}),e.jsx(s.Head,{action:!0})]}),e.jsx(s.Body,{isLoading:g,isEmpty:!(i!=null&&i.total),resource:"CUSTOMERS",action:"READ",children:i==null?void 0:i.data.map(n=>e.jsxs(s.Row,{children:[e.jsx(s.Cell,{label:String(n.id)}),e.jsx(s.Cell,{label:n.fullName}),e.jsx(s.Cell,{label:n.email}),e.jsx(s.Cell,{label:n.phone}),e.jsx(s.Cell,{label:n.archivedAt?"Inativo":"Ativo"}),e.jsx(s.Action,{children:e.jsx(J,{isActive:!n.archivedAt,customerId:String(n.id),fullName:n.fullName,handleDisableCustomerInfo:f})})]},n.id))}),e.jsx(s.Footer,{currentStartItem:l==null?void 0:l.page,totalItems:i==null?void 0:i.total,onClickNavigateBtn:C,isLoading:g})]})]})}function X(){const a=R();return e.jsxs("div",{className:"flex flex-col gap-4 h-full w-full",children:[e.jsx(O,{title:"Clientes",children:e.jsx(h,{label:"Adicionar cliente",iconLeft:"Add",onClick:()=>a("/customers/new"),resource:"CUSTOMERS",action:"CREATE",color:"green","data-cy":"new-customer-button"})}),e.jsx(W,{})]})}function ie(){return e.jsx(K,{children:e.jsx(X,{})})}export{ie as default};
