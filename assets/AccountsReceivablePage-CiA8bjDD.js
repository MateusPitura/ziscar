import{r as u,j as e,a as v,A as x,aD as b,f as E,T as j,g as h,u as D,h as y,aE as n,B as N,e as L}from"./index-CDuUmDit.js";import{P as V}from"./PageHeader-B5SIBKuZ.js";import{S as g,T as l}from"./Table-DGenUfom.js";import{S as P,A as R}from"./index-BBEx5tML.js";import{u as f,f as B}from"./react-pdf.browser-BH4xx2Am.js";import{E as I}from"./ExportButton-cBBOA7--.js";import{F as T,I as A,u as H}from"./schemas-CxmGnStq.js";import{u as _}from"./useButtonState-DJFFoANO.js";import{u as C}from"./useDialogContext-cToDCl1e.js";import{C as d}from"./Choice-D6VCytWq.js";import"./DialogContext-28MRl5PT.js";import"./dialog-3JPZnGOG.js";import"./useIsFetching-CQOvAVOi.js";const $=u.createContext(null);function q({children:t}){const[a,s]=u.useState("");function i(m){s(m)}const c=u.useMemo(()=>({example:a,handleExample:i}),[a]);return e.jsx($.Provider,{value:c,children:t})}function w(t){const a=[];for(const s of t.data)a.push({...s,totalValue:v(s.totalValue,"money")??""});return{total:t.total,data:a}}function M(t){const a=[];for(const s of t.data)a.push({...s,totalValue:v(s.totalValue,"money")??"",overallStatus:s.overallStatus==="PAID"?"Pago":"Pendente"});return a}function k(){const{accountsReceivableFilter:t,handleAccountsReceivableFilter:a}=f(),{closeDialog:s}=C();function i(c){a({page:1,...c}),s()}return e.jsx(T,{schema:P,onSubmit:i,className:"flex-1 flex flex-col min-h-0",defaultValues:{startDate:(t==null?void 0:t.startDate)||"",endDate:(t==null?void 0:t.endDate)||"",overallStatus:(t==null?void 0:t.overallStatus)||x.PAID},replaceEmptyStringToNull:!1,children:e.jsx(U,{})})}function U(){const{reset:t}=_(),{handleAccountsReceivableFilter:a}=f(),{closeDialog:s}=C();function i(){a(b),t(b),s()}return e.jsxs(e.Fragment,{children:[e.jsxs(g.Body,{className:"flex flex-col gap-4",children:[e.jsx(A,{name:"startDate",label:"Data inicial de criação",type:"date"}),e.jsx(A,{name:"endDate",label:"Data final de criação",type:"date"}),e.jsx(H,{label:"Status geral"}),e.jsx("div",{className:"flex flex-col gap-2",children:e.jsxs(d,{hideErrorLabel:!0,children:[e.jsx(d.Radio,{name:"overallStatus",label:"Pago",value:x.PAID}),e.jsx(d.Radio,{name:"overallStatus",label:"Pendente",value:x.PENDING})]})})]}),e.jsx(g.Footer,{primaryLabel:"Aplicar",secondaryLabel:"Limpar",onSecondaryCallback:i,dirty:!0})]})}const K=u.memo(k);function O({accountReceivableId:t,vehicleSaleId:a}){const s=E();return e.jsxs(e.Fragment,{children:[e.jsx(j,{content:"Veículo",children:e.jsx(h,{variant:"quaternary",iconLeft:"DirectionsCar",onClick:()=>s(`/vehicle-sale/view/${a}`),resource:"VEHICLE_SALE",action:"READ",padding:"none","data-cy":`button-view-vehicleSale-${a}`})}),e.jsx(j,{content:"Pagamento",children:e.jsx(h,{variant:"quaternary",iconLeft:"Visibility",onClick:()=>s(`/accounts-receivable/${t}/installments`),resource:"ACCOUNTS_RECEIVABLE",action:"READ",padding:"none","data-cy":`button-edit-accountReceivable-${t}`})})]})}const S=10;function G(){const{safeFetch:t}=D(),{accountsReceivableFilter:a,handleAccountsReceivableFilter:s}=f();function i(r){s({page:r})}const c=u.useMemo(()=>a?B(a):"",[a]);async function m(r){return await t(`${L}/account-receivable/search?${r}&orderBy=description`,{resource:"ACCOUNTS_RECEIVABLE",action:"READ"})}const{data:o,isFetching:p}=y({queryKey:["accounts-receivable",c],queryFn:({queryKey:r})=>m(r[1]),select:w}),F=u.useMemo(()=>o!=null&&o.data.length?Math.max(...o.data.map(r=>r.totalValue.length)):0,[o==null?void 0:o.data]);return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex gap-4 justify-end",children:[e.jsx(I,{fileName:"Relatório Contas a Receber",queryKey:["accounts-receivable",c],queryFn:m,selectQueryFn:M,formatFilters:{endDate:"Data final",startDate:"Data inicial",overallStatus:"Status geral"},formatFiltersValues:{overallStatus:{PAID:"Pago",PENDING:"Pendente"}},formatColumns:{installmentsNumber:"Número de parcelas",description:"Descrição",receivedFrom:"Recebido de",totalValue:"Valor total",overallStatus:"Status geral"}}),e.jsx(l.Filter,{form:e.jsx(K,{})})]}),e.jsxs(l,{children:[e.jsxs(l.Header,{gridColumns:S,children:[e.jsx(l.Head,{label:n.description.label}),e.jsx(l.Head,{label:n.installmentsNumber.label}),e.jsx(l.Head,{label:n.receivedFrom.label}),e.jsx(l.Head,{label:n.overallStatus.label}),e.jsx(l.Head,{label:n.totalValue.label,colSpan:n.totalValue.colSpan}),e.jsx(l.Head,{action:!0})]}),e.jsx(l.Body,{isLoading:p,isEmpty:!(o!=null&&o.total),resource:"ACCOUNTS_RECEIVABLE",action:"READ",children:o==null?void 0:o.data.map(r=>e.jsxs(l.Row,{gridColumns:S,children:[e.jsx(l.Cell,{label:r.description,columnLabel:n.description.label}),e.jsx(l.Cell,{label:r.installmentsNumber,columnLabel:n.installmentsNumber.label}),e.jsx(l.Cell,{label:r.receivedFrom,columnLabel:n.receivedFrom.label}),e.jsx(l.Cell,{label:e.jsx(R,{status:r.overallStatus}),columnLabel:n.overallStatus.label}),e.jsx(l.Cell,{label:r.totalValue.padStart(F,N),className:"font-mono whitespace-pre",colSpan:n.totalValue.colSpan,columnLabel:n.totalValue.label}),e.jsx(l.Action,{children:e.jsx(O,{accountReceivableId:String(r.id),vehicleSaleId:String(r.vehicleSaleId)})})]},r.id))}),e.jsx(l.Footer,{currentStartItem:a==null?void 0:a.page,totalItems:o==null?void 0:o.total,onClickNavigateBtn:i,isLoading:p})]})]})}function Q(){return e.jsxs("div",{className:"flex flex-col gap-4 h-full w-full",children:[e.jsx(V,{title:"Vendas"}),e.jsx(G,{})]})}function ne(){return e.jsx(q,{children:e.jsx(Q,{})})}export{ne as default};
