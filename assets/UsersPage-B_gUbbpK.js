import{r as d,j as e,a as D,N as C,i as L,u as y,b as A,c as N,d as R,T as E,k as h,e as v,B,f as P,U as c}from"./index-UdT0GBA4.js";import{P as $}from"./PageHeader-BWgTwsAh.js";import{S as F,T as n}from"./Table-C3pX6aIK.js";import{F as k,I as g,u as w}from"./schemas-BggDEbt9.js";import{C as S}from"./Choice-Dg5X3hHC.js";import{u as q}from"./useButtonState-N-GWfCKe.js";import{S as H}from"./index-AXMlH8He.js";import{u as T}from"./useDialogContext-3ywhn9HH.js";import{u as j,f as I}from"./react-pdf.browser--VWKIJ9j.js";import{D as b}from"./Dialog-EaJkbypX.js";import{u as M}from"./DialogContext-BXF1n5N_.js";import"./dialog-Cf7DmMJZ.js";import"./index-Bc_KExWn.js";const K=d.createContext(null);function Q({children:a}){const[t,s]=d.useState("");function r(u){s(u)}const l=d.useMemo(()=>({example:t,handleExample:r}),[t]);return e.jsx(K.Provider,{value:l,children:a})}function z(a){const t=[];for(const s of a.data)t.push({...s,phone:D(s==null?void 0:s.phone,"phone")??"",cpf:D(s==null?void 0:s.cpf,"cpf")??""});return{total:a.total,data:t}}function O(){const{usersFilter:a,handleUsersFilter:t}=j(),{closeDialog:s}=T();function r(l){t({page:1,...l}),s()}return e.jsx(k,{schema:H,onSubmit:r,className:"flex-1 flex flex-col min-h-0",defaultValues:{fullName:(a==null?void 0:a.fullName)||"",status:(a==null?void 0:a.status)||"active",startDate:(a==null?void 0:a.startDate)||"",endDate:(a==null?void 0:a.endDate)||""},replaceEmptyStringToNull:!1,children:e.jsx(V,{})})}function V(){const{reset:a}=q(),{handleUsersFilter:t}=j(),{closeDialog:s}=T();function r(){t(C),a(C),s()}return e.jsxs(e.Fragment,{children:[e.jsxs(F.Body,{className:"flex flex-col gap-4",children:[e.jsx(g,{name:"fullName",label:"Nome completo"}),e.jsx(w,{label:"Status"}),e.jsx("div",{className:"flex flex-col gap-2",children:e.jsxs(S,{hideErrorLabel:!0,children:[e.jsx(S.Radio,{name:"status",label:"Ativo",value:"active"}),e.jsx(S.Radio,{name:"status",label:"Inativo",value:"inactive"})]})}),e.jsx(g,{name:"startDate",label:"Data inicial de criação",type:"date"}),e.jsx(g,{name:"endDate",label:"Data final de criação",type:"date"})]}),e.jsx(F.Footer,{primaryLabel:"Aplicar",secondaryLabel:"Limpar",onSecondaryCallback:r,dirty:!0})]})}const _=d.memo(O);function G({fullName:a,userId:t,isActive:s,handleDisableUserInfo:r}){const l=L(),{safeFetch:u}=y(),{showSuccessSnackbar:m}=A(),x=N();async function f(){await u(`${v}/user/${t}`,{method:"DELETE",body:{archivedAt:null},resource:"USERS",action:"DELETE"})}const{mutate:p,isPending:i}=R({mutationFn:f,onSuccess:()=>{x.invalidateQueries({queryKey:["users"]}),m({title:`Usuário ${a} ativado com sucesso`})}});return s?e.jsxs(e.Fragment,{children:[e.jsx(E,{content:"Editar",children:e.jsx(h,{variant:"quaternary",iconLeft:"Edit",onClick:()=>l(`/users/edit/${t}`),resource:"USERS",action:"UPDATE",padding:"none","data-cy":`button-edit-user-${t}`})}),e.jsx(E,{content:"Desativar",children:e.jsx(h,{variant:"primary",iconLeft:"Delete",color:"red",padding:"none",onClick:()=>r({userName:a,userId:t}),resource:"USERS",action:"DELETE","data-cy":`button-disable-user-${t}`})})]}):e.jsx(E,{content:"Ativar",children:e.jsx(h,{variant:"quaternary",onClick:p,state:i?"loading":void 0,resource:"USERS",action:"DELETE",padding:"none",iconLeft:"ToggleOn","data-cy":`button-enable-user-${t}`})})}function J({userId:a,userName:t,...s}){const{safeFetch:r}=y(),{showSuccessSnackbar:l}=A(),u=N(),{handleUsersFilter:m}=j();async function x(){await r(`${v}/user/${a}`,{method:"DELETE",body:{archivedAt:new Date().toISOString()},resource:"USERS",action:"DELETE"})}const{mutate:f,isPending:p}=R({mutationFn:x,onSuccess:()=>{m({page:1}),u.invalidateQueries({queryKey:["users"]}),l({title:`Usuário ${t} desativado com sucesso`}),s.closeDialog()}});return e.jsxs(b,{...s,children:[e.jsx(b.Header,{title:"Desativar usuário"}),e.jsx(b.Body,{children:e.jsxs("span",{className:"text-body-medium text-neutral-700",children:["Tem certeza que deseja desativar o usuário",e.jsxs("span",{className:"font-bold",children:[B,t]}),"? Ao desativar ele não poderá mais acessar o sistema"]})}),e.jsx(b.Footer,{labelPrimaryBtn:"Desativar",onClickPrimaryBtn:f,primaryBtnState:p?"loading":void 0,primaryBtnColor:"red",primaryBtnResource:"USERS",primaryBtnAction:"DELETE"})]})}const W=!1;function X(){const[a,t]=d.useState({userName:"",userId:""}),s=M(),{safeFetch:r}=y(),{usersFilter:l,handleUsersFilter:u}=j();function m(o){s.openDialog(),t(o)}function x(o){u({page:o})}const f=d.useMemo(()=>l?I(l):"",[l]);async function p(o){return await r(`${v}/user?${o}&orderBy=fullName`,{resource:"USERS",action:"READ"})}const{data:i,isFetching:U}=P({queryKey:["users",f],queryFn:({queryKey:o})=>p(o[1]),select:z});return e.jsxs(e.Fragment,{children:[e.jsx(J,{...a,...s}),e.jsxs("div",{className:"flex gap-4 justify-end",children:[W,e.jsx(n.Filter,{form:e.jsx(_,{})})]}),e.jsxs(n,{children:[e.jsxs(n.Header,{children:[e.jsx(n.Head,{label:c.name.label}),e.jsx(n.Head,{label:c.cpf.label}),e.jsx(n.Head,{label:c.email.label}),e.jsx(n.Head,{label:c.phone.label}),e.jsx(n.Head,{label:c.status.label}),e.jsx(n.Head,{action:!0})]}),e.jsx(n.Body,{isLoading:U,isEmpty:!(i!=null&&i.total),resource:"USERS",action:"READ",children:i==null?void 0:i.data.map(o=>e.jsxs(n.Row,{children:[e.jsx(n.Cell,{label:o.fullName,columnLabel:c.name.label}),e.jsx(n.Cell,{label:o.cpf,columnLabel:c.cpf.label}),e.jsx(n.Cell,{label:o.email,columnLabel:c.email.label}),e.jsx(n.Cell,{label:o.phone,columnLabel:c.phone.label}),e.jsx(n.Cell,{label:o.archivedAt?"Inativo":"Ativo",columnLabel:c.status.label}),e.jsx(n.Action,{children:e.jsx(G,{isActive:!o.archivedAt,userId:String(o.id),fullName:o.fullName,handleDisableUserInfo:m})})]},o.id))}),e.jsx(n.Footer,{currentStartItem:l==null?void 0:l.page,totalItems:i==null?void 0:i.total,onClickNavigateBtn:x,isLoading:U})]})]})}function Y(){const a=L();return e.jsxs("div",{className:"flex flex-col gap-4 h-full w-full",children:[e.jsx($,{title:"Usuários",children:e.jsx(h,{label:"Adicionar usuário",iconLeft:"Add",onClick:()=>a("/users/new"),resource:"USERS",action:"CREATE",color:"green","data-cy":"new-user-button"})}),e.jsx(X,{})]})}function me(){return e.jsx(Q,{children:e.jsx(Y,{})})}export{me as default};
