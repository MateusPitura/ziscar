import{r as d,j as e,w as m,a as c,a3 as g,aD as b,i as N,l as T,u as M,f as B,aE as n,B as P,e as V}from"./index-BaodxefT.js";import{P as R}from"./PageHeader-BvWMz3kB.js";import{S as w}from"./Switch-D7upv-Sp.js";import{S as v,T as r}from"./Table-BxNCMX2w.js";import{A as H}from"./AccountStatus-iKPKeccA.js";import{D as x}from"./DataField-ClarmWOb.js";import{u as h,f as k}from"./react-pdf.browser-1tYw-4Ca.js";import{E as U}from"./ExportButton-Dx5afRnc.js";import{F as _,I as f,u as q}from"./schemas-C9qoDM_Y.js";import{C as j}from"./Choice-DG1qq5-b.js";import{u as E}from"./useDialogContext-DcEUxhEZ.js";import{u as O}from"./useDialog-B00w_pfZ.js";import{S as $}from"./index-BCwdgaKa.js";import"./Tag-cP9426l-.js";import"./useIsFetching-o-kdwTXk.js";const K=d.createContext(null);function Y({children:a}){const[t,s]=d.useState("");function i(p){s(p)}const u=d.useMemo(()=>({example:t,handleExample:i}),[t]);return e.jsx(K.Provider,{value:u,children:a})}function G(a){const t=[];for(const s of a.data)t.push({...s,totalValue:c(s.totalValue,"money")??"",date:s.date?m({date:s.date.split("T")[0],format:"dd/MM/yyyy"}):""});return{total:a.total,data:t,summary:a.summary}}function Q(a){const t=[];for(const s of a.data)t.push({...s,totalValue:c(s.totalValue,"money")??"",overallStatus:s.overallStatus==="PAID"?"Pago":"Pendente",date:s.date?m({date:s.date.split("T")[0],format:"dd/MM/yyyy"}):""});return t}function z(){const{accountsPayableFilter:a,handleAccountsPayableFilter:t}=h(),{closeDialog:s}=E();function i(u){t({page:1,...u}),s()}return e.jsx(_,{schema:$,onSubmit:i,className:"flex-1 flex flex-col min-h-0",defaultValues:{startDate:(a==null?void 0:a.startDate)||"",endDate:(a==null?void 0:a.endDate)||"",description:(a==null?void 0:a.description)||"",overallStatus:(a==null?void 0:a.overallStatus)||g.PAID},replaceEmptyStringToNull:!1,children:e.jsx(I,{})})}function I(){const{reset:a}=O(),{handleAccountsPayableFilter:t}=h(),{closeDialog:s}=E();function i(){t(b),a(b),s()}return e.jsxs(e.Fragment,{children:[e.jsxs(v.Body,{className:"flex flex-col gap-4",children:[e.jsx(f,{label:"Descrição",name:"description"}),e.jsx(f,{name:"startDate",label:"Data inicial de criação",type:"date"}),e.jsx(f,{name:"endDate",label:"Data final de criação",type:"date"}),e.jsx(q,{label:"Status geral"}),e.jsx("div",{className:"flex flex-col gap-2",children:e.jsxs(j,{hideErrorLabel:!0,children:[e.jsx(j.Radio,{name:"overallStatus",label:"Pago",value:g.PAID}),e.jsx(j.Radio,{name:"overallStatus",label:"Pendente",value:g.PENDING})]})})]}),e.jsx(v.Footer,{primaryLabel:"Aplicar",secondaryLabel:"Limpar",onSecondaryCallback:i,dirty:!0})]})}const J=d.memo(z);function W({accountPayableId:a}){const t=N();return e.jsx(T,{variant:"quaternary",iconLeft:"ReceiptLong",onClick:()=>t(`/accounts-payable/${a}/installments`),resource:"ACCOUNTS_PAYABLE",action:"READ",padding:"none","data-cy":`button-edit-accountPayable-${a}`,tooltipMessage:"Detalhes do pagamento"})}const C=10;function X(){var A,S,y;const{safeFetch:a}=M(),{accountsPayableFilter:t,handleAccountsPayableFilter:s}=h();function i(o){s({page:o})}const u=d.useMemo(()=>t?k(t):"",[t]);async function p(o){return await a(`${V}/account-payable/search?${o}&orderBy=description`,{resource:"ACCOUNTS_PAYABLE",action:"READ"})}const{data:l,isFetching:D}=B({queryKey:["accounts-payable",u],queryFn:({queryKey:o})=>p(o[1]),select:G}),F=d.useMemo(()=>l!=null&&l.data.length?Math.max(...l.data.map(o=>o.totalValue.length)):0,[l==null?void 0:l.data]),L=d.useMemo(()=>{if(!(t!=null&&t.startDate)||!(t!=null&&t.endDate))return!1;const o=m({date:new Date,format:"yyyy-MM-dd"});return t.startDate===o&&t.endDate===o},[t==null?void 0:t.startDate,t==null?void 0:t.endDate]);return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex gap-4 justify-between",children:[e.jsx(U,{fileName:"Relatório Pagamentos",queryKey:["accounts-payable",u],queryFn:p,selectQueryFn:Q,formatFilters:{endDate:"Data final",startDate:"Data inicial",overallStatus:"Status geral",description:"Descrição"},formatFiltersValues:{overallStatus:{PAID:"Pago",PENDING:"Pendente"}},formatColumns:{description:"Descrição",paidTo:"Pago a",overallStatus:"Status geral",totalValue:"Valor total"}}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx(w,{checked:L,label:"Contas de hoje",onCheck:()=>s({startDate:m({date:new Date,format:"yyyy-MM-dd"}),endDate:m({date:new Date,format:"yyyy-MM-dd"})}),onUncheck:()=>s({startDate:"",endDate:""})}),e.jsx(r.Filter,{form:e.jsx(J,{})})]})]}),e.jsxs("div",{className:"w-fit flex gap-4",children:[e.jsx(x,{label:"Total",value:c((A=l==null?void 0:l.summary)==null?void 0:A.totalOverall,"money")}),e.jsx(x,{label:"Total Pago",value:c((S=l==null?void 0:l.summary)==null?void 0:S.totalPaid,"money")}),e.jsx(x,{label:"Total Pendente",value:c((y=l==null?void 0:l.summary)==null?void 0:y.totalPending,"money")})]}),e.jsxs(r,{children:[e.jsxs(r.Header,{gridColumns:C,children:[e.jsx(r.Head,{label:n.description.label}),e.jsx(r.Head,{label:n.date.label}),e.jsx(r.Head,{label:n.paidTo.label}),e.jsx(r.Head,{label:n.overallStatus.label,colSpan:n.overallStatus.colSpan}),e.jsx(r.Head,{label:n.totalValue.label}),e.jsx(r.Head,{action:!0})]}),e.jsx(r.Body,{isLoading:D,isEmpty:!(l!=null&&l.total),resource:"ACCOUNTS_PAYABLE",action:"READ",children:l==null?void 0:l.data.map(o=>e.jsxs(r.Row,{gridColumns:C,children:[e.jsx(r.Cell,{label:o.description,columnLabel:n.description.label}),e.jsx(r.Cell,{label:o.date,columnLabel:n.date.label}),e.jsx(r.Cell,{label:o.paidTo,columnLabel:n.paidTo.label}),e.jsx(r.Cell,{label:e.jsx(H,{status:o.overallStatus}),columnLabel:n.overallStatus.label,colSpan:n.overallStatus.colSpan}),e.jsx(r.Cell,{label:o.totalValue.padStart(F,P),className:"font-mono whitespace-pre",columnLabel:n.totalValue.label}),e.jsx(r.Action,{children:e.jsx(W,{accountPayableId:String(o.id)})})]},o.id))}),e.jsx(r.Footer,{currentStartItem:t==null?void 0:t.page,totalItems:l==null?void 0:l.total,onClickNavigateBtn:i,isLoading:D})]})]})}function xe({contextHelper:a}){return e.jsx(Y,{children:e.jsxs("div",{className:"flex flex-col gap-4 h-full w-full",children:[e.jsx(R,{title:"Pagamentos",contextHelper:a}),e.jsx(X,{})]})})}export{xe as default};
