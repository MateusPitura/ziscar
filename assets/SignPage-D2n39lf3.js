import{r as u,aw as P,x as I,j as e,m as j,u as m,b,l as E,d as x,e as f,ax as k,ay as q,az as U,aA as A}from"./index-qW6Jgc2x.js";import{c as R}from"./useButtonState-D4P9Pwdl.js";import{I as l,F as h,S as D,w as N,z as v,M as F,P as B,K as O}from"./schemas-DhckABRc.js";import{u as _}from"./DialogContext-CCY72MLl.js";import{D as d}from"./Dialog-CraqqAPp.js";import{u as M}from"./useDialogContext-DbYsvN72.js";import{a as T}from"./index-CDEa5u-M.js";import"./dialog-D5XMW0Vt.js";import"./index-CImUiWf5.js";function G(a){if(a.has("token"))return a.get("token")}const y=u.createContext(null);function V({children:a}){const[s]=P(),o=I(),r=G(s),t=o.pathname.includes("new-account"),[n,i]=u.useState(r?"NEW_PASSWORD":t?"SIGN_UP":"SIGN_IN");function p(g){i(g)}const S=u.useMemo(()=>({step:n,handleStep:p}),[n]);return e.jsx(y.Provider,{value:S,children:a})}function W({title:a,children:s}){return e.jsxs("div",{className:"w-[23rem] h-[41rem] bg-neutral-50 shadow-md px-4 py-8 flex flex-col gap-8 rounded-md",children:[e.jsx("span",{className:"text-headline-large text-neutral-700 text-center",children:a}),s]})}function L({label:a,variant:s="primary",primaryBtnState:o,secondaryBtnLabel:r,onClickSecondaryBtn:t}){const n=R({buttonState:o});return e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx(j,{label:a,textAlign:"center",variant:s,state:n,fullWidth:!0,type:"submit"}),r&&e.jsx("div",{className:"flex-1 flex justify-center",children:e.jsx(j,{label:r,textAlign:"center",variant:"quaternary",onClick:t})})]})}const c=Object.assign(W,{Footer:L});function w({label:a,required:s,name:o,autoFocus:r=!1}){const[t,n]=u.useState(!1);return e.jsx(l,{name:o,label:a,required:s,iconRight:t?"Visibility":"VisibilityOff",onClickIconRight:()=>n(i=>!i),type:t?"text":"password",autoFocus:r})}function C(){const a=u.useContext(y);if(!a)throw new Error("useSignPageContext must be used within a SignPageProvider");return a}function $(){const{safeFetch:a}=m(),{showSuccessSnackbar:s}=b(),{handleStep:o}=C(),r=E(),[t]=P();let n=null;t.has("token")&&(n=t.get("token"));async function i(g){await a(`${f}/auth/reset-password`,{method:"POST",body:{password:g.newPassword,token:n}})}const{mutate:p,isPending:S}=x({mutationFn:i,onSuccess:()=>{r("/"),o("SIGN_IN"),s({title:"Senha definida com sucesso",description:"Acesse com a nova senha"})}});return e.jsxs(h,{defaultValues:{confirmPassword:"",newPassword:""},schema:D,onSubmit:p,className:"flex-1 flex flex-col",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx(w,{label:"Nova senha",name:"newPassword",required:!0,autoFocus:!0}),e.jsx(w,{label:"Confirmar senha",name:"confirmPassword",required:!0})]}),e.jsx(c.Footer,{label:"Salvar",primaryBtnState:S?"loading":void 0})]})}const z=T.pick({email:!0});function H(){const{safeFetch:a}=m(),{showSuccessSnackbar:s}=b(),{closeDialog:o}=M();async function r(i){await a(`${f}/auth/forget-password`,{method:"POST",body:i})}const{mutate:t,isPending:n}=x({mutationFn:r,onSuccess:()=>{s({title:"Um email será enviado",description:"Confira também a caixa de spam"}),o()}});return e.jsxs(h,{defaultValues:{email:""},schema:z,onSubmit:t,children:[e.jsx(d.Body,{children:e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsx("span",{className:"text-body-large text-neutral-700",children:"Insira seu email para enviarmos as instruções para recuperar sua senha"}),e.jsx(l,{name:"email",label:"Email",required:!0})]})}),e.jsx(d.Footer,{labelPrimaryBtn:"Enviar",dirty:!0,primaryBtnState:n?"loading":void 0})]})}function K({...a}){return e.jsxs(d,{...a,children:[e.jsx(d.Header,{title:"Recuperar senha"}),e.jsx(H,{})]})}const J=N({email:F(),password:v()});function Z(){const a=_(),{safeFetch:s}=m(),{authChannel:o}=k();async function r(i){await s(`${f}/auth/sign-in`,{method:"POST",body:i})}const{mutate:t,isPending:n}=x({mutationFn:r,onSuccess:()=>{q(U),o.postMessage({type:A.SIGNIN})}});return e.jsxs(e.Fragment,{children:[e.jsx(K,{...a}),e.jsxs(h,{schema:J,defaultValues:{email:"",password:""},onSubmit:t,className:"flex-1 flex flex-col",children:[e.jsxs("div",{className:"flex-1 flex flex-col gap-2",children:[e.jsx(l,{name:"email",label:"Email",autoFocus:!0,required:!0}),e.jsx(w,{label:"Senha",name:"password",required:!0}),e.jsx("div",{className:"flex items-end justify-end",children:e.jsx(j,{label:"Esqueci a senha",variant:"quaternary",onClick:a.openDialog,"data-cy":"forget-password-button"})})]}),e.jsx(c.Footer,{label:"Entrar",primaryBtnState:n?"loading":void 0})]})]})}const Q=N({name:v(),cnpj:O(),fullName:B(),email:F()});function X(){const{safeFetch:a}=m(),{showSuccessSnackbar:s}=b();async function o(n){await a(`${f}/auth/sign-up`,{method:"POST",body:n})}const{mutate:r,isPending:t}=x({mutationFn:o,onSuccess:()=>{s({title:"Um email será enviado",description:"Confira também a caixa de spam"})}});return e.jsxs(h,{schema:Q,defaultValues:{name:"",cnpj:"",fullName:"",email:""},onSubmit:r,className:"flex-1 flex flex-col",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx(l,{name:"name",label:"Nome da filial",required:!0,autoFocus:!0}),e.jsx(l,{name:"cnpj",label:"CNPJ",required:!0,mask:"cnpj"}),e.jsx(l,{name:"fullName",label:"Nome do usuário",required:!0}),e.jsx(l,{name:"email",label:"Email do usuário",required:!0})]}),e.jsx(c.Footer,{label:"Criar",primaryBtnState:t?"loading":void 0})]})}function Y(){const{step:a}=C(),s=u.useMemo(()=>{switch(a){case"NEW_PASSWORD":return e.jsx(c,{title:"Criar nova senha",children:e.jsx($,{})});case"SIGN_UP":return e.jsx(c,{title:"Criar conta",children:e.jsx(X,{})});default:return e.jsx(c,{title:"Login",children:e.jsx(Z,{})})}},[a]);return e.jsxs("div",{className:"bg-slate-800 w-full h-screen flex justify-center items-center flex-col gap-4",children:[e.jsx("span",{className:"text-headline-large text-neutral-100",children:"Ziscar"}),e.jsx("div",{className:"border-b border-neutral-300 w-96"}),s]})}function ce(){return e.jsx(V,{children:e.jsx(Y,{})})}export{ce as default};
