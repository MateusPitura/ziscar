import{r as d,j as e,u as E,b as F,c as T,d as L,B as N,e as y,f as A,T as p,g as f,P as D,h as B}from"./index-DLLA1f-v.js";import{P}from"./PageHeader-Bs9TDp09.js";import{S as C,T as t}from"./Table-By5z5vhx.js";import{u as h,f as $}from"./react-pdf.browser-s4H9466t.js";import{u as O}from"./useDialog-DlT6EUiq.js";import{D as S}from"./Dialog-D33IGNgm.js";import{s as k}from"./selectStoresInfo-D_L-tg5X.js";import{F as w,I as b,u as q}from"./schemas-Bhi0Dh6I.js";import{C as g}from"./Choice-BxW3kVCA.js";import{u as H}from"./useButtonState-3b0McXTU.js";import{S as I}from"./index-DxMSBUxc.js";import{u as R}from"./useDialogContext-BXiPHqkt.js";import"./dialog-BH6A_dKB.js";import"./index-2Ad1AATz.js";const K=d.createContext(null);function M({children:a}){const[n,r]=d.useState("");function i(c){r(c)}const o=d.useMemo(()=>({example:n,handleExample:i}),[n]);return e.jsx(K.Provider,{value:o,children:a})}function Q({storeId:a,storeName:n,...r}){const{safeFetch:i}=E(),{showSuccessSnackbar:o}=F(),c=T(),{handleStoresFilter:u}=h();async function m(){await i(`${y}/store/${a}`,{method:"DELETE",body:{archivedAt:new Date().toISOString()},resource:"STORES",action:"DELETE"})}const{mutate:x,isPending:j}=L({mutationFn:m,onSuccess:()=>{u({page:1}),c.invalidateQueries({queryKey:["stores"]}),o({title:`Loja ${n} desativada com sucesso`}),r.closeDialog()}});return e.jsxs(S,{...r,children:[e.jsx(S.Header,{title:"Desativar loja"}),e.jsx(S.Body,{children:e.jsxs("span",{className:"text-body-medium text-neutral-700",children:["Tem certeza que deseja desativar a loja",e.jsxs("span",{className:"font-bold",children:[N,n]}),"? Ao desativar os registros relacionados a ela não serão mais acessíveis"]})}),e.jsx(S.Footer,{labelPrimaryBtn:"Desativar",onClickPrimaryBtn:x,primaryBtnState:j?"loading":void 0,primaryBtnColor:"red",primaryBtnResource:"STORES",primaryBtnAction:"DELETE"})]})}function z({storeId:a,name:n,isActive:r,handleDisableStoreInfo:i}){const o=A(),{safeFetch:c}=E(),{showSuccessSnackbar:u}=F(),m=T();async function x(){await c(`${y}/store/${a}`,{method:"DELETE",body:{archivedAt:null},resource:"STORES",action:"DELETE"})}const{mutate:j,isPending:l}=L({mutationFn:x,onSuccess:()=>{m.invalidateQueries({queryKey:["stores"]}),u({title:`Loja ${n} ativada com sucesso`})}});return r?e.jsxs(e.Fragment,{children:[e.jsx(p,{content:"Editar",children:e.jsx(f,{variant:"quaternary",iconLeft:"Edit",onClick:()=>o(`/stores/edit/${a}`),resource:"STORES",action:"UPDATE",padding:"none","data-cy":`button-edit-store-${a}`})}),e.jsx(p,{content:"Desativar",children:e.jsx(f,{variant:"primary",iconLeft:"Delete",color:"red",padding:"none",onClick:()=>i({storeName:n,storeId:a}),resource:"STORES",action:"DELETE","data-cy":`button-disable-store-${a}`})})]}):e.jsx(p,{content:"Ativar",children:e.jsx(f,{variant:"quaternary",onClick:j,state:l?"loading":void 0,resource:"STORES",action:"DELETE",padding:"none",iconLeft:"ToggleOn","data-cy":`button-enable-store-${a}`})})}function U(){const{storesFilter:a,handleStoresFilter:n}=h(),{closeDialog:r}=R();function i(o){n({page:1,...o}),r()}return e.jsx(w,{schema:I,onSubmit:i,className:"flex-1 flex flex-col",defaultValues:{name:(a==null?void 0:a.name)||"",status:(a==null?void 0:a.status)||"active",startDate:(a==null?void 0:a.startDate)||"",endDate:(a==null?void 0:a.endDate)||""},replaceEmptyStringToNull:!1,children:e.jsx(V,{})})}function V(){const{reset:a}=H(),{handleStoresFilter:n}=h(),{closeDialog:r}=R();function i(){n(D),a(D),r()}return e.jsxs(e.Fragment,{children:[e.jsxs(C.Body,{className:"flex flex-col gap-4",children:[e.jsx(b,{name:"name",label:"Nome"}),e.jsx(q,{label:"Status"}),e.jsx("div",{className:"flex flex-col gap-2",children:e.jsxs(g,{hideErrorLabel:!0,children:[e.jsx(g.Radio,{name:"status",label:"Ativo",value:"active"}),e.jsx(g.Radio,{name:"status",label:"Inativo",value:"inactive"})]})}),e.jsx(b,{name:"startDate",label:"Data inicial de criação",type:"date"}),e.jsx(b,{name:"endDate",label:"Data final de criação",type:"date"})]}),e.jsx(C.Footer,{primaryLabel:"Aplicar",secondaryLabel:"Limpar",onSecondaryCallback:i,dirty:!0})]})}const J=d.memo(U),_=!1;function G(){const[a,n]=d.useState({storeName:"",storeId:""}),r=O(),{safeFetch:i}=E(),{storesFilter:o,handleStoresFilter:c}=h();function u(s){r.openDialog(),n(s)}function m(s){c({page:s})}const x=d.useMemo(()=>o?$(o):"",[o]);async function j(s){return await i(`${y}/store?${s}&orderBy=name`,{resource:"STORES",action:"READ"})}const{data:l,isFetching:v}=B({queryKey:["stores",x],queryFn:({queryKey:s})=>j(s[1]),select:k});return e.jsxs(e.Fragment,{children:[e.jsx(Q,{...a,...r}),e.jsxs("div",{className:"flex gap-4 justify-end",children:[_,e.jsx(t.Filter,{form:e.jsx(J,{})})]}),e.jsxs(t,{children:[e.jsxs(t.Header,{children:[e.jsx(t.Head,{label:"Nome"}),e.jsx(t.Head,{label:"CNPJ"}),e.jsx(t.Head,{label:"Email"}),e.jsx(t.Head,{label:"Celular"}),e.jsx(t.Head,{label:"Status"}),e.jsx(t.Head,{action:!0})]}),e.jsx(t.Body,{isLoading:v,isEmpty:!(l!=null&&l.total),resource:"STORES",action:"READ",children:l==null?void 0:l.data.map(s=>e.jsxs(t.Row,{children:[e.jsx(t.Cell,{label:s.name}),e.jsx(t.Cell,{label:s.cnpj}),e.jsx(t.Cell,{label:s.email}),e.jsx(t.Cell,{label:s.phone}),e.jsx(t.Cell,{label:s.archivedAt?"Inativo":"Ativo"}),e.jsx(t.Action,{children:e.jsx(z,{isActive:!s.archivedAt,storeId:String(s.id),name:s.name,handleDisableStoreInfo:u})})]},s.id))}),e.jsx(t.Footer,{currentStartItem:o==null?void 0:o.page,totalItems:l==null?void 0:l.total,onClickNavigateBtn:m,isLoading:v})]})]})}function W(){const a=A();return e.jsxs("div",{className:"flex flex-col gap-4 h-full w-full",children:[e.jsx(P,{title:"Lojas",children:e.jsx(f,{label:"Adicionar loja",iconLeft:"Add",onClick:()=>a("/stores/new"),resource:"STORES",action:"CREATE",color:"green","data-cy":"new-store-button"})}),e.jsx(G,{})]})}function ue(){return e.jsx(M,{children:e.jsx(W,{})})}export{ue as default};
