import{r as f,j as a,a as M,V as L,u as A,b as q,c as B,d as F,B as R,e as y,f as P,g as z,h as O,Y as G,M as W,v as H,i as k,k as j,l as S,m as s,I as X}from"./index-DmwSkqVz.js";import{P as J}from"./PageHeader-CS70jJr4.js";import{S as v,T as r}from"./Table-CsMxXttX.js";import{D,u as Z,a as ee,b as ae}from"./useDialog-B87cicjl.js";import{u as I,f as te}from"./react-pdf.browser-CNmtyLLt.js";import{E as ne}from"./ExportButton-DLacmjSh.js";import{s as w}from"./selectStoresInfo-DCWEm6F2.js";import{s as _}from"./selectBrandsInfo-VDxn_10s.js";import{V as oe,S as se,a as re}from"./index-CUlM27kl.js";import{F as le,I as E}from"./schemas-CDh-Ls0x.js";import{S as h}from"./Select-BCdmGCll.js";import{u as K}from"./useDialogContext-BfxMW9hJ.js";import{T as ce}from"./Tag-RoqvY_d_.js";import"./useIsFetching-awalAWhd.js";import"./index-fjEarVAD.js";const ie=f.createContext(null);function ue({children:e}){const[t,o]=f.useState("");function i(d){o(d)}const c=f.useMemo(()=>({example:t,handleExample:i}),[t]);return a.jsx(ie.Provider,{value:c,children:e})}function de(e){const t=[];for(const o of e.data)t.push({...o,announcedPrice:M(o.announcedPrice,"money")??"",plateNumber:M(o.plateNumber,"plateNumber")??"",modelYear:o.modelYear?String(o.modelYear):"",brandName:o.brand.name});return{total:e.total,data:t}}function me(e){const t=[];for(const o of e.data)t.push({...o,announcedPrice:M(o.announcedPrice,"money")??"",plateNumber:M(o.plateNumber,"plateNumber")??"",status:o.archivedAt?L[oe]:L[o.status],brand:o.brand.name});return t}function be({vehicleId:e,plateNumber:t,...o}){const{safeFetch:i}=A(),{showSuccessSnackbar:c}=q(),d=B(),{handleVehiclesFilter:p}=I();async function g(){await i(`${y}/vehicles/${e}/archive`,{method:"PATCH",resource:"VEHICLES",action:"DELETE"})}const{mutate:m,isPending:x}=F({mutationFn:g,onSuccess:()=>{p({page:1}),d.invalidateQueries({queryKey:["vehicles"]}),c({title:`Veículo ${t} desativado com sucesso`}),o.closeDialog()}});return a.jsxs(D,{...o,children:[a.jsx(D.Header,{title:"Desativar veículo"}),a.jsx(D.Body,{children:a.jsxs("span",{className:"text-body-medium text-neutral-700",children:["Tem certeza que deseja desativar o veículo",a.jsxs("span",{className:"font-bold",children:[R,t]}),"? Ao desativar os registros relacionados a ele não serão mais acessíveis"]})}),a.jsx(D.Footer,{labelPrimaryBtn:"Desativar",onClickPrimaryBtn:m,primaryBtnState:x?"loading":void 0,primaryBtnColor:"red",primaryBtnResource:"VEHICLES",primaryBtnAction:"DELETE"})]})}function pe(){const{vehiclesFilter:e,handleVehiclesFilter:t}=I(),{closeDialog:o}=K(),{safeFetch:i}=A();async function c(){return await i(`${y}/store?orderBy=name`,{resource:"STORES",action:"READ"})}const{data:d,isFetching:p}=P({queryKey:["stores"],queryFn:c,select:w});async function g(){return await i(`${y}/vehicles/brands`)}const{data:m,isFetching:x}=P({queryKey:["brands"],queryFn:g,select:_});function b(u){t({page:1,...u}),o()}return a.jsx(le,{schema:se,onSubmit:b,className:"flex-1 flex flex-col min-h-0",defaultValues:{startDate:(e==null?void 0:e.startDate)||"",endDate:(e==null?void 0:e.endDate)||"",storeId:(e==null?void 0:e.storeId)||"",brandId:(e==null?void 0:e.brandId)||"",status:(e==null?void 0:e.status)||"",category:(e==null?void 0:e.category)||"",modelYear:(e==null?void 0:e.modelYear)||"",yearOfManufacture:(e==null?void 0:e.yearOfManufacture)||"",modelName:(e==null?void 0:e.modelName)||"",plateNumber:(e==null?void 0:e.plateNumber)||"",announcedPriceMin:(e==null?void 0:e.announcedPriceMin)||"",announcedPriceMax:(e==null?void 0:e.announcedPriceMax)||""},replaceEmptyStringToNull:!1,children:a.jsx(ge,{storesInfo:d,isFetchingStoresInfo:p,brandsInfo:m,isFetchingBrandsInfo:x})})}function ge({storesInfo:e,isFetchingStoresInfo:t,brandsInfo:o,isFetchingBrandsInfo:i}){const{reset:c,control:d,setValue:p}=Z(),{handleVehiclesFilter:g}=I(),{closeDialog:m}=K();function x(){g(H),c(H),m()}const b=ee({control:d,name:"yearOfManufacture"});return a.jsxs(a.Fragment,{children:[a.jsxs(v.Body,{className:"flex flex-col gap-4 max-h-[82vh] overflow-y-auto",children:[a.jsx(E,{name:"modelName",label:"Modelo",placeholder:"Nome do modelo"}),a.jsx(E,{name:"plateNumber",label:"Placa",placeholder:"ABC-1234",mask:"plateNumber",maxLength:8}),a.jsx(h,{name:"storeId",label:"Loja",options:[{value:"",label:"Todas as lojas"},...(e==null?void 0:e.data.map(u=>({value:String(u.id),label:String(u.name)})))??[]],loading:t}),a.jsx(h,{name:"status",label:"Status",options:[{value:"",label:"Todos os ativos"},...Object.values(re).map(u=>({value:u,label:L[u]}))]}),a.jsx(h,{name:"brandId",label:"Marca",options:[{value:"",label:"Todas as marcas"},...o??[]],loading:i}),a.jsx(h,{name:"category",label:"Categoria",options:[{value:"",label:"Todas as categorias"},...Object.values(z).map(u=>({value:u,label:O[u]}))]}),a.jsx(h,{name:"yearOfManufacture",label:"Ano de fabricação",options:[{value:"",label:"Todos os anos"},...G],onChange:()=>p("modelYear","")}),a.jsx(h,{name:"modelYear",label:"Ano do modelo",options:[{value:"",label:"Todos os anos"},...b?[{value:b,label:b},{value:String(Number(b)+1),label:String(Number(b)+1)}]:W]}),a.jsx(E,{name:"announcedPriceMin",label:"Preço anunciado mínimo",mask:"money",placeholder:"R$ 0,00"}),a.jsx(E,{name:"announcedPriceMax",label:"Preço anunciado máximo",mask:"money",placeholder:"R$ 0,00"}),a.jsx(E,{name:"startDate",label:"Data inicial de criação",type:"date"}),a.jsx(E,{name:"endDate",label:"Data final de criação",type:"date"})]}),a.jsx(v.Footer,{primaryLabel:"Aplicar",secondaryLabel:"Limpar",onSecondaryCallback:x,dirty:!0})]})}const xe=f.memo(pe);function fe({vehicleId:e,plateNumber:t,isActive:o,handleDisableVehicleInfo:i,status:c}){const d=k(),{safeFetch:p}=A(),{showSuccessSnackbar:g}=q(),m=B();async function x(){await p(`${y}/vehicles/${e}/unarchive`,{method:"PATCH",resource:"VEHICLES",action:"DELETE"})}const{mutate:b,isPending:u}=F({mutationFn:x,onSuccess:()=>{m.invalidateQueries({queryKey:["vehicles"]}),g({title:`Veículo ${t} ativado com sucesso`})}});async function l(){await p(`${y}/vehicles/${e}`,{method:"PATCH",body:{status:j.IN_STOCK},resource:"VEHICLES",action:"UPDATE"})}const{mutate:T,isPending:C}=F({mutationFn:l,onSuccess:()=>{g({title:`Veículo ${t} atualizado com sucesso`}),m.invalidateQueries({queryKey:["vehicle",e]}),m.invalidateQueries({queryKey:["vehicles"]})}});return o?a.jsxs(a.Fragment,{children:[c===j.IN_STOCK?a.jsx(S,{tooltipMessage:"Vender",variant:"quaternary",iconLeft:"CurrencyExchange",onClick:()=>d(`/vehicle-sale/new/${e}`),resource:"VEHICLE_SALE",action:"CREATE",padding:"none","data-cy":`button-vehicleSale-${e}`}):a.jsx(S,{tooltipMessage:'Marcar como "Em Estoque"',variant:"quaternary",iconLeft:"NoCrash",onClick:T,resource:"VEHICLES",action:"UPDATE",padding:"none",state:C?"loading":void 0,"data-cy":`button-makeAvailable-${e}`}),a.jsx(S,{tooltipMessage:"Editar",variant:"quaternary",iconLeft:"Edit",onClick:()=>d(`/vehicles/edit/${e}`),resource:"VEHICLES",action:"UPDATE",padding:"none","data-cy":`button-edit-vehicle-${e}`}),a.jsx(S,{tooltipMessage:"Gastos",variant:"quaternary",iconLeft:"History",onClick:()=>d(`/vehicles/expense/${e}`),resource:"VEHICLE_EXPENSE",action:"READ",padding:"none","data-cy":`button-vehicle-expense-${e}`}),a.jsx(S,{tooltipMessage:"Desativar",variant:"primary",iconLeft:"Delete",color:"red",padding:"none",onClick:()=>i({plateNumber:t,vehicleId:e}),resource:"VEHICLES",action:"DELETE","data-cy":`button-disable-vehicle-${e}`})]}):a.jsx(S,{tooltipMessage:"Ativar",variant:"quaternary",onClick:b,state:u?"loading":void 0,resource:"VEHICLES",action:"DELETE",padding:"none",iconLeft:"ToggleOn","data-cy":`button-enable-vehicle-${e}`})}function ye({status:e,isActive:t}){return a.jsx(ce,{className:{"bg-blue-100 text-blue-800 border-blue-800":e===j.PURCHASED&&t,"bg-green-100 text-green-800 border-green-800":e===j.IN_STOCK&&t,"bg-orange-100 text-orange-800 border-orange-800":e===j.MAINTENANCE&&t,"bg-gray-100 text-gray-800 border-gray-800":e===j.SOLD&&t,"bg-red-100 text-red-800 border-red-800":!t},content:t?L[e]:"Inativo"})}const $=7;function Se(){const[e,t]=f.useState({plateNumber:"",vehicleId:""}),o=ae(),{safeFetch:i}=A(),{vehiclesFilter:c,handleVehiclesFilter:d}=I();function p(n){o.openDialog(),t(n)}function g(n){d({page:n})}const m=f.useMemo(()=>c?te(c):"",[c]);async function x(n){return await i(`${y}/vehicles?${n}&limit=${X}`,{resource:"VEHICLES",action:"READ"})}async function b(){return await i(`${y}/vehicles/brands`)}async function u(){return await i(`${y}/store?orderBy=name`,{resource:"STORES",action:"READ"})}const{data:l,isLoading:T}=P({queryKey:["vehicles",m],queryFn:({queryKey:n})=>x(n[1]),select:de}),{data:C}=P({queryKey:["brands"],queryFn:b,select:_}),{data:V}=P({queryKey:["stores"],queryFn:u,select:w}),Y=f.useMemo(()=>C?C.reduce((n,N)=>(n[N.value]=N.label,n),{}):{},[C]),U=f.useMemo(()=>V!=null&&V.data?V.data.reduce((n,N)=>(n[String(N.id)]=N.name,n),{}):{},[V]),Q=f.useMemo(()=>l!=null&&l.data.length?Math.max(...l.data.map(n=>n.announcedPrice.length)):0,[l==null?void 0:l.data]);return a.jsxs(a.Fragment,{children:[a.jsx(be,{...e,...o}),a.jsxs("div",{className:"flex gap-4 justify-between",children:[a.jsx(ne,{fileName:"Relatório Veículos",queryKey:["vehicles",m],queryFn:x,selectQueryFn:me,formatFilters:{endDate:"Data final",startDate:"Data inicial",storeId:"Loja",brandId:"Marca",status:"Status",category:"Categoria",modelYear:"Ano do modelo",yearOfManufacture:"Ano de fabricação",modelName:"Modelo",plateNumber:"Placa",announcedPriceMin:"Preço mínimo",announcedPriceMax:"Preço máximo"},formatFiltersValues:{status:L,category:{...O,"":"Todas"},brandId:Y,storeId:U},formatColumns:{modelName:"Modelo",brand:"Marca",plateNumber:"Placa",modelYear:"Ano do modelo",status:"Status",announcedPrice:"Preço anunciado"}}),a.jsx(r.Filter,{form:a.jsx(xe,{})})]}),a.jsxs(r,{children:[a.jsxs(r.Header,{gridColumns:$,children:[a.jsx(r.Head,{label:s.model.label,colSpan:s.model.colSpan}),a.jsx(r.Head,{label:s.brand.label,colSpan:s.brand.colSpan}),a.jsx(r.Head,{label:s.plate.label,colSpan:s.plate.colSpan}),a.jsx(r.Head,{label:s.year.label,colSpan:s.year.colSpan}),a.jsx(r.Head,{label:s.price.label,colSpan:s.price.colSpan}),a.jsx(r.Head,{label:s.status.label,colSpan:s.status.colSpan}),a.jsx(r.Head,{action:!0})]}),a.jsx(r.Body,{isLoading:T,isEmpty:!(l!=null&&l.total),resource:"VEHICLES",action:"READ",children:l==null?void 0:l.data.map(n=>a.jsxs(r.Row,{gridColumns:$,children:[a.jsx(r.Cell,{label:n.modelName,columnLabel:s.model.label,colSpan:s.model.colSpan}),a.jsx(r.Cell,{label:n.brandName,columnLabel:s.brand.label,colSpan:s.brand.colSpan}),a.jsx(r.Cell,{label:n.plateNumber,colSpan:s.plate.colSpan,columnLabel:s.plate.label}),a.jsx(r.Cell,{label:n.modelYear,colSpan:s.year.colSpan,columnLabel:s.year.label}),a.jsx(r.Cell,{label:n.announcedPrice.padStart(Q,R),columnLabel:s.price.label,className:"font-mono xl:whitespace-pre",colSpan:s.price.colSpan}),a.jsx(r.Cell,{columnLabel:s.status.label,label:a.jsx(ye,{isActive:!n.archivedAt,status:n.status}),colSpan:s.status.colSpan}),a.jsx(r.Action,{children:a.jsx(fe,{status:n.status,isActive:!n.archivedAt,vehicleId:String(n.id),plateNumber:n.plateNumber,handleDisableVehicleInfo:p})})]},n.id))}),a.jsx(r.Footer,{currentStartItem:c==null?void 0:c.page,totalItems:l==null?void 0:l.total,onClickNavigateBtn:g,isLoading:T})]})]})}function ve({contextHelper:e}){const t=k();return a.jsx(ue,{children:a.jsxs("div",{className:"flex flex-col gap-4 h-full w-full",children:[a.jsx(J,{title:"Veículos",contextHelper:e,children:a.jsx(S,{label:"Adicionar veículo",iconLeft:"Add",onClick:()=>t("/vehicles/new"),resource:"VEHICLES",action:"CREATE",color:"green","data-cy":"new-vehicle-button",tooltipMessage:"Adicionar novo veículo"})}),a.jsx(Se,{})]})})}export{ve as default};
