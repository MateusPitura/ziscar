import{i as x,u as g,b as y,c as S,d as b,r as C,j as e,n as E,l,e as j}from"./index-CnY9f91V.js";import{F as w}from"./schemas-CZyi_FYc.js";import{P as V}from"./FieldArray-Ckm8lv6T.js";import{P as F}from"./PageHeader-nhaYMwqU.js";import{f as P}from"./formatInstallment-DC7w0kSr.js";import{b as q}from"./index-AykQK_Nc.js";import{V as B}from"./VehicleTabs-COrNGLJ3.js";import"./useDialog-DgUnmKfd.js";import"./Section-C_3Epz3l.js";import"./index-8LNUc8ZP.js";import"./ColorPreview-COA3khnx.js";import"./PaymentForm-C1cv7kbc.js";import"./Select-7V9bPDz1.js";import"./DataField-wmA4TIPk.js";import"./Choice-C2iLnYQh.js";import"./selectStoresInfo-CYKlEn6i.js";import"./Search-B-8kiSkH.js";import"./selectBrandsInfo-VDxn_10s.js";function J({contextHelper:c}){const s=x(),{safeFetch:n}=g(),{showSuccessSnackbar:u}=y(),a=S();async function m({vehicle:o,characteristics:r,payment:t}){const f=[...r.commonCharacteristics,...r.newCharacteristics.map(v=>v.description)],h=P({installment:t.installment,upfront:t.upfront});await n(`${j}/vehicles`,{method:"POST",body:{...o,characteristics:f,payment:{purchaseDate:t.purchaseDate,paidTo:t.paidTo,installments:h}},resource:"VEHICLES",action:"CREATE"})}const{mutate:d,isPending:p}=b({mutationFn:m,onSuccess:()=>{u({title:"Veículo criado com sucesso"}),s("/vehicles"),a.invalidateQueries({queryKey:["vehicles"]}),a.invalidateQueries({queryKey:["accounts-payable"]}),a.invalidateQueries({queryKey:["paid-to"]}),a.invalidateQueries({queryKey:["vehicle-model"]})}});function i(o){o.preventDefault()}return C.useEffect(()=>(window.addEventListener("beforeunload",i),()=>{window.removeEventListener("beforeunload",i)}),[]),e.jsx("div",{className:"flex flex-col gap-4 w-full",children:e.jsxs(w,{onSubmit:d,className:"flex-1 flex flex-col gap-4",schema:q,defaultValues:E,children:[e.jsx(F,{title:"Cadastrar veículo",contextHelper:c}),e.jsx(B,{}),e.jsxs(V,{dirty:!0,primaryBtnState:p?"loading":void 0,children:[e.jsx(l,{color:"lightBlue",iconRight:"Save",label:"Salvar",tooltipMessage:"Salvar cadastro"}),e.jsx(l,{color:"red",iconRight:"Close",label:"Cancelar",tooltipMessage:"Cancelar cadastro",onClick:()=>s("/vehicles")})]})]})})}export{J as default};
