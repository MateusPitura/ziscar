import{r as m,J as w,j as e,B as j,v as x,w as b,t as y,y as h,z as f,x as I}from"./index-BjaSeb4Z.js";import{u as q,F as S,e as B,c as E,I as l,o as N,s as v,g as F,h as _,i as D}from"./index-CqNXhMKj.js";import{I as P}from"./InputPassword-CdW0rELS.js";import{g as O,i as d,f as U}from"./Dialog-Cs0_pBLn.js";const C=m.createContext(null);function A({children:a}){const[s]=w();let t=null;s.has("token")&&(t=s.get("token"));const[n,r]=m.useState(t?"NEW_PASSWORD":"SIGN_IN");function i(u){r(u)}const o=m.useMemo(()=>({step:n,handleStep:i}),[n]);return e.jsx(C.Provider,{value:o,children:a})}function G({title:a,children:s}){return e.jsxs("div",{className:"w-[23rem] h-[41rem] bg-light-surfaceContainerLowest px-4 py-8 flex flex-col gap-8 rounded-md",children:[e.jsx("span",{className:"text-headline-large text-light-onSurface text-center",children:a}),s]})}function M({label:a,variant:s="primary",primaryBtnState:t,secondaryBtnLabel:n,onClickSecondaryBtn:r}){const i=q({buttonState:t});return e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx(j,{label:a,textAlign:"center",variant:s,state:i,fullWidth:!0,type:"submit"}),n&&e.jsx("div",{className:"flex-1 flex justify-center",children:e.jsx(j,{label:n,textAlign:"center",variant:"quaternary",onClick:r})})]})}const c=Object.assign(G,{Footer:M});function g(){const a=m.useContext(C);if(!a)throw new Error("useSignPageContext must be used within a SignPageProvider");return a}function R(){const{safeFetch:a}=x(),{showSuccessSnackbar:s}=b(),{handleStep:t}=g(),n=y(),[r]=w();let i=null;r.has("token")&&(i=r.get("token"));async function o(k){await a(`${f}/auth/reset-password`,{method:"POST",body:{password:k.newPassword,token:i}})}const{mutate:u,isPending:p}=h({mutationFn:o,onSuccess:()=>{n("/"),t("SIGN_IN"),s({title:"Senha definida com sucesso",description:"Acesse com a nova senha"})}});return e.jsxs(S,{defaultValues:{confirmPassword:"",newPassword:""},schema:B,onSubmit:u,className:"flex-1 flex flex-col",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx(P,{label:"Nova senha",name:"newPassword",required:!0}),e.jsx(P,{label:"Confirmar senha",name:"confirmPassword",required:!0})]}),e.jsx(c.Footer,{label:"Salvar",primaryBtnState:p?"loading":void 0})]})}const W=E.pick({email:!0});function T(){const{safeFetch:a}=x(),{showSuccessSnackbar:s}=b(),{closeDialog:t}=O();async function n(o){await a(`${f}/auth/forget-password`,{method:"POST",body:o})}const{mutate:r,isPending:i}=h({mutationFn:n,onSuccess:()=>{s({title:"Enviaremos um email para definir a senha",description:"Confira também a caixa de spam"}),t()}});return e.jsxs(S,{defaultValues:{email:""},schema:W,onSubmit:r,children:[e.jsx(d.Body,{children:e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsx("span",{className:"text-body-large text-light-onSurface",children:"Insira seu email para enviarmos as instruções para recuperar a senha"}),e.jsx(l,{name:"email",label:"Email",required:!0})]})}),e.jsx(d.Footer,{labelPrimaryBtn:"Enviar",dirty:!0,primaryBtnState:i?"loading":void 0})]})}function V({...a}){return e.jsxs(d,{...a,children:[e.jsx(d.Header,{title:"Recuperar senha"}),e.jsx(T,{})]})}const $=N({email:F(),password:v()});function L(){const{handleStep:a}=g(),s=U(),{safeFetch:t}=x(),n=y(),r=I();async function i(p){await t(`${f}/auth/sign-in`,{method:"POST",body:p})}const{mutate:o,isPending:u}=h({mutationFn:i,onSuccess:()=>{r.invalidateQueries({queryKey:["permissions"]}),n("/profile")}});return e.jsxs(e.Fragment,{children:[e.jsx(V,{...s}),e.jsxs(S,{schema:$,defaultValues:{email:"",password:""},onSubmit:o,className:"flex-1 flex flex-col",children:[e.jsxs("div",{className:"flex-1 flex flex-col gap-2",children:[e.jsx(l,{name:"email",label:"Email",required:!0}),e.jsx(P,{label:"Senha",name:"password",required:!0}),e.jsx("div",{className:"flex items-end justify-end",children:e.jsx(j,{label:"Esqueci a senha",variant:"quaternary",onClick:s.openDialog})})]}),e.jsx(c.Footer,{label:"Entrar",secondaryBtnLabel:"Criar conta",onClickSecondaryBtn:()=>a("SIGN_UP"),primaryBtnState:u?"loading":void 0})]})]})}const z=N({name:v(),cnpj:D(),fullName:_(),email:F()});function J(){const{handleStep:a}=g(),{safeFetch:s}=x(),{showSuccessSnackbar:t}=b();async function n(o){await s(`${f}/auth/sign-up`,{method:"POST",body:o})}const{mutate:r,isPending:i}=h({mutationFn:n,onSuccess:()=>{t({title:"Enviaremos um email para definir a senha",description:"Confira também a caixa de spam"})}});return e.jsxs(S,{schema:z,defaultValues:{name:"",cnpj:"",fullName:"",email:""},onSubmit:r,className:"flex-1 flex flex-col",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx(l,{name:"name",label:"Nome da filial",required:!0}),e.jsx(l,{name:"cnpj",label:"CNPJ",required:!0,mask:"cnpj"}),e.jsx(l,{name:"fullName",label:"Nome do usuário",required:!0}),e.jsx(l,{name:"email",label:"Email do usuário",required:!0})]}),e.jsx(c.Footer,{label:"Criar",secondaryBtnLabel:"Cancelar",onClickSecondaryBtn:()=>a("SIGN_IN"),primaryBtnState:i?"loading":void 0})]})}function Q(){const{step:a}=g(),s=m.useMemo(()=>{switch(a){case"NEW_PASSWORD":return e.jsx(c,{title:"Criar nova senha",children:e.jsx(R,{})});case"SIGN_UP":return e.jsx(c,{title:"Criar conta",children:e.jsx(J,{})});default:return e.jsx(c,{title:"Ziscar",children:e.jsx(L,{})})}},[a]);return e.jsx("div",{className:"bg-gradient-to-br from-light-tertiaryContainer to-light-primary w-full h-screen flex justify-center items-center",children:s})}function Y(){return e.jsx(A,{children:e.jsx(Q,{})})}export{Y as default};
