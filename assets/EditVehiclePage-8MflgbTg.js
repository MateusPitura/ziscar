import{i as g,u as C,b as E,c as j,n as y,f as F,d as b,r as P,j as e,S as N,k as m,e as p}from"./index-CrVTpVTI.js";import{F as w}from"./schemas-B7gcU9vp.js";import{P as T}from"./FieldArray-DswNorv6.js";import{P as q}from"./PageHeader-DARJqnt5.js";import{b as A}from"./index-uyprc1Rk.js";import{s as R}from"./selectVehicleInfo-D5Hlg63I.js";import{V as $}from"./VehicleTabs-CA4iLTwE.js";import"./useButtonState-C7TXS9Jx.js";import"./index-CLx72V5J.js";import"./ColorPreview-C16SKF8Q.js";import"./Section-DVwlB0L5.js";import"./PaymentForm-w1UECrqX.js";import"./Select-CB-6jpCF.js";import"./dialog-Ct9-qcrh.js";import"./DataField-CmnNFbKB.js";import"./Choice-LKCp7m0f.js";import"./selectStoresInfo-36oKAABV.js";import"./selectBrandsInfo-VDxn_10s.js";function k(){const n=g(),{safeFetch:u}=C(),{showSuccessSnackbar:d}=E(),c=j(),{vehicleId:t}=y();async function f(){const r=await u(`${p}/vehicles/${t}`,{resource:"VEHICLES",action:"READ"}),{payment:s,vehicleCharacteristicValues:o,...l}=r;return{payment:s,vehicle:{...l,vehicleCharacteristicValues:o.map(a=>a==null?void 0:a.characteristic)}}}const{data:i,isFetching:v}=F({queryKey:["vehicle",t],queryFn:f,select:R});async function x({characteristics:r,payment:s,vehicle:o}){const l=[...r.commonCharacteristics,...r.newCharacteristics.map(a=>a.description)];await u(`${p}/vehicles/${t}`,{method:"PATCH",body:{...o,characteristics:l,payment:{purchaseDate:s==null?void 0:s.purchaseDate,paidTo:s==null?void 0:s.paidTo}},resource:"VEHICLES",action:"UPDATE"})}const{mutate:S,isPending:V,isSuccess:h}=b({mutationFn:x,onSuccess:()=>{d({title:`Veículo ${i==null?void 0:i.vehicle.modelName} atualizado com sucesso`}),n("/vehicles"),c.invalidateQueries({queryKey:["vehicles"]})}});return P.useEffect(()=>()=>{h&&c.invalidateQueries({queryKey:["vehicle",t]})},[h,c,t]),v?e.jsx("div",{className:"flex justify-center items-center h-full w-full",children:e.jsx(N,{})}):i&&e.jsx("div",{className:"flex flex-col gap-4 w-full",children:e.jsxs(w,{onSubmit:S,className:"flex-1 flex flex-col gap-4",schema:A,replaceEmptyStringToNull:!0,defaultValues:{characteristics:i.characteristics,payment:i.payment,vehicle:i.vehicle},children:[e.jsx(q,{title:"Alterar veículo"}),e.jsx($,{isEdit:!0,purchaseValue:i.purchaseValue}),e.jsxs(T,{dirty:!0,primaryBtnState:V?"loading":void 0,children:[e.jsx(m,{color:"lightBlue",iconRight:"Save",label:"Salvar"}),e.jsx(m,{color:"red",iconRight:"Close",label:"Cancelar",onClick:()=>n("/vehicles")})]})]})})}function ee(){return e.jsx(k,{})}export{ee as default};
