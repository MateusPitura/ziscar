import{r as u,u as D,b as V,f as b,a0 as g,j as s,a1 as w,a2 as I,e as q}from"./index-BaodxefT.js";import{F as T}from"./FieldArray-DtKa32ag.js";import{I as i}from"./schemas-C9qoDM_Y.js";import{S as h}from"./Select-JHn8gkD0.js";import{u as k}from"./useDialog-B00w_pfZ.js";function N(){const[l,y]=u.useState(""),{setValue:t,trigger:C,getValues:x,watch:c}=k(),{safeFetch:m}=D(),{showErrorSnackbar:p}=V();async function F(e){return await m(`https://viacep.com.br/ws/${e}/json/`,{enableCookie:!1})}const{data:r,isFetching:a}=b({queryKey:["cepApi",l],queryFn:({queryKey:e})=>F(e[1]),enabled:!!l});u.useEffect(()=>{if(r!=null&&r.erro){p({description:"CEP não encontrado"});return}r&&(t("address.0.street",r.logradouro,{shouldDirty:!0}),t("address.0.neighborhood",r.bairro,{shouldDirty:!0}),t("address.0.cityIbgeCode",r.ibge,{shouldDirty:!0}),t("address.0.state",r.uf,{shouldDirty:!0}))},[r,t,p]);async function E(e){return e?await m(`${q}/city/${e}`):[]}const o=c("address.0.state"),{data:S,isFetching:j}=b({queryKey:["ibgeApi",o],queryFn:({queryKey:e})=>E(e[1]),enabled:!!o,select:e=>e==null?void 0:e.map(n=>({value:String(n.ibgeCode),label:n.name}))});async function f(){if(await C("address.0.cep")){const n=x("address.0.cep");y(n)}}const d=c("address.0.cep");u.useEffect(()=>{(d==null?void 0:d.length)===g&&f()},[d]);function A(e){e.key==="Enter"&&(e.preventDefault(),f())}return s.jsx(T,{name:"address",appendText:"Adicionar endereço",removeText:"Remover endereço",maxLength:1,title:"Endereço",appendDefaultValues:w,render:()=>s.jsxs(s.Fragment,{children:[s.jsx("div",{onKeyDown:A,children:s.jsx(i,{label:"CEP",name:"address.0.cep",mask:"cep",maxLength:g,required:!0,forceUnselect:!0,disabled:a})}),s.jsx(i,{label:"Número",name:"address.0.number",required:!0}),s.jsx(i,{label:"Rua",name:"address.0.street",disabled:a}),s.jsx(i,{label:"Bairro",name:"address.0.neighborhood",disabled:a}),s.jsx(h,{label:"Estado",name:"address.0.state",options:I,onChange:()=>t("address.0.cityIbgeCode","",{shouldDirty:!0}),disabled:a}),s.jsx(h,{label:"Cidade",name:"address.0.cityIbgeCode",options:S||[],loading:j,disabled:!o})]})})}export{N as A};
