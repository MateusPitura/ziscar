import{r as u,j as e,a as v,a6 as x,aF as b,l as E,T as h,m as j,u as D,f as y,aG as r,B as L,e as N}from"./index-qW6Jgc2x.js";import{P}from"./PageHeader-Duldp10i.js";import{S as g,T as l}from"./Table-BA_YUflV.js";import{S as V,A as R}from"./index-CKXDXvjH.js";import{u as p,f as B}from"./react-pdf.browser-DEW3ltMk.js";import{E as I}from"./ExportButton-BKXomDU2.js";import{F as T,I as S,u as H}from"./schemas-DhckABRc.js";import{u as _}from"./useButtonState-D4P9Pwdl.js";import{u as C}from"./useDialogContext-DbYsvN72.js";import{C as m}from"./Choice-RetwyA5o.js";import"./DialogContext-CCY72MLl.js";import"./dialog-D5XMW0Vt.js";import"./useIsFetching-BuLOKJUG.js";const $=u.createContext(null);function q({children:a}){const[t,s]=u.useState("");function i(d){s(d)}const c=u.useMemo(()=>({example:t,handleExample:i}),[t]);return e.jsx($.Provider,{value:c,children:a})}function w(a){const t=[];for(const s of a.data)t.push({...s,totalValue:v(s.totalValue,"money")??""});return{total:a.total,data:t}}function M(a){const t=[];for(const s of a.data)t.push({...s,totalValue:v(s.totalValue,"money")??"",overallStatus:s.overallStatus==="PAID"?"Pago":"Pendente"});return t}function k(){const{accountsReceivableFilter:a,handleAccountsReceivableFilter:t}=p(),{closeDialog:s}=C();function i(c){t({page:1,...c}),s()}return e.jsx(T,{schema:V,onSubmit:i,className:"flex-1 flex flex-col min-h-0",defaultValues:{startDate:(a==null?void 0:a.startDate)||"",endDate:(a==null?void 0:a.endDate)||"",overallStatus:(a==null?void 0:a.overallStatus)||x.PAID},replaceEmptyStringToNull:!1,children:e.jsx(U,{})})}function U(){const{reset:a}=_(),{handleAccountsReceivableFilter:t}=p(),{closeDialog:s}=C();function i(){t(b),a(b),s()}return e.jsxs(e.Fragment,{children:[e.jsxs(g.Body,{className:"flex flex-col gap-4",children:[e.jsx(S,{name:"startDate",label:"Data inicial de criação",type:"date"}),e.jsx(S,{name:"endDate",label:"Data final de criação",type:"date"}),e.jsx(H,{label:"Status geral"}),e.jsx("div",{className:"flex flex-col gap-2",children:e.jsxs(m,{hideErrorLabel:!0,children:[e.jsx(m.Radio,{name:"overallStatus",label:"Pago",value:x.PAID}),e.jsx(m.Radio,{name:"overallStatus",label:"Pendente",value:x.PENDING})]})})]}),e.jsx(g.Footer,{primaryLabel:"Aplicar",secondaryLabel:"Limpar",onSecondaryCallback:i,dirty:!0})]})}const K=u.memo(k);function O({accountReceivableId:a,vehicleSaleId:t}){const s=E();return e.jsxs(e.Fragment,{children:[e.jsx(h,{content:"Detalhes da venda",children:e.jsx(j,{variant:"quaternary",iconLeft:"CurrencyExchange",onClick:()=>s(`/vehicle-sale/view/${t}`),resource:"VEHICLE_SALE",action:"READ",padding:"none","data-cy":`button-view-vehicleSale-${t}`})}),e.jsx(h,{content:"Detalhes do pagamento",children:e.jsx(j,{variant:"quaternary",iconLeft:"ReceiptLong",onClick:()=>s(`/accounts-receivable/${a}/installments`),resource:"ACCOUNTS_RECEIVABLE",action:"READ",padding:"none","data-cy":`button-edit-accountReceivable-${a}`})})]})}const A=10;function G(){const{safeFetch:a}=D(),{accountsReceivableFilter:t,handleAccountsReceivableFilter:s}=p();function i(n){s({page:n})}const c=u.useMemo(()=>t?B(t):"",[t]);async function d(n){return await a(`${N}/account-receivable/search?${n}&orderBy=description`,{resource:"ACCOUNTS_RECEIVABLE",action:"READ"})}const{data:o,isFetching:f}=y({queryKey:["accounts-receivable",c],queryFn:({queryKey:n})=>d(n[1]),select:w}),F=u.useMemo(()=>o!=null&&o.data.length?Math.max(...o.data.map(n=>n.totalValue.length)):0,[o==null?void 0:o.data]);return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex gap-4 justify-end",children:[e.jsx(I,{fileName:"Relatório Contas a Receber",queryKey:["accounts-receivable",c],queryFn:d,selectQueryFn:M,formatFilters:{endDate:"Data final",startDate:"Data inicial",overallStatus:"Status geral"},formatFiltersValues:{overallStatus:{PAID:"Pago",PENDING:"Pendente"}},formatColumns:{installmentsNumber:"Número de parcelas",description:"Descrição",receivedFrom:"Recebido de",totalValue:"Valor total",overallStatus:"Status geral"}}),e.jsx(l.Filter,{form:e.jsx(K,{})})]}),e.jsxs(l,{children:[e.jsxs(l.Header,{gridColumns:A,children:[e.jsx(l.Head,{label:r.description.label}),e.jsx(l.Head,{label:r.installmentsNumber.label}),e.jsx(l.Head,{label:r.receivedFrom.label}),e.jsx(l.Head,{label:r.overallStatus.label,colSpan:r.overallStatus.colSpan}),e.jsx(l.Head,{label:r.totalValue.label}),e.jsx(l.Head,{action:!0})]}),e.jsx(l.Body,{isLoading:f,isEmpty:!(o!=null&&o.total),resource:"ACCOUNTS_RECEIVABLE",action:"READ",children:o==null?void 0:o.data.map(n=>e.jsxs(l.Row,{gridColumns:A,children:[e.jsx(l.Cell,{label:n.description,columnLabel:r.description.label}),e.jsx(l.Cell,{label:n.installmentsNumber,columnLabel:r.installmentsNumber.label}),e.jsx(l.Cell,{label:n.receivedFrom,columnLabel:r.receivedFrom.label}),e.jsx(l.Cell,{label:e.jsx(R,{status:n.overallStatus}),columnLabel:r.overallStatus.label,colSpan:r.overallStatus.colSpan}),e.jsx(l.Cell,{label:n.totalValue.padStart(F,L),className:"font-mono whitespace-pre",columnLabel:r.totalValue.label}),e.jsx(l.Action,{children:e.jsx(O,{accountReceivableId:String(n.id),vehicleSaleId:String(n.vehicleSaleId)})})]},n.id))}),e.jsx(l.Footer,{currentStartItem:t==null?void 0:t.page,totalItems:o==null?void 0:o.total,onClickNavigateBtn:i,isLoading:f})]})]})}function Q(){return e.jsxs("div",{className:"flex flex-col gap-4 h-full w-full",children:[e.jsx(P,{title:"Vendas"}),e.jsx(G,{})]})}function re(){return e.jsx(q,{children:e.jsx(Q,{})})}export{re as default};
