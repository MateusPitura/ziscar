import{u as g,b as f,c as j,d as v,j as e,B as V,e as S,f as N,t as T,T as m,g as h,w as F,a as D,r as p,h as H,x as i,E as x,y,S as P}from"./index-CDuUmDit.js";import{V as B}from"./VehicleExpenseHeader-HhexgJd-.js";import{T as o}from"./Table-DGenUfom.js";import{u as w}from"./DialogContext-28MRl5PT.js";import{D as E}from"./Dialog-BW0_p7Tw.js";import{D as q}from"./DataField-B0EHyytN.js";import{u as I}from"./useIsFetching-CQOvAVOi.js";import"./PageHeader-B5SIBKuZ.js";import"./useButtonState-DJFFoANO.js";import"./selectVehicleInfo-DaknI4Z7.js";import"./dialog-3JPZnGOG.js";function _({vehicleExpenseId:s,vehicleCategory:l,...n}){const{safeFetch:c}=g(),{showSuccessSnackbar:r}=f(),a=j();async function u(){await c(`${S}/vehicle-expense/${s}`,{method:"DELETE",body:{archivedAt:new Date().toISOString()},resource:"VEHICLE_EXPENSE",action:"DELETE"})}const{mutate:d,isPending:t}=v({mutationFn:u,onSuccess:()=>{a.invalidateQueries({queryKey:["vehicle-expenses"]}),r({title:"Gasto removido com sucesso"}),n.closeDialog()}});return e.jsxs(E,{...n,children:[e.jsx(E.Header,{title:"Remover gasto"}),e.jsx(E.Body,{children:e.jsxs("span",{className:"text-body-medium text-neutral-700",children:["Tem certeza que deseja remover o gasto de",e.jsxs("span",{className:"font-bold",children:[V,l]}),"? Ao remover ele não será mais acessível"]})}),e.jsx(E.Footer,{labelPrimaryBtn:"Remover",onClickPrimaryBtn:d,primaryBtnState:t?"loading":void 0,primaryBtnColor:"red",primaryBtnResource:"VEHICLE_EXPENSE",primaryBtnAction:"DELETE"})]})}function $({vehicleExpenseId:s,vehicleCategory:l,isActive:n,handleDisableVehicleExpenseInfo:c}){const r=N(),{pathname:a}=T(),{safeFetch:u}=g(),d=j(),{showSuccessSnackbar:t}=f();async function L(){await u(`${S}/vehicle-expense/${s}`,{method:"DELETE",body:{archivedAt:null},resource:"VEHICLE_EXPENSE",action:"DELETE"})}const{mutate:C,isPending:A}=v({mutationFn:L,onSuccess:()=>{d.invalidateQueries({queryKey:["vehicle-expenses"]}),t({title:`Gasto de ${l} ativado com sucesso`})}});return n?e.jsxs(e.Fragment,{children:[e.jsx(m,{content:"Editar",children:e.jsx(h,{variant:"quaternary",iconLeft:"Edit",onClick:()=>r(`${a}/edit/${s}`),resource:"VEHICLE_EXPENSE",action:"UPDATE",padding:"none","data-cy":`button-edit-vehicle-expense-${s}`})}),e.jsx(m,{content:"Desativar",children:e.jsx(h,{variant:"primary",iconLeft:"Delete",color:"red",padding:"none",onClick:()=>{c({vehicleExpenseId:s,vehicleCategory:l})},resource:"VEHICLE_EXPENSE",action:"DELETE","data-cy":`button-disable-vehicle-expense-${s}`})})]}):e.jsx(m,{content:"Ativar",children:e.jsx(h,{variant:"quaternary",onClick:C,state:A?"loading":void 0,resource:"VEHICLE_EXPENSE",action:"DELETE",padding:"none",iconLeft:"ToggleOn","data-cy":`button-enable-vehicle-expense-${s}`})})}function k(s){const l=[];for(const n of s)l.push({...n,totalValue:D(n.totalValue,"money")??"",competencyDate:F({date:n.competencyDate,format:"dd/MM/yyyy"})});return l}const b=8;function M(){const[s,l]=p.useState({vehicleExpenseId:"",vehicleCategory:""}),n=w();function c(t){n.openDialog(),l(t)}async function r(){return[{id:1,category:y.MAINTENANCE,observations:"Troca de óleo",archivedAt:void 0,totalValue:"1500",competencyDate:"2023-10-01"},{id:2,category:y.FUEL,observations:"Abastecimento",archivedAt:void 0,totalValue:"300",competencyDate:"2023-10-05"},{id:3,category:y.INSURANCE,observations:"Seguro anual",archivedAt:void 0,totalValue:"1200",competencyDate:"2023-10-10"}]}const{data:a,isFetching:u}=H({queryKey:["vehicle-expenses"],queryFn:r,select:k}),d=p.useMemo(()=>a!=null&&a.length?Math.max(...a.map(t=>t.totalValue.length)):0,[a]);return e.jsxs(e.Fragment,{children:[e.jsx(_,{...s,...n}),e.jsx("div",{className:"w-fit",children:e.jsx(q,{label:"Total de gastos",value:D("1000000","money")})}),e.jsxs(o,{children:[e.jsxs(o.Header,{gridColumns:b,children:[e.jsx(o.Head,{label:i.competencyDate.label}),e.jsx(o.Head,{label:i.observations.label}),e.jsx(o.Head,{label:i.category.label}),e.jsx(o.Head,{label:i.totalValue.label,colSpan:i.totalValue.colSpan}),e.jsx(o.Head,{action:!0})]}),e.jsx(o.Body,{isLoading:u,isEmpty:!(a!=null&&a.length),resource:"VEHICLE_EXPENSE",action:"READ",children:a==null?void 0:a.map(t=>e.jsxs(o.Row,{gridColumns:b,children:[e.jsx(o.Cell,{label:t.competencyDate,columnLabel:i.competencyDate.label}),e.jsx(o.Cell,{label:t.observations,columnLabel:i.observations.label}),e.jsx(o.Cell,{label:x[t.category],columnLabel:i.category.label}),e.jsx(o.Cell,{label:t.totalValue.padStart(d,V),className:"font-mono whitespace-pre",colSpan:i.totalValue.colSpan,columnLabel:i.totalValue.label}),e.jsx(o.Action,{children:e.jsx($,{vehicleExpenseId:String(t.id),vehicleCategory:x[t.category],handleDisableVehicleExpenseInfo:c,isActive:!t.archivedAt})})]},t.id))})]})]})}function R(){return I({queryKey:["vehicle"]})?e.jsx("div",{className:"flex justify-center items-center h-full w-full",children:e.jsx(P,{})}):e.jsxs("div",{className:"flex flex-col gap-4 h-full w-full",children:[e.jsx(B,{title:"Gastos do Veículo",showActions:!0}),e.jsx(M,{})]})}function ee(){return e.jsx(R,{})}export{ee as default};
