import{r as u,j as e,t as b,a as S,a4 as x,aE as g,i as F,T as C,k as v,u as P,f as E,aF as n,B as L,e as N}from"./index-C8Hi2I9-.js";import{P as T}from"./PageHeader-C3bsmlao.js";import{S as h,T as o}from"./Table-DwjZzqAC.js";import{A as B}from"./AccountStatus-CW7qdCgu.js";import{u as f,f as V}from"./react-pdf.browser-BXhLJome.js";import{E as R}from"./ExportButton-zBvyv4kA.js";import{F as M,I as m,u as H}from"./schemas-ARZMo_di.js";import{C as p}from"./Choice-DK2qdk0A.js";import{u as y}from"./useDialogContext-C__WYHYu.js";import{u as I}from"./useButtonState-D8nv53KZ.js";import{S as _}from"./index-DSuoN_i-.js";import"./DialogContext-DTkaQtxz.js";import"./dialog-DBF6ydzz.js";import"./useIsFetching-B7K5de3P.js";const k=u.createContext(null);function q({children:a}){const[t,l]=u.useState("");function i(d){l(d)}const c=u.useMemo(()=>({example:t,handleExample:i}),[t]);return e.jsx(k.Provider,{value:c,children:a})}function U(a){const t=[];for(const l of a.data)t.push({...l,totalValue:S(l.totalValue,"money")??"",date:l.date?b({date:l.date.split("T")[0],format:"dd/MM/yyyy"}):""});return{total:a.total,data:t}}function $(a){const t=[];for(const l of a.data)t.push({...l,totalValue:S(l.totalValue,"money")??"",overallStatus:l.overallStatus==="PAID"?"Pago":"Pendente",date:l.date?b({date:l.date.split("T")[0],format:"dd/MM/yyyy"}):""});return t}function w(){const{accountsPayableFilter:a,handleAccountsPayableFilter:t}=f(),{closeDialog:l}=y();function i(c){t({page:1,...c}),l()}return e.jsx(M,{schema:_,onSubmit:i,className:"flex-1 flex flex-col min-h-0",defaultValues:{startDate:(a==null?void 0:a.startDate)||"",endDate:(a==null?void 0:a.endDate)||"",description:(a==null?void 0:a.description)||"",overallStatus:(a==null?void 0:a.overallStatus)||x.PAID},replaceEmptyStringToNull:!1,children:e.jsx(K,{})})}function K(){const{reset:a}=I(),{handleAccountsPayableFilter:t}=f(),{closeDialog:l}=y();function i(){t(g),a(g),l()}return e.jsxs(e.Fragment,{children:[e.jsxs(h.Body,{className:"flex flex-col gap-4",children:[e.jsx(m,{label:"Descrição",name:"description"}),e.jsx(m,{name:"startDate",label:"Data inicial de criação",type:"date"}),e.jsx(m,{name:"endDate",label:"Data final de criação",type:"date"}),e.jsx(H,{label:"Status geral"}),e.jsx("div",{className:"flex flex-col gap-2",children:e.jsxs(p,{hideErrorLabel:!0,children:[e.jsx(p.Radio,{name:"overallStatus",label:"Pago",value:x.PAID}),e.jsx(p.Radio,{name:"overallStatus",label:"Pendente",value:x.PENDING})]})})]}),e.jsx(h.Footer,{primaryLabel:"Aplicar",secondaryLabel:"Limpar",onSecondaryCallback:i,dirty:!0})]})}const O=u.memo(w);function Y({accountPayableId:a}){const t=F();return e.jsx(e.Fragment,{children:e.jsx(C,{content:"Detalhes do pagamento",children:e.jsx(v,{variant:"quaternary",iconLeft:"ReceiptLong",onClick:()=>t(`/accounts-payable/${a}/installments`),resource:"ACCOUNTS_PAYABLE",action:"READ",padding:"none","data-cy":`button-edit-accountPayable-${a}`})})})}const A=8;function G(){const{safeFetch:a}=P(),{accountsPayableFilter:t,handleAccountsPayableFilter:l}=f();function i(r){l({page:r})}const c=u.useMemo(()=>t?V(t):"",[t]);async function d(r){return await a(`${N}/account-payable/search?${r}&orderBy=description`,{resource:"ACCOUNTS_PAYABLE",action:"READ"})}const{data:s,isFetching:j}=E({queryKey:["accounts-payable",c],queryFn:({queryKey:r})=>d(r[1]),select:U}),D=u.useMemo(()=>s!=null&&s.data.length?Math.max(...s.data.map(r=>r.totalValue.length)):0,[s==null?void 0:s.data]);return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex gap-4 justify-end",children:[e.jsx(R,{fileName:"Relatório Contas a Pagar",queryKey:["accounts-payable",c],queryFn:d,selectQueryFn:$,formatFilters:{endDate:"Data final",startDate:"Data inicial",overallStatus:"Status geral",description:"Descrição"},formatFiltersValues:{overallStatus:{PAID:"Pago",PENDING:"Pendente"}},formatColumns:{description:"Descrição",paidTo:"Pago a",overallStatus:"Status geral",totalValue:"Valor total"}}),e.jsx(o.Filter,{form:e.jsx(O,{})})]}),e.jsxs(o,{children:[e.jsxs(o.Header,{gridColumns:A,children:[e.jsx(o.Head,{label:n.description.label}),e.jsx(o.Head,{label:n.paidTo.label}),e.jsx(o.Head,{label:n.overallStatus.label,colSpan:n.overallStatus.colSpan}),e.jsx(o.Head,{label:n.totalValue.label}),e.jsx(o.Head,{action:!0})]}),e.jsx(o.Body,{isLoading:j,isEmpty:!(s!=null&&s.total),resource:"ACCOUNTS_PAYABLE",action:"READ",children:s==null?void 0:s.data.map(r=>e.jsxs(o.Row,{gridColumns:A,children:[e.jsx(o.Cell,{label:r.description,columnLabel:n.description.label}),e.jsx(o.Cell,{label:r.paidTo,columnLabel:n.paidTo.label}),e.jsx(o.Cell,{label:e.jsx(B,{status:r.overallStatus}),columnLabel:n.overallStatus.label,colSpan:n.overallStatus.colSpan}),e.jsx(o.Cell,{label:r.totalValue.padStart(D,L),className:"font-mono whitespace-pre",columnLabel:n.totalValue.label}),e.jsx(o.Action,{children:e.jsx(Y,{accountPayableId:String(r.id)})})]},r.id))}),e.jsx(o.Footer,{currentStartItem:t==null?void 0:t.page,totalItems:s==null?void 0:s.total,onClickNavigateBtn:i,isLoading:j})]})]})}function Q(){return e.jsxs("div",{className:"flex flex-col gap-4 h-full w-full",children:[e.jsx(T,{title:"Pagamentos"}),e.jsx(G,{})]})}function ce(){return e.jsx(q,{children:e.jsx(Q,{})})}export{ce as default};
