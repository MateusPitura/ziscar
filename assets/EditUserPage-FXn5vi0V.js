import{r as a,j as i,a as m,u as P,b as A,i as v,c as j,o as F,f as C,d as R,S as q,e as p}from"./index-DmwSkqVz.js";import{U as w}from"./UserForm-GlHKO_1M.js";import{s as I,p as N}from"./selectAddressInfo-CNJdWtNC.js";import{u as b}from"./useIsFetching-awalAWhd.js";import"./schemas-CDh-Ls0x.js";import"./useDialog-B87cicjl.js";import"./Choice-D6EJHI4O.js";import"./AddressFields-vz8v9WNE.js";import"./FieldArray-CccZHlDo.js";import"./Section-VDDmVTvE.js";import"./Select-BCdmGCll.js";import"./PageHeader-CS70jJr4.js";import"./index-a2UIgC7o.js";import"./index-fjEarVAD.js";const K=a.createContext(null);function T({children:e}){const[s,n]=a.useState(!1);function u(t){n(t)}const c=a.useMemo(()=>({example:s,handleExample:u}),[s]);return i.jsx(K.Provider,{value:c,children:e})}function $(e){var s;return{fullName:e.fullName,email:e.email,phone:m(e.phone,"phone")??"",cpf:m(e.cpf,"cpf")??"",roleId:((s=e.roleId)==null?void 0:s.toString())??"",address:I(e.address)}}function X({contextHelper:e}){const{safeFetch:s}=P(),{showSuccessSnackbar:n}=A(),u=b({queryKey:["cepApi"]}),c=v(),t=j(),{userId:o}=F();async function f(){return await s(`${p}/user/${o}`,{resource:"USERS",action:"READ"})}const{data:r,isFetching:y}=C({queryKey:["user",o],queryFn:f,select:$});async function E(h){const{address:x,...g}=h,d=N({newAddress:x,oldAddress:r==null?void 0:r.address});await s(`${p}/user/${o}`,{method:"PATCH",body:{...g,...d&&{address:d}},resource:"USERS",action:"UPDATE"})}const{mutate:S,isPending:U,isSuccess:l}=R({mutationFn:E,onSuccess:async()=>{n({title:`Usuário ${r==null?void 0:r.fullName} atualizado com sucesso`}),t.invalidateQueries({queryKey:["users"]}),c("/users")}});return a.useEffect(()=>()=>{l&&t.invalidateQueries({queryKey:["user",o]})},[l,t,o]),y?i.jsx("div",{className:"flex justify-center items-center h-full w-full",children:i.jsx(q,{})}):i.jsx(T,{children:r&&i.jsx(w,{defaultValues:r,onSubmit:S,isPending:U||!!u,headerTitle:"Alterar usuário",isEdit:!0,resource:"USERS",action:"UPDATE",allowEditRole:!0,contextHelper:e})})}export{X as default};
