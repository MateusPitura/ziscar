import{r as d,j as e,u as y,b as C,c as F,d as A,B as N,e as v,i as R,T as p,k as f,W as L,f as P,X as c}from"./index-UdT0GBA4.js";import{P as $}from"./PageHeader-BWgTwsAh.js";import{S as T,T as t}from"./Table-C3pX6aIK.js";import{u as h,f as O}from"./react-pdf.browser--VWKIJ9j.js";import{u as k}from"./DialogContext-BXF1n5N_.js";import{D as b}from"./Dialog-EaJkbypX.js";import{s as w}from"./selectStoresInfo-PKSV8PaO.js";import{F as q,I as E,u as H}from"./schemas-BggDEbt9.js";import{C as g}from"./Choice-Dg5X3hHC.js";import{u as I}from"./useButtonState-N-GWfCKe.js";import{S as K}from"./index-BIfgPIhv.js";import{u as B}from"./useDialogContext-3ywhn9HH.js";import"./dialog-Cf7DmMJZ.js";import"./index-Bc_KExWn.js";const M=d.createContext(null);function Q({children:a}){const[s,l]=d.useState("");function r(u){l(u)}const o=d.useMemo(()=>({example:s,handleExample:r}),[s]);return e.jsx(M.Provider,{value:o,children:a})}function z({storeId:a,storeName:s,...l}){const{safeFetch:r}=y(),{showSuccessSnackbar:o}=C(),u=F(),{handleStoresFilter:m}=h();async function x(){await r(`${v}/store/${a}`,{method:"DELETE",body:{archivedAt:new Date().toISOString()},resource:"STORES",action:"DELETE"})}const{mutate:j,isPending:S}=A({mutationFn:x,onSuccess:()=>{m({page:1}),u.invalidateQueries({queryKey:["stores"]}),o({title:`Loja ${s} desativada com sucesso`}),l.closeDialog()}});return e.jsxs(b,{...l,children:[e.jsx(b.Header,{title:"Desativar loja"}),e.jsx(b.Body,{children:e.jsxs("span",{className:"text-body-medium text-neutral-700",children:["Tem certeza que deseja desativar a loja",e.jsxs("span",{className:"font-bold",children:[N,s]}),"? Ao desativar os registros relacionados a ela não serão mais acessíveis"]})}),e.jsx(b.Footer,{labelPrimaryBtn:"Desativar",onClickPrimaryBtn:j,primaryBtnState:S?"loading":void 0,primaryBtnColor:"red",primaryBtnResource:"STORES",primaryBtnAction:"DELETE"})]})}function U({storeId:a,name:s,isActive:l,handleDisableStoreInfo:r}){const o=R(),{safeFetch:u}=y(),{showSuccessSnackbar:m}=C(),x=F();async function j(){await u(`${v}/store/${a}`,{method:"DELETE",body:{archivedAt:null},resource:"STORES",action:"DELETE"})}const{mutate:S,isPending:i}=A({mutationFn:j,onSuccess:()=>{x.invalidateQueries({queryKey:["stores"]}),m({title:`Loja ${s} ativada com sucesso`})}});return l?e.jsxs(e.Fragment,{children:[e.jsx(p,{content:"Editar",children:e.jsx(f,{variant:"quaternary",iconLeft:"Edit",onClick:()=>o(`/stores/edit/${a}`),resource:"STORES",action:"UPDATE",padding:"none","data-cy":`button-edit-store-${a}`})}),e.jsx(p,{content:"Desativar",children:e.jsx(f,{variant:"primary",iconLeft:"Delete",color:"red",padding:"none",onClick:()=>r({storeName:s,storeId:a}),resource:"STORES",action:"DELETE","data-cy":`button-disable-store-${a}`})})]}):e.jsx(p,{content:"Ativar",children:e.jsx(f,{variant:"quaternary",onClick:S,state:i?"loading":void 0,resource:"STORES",action:"DELETE",padding:"none",iconLeft:"ToggleOn","data-cy":`button-enable-store-${a}`})})}function V(){const{storesFilter:a,handleStoresFilter:s}=h(),{closeDialog:l}=B();function r(o){s({page:1,...o}),l()}return e.jsx(q,{schema:K,onSubmit:r,className:"flex-1 flex flex-col min-h-0",defaultValues:{name:(a==null?void 0:a.name)||"",status:(a==null?void 0:a.status)||"active",startDate:(a==null?void 0:a.startDate)||"",endDate:(a==null?void 0:a.endDate)||""},replaceEmptyStringToNull:!1,children:e.jsx(_,{})})}function _(){const{reset:a}=I(),{handleStoresFilter:s}=h(),{closeDialog:l}=B();function r(){s(L),a(L),l()}return e.jsxs(e.Fragment,{children:[e.jsxs(T.Body,{className:"flex flex-col gap-4",children:[e.jsx(E,{name:"name",label:"Nome"}),e.jsx(H,{label:"Status"}),e.jsx("div",{className:"flex flex-col gap-2",children:e.jsxs(g,{hideErrorLabel:!0,children:[e.jsx(g.Radio,{name:"status",label:"Ativo",value:"active"}),e.jsx(g.Radio,{name:"status",label:"Inativo",value:"inactive"})]})}),e.jsx(E,{name:"startDate",label:"Data inicial de criação",type:"date"}),e.jsx(E,{name:"endDate",label:"Data final de criação",type:"date"})]}),e.jsx(T.Footer,{primaryLabel:"Aplicar",secondaryLabel:"Limpar",onSecondaryCallback:r,dirty:!0})]})}const W=d.memo(V),X=!1;function G(){const[a,s]=d.useState({storeName:"",storeId:""}),l=k(),{safeFetch:r}=y(),{storesFilter:o,handleStoresFilter:u}=h();function m(n){l.openDialog(),s(n)}function x(n){u({page:n})}const j=d.useMemo(()=>o?O(o):"",[o]);async function S(n){return await r(`${v}/store?${n}&orderBy=name`,{resource:"STORES",action:"READ"})}const{data:i,isFetching:D}=P({queryKey:["stores",j],queryFn:({queryKey:n})=>S(n[1]),select:w});return e.jsxs(e.Fragment,{children:[e.jsx(z,{...a,...l}),e.jsxs("div",{className:"flex gap-4 justify-end",children:[X,e.jsx(t.Filter,{form:e.jsx(W,{})})]}),e.jsxs(t,{children:[e.jsxs(t.Header,{children:[e.jsx(t.Head,{label:c.name.label}),e.jsx(t.Head,{label:c.cnpj.label}),e.jsx(t.Head,{label:c.email.label}),e.jsx(t.Head,{label:c.phone.label}),e.jsx(t.Head,{label:c.status.label}),e.jsx(t.Head,{action:!0})]}),e.jsx(t.Body,{isLoading:D,isEmpty:!(i!=null&&i.total),resource:"STORES",action:"READ",children:i==null?void 0:i.data.map(n=>e.jsxs(t.Row,{children:[e.jsx(t.Cell,{label:n.name,columnLabel:c.name.label}),e.jsx(t.Cell,{label:n.cnpj,columnLabel:c.cnpj.label}),e.jsx(t.Cell,{label:n.email,columnLabel:c.email.label}),e.jsx(t.Cell,{label:n.phone,columnLabel:c.phone.label}),e.jsx(t.Cell,{label:n.archivedAt?"Inativo":"Ativo",columnLabel:c.status.label}),e.jsx(t.Action,{children:e.jsx(U,{isActive:!n.archivedAt,storeId:String(n.id),name:n.name,handleDisableStoreInfo:m})})]},n.id))}),e.jsx(t.Footer,{currentStartItem:o==null?void 0:o.page,totalItems:i==null?void 0:i.total,onClickNavigateBtn:x,isLoading:D})]})]})}function J(){const a=R();return e.jsxs("div",{className:"flex flex-col gap-4 h-full w-full",children:[e.jsx($,{title:"Lojas",children:e.jsx(f,{label:"Adicionar loja",iconLeft:"Add",onClick:()=>a("/stores/new"),resource:"STORES",action:"CREATE",color:"green","data-cy":"new-store-button"})}),e.jsx(G,{})]})}function me(){return e.jsx(Q,{children:e.jsx(J,{})})}export{me as default};
