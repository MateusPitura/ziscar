import{t as H,a as S,u as g,b as C,c as D,d as L,j as e,B as T,e as f,i as N,w as F,T as p,k as y,r as b,n as P,f as A,x as B,y as l,E as V,S as w}from"./index-CrVTpVTI.js";import{V as $}from"./VehicleExpenseHeader-OcndBYbf.js";import{T as s}from"./Table-CQjU_dFI.js";import{D as _}from"./DataField-CmnNFbKB.js";import{u as k}from"./DialogContext-3LqbYYdn.js";import{D as m}from"./Dialog-BHTFXl4K.js";import{u as q}from"./useIsFetching-Dh2N-bBa.js";import"./PageHeader-DARJqnt5.js";import"./useButtonState-C7TXS9Jx.js";import"./selectVehicleInfo-D5Hlg63I.js";import"./dialog-Ct9-qcrh.js";function M(n){var o,r;const c=[];for(const i of n)c.push({...i,totalValue:S(i.totalValue,"money")??"",competencyDate:H({date:(r=(o=i.competencyDate)==null?void 0:o.split("T"))==null?void 0:r[0],format:"dd/MM/yyyy"})});return c}function X({vehicleExpenseId:n,vehicleCategory:c,...o}){const{safeFetch:r}=g(),{showSuccessSnackbar:i}=C(),u=D();async function d(){await r(`${f}/vehicle-expense/${n}/archive`,{method:"PATCH",resource:"VEHICLE_EXPENSE",action:"DELETE"})}const{mutate:t,isPending:E}=L({mutationFn:d,onSuccess:()=>{u.invalidateQueries({queryKey:["vehicle-expenses"]}),i({title:"Gasto desativado com sucesso"}),o.closeDialog()}});return e.jsxs(m,{...o,children:[e.jsx(m.Header,{title:"Desativar gasto"}),e.jsx(m.Body,{children:e.jsxs("span",{className:"text-body-medium text-neutral-700",children:["Tem certeza que deseja desativar o gasto de",e.jsxs("span",{className:"font-bold",children:[T,c]}),"? Ao desativar ele não será mais acessível"]})}),e.jsx(m.Footer,{labelPrimaryBtn:"Desativar",onClickPrimaryBtn:t,primaryBtnState:E?"loading":void 0,primaryBtnColor:"red",primaryBtnResource:"VEHICLE_EXPENSE",primaryBtnAction:"DELETE"})]})}function I({vehicleExpenseId:n,vehicleCategory:c,isActive:o,handleDisableVehicleExpenseInfo:r}){const i=N(),{pathname:u}=F(),{safeFetch:d}=g(),t=D(),{showSuccessSnackbar:E}=C();async function h(){await d(`${f}/vehicle-expense/${n}/unarchive`,{method:"PATCH",resource:"VEHICLE_EXPENSE",action:"DELETE"})}const{mutate:x,isPending:a}=L({mutationFn:h,onSuccess:()=>{t.invalidateQueries({queryKey:["vehicle-expenses"]}),E({title:`Gasto de ${c} ativado com sucesso`})}});return o?e.jsxs(e.Fragment,{children:[e.jsx(p,{content:"Editar",children:e.jsx(y,{variant:"quaternary",iconLeft:"Edit",onClick:()=>i(`${u}/edit/${n}`),resource:"VEHICLE_EXPENSE",action:"UPDATE",padding:"none","data-cy":`button-edit-vehicle-expense-${n}`})}),e.jsx(p,{content:"Desativar",children:e.jsx(y,{variant:"primary",iconLeft:"Delete",color:"red",padding:"none",onClick:()=>{r({vehicleExpenseId:n,vehicleCategory:c})},resource:"VEHICLE_EXPENSE",action:"DELETE","data-cy":`button-disable-vehicle-expense-${n}`})})]}):e.jsx(p,{content:"Ativar",children:e.jsx(y,{variant:"quaternary",onClick:x,state:a?"loading":void 0,resource:"VEHICLE_EXPENSE",action:"DELETE",padding:"none",iconLeft:"ToggleOn","data-cy":`button-enable-vehicle-expense-${n}`})})}const v=8;function K(){const[n,c]=b.useState({vehicleExpenseId:"",vehicleCategory:""}),o=k(),{safeFetch:r}=g(),{vehicleId:i}=P();function u(a){o.openDialog(),c(a)}async function d(){return await r(`${f}/vehicle-expense/${i}`,{resource:"VEHICLE_EXPENSE",action:"READ"})}const{data:t,isFetching:E}=A({queryKey:["vehicle-expenses",i],queryFn:d,select:M}),h=b.useMemo(()=>t!=null&&t.length?Math.max(...t.map(a=>String(a.totalValue).length)):0,[t]),x=b.useMemo(()=>{if(!(t!=null&&t.length))return"0";let a=0;for(const j of t)j.archivedAt||(a+=Number(B(j.totalValue)));return String(a)},[t]);return e.jsxs(e.Fragment,{children:[e.jsx(X,{...n,...o}),e.jsx("div",{className:"w-fit",children:e.jsx(_,{label:"Total de gastos",value:S(x,"money")})}),e.jsxs(s,{children:[e.jsxs(s.Header,{gridColumns:v,children:[e.jsx(s.Head,{label:l.competencyDate.label}),e.jsx(s.Head,{label:l.observations.label}),e.jsx(s.Head,{label:l.category.label}),e.jsx(s.Head,{label:l.totalValue.label,colSpan:l.totalValue.colSpan}),e.jsx(s.Head,{action:!0})]}),e.jsx(s.Body,{isLoading:E,isEmpty:!(t!=null&&t.length),resource:"VEHICLE_EXPENSE",action:"READ",children:t==null?void 0:t.map(a=>e.jsxs(s.Row,{gridColumns:v,children:[e.jsx(s.Cell,{label:a.competencyDate,columnLabel:l.competencyDate.label}),e.jsx(s.Cell,{label:a.observations,columnLabel:l.observations.label}),e.jsx(s.Cell,{label:V[a.category],columnLabel:l.category.label}),e.jsx(s.Cell,{id:String(a.id),label:a.totalValue.padStart(h,T),className:"font-mono whitespace-pre",colSpan:l.totalValue.colSpan,columnLabel:l.totalValue.label}),e.jsx(s.Action,{children:e.jsx(I,{vehicleExpenseId:String(a.id),vehicleCategory:V[a.category],handleDisableVehicleExpenseInfo:u,isActive:!a.archivedAt})})]},a.id))})]})]})}function R(){return q({queryKey:["vehicle"]})?e.jsx("div",{className:"flex justify-center items-center h-full w-full",children:e.jsx(w,{})}):e.jsxs("div",{className:"flex flex-col gap-4 h-full w-full",children:[e.jsx($,{title:"Gastos do Veículo",showActions:!0}),e.jsx(K,{})]})}function ae(){return e.jsx(R,{})}export{ae as default};
