import{r as l,j as a,w as E,x as S,v as U,y as g,H as P,a as b,z as v,q as j,E as f}from"./index-CERee9Ii.js";import{u as F}from"./Section-VtqFNpiH.js";import{U as A}from"./UserForm-UpnkHTwl.js";import{a as m}from"./index-vtalDThm.js";import{s as D}from"./safeFormat-KZryEU5L.js";import"./Loading-Bkl2o9nd.js";import"./Choice-PnALkS5n.js";const q=l.createContext(null);function C({children:e}){const[n,o]=l.useState(!1);function i(r){o(r)}const s=l.useMemo(()=>({example:n,handleExample:i}),[n]);return a.jsx(q.Provider,{value:s,children:e})}function M(e){var n,o,i,s,r,u,t,c;return{fullName:e.fullName,email:e.email,cellPhone:m(e.cellPhone,"cellphone")??"",cpf:m(e.cpf,"cpf")??"",code:e.code??"",birthDate:e.birthDate?D({date:new Date(e.birthDate),format:"yyyy-MM-dd"}):"",roleId:((n=e.roleId)==null?void 0:n.toString())??"",address:{cep:m((o=e.address)==null?void 0:o.cep,"cep")??"",number:((i=e.address)==null?void 0:i.number)??"",street:((s=e.address)==null?void 0:s.street)??"",complement:((r=e.address)==null?void 0:r.complement)??"",neighborhood:((u=e.address)==null?void 0:u.neighborhood)??"",city:((t=e.address)==null?void 0:t.city)??"",state:((c=e.address)==null?void 0:c.state)??""}}}function R(){const{safeFetch:e}=E(),{showSuccessSnackbar:n}=S(),o=F({queryKey:["cepApi"]}),i=U(),s=g(),{userId:r}=P();async function u(){return await e(`${f}/user/${r}`,{resource:"USERS",action:"READ"})}const{data:t,isFetching:c}=b({queryKey:["user",r],queryFn:u,select:M});async function p(x){await e(`${f}/user/${r}`,{method:"PATCH",body:x,resource:"USERS",action:"UPDATE"})}const{mutate:y,isPending:h,isSuccess:d}=v({mutationFn:p,onSuccess:async()=>{n({title:`Usuário ${t==null?void 0:t.fullName} atualizado com sucesso`}),s.invalidateQueries({queryKey:["usersDashboard"]}),i("/users")}});return l.useEffect(()=>()=>{d&&s.invalidateQueries({queryKey:["user"]})},[d,s]),c?a.jsx("div",{className:"flex justify-center items-center h-full",children:a.jsx(j,{})}):t&&a.jsx(A,{defaultValues:t,onSubmit:y,isPending:h||!!o,headerPrimaryBtnLabel:"Alterar",headerTitle:"Alterar usuário",onlyDirty:!0,resource:"USERS",action:"UPDATE"})}function k(){return a.jsx(C,{children:a.jsx(R,{})})}export{k as default};
