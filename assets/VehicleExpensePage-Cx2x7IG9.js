import{w as H,a as S,u as f,b as C,c as D,d as L,j as e,B as T,e as g,l as N,x as F,T as p,m as y,r as b,p as P,f as A,y as B,z as i,E as V,S as w}from"./index-qW6Jgc2x.js";import{V as $}from"./VehicleExpenseHeader-Bq74YEj2.js";import{T as s}from"./Table-BA_YUflV.js";import{D as _}from"./DataField-ChWFe_Y0.js";import{u as q}from"./DialogContext-CCY72MLl.js";import{D as m}from"./Dialog-CraqqAPp.js";import{u as k}from"./useIsFetching-BuLOKJUG.js";import"./PageHeader-Duldp10i.js";import"./useButtonState-D4P9Pwdl.js";import"./selectVehicleInfo-BksJfRaS.js";import"./dialog-D5XMW0Vt.js";function M(n){var o,r;const c=[];for(const l of n)c.push({...l,totalValue:S(l.totalValue,"money")??"",competencyDate:H({date:(r=(o=l.competencyDate)==null?void 0:o.split("T"))==null?void 0:r[0],format:"dd/MM/yyyy"})});return c}function X({vehicleExpenseId:n,vehicleCategory:c,...o}){const{safeFetch:r}=f(),{showSuccessSnackbar:l}=C(),u=D();async function d(){await r(`${g}/vehicle-expense/${n}/archive`,{method:"PATCH",resource:"VEHICLE_EXPENSE",action:"DELETE"})}const{mutate:a,isPending:E}=L({mutationFn:d,onSuccess:()=>{u.invalidateQueries({queryKey:["vehicle-expenses"]}),l({title:"Gasto desativado com sucesso"}),o.closeDialog()}});return e.jsxs(m,{...o,children:[e.jsx(m.Header,{title:"Desativar gasto"}),e.jsx(m.Body,{children:e.jsxs("span",{className:"text-body-medium text-neutral-700",children:["Tem certeza que deseja desativar o gasto de",e.jsxs("span",{className:"font-bold",children:[T,c]}),"? Ao desativar ele não será mais acessível"]})}),e.jsx(m.Footer,{labelPrimaryBtn:"Desativar",onClickPrimaryBtn:a,primaryBtnState:E?"loading":void 0,primaryBtnColor:"red",primaryBtnResource:"VEHICLE_EXPENSE",primaryBtnAction:"DELETE"})]})}function I({vehicleExpenseId:n,vehicleCategory:c,isActive:o,handleDisableVehicleExpenseInfo:r}){const l=N(),{pathname:u}=F(),{safeFetch:d}=f(),a=D(),{showSuccessSnackbar:E}=C();async function h(){await d(`${g}/vehicle-expense/${n}/unarchive`,{method:"PATCH",resource:"VEHICLE_EXPENSE",action:"DELETE"})}const{mutate:x,isPending:t}=L({mutationFn:h,onSuccess:()=>{a.invalidateQueries({queryKey:["vehicle-expenses"]}),E({title:`Gasto de ${c} ativado com sucesso`})}});return o?e.jsxs(e.Fragment,{children:[e.jsx(p,{content:"Editar",children:e.jsx(y,{variant:"quaternary",iconLeft:"Edit",onClick:()=>l(`${u}/edit/${n}`),resource:"VEHICLE_EXPENSE",action:"UPDATE",padding:"none","data-cy":`button-edit-vehicle-expense-${n}`})}),e.jsx(p,{content:"Desativar",children:e.jsx(y,{variant:"primary",iconLeft:"Delete",color:"red",padding:"none",onClick:()=>{r({vehicleExpenseId:n,vehicleCategory:c})},resource:"VEHICLE_EXPENSE",action:"DELETE","data-cy":`button-disable-vehicle-expense-${n}`})})]}):e.jsx(p,{content:"Ativar",children:e.jsx(y,{variant:"quaternary",onClick:x,state:t?"loading":void 0,resource:"VEHICLE_EXPENSE",action:"DELETE",padding:"none",iconLeft:"ToggleOn","data-cy":`button-enable-vehicle-expense-${n}`})})}const v=8;function K(){const[n,c]=b.useState({vehicleExpenseId:"",vehicleCategory:""}),o=q(),{safeFetch:r}=f(),{vehicleId:l}=P();function u(t){o.openDialog(),c(t)}async function d(){return await r(`${g}/vehicle-expense/${l}`,{resource:"VEHICLE_EXPENSE",action:"READ"})}const{data:a,isFetching:E}=A({queryKey:["vehicle-expenses",l],queryFn:d,select:M}),h=b.useMemo(()=>a!=null&&a.length?Math.max(...a.map(t=>String(t.totalValue).length)):0,[a]),x=b.useMemo(()=>{if(!(a!=null&&a.length))return"0";let t=0;for(const j of a)j.archivedAt||(t+=Number(B(j.totalValue)));return String(t)},[a]);return e.jsxs(e.Fragment,{children:[e.jsx(X,{...n,...o}),e.jsx("div",{className:"w-fit",children:e.jsx(_,{label:"Total de gastos",value:S(x,"money")})}),e.jsxs(s,{children:[e.jsxs(s.Header,{gridColumns:v,children:[e.jsx(s.Head,{label:i.competencyDate.label}),e.jsx(s.Head,{label:i.observations.label}),e.jsx(s.Head,{label:i.category.label}),e.jsx(s.Head,{label:i.totalValue.label,colSpan:i.totalValue.colSpan}),e.jsx(s.Head,{action:!0})]}),e.jsx(s.Body,{isLoading:E,isEmpty:!(a!=null&&a.length),resource:"VEHICLE_EXPENSE",action:"READ",children:a==null?void 0:a.map(t=>e.jsxs(s.Row,{gridColumns:v,children:[e.jsx(s.Cell,{label:t.competencyDate,columnLabel:i.competencyDate.label}),e.jsx(s.Cell,{label:t.observations,columnLabel:i.observations.label}),e.jsx(s.Cell,{label:V[t.category],columnLabel:i.category.label}),e.jsx(s.Cell,{label:t.totalValue.padStart(h,T),className:"font-mono whitespace-pre",colSpan:i.totalValue.colSpan,columnLabel:i.totalValue.label}),e.jsx(s.Action,{children:e.jsx(I,{vehicleExpenseId:String(t.id),vehicleCategory:V[t.category],handleDisableVehicleExpenseInfo:u,isActive:!t.archivedAt})})]},t.id))})]})]})}function R(){return k({queryKey:["vehicle"]})?e.jsx("div",{className:"flex justify-center items-center h-full w-full",children:e.jsx(w,{})}):e.jsxs("div",{className:"flex flex-col gap-4 h-full w-full",children:[e.jsx($,{title:"Gastos do Veículo",showActions:!0}),e.jsx(K,{})]})}function te(){return e.jsx(R,{})}export{te as default};
