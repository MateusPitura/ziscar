import{a as D,i as P,n as x,u as b,f as j,j as e,k as F,e as h,t as f,T as I,S as T,aO as v,b as q,c as B,d as N,aP as V,aQ as w,r as E,aR as c,B as H}from"./index-C8Hi2I9-.js";import{P as O}from"./PageHeader-C3bsmlao.js";import{T as o}from"./Table-DwjZzqAC.js";import{A as U}from"./AccountStatus-CW7qdCgu.js";import{u as _}from"./DialogContext-DTkaQtxz.js";import{D as m}from"./Dialog-BSVWjxlV.js";import{D as R}from"./DataField-CDqrsgkO.js";import{F as $,I as K,u as k}from"./schemas-ARZMo_di.js";import{C as M}from"./Choice-DK2qdk0A.js";import{a as Q}from"./index-Be_rqggP.js";import{u as z}from"./useIsFetching-B7K5de3P.js";import"./useButtonState-D8nv53KZ.js";import"./dialog-DBF6ydzz.js";function G(a){return{...a,totalValue:D(a.totalValue,"money")??""}}function J(){const a=P(),{accountReceivableId:n}=x(),{safeFetch:r}=b();async function i(){return await r(`${h}/account-receivable/${n}`,{resource:"ACCOUNTS_RECEIVABLE",action:"READ"})}const{data:t}=j({queryKey:["account-receivable",n],queryFn:i,select:G});return e.jsx(O,{title:t!=null&&t.description?`Detalhes do Pagamento "${t.description}"`:"Detalhes do Pagamento",children:e.jsx(F,{variant:"quaternary",label:"Voltar",iconLeft:"ArrowBack",onClick:()=>a("/accounts-receivable"),action:"READ",resource:"ACCOUNTS_RECEIVABLE","data-cy":"back-accounts-receivable-button"})})}function W(a){const n=[];for(const r of a){const i=[];for(const t of r.paymentMethodReceivables)i.push({...t,paymentDate:t.paymentDate?f({date:t.paymentDate,format:"dd/MM/yyyy"}):""});n.push({...r,dueDate:r.dueDate?f({date:r.dueDate,format:"dd/MM/yyyy"}):"",value:D(r.value,"money")??"",paymentMethodReceivables:i})}return n}function X({installment:a,handleInstallmentToPaymentMethodInfo:n}){if(!a.paymentMethodReceivables.length)return e.jsx(I,{content:"Adicionar método de pagamento",children:e.jsx(F,{variant:"quaternary",iconLeft:"AddCard",onClick:()=>n(a),resource:"ACCOUNTS_RECEIVABLE",action:"READ",padding:"none","data-cy":`button-edit-addPaymentMethod-${a.id}`})})}function Y(a){return{...a,paymentDate:f({date:a.paymentDate,format:"dd/MM/yyyy"})??""}}function Z({installment:a,...n}){const{safeFetch:r}=b();async function i(){var s;const u=await r(`${h}/account-receivable-installments/payment-method/${a==null?void 0:a.id}`,{resource:"ACCOUNTS_RECEIVABLE",action:"READ"});return(s=u==null?void 0:u.paymentMethodReceivables)==null?void 0:s[0]}const{data:t,isFetching:y}=j({queryKey:["accounts-receivable-payment-method",a.id],queryFn:i,select:Y});return e.jsxs(m,{...n,children:[e.jsx(m.Header,{title:"Detalhes do Método de Pagamento"}),e.jsx(m.Body,{children:e.jsx("div",{className:"flex flex-col gap-4 h-36 mb-8",children:y?e.jsx("div",{className:"flex justify-center items-center h-full w-full",children:e.jsx(T,{})}):e.jsxs(e.Fragment,{children:[e.jsx(R,{label:"Data do pagamento",value:t==null?void 0:t.paymentDate}),e.jsx(R,{label:"Forma de pagamento",value:t&&v[t==null?void 0:t.type]})]})})})]})}function ee({installment:a,...n}){const{safeFetch:r}=b(),{showSuccessSnackbar:i}=q(),t=B(),{accountReceivableId:y}=x();async function u(d){await r(`${h}/account-receivable-installments/payment-method/${a.id}`,{method:"POST",body:d,resource:"ACCOUNTS_RECEIVABLE",action:"CREATE"})}const{mutate:s,isPending:p}=N({mutationFn:u,onSuccess:()=>{i({title:"Método de pagamento adicionado"}),t.invalidateQueries({queryKey:["accounts-receivable-installments",y]}),t.invalidateQueries({queryKey:["accounts-receivable-payment-method",String(a.id)]}),t.invalidateQueries({queryKey:["accounts-receivable"]}),n.closeDialog()}});return e.jsxs(m,{...n,children:[e.jsx(m.Header,{title:"Adicionar Método de Pagamento"}),e.jsx(m.Body,{children:e.jsxs($,{schema:Q,defaultValues:V,onSubmit:s,className:"flex flex-col gap-4",children:[e.jsx(K,{name:"paymentDate",label:"Data do pagamento",required:!0,type:"date"}),e.jsx(k,{label:"Forma de pagamento",required:!0}),e.jsx("div",{className:"flex flex-col gap-2",children:e.jsx(M,{required:!0,children:Object.values(w).map(d=>e.jsx(M.Radio,{label:v[d],name:"type",value:d},d))})}),e.jsx(m.Footer,{labelPrimaryBtn:"Adicionar",className:"px-0",dirty:!1,primaryBtnState:p?"loading":void 0,primaryBtnResource:"ACCOUNTS_RECEIVABLE",primaryBtnAction:"CREATE"})]})})]})}function ae({installment:a,...n}){if(a)return a.paymentMethodReceivables.length?e.jsx(Z,{installment:a,...n}):e.jsx(ee,{installment:a,...n})}const S=11;function te(){const{safeFetch:a}=b(),{accountReceivableId:n}=x(),[r,i]=E.useState(null),t=_();function y(l){t.openDialog(),i(l)}async function u(){return await a(`${h}/account-receivable-installments/by-account/${n}`,{resource:"ACCOUNTS_RECEIVABLE",action:"READ"})}const{data:s,isFetching:p}=j({queryKey:["accounts-receivable-installments",n],queryFn:u,select:W}),d=E.useMemo(()=>s!=null&&s.length?Math.max(...s.map(l=>l.value.length)):0,[s]);return e.jsxs(e.Fragment,{children:[e.jsx(ae,{installment:r,...t}),e.jsxs(o,{children:[e.jsxs(o.Header,{gridColumns:S,children:[e.jsx(o.Head,{label:c.installmentSequence.label,colSpan:c.installmentSequence.colSpan}),e.jsx(o.Head,{label:c.dueDate.label}),e.jsx(o.Head,{label:c.paymentDate.label}),e.jsx(o.Head,{label:c.paymentMethod.label}),e.jsx(o.Head,{label:c.status.label}),e.jsx(o.Head,{label:c.value.label,colSpan:c.installmentSequence.colSpan}),e.jsx(o.Head,{action:!0})]}),e.jsx(o.Body,{isLoading:p,isEmpty:!(s!=null&&s.length),resource:"ACCOUNTS_RECEIVABLE",action:"READ",children:s==null?void 0:s.map(l=>{var A,g,C;return e.jsxs(o.Row,{gridColumns:S,children:[e.jsx(o.Cell,{columnLabel:c.installmentSequence.label,colSpan:c.installmentSequence.colSpan,label:l.isUpfront?"Entrada":`${l.installmentSequence}/${(A=s.filter(L=>!L.isUpfront))==null?void 0:A.length}`}),e.jsx(o.Cell,{columnLabel:c.dueDate.label,label:l.dueDate}),e.jsx(o.Cell,{columnLabel:c.paymentDate.label,label:(g=l.paymentMethodReceivables)!=null&&g.length?l.paymentMethodReceivables[0].paymentDate:""}),e.jsx(o.Cell,{columnLabel:c.paymentMethod.label,label:(C=l.paymentMethodReceivables)!=null&&C.length?v[l.paymentMethodReceivables[0].type]:""}),e.jsx(o.Cell,{columnLabel:c.status.label,label:e.jsx(U,{status:l.status})}),e.jsx(o.Cell,{columnLabel:c.value.label,label:l.value.padStart(d,H),className:"font-mono whitespace-pre",colSpan:c.value.colSpan}),e.jsx(o.Action,{children:e.jsx(X,{installment:l,handleInstallmentToPaymentMethodInfo:y})})]},l.id)})})]})]})}function ne(){return z({queryKey:["account-receivable"]})?e.jsx("div",{className:"flex justify-center items-center h-full w-full",children:e.jsx(T,{})}):e.jsxs("div",{className:"flex flex-col gap-4 h-full w-full",children:[e.jsx(J,{}),e.jsx(te,{})]})}function fe(){return e.jsx(ne,{})}export{fe as default};
