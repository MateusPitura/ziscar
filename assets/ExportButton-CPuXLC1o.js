import{j as t,s as j,b as z,a as H,f as P,an as L}from"./index-CwQymCQa.js";import{V as s,S as R,T as a,D as w,P as S,p as O}from"./react-pdf.browser-IDMxSf8g.js";import{u as M}from"./useIsFetching-DbLUeXt5.js";const u=R.create({header:{marginBottom:20,textAlign:"center",borderBottomWidth:2,borderBottomColor:"#000000",paddingBottom:10},title:{fontSize:24,fontWeight:"bold",marginBottom:5},subtitle:{fontSize:14,color:"#666666"},section:{marginBottom:15},sectionTitle:{fontSize:16,fontWeight:"bold",marginBottom:8,color:"#333333"},summary:{padding:15,backgroundColor:"#F9FAFB",borderRadius:4},summaryText:{fontSize:12,marginBottom:5,color:"#374151"}});function B({appliedFilters:r,title:c}){return t.jsxs(t.Fragment,{children:[t.jsxs(s,{style:u.header,children:[t.jsx(a,{style:u.title,children:c}),t.jsxs(a,{style:u.subtitle,children:["Gerado em ",j({date:new Date,format:"dd/MM/yyyy"})]})]}),r&&Object.keys(r).length>0&&t.jsxs(s,{style:u.section,children:[t.jsx(a,{style:u.sectionTitle,children:"Filtros aplicados"}),t.jsx(s,{style:u.summary,children:Object.entries(r).map(([n,i])=>t.jsxs(a,{style:u.summaryText,children:["• ",n,": ",i]},n))})]})]})}const o=R.create({page:{flexDirection:"column",backgroundColor:"#FFFFFF",padding:30},title:{fontSize:24,fontWeight:"bold",marginBottom:5},section:{marginBottom:15},sectionTitle:{fontSize:16,fontWeight:"bold",marginBottom:8,color:"#333333"},table:{width:"auto",borderStyle:"solid",borderLeftWidth:1,borderTopWidth:1,borderColor:"#CCCCCC"},tableRow:{margin:"auto",flexDirection:"row",minHeight:30,borderStyle:"solid",borderLeftWidth:1,borderTopWidth:1,borderColor:"#CCCCCC"},tableHeader:{backgroundColor:"#F3F4F6"},tableRowAlternate:{backgroundColor:"#F9FAFB"},tableColHeader:{borderStyle:"solid",borderWidth:1,borderLeftWidth:0,borderTopWidth:0,borderColor:"#CCCCCC",padding:8,justifyContent:"center"},tableCol:{borderStyle:"solid",borderWidth:1,borderLeftWidth:0,borderTopWidth:0,borderColor:"#CCCCCC",padding:8,justifyContent:"center"},tableCellHeader:{fontSize:10,fontWeight:"bold",color:"#374151"},tableCell:{fontSize:9,color:"#000000"},summary:{padding:15,backgroundColor:"#F9FAFB",borderRadius:4},summaryText:{fontSize:12,marginBottom:5,color:"#374151"}});function $({data:r,formatColumns:c,title:n,appliedFilters:i}){if(!r||r.length===0)return t.jsx(w,{children:t.jsxs(S,{size:"A4",orientation:"landscape",style:o.page,children:[t.jsx(B,{appliedFilters:i,title:n}),t.jsx(s,{style:o.section,children:t.jsx(a,{style:o.sectionTitle,children:"Nenhum dado encontrado"})})]})});const h=Object.keys(r[0]||{}).filter(e=>c[e]),d=`${100/h.length}%`,y=(e,l)=>l==="archivedAt"?e?"Não":"Sim":e==null?"-":typeof e=="boolean"?e?"Sim":"Não":typeof e=="object"?JSON.stringify(e):String(e);return t.jsx(w,{children:t.jsxs(S,{size:"A4",orientation:"landscape",style:o.page,children:[t.jsx(B,{appliedFilters:i,title:n}),t.jsxs(s,{style:o.section,children:[t.jsx(a,{style:o.sectionTitle,children:"Lista de dados"}),t.jsx(s,{style:[o.tableRow,o.tableHeader],children:h.map(e=>t.jsx(s,{style:[o.tableColHeader,{width:d}],children:t.jsx(a,{style:o.tableCellHeader,children:c[e]})},e))}),r.map((e,l)=>t.jsx(s,{style:[o.tableRow,...l%2===1?[o.tableRowAlternate]:[]],wrap:!1,children:h.map(g=>t.jsx(s,{style:[o.tableCol,{width:d}],children:t.jsx(a,{style:o.tableCell,children:y(e[g],g)})},g))},`row-${l}`))]}),t.jsxs(s,{style:o.section,children:[t.jsx(a,{style:o.sectionTitle,children:"Resumo"}),t.jsx(s,{style:o.summary,children:t.jsxs(a,{style:o.summaryText,children:["• Total de registros: ",r.length]})})]})]})})}function N({formatFilters:r,formatFiltersValues:c,queryKey:n}){const i={};for(const h of n[1].split("&")){const[d,y]=h.split("=");if(d==="page")continue;const e=r[d],l=c[d];l?i[e]=l[y]:i[e]=y}return i}function Q({fileName:r,resource:c,queryKey:n,queryFn:i,selectQueryFn:h,formatColumns:d,formatFilters:y,formatFiltersValues:e}){const l=z(),{showErrorSnackbar:g,showSuccessSnackbar:T}=H(),W=M({queryKey:[n[0]]});async function A(){if(!n)throw new Error;const b=l.getQueryData(n);if(!b)throw new Error;const C=Math.ceil((b==null?void 0:b.total)/L),p=[];for(let m=1;m<=C;m++){const f=n[1],x=/page=\d+/,k=f==null?void 0:f.replace(x,`page=${m}`),D=l.fetchQuery({queryKey:[n[0],k],queryFn:({queryKey:E})=>i(E[1])});p.push(D)}return(await Promise.all(p)).flatMap(m=>h(m))}return t.jsx(P,{variant:"primary",color:"darkBlue",label:"Gerar relatório PDF",iconRight:"FileDownload",state:W?"loading":void 0,resource:c,action:"READ","data-cy":"export-button",onClick:async()=>{const b=T({title:"O PDF está sendo gerado",actionBtnAction:"READ",actionBtnResource:c});try{const C=await A(),p=N({queryKey:n,formatFilters:y,formatFiltersValues:e}),F=await O(t.jsx($,{data:C,formatColumns:d,title:r,appliedFilters:p})).toBlob();b.dismiss();const m=URL.createObjectURL(F),f=document.createElement("a");f.href=m;const x=`${r} ${j({date:new Date,format:"dd-MM-yyyy"})} ${j({date:new Date,format:"HH-mm"})}.pdf`;f.download=x,f.click(),URL.revokeObjectURL(m)}catch{b.dismiss(),g({description:"Ocorreu um erro ao gerar o PDF"})}}})}export{Q as E};
