import{j as e,t as R,c as N,b as z,l as k,I}from"./index-LO79eavt.js";import{V as s,S as j,I as M,T as u,D as P,P as E,p as O}from"./react-pdf.browser-BkjHwKfS.js";import{u as W}from"./useIsFetching-DT0DLOnX.js";function V({formatFilters:t,formatFiltersValues:r,queryKey:o}){const n={};for(const c of o[1].split("&")){const[d,p]=c.split("=");if(d==="page")continue;const g=t[d],i=r[d];i?n[g]=i[p]:n[g]=G(p,d)}return n}function G(t,r){if(r.toLowerCase().includes("price")||r.toLowerCase().includes("value")){const o=parseInt(t);if(!isNaN(o))return`R$ ${(o/100).toLocaleString("pt-BR",{minimumFractionDigits:2,maximumFractionDigits:2})}`}if(r.toLowerCase().includes("date")){const o=new Date(t);if(!isNaN(o.getTime()))return o.toLocaleDateString("pt-BR")}return t}function U(t){return[/price/i,/value/i,/amount/i,/cost/i,/total/i,/^r\$/i].some(o=>o.test(t))}const a=j.create({header:{height:60,flexDirection:"row",marginBottom:10,paddingBottom:10,backgroundColor:"#FFFFFF"},gridColumn:{flex:1,minHeight:40},logoText:{fontSize:7,color:"#9CA3AF"},centerContainer:{alignItems:"center",justifyContent:"center"},title:{fontSize:14,fontWeight:"bold",marginBottom:2,textAlign:"center"},subtitle:{fontSize:9,color:"#666666",textAlign:"center"},filtersContainer:{flexDirection:"row",flexWrap:"wrap",justifyContent:"flex-end",alignContent:"flex-start",marginLeft:8},filterChip:{backgroundColor:"#F8F9FA",borderRadius:10,paddingHorizontal:6,paddingVertical:2,marginBottom:2,marginLeft:2,borderWidth:.5,borderColor:"#E5E7EB"},filterText:{fontSize:7,color:"#374151"}});function T({appliedFilters:t,title:r}){return e.jsxs(s,{style:a.header,fixed:!0,children:[e.jsx(s,{style:a.gridColumn,children:e.jsx(s,{children:e.jsx(M,{src:"/somente-logo.png",style:{width:40,height:40}})})}),e.jsx(s,{style:a.gridColumn,children:e.jsxs(s,{style:a.centerContainer,children:[e.jsx(u,{style:a.title,children:r}),e.jsxs(u,{style:a.subtitle,children:["Gerado em"," ",R({date:new Date,format:"dd/MM/yyyy HH:mm"})]})]})}),e.jsx(s,{style:a.gridColumn,children:t&&Object.keys(t).length>0&&e.jsx(s,{style:a.filtersContainer,children:Object.entries(t).map(([o,n])=>e.jsx(s,{style:a.filterChip,children:e.jsxs(u,{style:a.filterText,children:[o,": ",n]})},o))})})]})}const D=j.create({tableRow:{flexDirection:"row",minHeight:20,marginTop:3,backgroundColor:"#F8F9FA"},tableColHeader:{borderStyle:"solid",borderLeftWidth:.5,borderBottomWidth:.5,borderColor:"#DDDDDD",padding:4,justifyContent:"center",alignItems:"center"},tableCellHeader:{fontSize:11,fontWeight:"bold"}});function Q({keys:t,formatColumns:r,columnWidth:o}){return e.jsx(s,{style:D.tableRow,fixed:!0,children:t.map(n=>e.jsx(s,{style:[D.tableColHeader,{width:o}],children:e.jsx(u,{style:D.tableCellHeader,children:r[n]})},n))})}const S=j.create({footer:{position:"absolute",bottom:15,left:15,right:15,flexDirection:"row",justifyContent:"space-between",alignItems:"center",paddingTop:8},recordsCounter:{fontSize:10,color:"#666666",flex:1,textAlign:"center"},pageNumber:{fontSize:10,color:"#666666"}});function $({totalRecords:t,itemsPerPage:r}){return e.jsxs(s,{style:S.footer,fixed:!0,children:[e.jsx(s,{style:{width:50}}),e.jsx(u,{style:S.recordsCounter,render:({pageNumber:o})=>{if(!t)return;const n=(o-1)*r,c=Math.min(n+r,t);return`${n+1} a ${c} de ${t} itens`}}),e.jsx(u,{style:S.pageNumber,render:({pageNumber:o,totalPages:n})=>`Página ${o}/${n}`})]})}const l=j.create({page:{flexDirection:"column",backgroundColor:"#FFFFFF",padding:15,paddingBottom:25},content:{flex:1},emptyState:{textAlign:"center",marginTop:30},emptyText:{fontSize:16,color:"#666666"},tableContainer:{marginTop:0},tableRow:{flexDirection:"row",minHeight:20},tableRowAlternate:{backgroundColor:"#F0F0F0"},tableCol:{borderStyle:"solid",borderLeftWidth:.25,borderColor:"#DDDDDD",padding:4,justifyContent:"center"},tableColNumeric:{alignItems:"flex-end"},tableCell:{fontSize:10,color:"#000000"}});function _({data:t,formatColumns:r,title:o,appliedFilters:n}){if(!t||t.length===0)return e.jsx(P,{children:e.jsxs(E,{size:"A4",orientation:"landscape",style:l.page,children:[e.jsx(T,{appliedFilters:n,title:o}),e.jsx(s,{style:l.content,children:e.jsx(s,{style:l.emptyState,children:e.jsx(u,{style:l.emptyText,children:"Nenhum dado encontrado"})})}),e.jsx($,{totalRecords:0,itemsPerPage:16})]})});const c=Object.keys(r).filter(i=>{var f;return r[i]&&((f=t[0])==null?void 0:f[i])!==void 0}),d=`${100/c.length}%`,p=22,g=(i,f)=>f==="archivedAt"?i?"Não":"Sim":i==null?"-":typeof i=="boolean"?i?"Sim":"Não":typeof i=="object"?JSON.stringify(i):String(i);return e.jsx(P,{children:e.jsxs(E,{size:"A4",orientation:"landscape",style:l.page,children:[e.jsx(T,{appliedFilters:n,title:o}),e.jsx(Q,{keys:c,formatColumns:r,columnWidth:d}),e.jsx(s,{style:l.content,children:e.jsx(s,{style:l.tableContainer,children:t.map((i,f)=>e.jsx(s,{style:[l.tableRow,...f%2===1?[l.tableRowAlternate]:[]],wrap:!1,minPresenceAhead:8,children:c.map(y=>{const C=U(y);return e.jsx(s,{style:[l.tableCol,{width:d},...C?[l.tableColNumeric]:[]],children:e.jsx(u,{style:l.tableCell,children:g(i[y],y)})},y)})},`row-${f}`))})}),e.jsx($,{totalRecords:t.length,itemsPerPage:p})]})})}function X({fileName:t,queryKey:r,queryFn:o,selectQueryFn:n,formatColumns:c,formatFilters:d,formatFiltersValues:p}){const g=N(),{showErrorSnackbar:i,showSuccessSnackbar:f}=z(),y=W({queryKey:[r[0]]});async function C(){if(!r)throw new Error;const h=g.getQueryData(r);if(!h)throw new Error;const F=Math.ceil((h==null?void 0:h.total)/I),b=[];for(let m=1;m<=F;m++){const x=r[1],w=/page=\d+/,B=x==null?void 0:x.replace(w,`page=${m}`),H=g.fetchQuery({queryKey:[r[0],B],queryFn:({queryKey:L})=>o(L[1])});b.push(H)}return(await Promise.all(b)).flatMap(m=>n(m))}return e.jsx(k,{variant:"primary",color:"darkBlue",tooltipMessage:"Gerar relatório PDF",label:"Gerar relatório PDF",iconRight:"FileDownload",state:y?"loading":void 0,resource:"REPORTS",action:"CREATE","data-cy":"export-button",onClick:async()=>{const h=f({title:"O PDF está sendo gerado",actionBtnAction:"CREATE",actionBtnResource:"REPORTS"});try{const F=await C(),b=V({queryKey:r,formatFilters:d,formatFiltersValues:p}),A=await O(e.jsx(_,{data:F,formatColumns:c,title:t,appliedFilters:b})).toBlob();h.dismiss();const m=URL.createObjectURL(A),x=document.createElement("a");x.href=m;const w=`${t} ${R({date:new Date,format:"dd-MM-yyyy"})} ${R({date:new Date,format:"HH-mm"})}.pdf`;x.download=w,x.click(),URL.revokeObjectURL(m)}catch{h.dismiss(),i({description:"Ocorreu um erro ao gerar o PDF"})}}})}export{X as E};
