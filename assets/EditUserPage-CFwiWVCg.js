import{r as i,j as o,b as g,c as P,a as A,d as j,k as v,h as C,e as F,S as R,f as l}from"./index-B_iWEUUC.js";import{u as q}from"./useIsFetching-DqnnrfEG.js";import{U as w}from"./UserForm-B_IHgccJ.js";import{a as m}from"./schemas-D1jfyf81.js";import{s as I,p as N}from"./parseAddressToUpdate-BhV3BZpB.js";import"./Choice-B-eajStn.js";import"./AddressFields-YumhuKEd.js";import"./PageFooter-CsJslnfg.js";import"./PageHeader-DfUmqkU2.js";import"./index-jdHX1-O2.js";import"./index-CS_UDAGd.js";import"./useDialog-C-b4l8WV.js";import"./Dialog-CGi7XIRs.js";const b=i.createContext(null);function K({children:e}){const[r,a]=i.useState(!1);function u(t){a(t)}const n=i.useMemo(()=>({example:r,handleExample:u}),[r]);return o.jsx(b.Provider,{value:n,children:e})}function T(e){var r;return{fullName:e.fullName,email:e.email,phone:m(e.phone,"phone")??"",cpf:m(e.cpf,"cpf")??"",roleId:((r=e.roleId)==null?void 0:r.toString())??"",address:I(e.address)}}function $(){const{safeFetch:e}=g(),{showSuccessSnackbar:r}=P(),a=q({queryKey:["cepApi"]}),u=A(),n=j(),{userId:t}=v();async function f(){return await e(`${l}/user/${t}`,{resource:"USERS",action:"READ"})}const{data:s,isFetching:p}=C({queryKey:["user",t],queryFn:f,select:T});async function y(U){const{address:h,...x}=U,d=N({newAddress:h,oldAddress:s==null?void 0:s.address});await e(`${l}/user/${t}`,{method:"PATCH",body:{...x,...d&&{address:d}},resource:"USERS",action:"UPDATE"})}const{mutate:E,isPending:S,isSuccess:c}=F({mutationFn:y,onSuccess:async()=>{r({title:`Usuário ${s==null?void 0:s.fullName} atualizado com sucesso`}),n.invalidateQueries({queryKey:["users"]}),u("/users")}});return i.useEffect(()=>()=>{c&&n.invalidateQueries({queryKey:["user",t]})},[c,n,t]),p?o.jsx("div",{className:"flex justify-center items-center h-full w-full",children:o.jsx(R,{})}):s&&o.jsx(w,{defaultValues:s,onSubmit:E,isPending:S||!!a,headerTitle:"Alterar usuário",isEdit:!0,resource:"USERS",action:"UPDATE",allowEditRole:!0})}function W(){return o.jsx(K,{children:o.jsx($,{})})}export{W as default};
