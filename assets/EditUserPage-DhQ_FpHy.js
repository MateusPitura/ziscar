import{r as l,j as u,h as g,i as P,g as b,k as A,q as j,o as v,l as F,S as C,m as p}from"./index-aVBDU0Ve.js";import{u as q,U as R}from"./UserForm-DqhVntOB.js";import{f as d}from"./Dialog-DJzmwurf.js";import{s as w,p as M}from"./parseAddressPayload-DEOBBegZ.js";import"./Choice-CQV22enN.js";const N=l.createContext(null);function I({children:e}){const[n,o]=l.useState(!1);function i(r){o(r)}const t=l.useMemo(()=>({example:n,handleExample:i}),[n]);return u.jsx(N.Provider,{value:t,children:e})}function K(e){var n,o,i,t,r,a,s,c;return{fullName:e.fullName,email:e.email,cellPhone:d(e.cellPhone,"cellphone")??"",cpf:d(e.cpf,"cpf")??"",code:e.code??"",birthDate:e.birthDate?w({date:e.birthDate,format:"yyyy-MM-dd"}):"",roleId:((n=e.roleId)==null?void 0:n.toString())??"",address:e.address?{cep:d((o=e.address)==null?void 0:o.cep,"cep")??"",number:((i=e.address)==null?void 0:i.number)??"",street:((t=e.address)==null?void 0:t.street)??"",complement:((r=e.address)==null?void 0:r.complement)??"",neighborhood:((a=e.address)==null?void 0:a.neighborhood)??"",city:((s=e.address)==null?void 0:s.city)??"",state:((c=e.address)==null?void 0:c.state)??""}:null}}function $(){const{safeFetch:e}=g(),{showSuccessSnackbar:n}=P(),o=q({queryKey:["cepApi"]}),i=b(),t=A(),{userId:r}=j();async function a(){return await e(`${p}/user/${r}`,{resource:"USERS",action:"READ"})}const{data:s,isFetching:c}=v({queryKey:["user",r],queryFn:a,select:K});async function y(S){const{address:x,...U}=S,f=M({newAddress:x,oldAddress:s==null?void 0:s.address});await e(`${p}/user/${r}`,{method:"PATCH",body:{...U,...f&&{address:f}},resource:"USERS",action:"UPDATE"})}const{mutate:h,isPending:E,isSuccess:m}=F({mutationFn:y,onSuccess:async()=>{n({title:`Usuário ${s==null?void 0:s.fullName} atualizado com sucesso`}),t.invalidateQueries({queryKey:["users"]}),i("/users")}});return l.useEffect(()=>()=>{m&&t.invalidateQueries({queryKey:["user",r]})},[m,t,r]),c?u.jsx("div",{className:"flex justify-center items-center h-full w-full",children:u.jsx(C,{})}):s&&u.jsx(R,{defaultValues:s,onSubmit:h,isPending:E||!!o,headerTitle:"Alterar usuário",isEdit:!0,resource:"USERS",action:"UPDATE",allowEditRole:!0})}function B(){return u.jsx(I,{children:u.jsx($,{})})}export{B as default};
