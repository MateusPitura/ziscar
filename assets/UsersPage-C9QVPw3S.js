import{r as d,j as e,a as U,K as D,f as F,u as S,b as A,c as N,d as L,T as b,g as j,e as y,B as T,h as B}from"./index-DLLA1f-v.js";import{P}from"./PageHeader-Bs9TDp09.js";import{S as C,T as n}from"./Table-By5z5vhx.js";import{F as $,I as g,u as k}from"./schemas-Bhi0Dh6I.js";import{C as E}from"./Choice-BxW3kVCA.js";import{u as w}from"./useButtonState-3b0McXTU.js";import{S as q}from"./index-9G9dNcef.js";import{u as R}from"./useDialogContext-BXiPHqkt.js";import{u as h,f as H}from"./react-pdf.browser-s4H9466t.js";import{D as p}from"./Dialog-D33IGNgm.js";import{u as I}from"./useDialog-DlT6EUiq.js";import"./dialog-BH6A_dKB.js";import"./index-2Ad1AATz.js";const K=d.createContext(null);function M({children:a}){const[t,s]=d.useState("");function i(c){s(c)}const r=d.useMemo(()=>({example:t,handleExample:i}),[t]);return e.jsx(K.Provider,{value:r,children:a})}function Q(a){const t=[];for(const s of a.data)t.push({...s,phone:U(s==null?void 0:s.phone,"phone")??"",cpf:U(s==null?void 0:s.cpf,"cpf")??""});return{total:a.total,data:t}}function z(){const{usersFilter:a,handleUsersFilter:t}=h(),{closeDialog:s}=R();function i(r){t({page:1,...r}),s()}return e.jsx($,{schema:q,onSubmit:i,className:"flex-1 flex flex-col",defaultValues:{fullName:(a==null?void 0:a.fullName)||"",status:(a==null?void 0:a.status)||"active",startDate:(a==null?void 0:a.startDate)||"",endDate:(a==null?void 0:a.endDate)||""},replaceEmptyStringToNull:!1,children:e.jsx(O,{})})}function O(){const{reset:a}=w(),{handleUsersFilter:t}=h(),{closeDialog:s}=R();function i(){t(D),a(D),s()}return e.jsxs(e.Fragment,{children:[e.jsxs(C.Body,{className:"flex flex-col gap-4",children:[e.jsx(g,{name:"fullName",label:"Nome completo"}),e.jsx(k,{label:"Status"}),e.jsx("div",{className:"flex flex-col gap-2",children:e.jsxs(E,{hideErrorLabel:!0,children:[e.jsx(E.Radio,{name:"status",label:"Ativo",value:"active"}),e.jsx(E.Radio,{name:"status",label:"Inativo",value:"inactive"})]})}),e.jsx(g,{name:"startDate",label:"Data inicial de criação",type:"date"}),e.jsx(g,{name:"endDate",label:"Data final de criação",type:"date"})]}),e.jsx(C.Footer,{primaryLabel:"Aplicar",secondaryLabel:"Limpar",onSecondaryCallback:i,dirty:!0})]})}const V=d.memo(z);function _({fullName:a,userId:t,isActive:s,handleDisableUserInfo:i}){const r=F(),{safeFetch:c}=S(),{showSuccessSnackbar:u}=A(),m=N();async function x(){await c(`${y}/user/${t}`,{method:"DELETE",body:{archivedAt:null},resource:"USERS",action:"DELETE"})}const{mutate:f,isPending:l}=L({mutationFn:x,onSuccess:()=>{m.invalidateQueries({queryKey:["users"]}),u({title:`Usuário ${a} ativado com sucesso`})}});return s?e.jsxs(e.Fragment,{children:[e.jsx(b,{content:"Editar",children:e.jsx(j,{variant:"quaternary",iconLeft:"Edit",onClick:()=>r(`/users/edit/${t}`),resource:"USERS",action:"UPDATE",padding:"none","data-cy":`button-edit-user-${t}`})}),e.jsx(b,{content:"Desativar",children:e.jsx(j,{variant:"primary",iconLeft:"Delete",color:"red",padding:"none",onClick:()=>i({userName:a,userId:t}),resource:"USERS",action:"DELETE","data-cy":`button-disable-user-${t}`})})]}):e.jsx(b,{content:"Ativar",children:e.jsx(j,{variant:"quaternary",onClick:f,state:l?"loading":void 0,resource:"USERS",action:"DELETE",padding:"none",iconLeft:"ToggleOn","data-cy":`button-enable-user-${t}`})})}function G({userId:a,userName:t,...s}){const{safeFetch:i}=S(),{showSuccessSnackbar:r}=A(),c=N(),{handleUsersFilter:u}=h();async function m(){await i(`${y}/user/${a}`,{method:"DELETE",body:{archivedAt:new Date().toISOString()},resource:"USERS",action:"DELETE"})}const{mutate:x,isPending:f}=L({mutationFn:m,onSuccess:()=>{u({page:1}),c.invalidateQueries({queryKey:["users"]}),r({title:`Usuário ${t} desativado com sucesso`}),s.closeDialog()}});return e.jsxs(p,{...s,children:[e.jsx(p.Header,{title:"Desativar usuário"}),e.jsx(p.Body,{children:e.jsxs("span",{className:"text-body-medium text-neutral-700",children:["Tem certeza que deseja desativar o usuário",e.jsxs("span",{className:"font-bold",children:[T,t]}),"? Ao desativar ele não poderá mais acessar o sistema"]})}),e.jsx(p.Footer,{labelPrimaryBtn:"Desativar",onClickPrimaryBtn:x,primaryBtnState:f?"loading":void 0,primaryBtnColor:"red",primaryBtnResource:"USERS",primaryBtnAction:"DELETE"})]})}const J=!1;function W(){const[a,t]=d.useState({userName:"",userId:""}),s=I(),{safeFetch:i}=S(),{usersFilter:r,handleUsersFilter:c}=h();function u(o){s.openDialog(),t(o)}function m(o){c({page:o})}const x=d.useMemo(()=>r?H(r):"",[r]);async function f(o){return await i(`${y}/user?${o}&orderBy=fullName`,{resource:"USERS",action:"READ"})}const{data:l,isFetching:v}=B({queryKey:["users",x],queryFn:({queryKey:o})=>f(o[1]),select:Q});return e.jsxs(e.Fragment,{children:[e.jsx(G,{...a,...s}),e.jsxs("div",{className:"flex gap-4 justify-end",children:[J,e.jsx(n.Filter,{form:e.jsx(V,{})})]}),e.jsxs(n,{children:[e.jsxs(n.Header,{children:[e.jsx(n.Head,{label:"Nome completo"}),e.jsx(n.Head,{label:"CPF"}),e.jsx(n.Head,{label:"Email"}),e.jsx(n.Head,{label:"Celular"}),e.jsx(n.Head,{label:"Status"}),e.jsx(n.Head,{action:!0})]}),e.jsx(n.Body,{isLoading:v,isEmpty:!(l!=null&&l.total),resource:"USERS",action:"READ",children:l==null?void 0:l.data.map(o=>e.jsxs(n.Row,{children:[e.jsx(n.Cell,{label:o.fullName}),e.jsx(n.Cell,{label:o.cpf}),e.jsx(n.Cell,{label:o.email}),e.jsx(n.Cell,{label:o.phone}),e.jsx(n.Cell,{label:o.archivedAt?"Inativo":"Ativo"}),e.jsx(n.Action,{children:e.jsx(_,{isActive:!o.archivedAt,userId:String(o.id),fullName:o.fullName,handleDisableUserInfo:u})})]},o.id))}),e.jsx(n.Footer,{currentStartItem:r==null?void 0:r.page,totalItems:l==null?void 0:l.total,onClickNavigateBtn:m,isLoading:v})]})]})}function X(){const a=F();return e.jsxs("div",{className:"flex flex-col gap-4 h-full w-full",children:[e.jsx(P,{title:"Usuários",children:e.jsx(j,{label:"Adicionar usuário",iconLeft:"Add",onClick:()=>a("/users/new"),resource:"USERS",action:"CREATE",color:"green","data-cy":"new-user-button"})}),e.jsx(W,{})]})}function ue(){return e.jsx(M,{children:e.jsx(X,{})})}export{ue as default};
