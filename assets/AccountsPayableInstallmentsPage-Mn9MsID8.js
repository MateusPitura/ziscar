import{a as E,i as q,n as x,u as p,f as A,j as e,k as F,e as b,t as f,T as B,b as N,c as I,d as H,aG as R,a5 as w,aH as j,S as L,r as S,aI as l,B as U}from"./index-CrVTpVTI.js";import{u as _}from"./useIsFetching-Dh2N-bBa.js";import{P as $}from"./PageHeader-DARJqnt5.js";import{T as o}from"./Table-CQjU_dFI.js";import{A as O}from"./AccountStatus-BNzGywzN.js";import{u as K}from"./DialogContext-3LqbYYdn.js";import{D as m}from"./Dialog-BHTFXl4K.js";import{F as Y,I as k,u as V}from"./schemas-B7gcU9vp.js";import{C}from"./Choice-LKCp7m0f.js";import{a as Q}from"./index-Cz1urOUq.js";import{D}from"./DataField-CmnNFbKB.js";import"./useButtonState-C7TXS9Jx.js";import"./dialog-Ct9-qcrh.js";function G(a){return{...a,totalValue:E(a.totalValue,"money")??""}}function z(){const a=q(),{accountPayableId:n}=x(),{safeFetch:u}=p();async function i(){return await u(`${b}/account-payable/${n}`,{resource:"ACCOUNTS_PAYABLE",action:"READ"})}const{data:t}=A({queryKey:["account-payable",n],queryFn:i,select:G});return e.jsx($,{title:t!=null&&t.description?`Detalhes do Pagamento "${t.description}"`:"Detalhes do Pagamento",children:e.jsx(F,{variant:"quaternary",label:"Voltar",iconLeft:"ArrowBack",onClick:()=>a("/accounts-payable"),action:"READ",resource:"ACCOUNTS_PAYABLE","data-cy":"back-accounts-payable-button"})})}function J(a){var u,i;const n=[];for(const t of a){const d=[];for(const r of t.paymentMethodPayables)d.push({...r,paymentDate:r.paymentDate?f({date:(u=r.paymentDate)==null?void 0:u.split("T")[0],format:"dd/MM/yyyy"}):""});n.push({...t,dueDate:t.dueDate?f({date:(i=t.dueDate)==null?void 0:i.split("T")[0],format:"dd/MM/yyyy"}):"",value:E(t.value,"money")??"",paymentMethodPayables:d})}return n}function W({installment:a,handleInstallmentToPaymentMethodInfo:n}){if(!a.paymentMethodPayables.length)return e.jsx(B,{content:"Adicionar método de pagamento",children:e.jsx(F,{variant:"quaternary",iconLeft:"AddCard",onClick:()=>n(a),resource:"ACCOUNTS_PAYABLE",action:"READ",padding:"none","data-cy":`button-edit-addPaymentMethod-${a.id}`})})}function X({installment:a,...n}){const{safeFetch:u}=p(),{showSuccessSnackbar:i}=N(),t=I(),{accountPayableId:d}=x();async function r(y){await u(`${b}/account-payable-installments/payment-method/${a.id}`,{method:"POST",body:y,resource:"ACCOUNTS_PAYABLE",action:"CREATE"})}const{mutate:s,isPending:h}=H({mutationFn:r,onSuccess:()=>{i({title:"Método de pagamento adicionado"}),t.invalidateQueries({queryKey:["accounts-payable-installments",d]}),t.invalidateQueries({queryKey:["accounts-payable-payment-method",String(a.id)]}),t.invalidateQueries({queryKey:["accounts-payable"]}),n.closeDialog()}});return e.jsxs(m,{...n,children:[e.jsx(m.Header,{title:"Adicionar Método de Pagamento"}),e.jsx(m.Body,{children:e.jsxs(Y,{schema:Q,defaultValues:R,onSubmit:s,className:"flex flex-col gap-4",children:[e.jsx(k,{name:"paymentDate",label:"Data do pagamento",required:!0,type:"date"}),e.jsx(V,{label:"Forma de pagamento",required:!0}),e.jsx("div",{className:"flex flex-col gap-2",children:e.jsx(C,{required:!0,children:Object.values(w).map(y=>e.jsx(C.Radio,{label:j[y],name:"type",value:y},y))})}),e.jsx(m.Footer,{labelPrimaryBtn:"Adicionar",className:"px-0",dirty:!1,primaryBtnState:h?"loading":void 0,primaryBtnResource:"ACCOUNTS_PAYABLE",primaryBtnAction:"CREATE"})]})})]})}function Z(a){return{...a,paymentDate:f({date:a.paymentDate,format:"dd/MM/yyyy"})??""}}function ee({installment:a,...n}){const{safeFetch:u}=p();async function i(){var s;const r=await u(`${b}/account-payable-installments/payment-method/${a==null?void 0:a.id}`,{resource:"ACCOUNTS_PAYABLE",action:"READ"});return(s=r==null?void 0:r.paymentMethodPayables)==null?void 0:s[0]}const{data:t,isFetching:d}=A({queryKey:["accounts-payable-payment-method",a.id],queryFn:i,select:Z});return e.jsxs(m,{...n,children:[e.jsx(m.Header,{title:"Detalhes do Método de Pagamento"}),e.jsx(m.Body,{children:e.jsx("div",{className:"flex flex-col gap-4 h-36 mb-8",children:d?e.jsx("div",{className:"flex justify-center items-center h-full w-full",children:e.jsx(L,{})}):e.jsxs(e.Fragment,{children:[e.jsx(D,{label:"Data do pagamento",value:t==null?void 0:t.paymentDate}),e.jsx(D,{label:"Forma de pagamento",value:t&&j[t==null?void 0:t.type]})]})})})]})}function ae({installment:a,...n}){if(a)return a.paymentMethodPayables.length?e.jsx(ee,{installment:a,...n}):e.jsx(X,{installment:a,...n})}const T=11;function te(){const{safeFetch:a}=p(),{accountPayableId:n}=x(),[u,i]=S.useState(null),t=K();function d(c){t.openDialog(),i(c)}async function r(){return await a(`${b}/account-payable-installments/by-account-payable/${n}`,{resource:"ACCOUNTS_PAYABLE",action:"READ"})}const{data:s,isFetching:h}=A({queryKey:["accounts-payable-installments",n],queryFn:r,select:J}),y=S.useMemo(()=>s!=null&&s.length?Math.max(...s.map(c=>c.value.length)):0,[s]);return e.jsxs(e.Fragment,{children:[e.jsx(ae,{installment:u,...t}),e.jsxs(o,{children:[e.jsxs(o.Header,{gridColumns:T,children:[e.jsx(o.Head,{label:l.installmentSequence.label,colSpan:l.installmentSequence.colSpan}),e.jsx(o.Head,{label:l.dueDate.label}),e.jsx(o.Head,{label:l.paymentDate.label}),e.jsx(o.Head,{label:l.paymentMethod.label}),e.jsx(o.Head,{label:l.status.label}),e.jsx(o.Head,{label:l.value.label,colSpan:l.installmentSequence.colSpan}),e.jsx(o.Head,{action:!0})]}),e.jsx(o.Body,{isLoading:h,isEmpty:!(s!=null&&s.length),resource:"ACCOUNTS_PAYABLE",action:"READ",children:s==null?void 0:s.map(c=>{var P,g,M;return e.jsxs(o.Row,{gridColumns:T,children:[e.jsx(o.Cell,{columnLabel:l.installmentSequence.label,colSpan:l.installmentSequence.colSpan,label:c.isUpfront?"Entrada":`${c.installmentSequence}/${(P=s.filter(v=>!v.isUpfront))==null?void 0:P.length}`}),e.jsx(o.Cell,{columnLabel:l.dueDate.label,label:c.dueDate}),e.jsx(o.Cell,{columnLabel:l.paymentDate.label,label:(g=c.paymentMethodPayables)!=null&&g.length?c.paymentMethodPayables[0].paymentDate:""}),e.jsx(o.Cell,{columnLabel:l.paymentMethod.label,label:(M=c.paymentMethodPayables)!=null&&M.length?j[c.paymentMethodPayables[0].type]:""}),e.jsx(o.Cell,{columnLabel:l.status.label,label:e.jsx(O,{status:c.status})}),e.jsx(o.Cell,{columnLabel:l.value.label,label:c.value.padStart(y,U),className:"font-mono whitespace-pre",colSpan:l.value.colSpan}),e.jsx(o.Action,{children:e.jsx(W,{installment:c,handleInstallmentToPaymentMethodInfo:d})})]},c.id)})})]})]})}function ne(){return _({queryKey:["account-payable"]})?e.jsx("div",{className:"flex justify-center items-center h-full w-full",children:e.jsx(L,{})}):e.jsxs("div",{className:"flex flex-col gap-4 h-full w-full",children:[e.jsx(z,{}),e.jsx(te,{})]})}function fe(){return e.jsx(ne,{})}export{fe as default};
