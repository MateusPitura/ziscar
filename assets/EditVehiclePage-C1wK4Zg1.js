import{i as V,u as C,b as E,c as j,o as b,f as F,d as P,r as q,j as e,S as N,l as h,e as m}from"./index-LO79eavt.js";import{F as w}from"./schemas-C0aL5P6j.js";import{P as K}from"./FieldArray-nV10FFMi.js";import{P as Q}from"./PageHeader-C8ixiw9T.js";import{f as T}from"./formatVehicleCharacteristics-BEECkIz-.js";import{b as A}from"./index-itdTiU89.js";import{s as R}from"./selectVehicleInfo-C2onKQ51.js";import{V as $}from"./VehicleTabs-Bf6ZsEzS.js";import"./useDialog-pT-Uqh-i.js";import"./Section-dk9GDjtF.js";import"./index-DfarobFx.js";import"./ColorPreview-B_aHk8_N.js";import"./PaymentForm-B-c3y5pd.js";import"./Select-CrTaPVoa.js";import"./DataField-DvGceO3C.js";import"./Choice-BGWichA8.js";import"./selectStoresInfo-BtHOsGNa.js";import"./Search-8ihBAnuu.js";import"./selectBrandsInfo-VDxn_10s.js";function se({contextHelper:p}){const l=V(),{safeFetch:u}=C(),{showSuccessSnackbar:d}=E(),a=j(),{vehicleId:t}=b();async function f(){const r=await u(`${m}/vehicles/${t}`,{resource:"VEHICLES",action:"READ"}),{payment:s,vehicleCharacteristicValues:c,...o}=r;return{payment:s,vehicle:{...o,vehicleCharacteristicValues:T({vehicleCharacteristicValues:c})}}}const{data:i,isFetching:v}=F({queryKey:["vehicle",t],queryFn:f,select:R});async function x({characteristics:r,payment:s,vehicle:c}){const o=[...r.commonCharacteristics,...r.newCharacteristics.map(y=>y.description)];await u(`${m}/vehicles/${t}`,{method:"PATCH",body:{...c,characteristics:o,payment:{purchaseDate:s==null?void 0:s.purchaseDate,paidTo:s==null?void 0:s.paidTo}},resource:"VEHICLES",action:"UPDATE"})}const{mutate:g,isPending:S,isSuccess:n}=P({mutationFn:x,onSuccess:()=>{d({title:`Veículo ${i==null?void 0:i.vehicle.plateNumber} atualizado com sucesso`}),l("/vehicles"),a.invalidateQueries({queryKey:["vehicles"]}),a.invalidateQueries({queryKey:["paid-to"]}),a.invalidateQueries({queryKey:["vehicle-model"]})}});return q.useEffect(()=>()=>{n&&a.invalidateQueries({queryKey:["vehicle",t]})},[n,a,t]),v?e.jsx("div",{className:"flex justify-center items-center h-full w-full",children:e.jsx(N,{})}):i&&e.jsx("div",{className:"flex flex-col gap-4 w-full",children:e.jsxs(w,{onSubmit:g,className:"flex-1 flex flex-col gap-4",schema:A,replaceEmptyStringToNull:!0,defaultValues:{characteristics:i.characteristics,payment:i.payment,vehicle:i.vehicle},children:[e.jsx(Q,{title:"Alterar veículo",contextHelper:p}),e.jsx($,{isEdit:!0,purchaseValue:i.purchaseValue}),e.jsxs(K,{dirty:!0,primaryBtnState:S?"loading":void 0,children:[e.jsx(h,{color:"lightBlue",iconRight:"Save",label:"Salvar",tooltipMessage:"Salvar cadastro"}),e.jsx(h,{color:"red",iconRight:"Close",label:"Cancelar",tooltipMessage:"Cancelar cadastro",onClick:()=>l("/vehicles")})]})]})})}export{se as default};
