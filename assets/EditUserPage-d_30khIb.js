import{r as n,j as o,u as g,a as P,e as A,b as j,C as v,g as C,c as F,S as R,d as l}from"./index-CwQymCQa.js";import{u as b}from"./useIsFetching-DbLUeXt5.js";import{U as q}from"./UserForm-B5-rgUjE.js";import{b as m}from"./schemas-BL4SC9at.js";import{s as w,p as I}from"./parseAddressToUpdate-CWPGC0hS.js";import"./Choice-DMQtnXq8.js";import"./AddressFields-CckxNv15.js";import"./Select-D2QyUKl8.js";import"./FieldArray-BwK9nGym.js";import"./PageHeader-ciO4E3wM.js";import"./index-B72T8EHL.js";import"./index-DTctZbkD.js";import"./PageFooter-BC-TFmMj.js";import"./DialogContext-qdOZWBM2.js";import"./Dialog-D_sfX160.js";const N=n.createContext(null);function K({children:e}){const[r,a]=n.useState(!1);function u(t){a(t)}const i=n.useMemo(()=>({example:r,handleExample:u}),[r]);return o.jsx(N.Provider,{value:i,children:e})}function T(e){var r;return{fullName:e.fullName,email:e.email,phone:m(e.phone,"phone")??"",cpf:m(e.cpf,"cpf")??"",roleId:((r=e.roleId)==null?void 0:r.toString())??"",address:w(e.address)}}function $(){const{safeFetch:e}=g(),{showSuccessSnackbar:r}=P(),a=b({queryKey:["cepApi"]}),u=A(),i=j(),{userId:t}=v();async function p(){return await e(`${l}/user/${t}`,{resource:"USERS",action:"READ"})}const{data:s,isFetching:f}=C({queryKey:["user",t],queryFn:p,select:T});async function y(U){const{address:x,...h}=U,d=I({newAddress:x,oldAddress:s==null?void 0:s.address});await e(`${l}/user/${t}`,{method:"PATCH",body:{...h,...d&&{address:d}},resource:"USERS",action:"UPDATE"})}const{mutate:E,isPending:S,isSuccess:c}=F({mutationFn:y,onSuccess:async()=>{r({title:`Usuário ${s==null?void 0:s.fullName} atualizado com sucesso`}),i.invalidateQueries({queryKey:["users"]}),u("/users")}});return n.useEffect(()=>()=>{c&&i.invalidateQueries({queryKey:["user",t]})},[c,i,t]),f?o.jsx("div",{className:"flex justify-center items-center h-full w-full",children:o.jsx(R,{})}):s&&o.jsx(q,{defaultValues:s,onSubmit:E,isPending:S||!!a,headerTitle:"Alterar usuário",isEdit:!0,resource:"USERS",action:"UPDATE",allowEditRole:!0})}function Y(){return o.jsx(K,{children:o.jsx($,{})})}export{Y as default};
