import{r as u,j as e,a as v,u as E,b as T,c as A,d as N,B,e as S,U as D,f as L,T as h,g as p,h as M}from"./index-DLLA1f-v.js";import{P}from"./PageHeader-Bs9TDp09.js";import{S as F,T as s}from"./Table-By5z5vhx.js";import{u as $}from"./useDialog-DlT6EUiq.js";import{u as j,f as U}from"./react-pdf.browser-s4H9466t.js";import{D as C}from"./Dialog-D33IGNgm.js";import{F as k,I as b,u as O}from"./schemas-Bhi0Dh6I.js";import{u as w}from"./useButtonState-3b0McXTU.js";import{u as R}from"./useDialogContext-BXiPHqkt.js";import{C as g}from"./Choice-BxW3kVCA.js";import{S as q}from"./index-CEd9O9Sp.js";import"./dialog-BH6A_dKB.js";import"./index-2Ad1AATz.js";const H=u.createContext(null);function I({children:t}){const[n,a]=u.useState("");function l(c){a(c)}const i=u.useMemo(()=>({example:n,handleExample:l}),[n]);return e.jsx(H.Provider,{value:i,children:t})}function K(t){const n=[];for(const a of t.data)n.push({...a,phone:v(a==null?void 0:a.phone,"phone")??"",cpf:v(a==null?void 0:a.cpf,"cpf")??""});return{total:t.total,data:n}}function Q({customerId:t,customerFullName:n,...a}){const{safeFetch:l}=E(),{showSuccessSnackbar:i}=T(),c=A(),{handleCustomersFilter:d}=j();async function m(){await l(`${S}/customer/${t}`,{method:"DELETE",body:{archivedAt:new Date().toISOString()},resource:"CUSTOMERS",action:"DELETE"})}const{mutate:x,isPending:f}=N({mutationFn:m,onSuccess:()=>{d({page:1}),c.invalidateQueries({queryKey:["customers"]}),i({title:`Cliente ${n} desativado com sucesso`}),a.closeDialog()}});return e.jsxs(C,{...a,children:[e.jsx(C.Header,{title:"Desativar cliente"}),e.jsx(C.Body,{children:e.jsxs("span",{className:"text-body-medium text-neutral-700",children:["Tem certeza que deseja desativar o cliente",e.jsxs("span",{className:"font-bold",children:[B,n]}),"? Ao desativar os registros relacionados a ele não serão mais acessíveis"]})}),e.jsx(C.Footer,{labelPrimaryBtn:"Desativar",onClickPrimaryBtn:x,primaryBtnState:f?"loading":void 0,primaryBtnColor:"red",primaryBtnResource:"CUSTOMERS",primaryBtnAction:"DELETE"})]})}function z(){const{customersFilter:t,handleCustomersFilter:n}=j(),{closeDialog:a}=R();function l(i){n({page:1,...i}),a()}return e.jsx(k,{schema:q,onSubmit:l,className:"flex-1 flex flex-col",defaultValues:{fullName:(t==null?void 0:t.fullName)||"",status:(t==null?void 0:t.status)||"active",startDate:(t==null?void 0:t.startDate)||"",endDate:(t==null?void 0:t.endDate)||""},replaceEmptyStringToNull:!1,children:e.jsx(V,{})})}function V(){const{reset:t}=w(),{handleCustomersFilter:n}=j(),{closeDialog:a}=R();function l(){n(D),t(D),a()}return e.jsxs(e.Fragment,{children:[e.jsxs(F.Body,{className:"flex flex-col gap-4",children:[e.jsx(b,{name:"fullName",label:"Nome completo"}),e.jsx(O,{label:"Status"}),e.jsx("div",{className:"flex flex-col gap-2",children:e.jsxs(g,{hideErrorLabel:!0,children:[e.jsx(g.Radio,{name:"status",label:"Ativo",value:"active"}),e.jsx(g.Radio,{name:"status",label:"Inativo",value:"inactive"})]})}),e.jsx(b,{name:"startDate",label:"Data inicial de criação",type:"date"}),e.jsx(b,{name:"endDate",label:"Data final de criação",type:"date"})]}),e.jsx(F.Footer,{primaryLabel:"Aplicar",secondaryLabel:"Limpar",onSecondaryCallback:l,dirty:!0})]})}const _=u.memo(z);function G({customerId:t,fullName:n,isActive:a,handleDisableCustomerInfo:l}){const i=L(),{safeFetch:c}=E(),{showSuccessSnackbar:d}=T(),m=A();async function x(){await c(`${S}/customer/${t}`,{method:"DELETE",body:{archivedAt:null},resource:"CUSTOMERS",action:"DELETE"})}const{mutate:f,isPending:r}=N({mutationFn:x,onSuccess:()=>{m.invalidateQueries({queryKey:["customers"]}),d({title:`Cliente ${n} ativado com sucesso`})}});return a?e.jsxs(e.Fragment,{children:[e.jsx(h,{content:"Editar",children:e.jsx(p,{variant:"quaternary",iconLeft:"Edit",onClick:()=>i(`/customers/edit/${t}`),resource:"CUSTOMERS",action:"UPDATE",padding:"none","data-cy":`button-edit-customer-${t}`})}),e.jsx(h,{content:"Desativar",children:e.jsx(p,{variant:"primary",iconLeft:"Delete",color:"red",padding:"none",onClick:()=>l({customerFullName:n,customerId:t}),resource:"CUSTOMERS",action:"DELETE","data-cy":`button-disable-customer-${t}`})})]}):e.jsx(h,{content:"Ativar",children:e.jsx(p,{variant:"quaternary",onClick:f,state:r?"loading":void 0,resource:"CUSTOMERS",action:"DELETE",padding:"none",iconLeft:"ToggleOn","data-cy":`button-enable-customer-${t}`})})}const J=!1;function W(){const[t,n]=u.useState({customerFullName:"",customerId:""}),a=$(),{safeFetch:l}=E(),{customersFilter:i,handleCustomersFilter:c}=j();function d(o){a.openDialog(),n(o)}function m(o){c({page:o})}const x=u.useMemo(()=>i?U(i):"",[i]);async function f(o){return await l(`${S}/customer?${o}&orderBy=fullName`,{resource:"CUSTOMERS",action:"READ"})}const{data:r,isFetching:y}=M({queryKey:["customers",x],queryFn:({queryKey:o})=>f(o[1]),select:K});return e.jsxs(e.Fragment,{children:[e.jsx(Q,{...t,...a}),e.jsxs("div",{className:"flex gap-4 justify-end",children:[J,e.jsx(s.Filter,{form:e.jsx(_,{})})]}),e.jsxs(s,{children:[e.jsxs(s.Header,{children:[e.jsx(s.Head,{label:"Nome completo"}),e.jsx(s.Head,{label:"CPF"}),e.jsx(s.Head,{label:"Email"}),e.jsx(s.Head,{label:"Celular"}),e.jsx(s.Head,{label:"Status"}),e.jsx(s.Head,{action:!0})]}),e.jsx(s.Body,{isLoading:y,isEmpty:!(r!=null&&r.total),resource:"CUSTOMERS",action:"READ",children:r==null?void 0:r.data.map(o=>e.jsxs(s.Row,{children:[e.jsx(s.Cell,{label:o.fullName}),e.jsx(s.Cell,{label:o.cpf}),e.jsx(s.Cell,{label:o.email}),e.jsx(s.Cell,{label:o.phone}),e.jsx(s.Cell,{label:o.archivedAt?"Inativo":"Ativo"}),e.jsx(s.Action,{children:e.jsx(G,{isActive:!o.archivedAt,customerId:String(o.id),fullName:o.fullName,handleDisableCustomerInfo:d})})]},o.id))}),e.jsx(s.Footer,{currentStartItem:i==null?void 0:i.page,totalItems:r==null?void 0:r.total,onClickNavigateBtn:m,isLoading:y})]})]})}function X(){const t=L();return e.jsxs("div",{className:"flex flex-col gap-4 h-full w-full",children:[e.jsx(P,{title:"Clientes",children:e.jsx(p,{label:"Adicionar cliente",iconLeft:"Add",onClick:()=>t("/customers/new"),resource:"CUSTOMERS",action:"CREATE",color:"green","data-cy":"new-customer-button"})}),e.jsx(W,{})]})}function de(){return e.jsx(I,{children:e.jsx(X,{})})}export{de as default};
