import{r as j,h as v,i as P,s as F,C as E,j as e,w as q,x as R,l as I,m as _,g as N,y as V,z as L,B as y,P as H}from"./index-0Nt7NBOD.js";import{e as T,f as i,F as U}from"./schemas-CDPgOUHG.js";import{P as G,C}from"./Choice-DcDSo3m0.js";import{F as K,S as D,a as s,P as O}from"./PageFooter-CS6OcIB9.js";import{a as g,u as M,b as $}from"./Dialog-aYrjmFvu.js";function z(){const[n,c]=j.useState(""),{setValue:t,trigger:u,getValues:l,watch:d}=T(),{safeFetch:m}=v(),{showErrorSnackbar:h}=P();async function f(a){return await m(`https://viacep.com.br/ws/${a}/json/`,{enableCookie:!1})}const{data:r,isFetching:o}=F({queryKey:["cepApi",n],queryFn:({queryKey:a})=>f(a[1]),enabled:!!n});j.useEffect(()=>{if(r!=null&&r.erro){h({description:"CEP não encontrado"});return}r&&(t("address.0.street",r.logradouro,{shouldDirty:!0}),t("address.0.neighborhood",r.bairro,{shouldDirty:!0}),t("address.0.cityIbgeCode",r.ibge,{shouldDirty:!0}),t("address.0.state",r.uf,{shouldDirty:!0}))},[r,t,h]);async function B(a){return a?await m(`https://servicodados.ibge.gov.br/api/v1/localidades/estados/${a}/municipios`,{enableCookie:!1}):[]}const b=d("address.0.state"),{data:w,isFetching:A}=F({queryKey:["ibgeApi",b],queryFn:({queryKey:a})=>B(a[1]),enabled:!!b,select:a=>a==null?void 0:a.map(p=>({value:String(p.id),label:p.nome}))});async function S(){if(await u("address.0.cep")){const p=l("address.0.cep");c(p)}}const x=d("address.0.cep");j.useEffect(()=>{(x==null?void 0:x.length)===E&&S()},[x]);function k(a){a.key==="Enter"&&(a.preventDefault(),S())}return e.jsx(K,{name:"address",appendText:"Adicionar endereço",removeText:"Remover endereço",maxLength:1,appendDefaultValues:q,render:()=>e.jsxs(e.Fragment,{children:[e.jsx("div",{onKeyDown:k,children:e.jsx(i,{label:"CEP",name:"address.0.cep",mask:"cep",maxLength:E,required:!0,forceUnselect:!0,disabled:o})}),e.jsx(i,{label:"Número",name:"address.0.number",required:!0}),e.jsx(i,{label:"Rua",name:"address.0.street",disabled:o}),e.jsx(i,{label:"Bairro",name:"address.0.neighborhood",disabled:o}),e.jsx(D,{label:"Estado",name:"address.0.state",options:R,onChange:()=>t("address.0.cityIbgeCode","",{shouldDirty:!0}),disabled:o}),e.jsx(D,{label:"Cidade",name:"address.0.cityIbgeCode",options:w||[],loading:A,disabled:!b})]})})}function Q({...n}){const{safeFetch:c}=v(),{showSuccessSnackbar:t}=P();async function u(){await c(`${_}/auth/request-change-password`,{method:"POST"})}const{mutate:l,isPending:d}=I({mutationFn:u,onSuccess:()=>{t({title:"Um email será enviado",description:"Confira também a caixa de spam"}),n.closeDialog()}});return e.jsxs(g,{...n,children:[e.jsx(g.Header,{title:"Alteração de senha"}),e.jsx(g.Body,{children:"Caso deseje alterar a senha, clique no botão abaixo e siga as instruções enviadas para seu email"}),e.jsx(g.Footer,{labelSecondaryBtn:"Cancelar",onClickPrimaryBtn:l,labelPrimaryBtn:"Solicitar alteração",onClickSecondaryBtn:n.closeDialog,primaryBtnState:d?"loading":void 0})]})}function ee({defaultValues:n,onSubmit:c,isPending:t,headerTitle:u,isEdit:l=!1,resource:d,action:m,allowEditRole:h=!1,allowChangePassword:f=!1}){const r=N(),o=M();return e.jsxs(e.Fragment,{children:[e.jsx(Q,{...o}),e.jsx("div",{className:"flex flex-col gap-4 w-full",children:e.jsxs(U,{schema:$,defaultValues:n,onSubmit:c,className:"gap-4 flex flex-col flex-1",onlyDirty:l,children:[e.jsx(G,{title:u}),e.jsx("div",{className:"flex justify-center flex-1",children:e.jsxs(s,{children:[e.jsxs(s.Group,{children:[e.jsx(s.Header,{title:"Dados"}),e.jsxs(s.Body,{children:[e.jsx(i,{name:"fullName",label:"Nome completo",required:!0,autoFocus:!0}),e.jsx(i,{name:"email",label:"Email",required:!0,disabled:l,type:"email"}),e.jsx(i,{name:"phone",label:"Celular",mask:"phone",maxLength:15,type:"tel"}),e.jsx(i,{name:"cpf",label:"CPF",mask:"cpf",maxLength:14})]})]}),e.jsxs(s.Group,{children:[e.jsx(s.Header,{title:"Endereço"}),e.jsx(s.Body,{children:e.jsx(z,{})})]}),h&&e.jsxs(s.Group,{children:[e.jsx(s.Header,{title:"Categoria"}),e.jsx(s.Body,{children:e.jsxs(C,{children:[e.jsx(C.Radio,{name:"roleId",label:"Administrador",value:String(V)}),e.jsx(C.Radio,{name:"roleId",label:"Vendedor",value:String(L)})]})})]}),f&&e.jsxs(s.Group,{children:[e.jsx(s.Header,{title:"Segurança"}),e.jsx(s.Body,{children:e.jsx(y,{"data-cy":"request-change-password-button",label:"Alterar senha",onClick:()=>o.openDialog()})})]})]})}),e.jsxs(O,{primaryBtnState:t?"loading":void 0,dirty:!0,children:[e.jsx(y,{color:"lightBlue",iconRight:"Save",label:"Salvar",resource:d,action:m}),e.jsx(y,{color:"red",iconRight:"Close",label:"Cancelar",onClick:()=>r(H)})]})]})})]})}export{ee as U};
