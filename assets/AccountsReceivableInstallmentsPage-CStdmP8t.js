import{a as v,i as q,j as e,l as F,w as S,u as g,f as R,S as B,aQ as D,e as A,b as I,c as V,o as P,d as w,aR as O,aS as H,r as C,y as N,aT as c,B as U}from"./index-PgcJxcI8.js";import{P as _}from"./PageHeader-D5LdL7k-.js";import{T as s}from"./Table-BekIIB6O.js";import{i as $,A as k}from"./AccountExpired-C6rEsZ_I.js";import{A as K}from"./AccountStatus-BpaywdVD.js";import{D as j}from"./DataField-DBVDlCWD.js";import{D as b,b as Q}from"./useDialog-BsfWsbN7.js";import{F as G,I as z,u as J}from"./schemas-C0lewGoY.js";import{C as T}from"./Choice-D0Rlvujn.js";import{a as W}from"./index-BT1i9xUF.js";import"./Tag-CNBfIfxT.js";function X(a){return{...a,totalValue:v(a.totalValue,"money")??""}}function Y({contextHelper:a,description:l}){const r=q();return e.jsx(_,{title:l?`Detalhes do Pagamento "${l}"`:"Detalhes do Pagamento",contextHelper:a,children:e.jsx(F,{variant:"quaternary",label:"Voltar",iconLeft:"ArrowBack",onClick:()=>r("/accounts-receivable"),action:"READ",resource:"ACCOUNTS_RECEIVABLE","data-cy":"back-accounts-receivable-button",tooltipMessage:"Página anterior"})})}function Z(a){var r,u;const l=[];for(const t of a){const d=[];for(const i of t.paymentMethodReceivables)d.push({...i,paymentDate:i.paymentDate?S({date:(r=i.paymentDate)==null?void 0:r.split("T")[0],format:"dd/MM/yyyy"}):""});l.push({...t,dueDate:t.dueDate?S({date:(u=t.dueDate)==null?void 0:u.split("T")[0],format:"dd/MM/yyyy"}):"",value:v(t.value,"money")??"",paymentMethodReceivables:d,isExpired:t.status==="PENDING"&&!!t.dueDate&&$(new Date(t.dueDate))})}return l}function ee({installment:a,handleInstallmentToPaymentMethodInfo:l}){if(!a.paymentMethodReceivables.length)return e.jsx(F,{tooltipMessage:"Adicionar método de pagamento",variant:"quaternary",iconLeft:"AddCard",onClick:()=>l(a),resource:"ACCOUNTS_RECEIVABLE",action:"READ",padding:"none","data-cy":`button-edit-addPaymentMethod-${a.id}`})}function ae(a){return{...a,paymentDate:S({date:a.paymentDate,format:"dd/MM/yyyy"})??""}}function te({installment:a,...l}){const{safeFetch:r}=g();async function u(){var n;const i=await r(`${A}/account-receivable-installments/payment-method/${a==null?void 0:a.id}`,{resource:"ACCOUNTS_RECEIVABLE",action:"READ"});return(n=i==null?void 0:i.paymentMethodReceivables)==null?void 0:n[0]}const{data:t,isFetching:d}=R({queryKey:["accounts-receivable-payment-method",a.id],queryFn:u,select:ae});return e.jsxs(b,{...l,children:[e.jsx(b.Header,{title:"Detalhes do Método de Pagamento"}),e.jsx(b.Body,{children:e.jsx("div",{className:"flex flex-col gap-4 h-36 mb-8",children:d?e.jsx("div",{className:"flex justify-center items-center h-full w-full",children:e.jsx(B,{})}):e.jsxs(e.Fragment,{children:[e.jsx(j,{label:"Data do pagamento",value:t==null?void 0:t.paymentDate}),e.jsx(j,{label:"Forma de pagamento",value:t&&D[t==null?void 0:t.type]})]})})})]})}function ne({installment:a,...l}){const{safeFetch:r}=g(),{showSuccessSnackbar:u}=I(),t=V(),{accountReceivableId:d}=P();async function i(p){await r(`${A}/account-receivable-installments/payment-method/${a.id}`,{method:"POST",body:p,resource:"ACCOUNTS_RECEIVABLE",action:"CREATE"})}const{mutate:n,isPending:E}=w({mutationFn:i,onSuccess:()=>{u({title:"Método de pagamento adicionado"}),t.invalidateQueries({queryKey:["accounts-receivable-installments",d]}),t.invalidateQueries({queryKey:["accounts-receivable-payment-method",String(a.id)]}),t.invalidateQueries({queryKey:["accounts-receivable"]}),l.closeDialog()}});return e.jsxs(b,{...l,children:[e.jsx(b.Header,{title:"Adicionar Método de Pagamento"}),e.jsx(b.Body,{children:e.jsxs(G,{schema:W,defaultValues:O,onSubmit:n,className:"flex flex-col gap-4",children:[e.jsx(z,{name:"paymentDate",label:"Data do pagamento",required:!0,type:"date"}),e.jsx(J,{label:"Forma de pagamento",required:!0}),e.jsx("div",{className:"flex flex-col gap-2",children:e.jsx(T,{required:!0,children:Object.values(H).map(p=>e.jsx(T.Radio,{label:D[p],name:"type",value:p},p))})}),e.jsx(b.Footer,{labelPrimaryBtn:"Adicionar",className:"px-0",dirty:!1,primaryBtnState:E?"loading":void 0,primaryBtnResource:"ACCOUNTS_RECEIVABLE",primaryBtnAction:"CREATE"})]})})]})}function le({installment:a,...l}){if(a)return a.paymentMethodReceivables.length?e.jsx(te,{installment:a,...l}):e.jsx(ne,{installment:a,...l})}const L=11;function oe(){const{safeFetch:a}=g(),{accountReceivableId:l}=P(),[r,u]=C.useState(null),t=Q();function d(o){t.openDialog(),u(o)}async function i(){return await a(`${A}/account-receivable-installments/by-account/${l}`,{resource:"ACCOUNTS_RECEIVABLE",action:"READ"})}const{data:n,isFetching:E}=R({queryKey:["accounts-receivable-installments",l],queryFn:i,select:Z}),p=C.useMemo(()=>n!=null&&n.length?Math.max(...n.map(o=>o.value.length)):0,[n]),m=C.useMemo(()=>{var x,f;if(!(n!=null&&n.length))return{totalOverall:0,totalPaid:0,totalPending:0};const o=((x=n.filter(y=>y.status==="PAID"))==null?void 0:x.reduce((y,M)=>y+Number(N(M.value)),0))??0,h=((f=n.filter(y=>y.status==="PENDING"))==null?void 0:f.reduce((y,M)=>y+Number(N(M.value)),0))??0;return{totalOverall:o+h,totalPaid:o,totalPending:h}},[n]);return e.jsxs(e.Fragment,{children:[e.jsx(le,{installment:r,...t}),e.jsxs("div",{className:"w-fit flex gap-4",children:[e.jsx(j,{label:"Total",value:v(m==null?void 0:m.totalOverall,"money")}),e.jsx(j,{label:"Total Pago",value:v(m==null?void 0:m.totalPaid,"money")}),e.jsx(j,{label:"Total Pendente",value:v(m==null?void 0:m.totalPending,"money")})]}),e.jsxs(s,{children:[e.jsxs(s.Header,{gridColumns:L,children:[e.jsx(s.Head,{label:c.installmentSequence.label,colSpan:c.installmentSequence.colSpan}),e.jsx(s.Head,{label:c.dueDate.label}),e.jsx(s.Head,{label:c.paymentDate.label}),e.jsx(s.Head,{label:c.paymentMethod.label}),e.jsx(s.Head,{label:c.status.label}),e.jsx(s.Head,{label:c.value.label,colSpan:c.installmentSequence.colSpan}),e.jsx(s.Head,{action:!0})]}),e.jsx(s.Body,{isLoading:E,isEmpty:!(n!=null&&n.length),resource:"ACCOUNTS_RECEIVABLE",action:"READ",children:n==null?void 0:n.map(o=>{var h,x,f;return e.jsxs(s.Row,{gridColumns:L,children:[e.jsx(s.Cell,{columnLabel:c.installmentSequence.label,colSpan:c.installmentSequence.colSpan,label:o.isUpfront?"Entrada":`${o.installmentSequence}/${(h=n.filter(y=>!y.isUpfront))==null?void 0:h.length}`}),e.jsx(s.Cell,{columnLabel:c.dueDate.label,label:e.jsxs("div",{className:"flex gap-1 text-center",children:[o.dueDate," ",o.isExpired&&e.jsx(k,{})]})}),e.jsx(s.Cell,{columnLabel:c.paymentDate.label,label:(x=o.paymentMethodReceivables)!=null&&x.length?o.paymentMethodReceivables[0].paymentDate:""}),e.jsx(s.Cell,{columnLabel:c.paymentMethod.label,label:(f=o.paymentMethodReceivables)!=null&&f.length?D[o.paymentMethodReceivables[0].type]:""}),e.jsx(s.Cell,{columnLabel:c.status.label,label:e.jsx(K,{status:o.status})}),e.jsx(s.Cell,{columnLabel:c.value.label,label:o.value.padStart(p,U),className:"font-mono whitespace-pre",colSpan:c.value.colSpan}),e.jsx(s.Action,{children:e.jsx(ee,{installment:o,handleInstallmentToPaymentMethodInfo:d})})]},o.id)})})]})]})}function xe({contextHelper:a}){const{accountReceivableId:l}=P(),{safeFetch:r}=g();async function u(){return await r(`${A}/account-receivable/${l}`,{resource:"ACCOUNTS_RECEIVABLE",action:"READ"})}const{data:t,isFetching:d}=R({queryKey:["account-receivable",l],queryFn:u,select:X});return d?e.jsx("div",{className:"flex justify-center items-center h-full w-full",children:e.jsx(B,{})}):e.jsxs("div",{className:"flex flex-col gap-4 h-full w-full",children:[e.jsx(Y,{contextHelper:a,description:t==null?void 0:t.description}),e.jsx(oe,{})]})}export{xe as default};
