import{r as x,j as e,b as y,c as N,d as T,e as A,g as M,f as v,o as S,a as R,T as b,B as h,h as O}from"./index-B_iWEUUC.js";import{P}from"./PageHeader-DfUmqkU2.js";import{S as D,T as o}from"./Table-D_1FooX_.js";import{u as $}from"./useDialog-C-b4l8WV.js";import{u as j,f as U}from"./react-pdf.browser-BCQg-I2E.js";import{E as k}from"./ExportButton-Cy4AqN82.js";import{a as B,F as q,u as w,I as E,b as F}from"./schemas-D1jfyf81.js";import{D as C}from"./Dialog-CGi7XIRs.js";import{u as L}from"./useDialogContext-BID4jU4R.js";import{C as m}from"./Choice-B-eajStn.js";import{S as I}from"./index-BpOXT6va.js";import"./useIsFetching-DqnnrfEG.js";import"./index-CS_UDAGd.js";const H=x.createContext(null);function K({children:a}){const[s,t]=x.useState("");function r(c){t(c)}const l=x.useMemo(()=>({example:s,handleExample:r}),[s]);return e.jsx(H.Provider,{value:l,children:a})}function Q(a){const s=[];for(const t of a.data)s.push({...t,phone:B(t==null?void 0:t.phone,"phone")??""});return{total:a.total,data:s}}function V({customerId:a,customerFullName:s,...t}){const{safeFetch:r}=y(),{showSuccessSnackbar:l}=N(),c=T(),{handleCustomersFilter:f}=j();async function p(){await r(`${v}/customer/${a}`,{method:"DELETE",body:{archivedAt:new Date().toISOString()},resource:"CUSTOMERS",action:"DELETE"})}const{mutate:u,isPending:d}=A({mutationFn:p,onSuccess:()=>{f({page:1}),c.invalidateQueries({queryKey:["customers"]}),l({title:`Cliente ${s} desativado com sucesso`}),t.closeDialog()}});return e.jsxs(C,{...t,children:[e.jsx(C.Header,{title:"Desativar cliente"}),e.jsx(C.Body,{children:e.jsxs("span",{className:"text-body-medium text-neutral-700",children:["Tem certeza que deseja desativar o cliente",e.jsxs("span",{className:"font-bold",children:[M,s]}),"? Ao desativar os registros relacionados a ele não serão mais acessíveis"]})}),e.jsx(C.Footer,{labelPrimaryBtn:"Desativar",onClickPrimaryBtn:u,primaryBtnState:d?"loading":void 0,primaryBtnColor:"red",primaryBtnResource:"CUSTOMERS",primaryBtnAction:"DELETE"})]})}function z(){const{customersFilter:a,handleCustomersFilter:s}=j(),{closeDialog:t}=L();function r(l){s({page:1,...l}),t()}return e.jsx(q,{schema:I,onSubmit:r,className:"flex-1 flex flex-col",defaultValues:{fullName:(a==null?void 0:a.fullName)||"",orderBy:(a==null?void 0:a.orderBy)||"fullName",status:(a==null?void 0:a.status)||"active",startDate:(a==null?void 0:a.startDate)||"",endDate:(a==null?void 0:a.endDate)||""},replaceEmptyStringToNull:!1,children:e.jsx(_,{})})}function _(){const{reset:a}=w(),{handleCustomersFilter:s}=j(),{closeDialog:t}=L();function r(){s(S),a(S),t()}return e.jsxs(e.Fragment,{children:[e.jsxs(D.Body,{className:"flex flex-col gap-4",children:[e.jsx(E,{name:"fullName",label:"Nome completo"}),e.jsx(F,{label:"Status"}),e.jsx("div",{className:"flex flex-col gap-2",children:e.jsxs(m,{hideErrorLabel:!0,children:[e.jsx(m.Radio,{name:"status",label:"Ativo",value:"active"}),e.jsx(m.Radio,{name:"status",label:"Inativo",value:"inactive"})]})}),e.jsx(E,{name:"startDate",label:"Data inicial",type:"date"}),e.jsx(E,{name:"endDate",label:"Data final",type:"date"}),e.jsx(F,{label:"Ordenar por"}),e.jsx("div",{className:"flex flex-col gap-2",children:e.jsxs(m,{hideErrorLabel:!0,children:[e.jsx(m.Radio,{name:"orderBy",label:"Nome",value:"fullName"}),e.jsx(m.Radio,{name:"orderBy",label:"Email",value:"email"})]})})]}),e.jsx(D.Footer,{primaryLabel:"Aplicar",secondaryLabel:"Limpar",onSecondaryCallback:r,dirty:!0})]})}const G=x.memo(z);function J({customerId:a,fullName:s,isActive:t,handleDisableCustomerInfo:r}){const l=R(),{safeFetch:c}=y(),{showSuccessSnackbar:f}=N(),p=T();async function u(){await c(`${v}/customer/${a}`,{method:"DELETE",body:{archivedAt:null},resource:"CUSTOMERS",action:"DELETE"})}const{mutate:d,isPending:i}=A({mutationFn:u,onSuccess:()=>{p.invalidateQueries({queryKey:["customers"]}),f({title:`Cliente ${s} ativado com sucesso`})}});return t?e.jsxs(e.Fragment,{children:[e.jsx(b,{content:"Editar",children:e.jsx(h,{variant:"quaternary",iconLeft:"Edit",onClick:()=>l(`/customers/edit/${a}`),resource:"CUSTOMERS",action:"UPDATE",padding:"none","data-cy":`button-edit-customer-${a}`})}),e.jsx(b,{content:"Desativar",children:e.jsx(h,{variant:"primary",iconLeft:"Delete",color:"red",padding:"none",onClick:()=>r({customerFullName:s,customerId:a}),resource:"CUSTOMERS",action:"DELETE","data-cy":`button-disable-customer-${a}`})})]}):e.jsx(b,{content:"Ativar",children:e.jsx(h,{variant:"quaternary",onClick:d,state:i?"loading":void 0,resource:"CUSTOMERS",action:"DELETE",padding:"none",iconLeft:"ToggleOn","data-cy":`button-enable-customer-${a}`})})}function W(a){const s=[];for(const t of a.data)s.push({...t,phone:B(t==null?void 0:t.phone,"phone")??""});return s}function X(){const[a,s]=x.useState({customerFullName:"",customerId:""}),t=$(),{safeFetch:r}=y(),{customersFilter:l,handleCustomersFilter:c}=j();function f(n){t.openDialog(),s(n)}function p(n){c({page:n})}const u=x.useMemo(()=>l?U(l):"",[l]);async function d(n){return await r(`${v}/customer?${n}`,{resource:"CUSTOMERS",action:"READ"})}const{data:i,isFetching:g}=O({queryKey:["customers",u],queryFn:({queryKey:n})=>d(n[1]),select:Q});return e.jsxs(e.Fragment,{children:[e.jsx(V,{...a,...t}),e.jsxs("div",{className:"flex gap-4 justify-end",children:[e.jsx(k,{fileName:"Relatório Clientes",resource:"CUSTOMERS",queryKey:["customers",u],queryFn:d,selectQueryFn:W,formatFilters:{fullName:"Nome completo",orderBy:"Ordenar por",status:"Status",endDate:"Data final",startDate:"Data inicial"},formatFiltersValues:{orderBy:{email:"Email",fullName:"Nome completo"},status:{active:"Ativo",inactive:"Inativo"}},formatColumns:{id:"ID",fullName:"Nome completo",email:"Email",phone:"Celular",archivedAt:"Ativo"}}),e.jsx(o.Filter,{form:e.jsx(G,{})})]}),e.jsxs(o,{children:[e.jsxs(o.Header,{children:[e.jsx(o.Head,{label:"ID"}),e.jsx(o.Head,{label:"Nome completo"}),e.jsx(o.Head,{label:"Email"}),e.jsx(o.Head,{label:"Celular"}),e.jsx(o.Head,{label:"Status"}),e.jsx(o.Head,{action:!0})]}),e.jsx(o.Body,{isLoading:g,isEmpty:!(i!=null&&i.total),resource:"CUSTOMERS",action:"READ",children:i==null?void 0:i.data.map(n=>e.jsxs(o.Row,{children:[e.jsx(o.Cell,{label:String(n.id)}),e.jsx(o.Cell,{label:n.fullName}),e.jsx(o.Cell,{label:n.email}),e.jsx(o.Cell,{label:n.phone}),e.jsx(o.Cell,{label:n.archivedAt?"Inativo":"Ativo"}),e.jsx(o.Action,{children:e.jsx(J,{isActive:!n.archivedAt,customerId:String(n.id),fullName:n.fullName,handleDisableCustomerInfo:f})})]},n.id))}),e.jsx(o.Footer,{currentStartItem:l==null?void 0:l.page,totalItems:i==null?void 0:i.total,onClickNavigateBtn:p,isLoading:g})]})]})}function Y(){const a=R();return e.jsxs("div",{className:"flex flex-col gap-4 h-full w-full",children:[e.jsx(P,{title:"Clientes",children:e.jsx(h,{label:"Adicionar cliente",iconLeft:"Add",onClick:()=>a("/customers/new"),resource:"CUSTOMERS",action:"CREATE",color:"green","data-cy":"new-customer-button"})}),e.jsx(X,{})]})}function me(){return e.jsx(K,{children:e.jsx(Y,{})})}export{me as default};
