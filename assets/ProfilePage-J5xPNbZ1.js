import{r as g,j as e,v as D,w as B,x as v,y as w,z as C,a as A}from"./index-DpCb8Zub.js";import{P as E}from"./Loading-IUelIp8A.js";import{u as k,A as N,S as i}from"./Section-ZokTC3Gm.js";import{s as M}from"./safeFormat-pk_71gGN.js";import{F as u,c as x,I as j,e as L,f as q,a as P}from"./index-BT4GbdeD.js";import{g as d,i as o,f as z}from"./Dialog-BZ5vJChX.js";import{I as p}from"./InputPassword-2Zfar7bS.js";const R=g.createContext(null);function T({children:s}){const[a,r]=g.useState("");function n(t){r(t)}const c=g.useMemo(()=>({example:a,handleExample:n}),[a]);return e.jsx(R.Provider,{value:c,children:s})}function m({onSuccessSubmit:s,snackbarTitle:a,shouldInvalidateQuery:r=!0}){const{safeFetch:n}=D(),{showSuccessSnackbar:c}=B(),t=v();async function l(F){await n(`${C}/profile`,{method:"PATCH",body:F})}const{mutate:h,isPending:b}=w({mutationFn:l,onSuccess:()=>{r&&(t.invalidateQueries({queryKey:["profile"]}),t.invalidateQueries({queryKey:["usersDashboard"]})),c({title:a}),s()}});return{mutate:h,isPending:b}}const U=x.pick({email:!0});function V({defaultValues:s}){const{closeDialog:a}=d(),{mutate:r,isPending:n}=m({onSuccessSubmit:a,snackbarTitle:"Email atualizado com sucesso"});return e.jsx(u,{onSubmit:r,defaultValues:s,schema:U,children:e.jsx(H,{isPending:n})})}function H({isPending:s}){return e.jsxs(e.Fragment,{children:[e.jsx(o.Body,{children:e.jsx(j,{name:"email",label:"Email",required:!0,forceUnselect:!0,autoFocus:!0})}),e.jsx(o.Footer,{labelPrimaryBtn:"Alterar",primaryBtnState:s?"loading":void 0,dirty:!0})]})}function K(){const{closeDialog:s}=d(),{mutate:a,isPending:r}=m({onSuccessSubmit:s,snackbarTitle:"Senha atualizada com sucesso",shouldInvalidateQuery:!1});function n(c){a({password:c.newPassword})}return e.jsx(u,{onSubmit:n,schema:L,defaultValues:{confirmPassword:"",newPassword:""},children:e.jsx(Q,{isPending:r})})}function Q({isPending:s}){return e.jsxs(e.Fragment,{children:[e.jsxs(o.Body,{children:[e.jsx(p,{label:"Nova senha",name:"newPassword",required:!0}),e.jsx(p,{label:"Confirmar senha",name:"confirmPassword",required:!0})]}),e.jsx(o.Footer,{labelPrimaryBtn:"Alterar",primaryBtnState:s?"loading":void 0,dirty:!0})]})}const G=x.pick({fullName:!0});function $({defaultValues:s}){const{closeDialog:a}=d(),{mutate:r,isPending:n}=m({onSuccessSubmit:a,snackbarTitle:"Nome completo atualizado com sucesso"});return e.jsx(u,{onSubmit:r,defaultValues:s,schema:G,children:e.jsx(_,{isPending:n})})}function _({isPending:s}){return e.jsxs(e.Fragment,{children:[e.jsx(o.Body,{children:e.jsx(j,{name:"fullName",label:"Nome completo",required:!0,forceUnselect:!0,autoFocus:!0})}),e.jsx(o.Footer,{labelPrimaryBtn:"Alterar",primaryBtnState:s?"loading":void 0,dirty:!0})]})}const J=q;function O({defaultValues:s}){const{closeDialog:a}=d(),{mutate:r,isPending:n}=m({onSuccessSubmit:a,snackbarTitle:"Endereço atualizado com sucesso"});function c(t){r({address:t})}return e.jsx(u,{onSubmit:c,schema:J,defaultValues:s,onlyDirty:!0,children:e.jsx(W,{isPending:n})})}function W({isPending:s}){const a=k({queryKey:["cepApi"]});return e.jsxs(e.Fragment,{children:[e.jsx(o.Body,{children:e.jsx(N,{autoFocus:!0})}),e.jsx(o.Footer,{labelPrimaryBtn:"Alterar",primaryBtnState:s||a?"loading":void 0,dirty:!0})]})}const X=x.pick({birthDate:!0});function Y({defaultValues:s}){const{closeDialog:a}=d(),{mutate:r,isPending:n}=m({onSuccessSubmit:a,snackbarTitle:"Data de nascimento atualizada com sucesso"});return e.jsx(u,{onSubmit:r,defaultValues:s,schema:X,children:e.jsx(Z,{isPending:n})})}function Z({isPending:s}){return e.jsxs(e.Fragment,{children:[e.jsx(o.Body,{children:e.jsx(j,{name:"birthDate",label:"Data de nascimento",type:"date"})}),e.jsx(o.Footer,{primaryBtnState:s?"loading":void 0,dirty:!0,labelPrimaryBtn:"Alterar"})]})}const I=x.pick({cpf:!0});function ee({defaultValues:s}){const{closeDialog:a}=d(),{isPending:r,mutate:n}=m({onSuccessSubmit:a,snackbarTitle:"CPF atualizado com sucesso"});return e.jsx(u,{onSubmit:n,defaultValues:s,schema:I,children:e.jsx(te,{isPending:r})})}function te({isPending:s}){return e.jsxs(e.Fragment,{children:[e.jsx(o.Body,{children:e.jsx(j,{name:"cpf",label:"CPF",mask:"cpf",maxLength:14,forceUnselect:!0,autoFocus:!0})}),e.jsx(o.Footer,{primaryBtnState:s?"loading":void 0,dirty:!0,labelPrimaryBtn:"Alterar"})]})}const se=x.pick({code:!0});function ae({defaultValues:s}){const{closeDialog:a}=d(),{mutate:r,isPending:n}=m({onSuccessSubmit:a,snackbarTitle:"Matrícula atualizada com sucesso"});return e.jsx(u,{onSubmit:r,defaultValues:s,schema:se,children:e.jsx(re,{isPending:n})})}function re({isPending:s}){return e.jsxs(e.Fragment,{children:[e.jsx(o.Body,{children:e.jsx(j,{name:"code",label:"Matrícula",forceUnselect:!0,autoFocus:!0})}),e.jsx(o.Footer,{labelPrimaryBtn:"Alterar",primaryBtnState:s?"loading":void 0,dirty:!0})]})}const ne=x.pick({cellPhone:!0});function oe({defaultValues:s}){const{closeDialog:a}=d(),{mutate:r,isPending:n}=m({onSuccessSubmit:a,snackbarTitle:"Celular atualizado com sucesso"});return e.jsx(u,{onSubmit:r,defaultValues:s,schema:ne,children:e.jsx(ie,{isPending:n})})}function ie({isPending:s}){return e.jsxs(e.Fragment,{children:[e.jsx(o.Body,{children:e.jsx(j,{name:"cellPhone",label:"Celular",mask:"cellphone",maxLength:15,forceUnselect:!0,autoFocus:!0})}),e.jsx(o.Footer,{labelPrimaryBtn:"Alterar",primaryBtnState:s?"loading":void 0,dirty:!0})]})}function le(s){var a,r,n,c,t,l,h;return{fullName:s.fullName,email:s.email,cellPhone:P(s.cellPhone,"cellphone")??"",cpf:P(s.cpf,"cpf")??"",code:s.code??"",birthDate:s.birthDate,address:{cep:P((a=s.address)==null?void 0:a.cep,"cep")??"",number:((r=s.address)==null?void 0:r.number)??"",street:((n=s.address)==null?void 0:n.street)??"",complement:((c=s.address)==null?void 0:c.complement)??"",neighborhood:((t=s.address)==null?void 0:t.neighborhood)??"",city:((l=s.address)==null?void 0:l.city)??"",state:((h=s.address)==null?void 0:h.state)??""}}}function ce({title:s,content:a,...r}){return e.jsxs(o,{...r,children:[e.jsx(o.Header,{title:s}),a]})}function ue(){var F,S;const[s,a]=g.useState({title:"",content:void 0}),r=z(),{safeFetch:n}=D();async function c(){return await n(`${C}/profile`)}const{data:t,isFetching:l}=A({queryKey:["profile"],queryFn:c,select:le}),h=g.useMemo(()=>{var y,f;return[(y=t==null?void 0:t.address)==null?void 0:y.street,(f=t==null?void 0:t.address)==null?void 0:f.number].filter(Boolean).join(", ")},[(F=t==null?void 0:t.address)==null?void 0:F.street,(S=t==null?void 0:t.address)==null?void 0:S.number]);function b(y){return t!=null&&t.birthDate?M({date:t.birthDate,format:y}):""}return e.jsxs(e.Fragment,{children:[e.jsx(ce,{...s,...r}),e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsx(E,{title:"Perfil"}),e.jsx("div",{className:"flex justify-center",children:e.jsxs(i,{children:[e.jsx(i.Title,{title:"Informações Pessoais"}),e.jsxs(i.Group,{children:[e.jsx(i.Header,{title:"Conta"}),e.jsx(i.Row,{label:"Email",value:t==null?void 0:t.email,isLoading:l,onEdit:()=>{r.openDialog(),a({title:"Alterar email",content:e.jsx(V,{defaultValues:{email:t==null?void 0:t.email}})})}}),e.jsx(i.Row,{label:"Senha",value:"••••••••••••",isLoading:l,onEdit:()=>{r.openDialog(),a({title:"Alterar senha",content:e.jsx(K,{})})}})]}),e.jsxs(i.Group,{children:[e.jsx(i.Header,{title:"Dados"}),e.jsx(i.Row,{label:"Nome completo",value:t==null?void 0:t.fullName,isLoading:l,onEdit:()=>{r.openDialog(),a({title:"Alterar nome completo",content:e.jsx($,{defaultValues:{fullName:t==null?void 0:t.fullName}})})}}),e.jsx(i.Row,{label:"Endereço",value:h,isLoading:l,onEdit:()=>{r.openDialog(),a({title:"Alterar endereço",content:e.jsx(O,{defaultValues:{...t==null?void 0:t.address}})})}}),e.jsx(i.Row,{label:"Data de nascimento",value:b("dd/MM/yyyy"),isLoading:l,onEdit:()=>{r.openDialog(),a({title:"Alterar data de nascimento",content:e.jsx(Y,{defaultValues:{birthDate:b("yyyy-MM-dd")}})})}}),e.jsx(i.Row,{label:"CPF",value:t==null?void 0:t.cpf,isLoading:l,onEdit:()=>{r.openDialog(),a({title:"Alterar CPF",content:e.jsx(ee,{defaultValues:{cpf:t==null?void 0:t.cpf}})})}}),e.jsx(i.Row,{label:"Matrícula",value:t==null?void 0:t.code,isLoading:l,onEdit:()=>{r.openDialog(),a({title:"Alterar matrícula",content:e.jsx(ae,{defaultValues:{code:t==null?void 0:t.code}})})}}),e.jsx(i.Row,{label:"Celular",value:t==null?void 0:t.cellPhone,isLoading:l,onEdit:()=>{r.openDialog(),a({title:"Alterar celular",content:e.jsx(oe,{defaultValues:{cellPhone:t==null?void 0:t.cellPhone}})})}})]})]})})]})]})}function Fe(){return e.jsx(T,{children:e.jsx(ue,{})})}export{Fe as default};
