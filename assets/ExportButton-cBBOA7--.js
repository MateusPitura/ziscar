import{j as e,w as R,c as z,b as H,g as O,I as L}from"./index-CDuUmDit.js";import{V as n,S as p,T as d,D as A,P as E,p as M}from"./react-pdf.browser-BH4xx2Am.js";import{u as I}from"./useIsFetching-CQOvAVOi.js";function N({formatFilters:t,formatFiltersValues:r,queryKey:l}){const o={};for(const c of l[1].split("&")){const[f,u]=c.split("=");if(f==="page")continue;const h=t[f],i=r[f];i?o[h]=i[u]:o[h]=u}return o}const s=p.create({header:{flexDirection:"row",marginBottom:15,borderBottomWidth:1,borderBottomColor:"#CCCCCC",paddingBottom:15,backgroundColor:"#FFFFFF"},gridColumn:{flex:1,minHeight:50},logoContainer:{height:40,backgroundColor:"#F3F4F6",borderRadius:4,justifyContent:"center",alignItems:"center",marginRight:10},logoText:{fontSize:8,color:"#9CA3AF"},centerContainer:{alignItems:"center",justifyContent:"center"},title:{fontSize:16,fontWeight:"bold",marginBottom:3,textAlign:"center"},subtitle:{fontSize:10,color:"#666666",textAlign:"center"},filtersContainer:{flexDirection:"row",flexWrap:"wrap",justifyContent:"flex-end",alignContent:"flex-start",marginLeft:10},filterChip:{backgroundColor:"#F3F4F6",borderRadius:12,paddingHorizontal:8,paddingVertical:3,marginBottom:3,marginLeft:3,borderWidth:1,borderColor:"#E5E7EB"},filterText:{fontSize:8,color:"#374151"}});function P({appliedFilters:t,title:r}){return e.jsxs(n,{style:s.header,fixed:!0,children:[e.jsx(n,{style:s.gridColumn,children:e.jsx(n,{style:s.logoContainer,children:e.jsx(d,{style:s.logoText,children:"LOGO"})})}),e.jsx(n,{style:s.gridColumn,children:e.jsxs(n,{style:s.centerContainer,children:[e.jsx(d,{style:s.title,children:r}),e.jsxs(d,{style:s.subtitle,children:["Gerado em ",R({date:new Date,format:"dd/MM/yyyy"})]})]})}),e.jsx(n,{style:s.gridColumn,children:t&&Object.keys(t).length>0&&e.jsx(n,{style:s.filtersContainer,children:Object.entries(t).map(([l,o])=>e.jsx(n,{style:s.filterChip,children:e.jsxs(d,{style:s.filterText,children:[l,": ",o]})},l))})})]})}const w=p.create({tableRow:{flexDirection:"row",minHeight:25,borderStyle:"solid",borderLeftWidth:1,borderTopWidth:1,borderColor:"#CCCCCC",marginTop:5,backgroundColor:"#F3F4F6"},tableColHeader:{borderStyle:"solid",borderWidth:1,borderLeftWidth:0,borderTopWidth:0,borderColor:"#CCCCCC",padding:6,justifyContent:"center"},tableCellHeader:{fontSize:9,fontWeight:"bold",color:"#374151"}});function V({keys:t,formatColumns:r,columnWidth:l}){return e.jsx(n,{style:w.tableRow,fixed:!0,children:t.map(o=>e.jsx(n,{style:[w.tableColHeader,{width:l}],children:e.jsx(d,{style:w.tableCellHeader,children:r[o]})},o))})}const S=p.create({footer:{position:"absolute",bottom:20,left:20,right:20,flexDirection:"row",justifyContent:"space-between",alignItems:"center",borderTopWidth:1,borderTopColor:"#CCCCCC",paddingTop:10},recordsCounter:{fontSize:10,color:"#666666",flex:1,textAlign:"center"},pageNumber:{fontSize:10,color:"#666666"}});function W({totalRecords:t,itemsPerPage:r}){return e.jsxs(n,{style:S.footer,fixed:!0,children:[e.jsx(n,{style:{width:60}}),e.jsx(d,{style:S.recordsCounter,render:({pageNumber:l})=>{if(!t)return;const o=(l-1)*r,c=Math.min(o+r,t);return`${o+1} a ${c} de ${t} itens`}}),e.jsx(d,{style:S.pageNumber,render:({pageNumber:l,totalPages:o})=>`Página ${l}/${o}`})]})}const a=p.create({page:{flexDirection:"column",backgroundColor:"#FFFFFF",padding:20,paddingBottom:30},content:{flex:1},emptyState:{textAlign:"center",marginTop:50},emptyText:{fontSize:16,color:"#666666"},tableContainer:{marginTop:0},tableRow:{flexDirection:"row",minHeight:25,borderStyle:"solid",borderLeftWidth:1,borderTopWidth:1,borderColor:"#CCCCCC"},tableRowAlternate:{backgroundColor:"#F9FAFB"},tableCol:{borderStyle:"solid",borderWidth:1,borderLeftWidth:0,borderTopWidth:0,borderColor:"#CCCCCC",padding:6,justifyContent:"center"},tableCell:{fontSize:8,color:"#000000"}});function G({data:t,formatColumns:r,title:l,appliedFilters:o}){if(!t||t.length===0)return e.jsx(A,{children:e.jsxs(E,{size:"A4",orientation:"landscape",style:a.page,children:[e.jsx(P,{appliedFilters:o,title:l}),e.jsx(n,{style:a.content,children:e.jsx(n,{style:a.emptyState,children:e.jsx(d,{style:a.emptyText,children:"Nenhum dado encontrado"})})}),e.jsx(W,{totalRecords:0,itemsPerPage:16})]})});const c=Object.keys(t[0]||{}).filter(i=>r[i]),f=`${100/c.length}%`,u=16,h=(i,m)=>m==="archivedAt"?i?"Não":"Sim":i==null?"-":typeof i=="boolean"?i?"Sim":"Não":typeof i=="object"?JSON.stringify(i):String(i);return e.jsx(A,{children:e.jsxs(E,{size:"A4",orientation:"landscape",style:a.page,children:[e.jsx(P,{appliedFilters:o,title:l}),e.jsx(V,{keys:c,formatColumns:r,columnWidth:f}),e.jsx(n,{style:a.content,children:e.jsx(n,{style:a.tableContainer,children:t.map((i,m)=>e.jsx(n,{style:[a.tableRow,...m%2===1?[a.tableRowAlternate]:[]],wrap:!1,minPresenceAhead:10,children:c.map(x=>e.jsx(n,{style:[a.tableCol,{width:f}],children:e.jsx(d,{style:a.tableCell,children:h(i[x],x)})},x))},`row-${m}`))})}),e.jsx(W,{totalRecords:t.length,itemsPerPage:u})]})})}function q({fileName:t,queryKey:r,queryFn:l,selectQueryFn:o,formatColumns:c,formatFilters:f,formatFiltersValues:u}){const h=z(),{showErrorSnackbar:i,showSuccessSnackbar:m}=H(),x=I({queryKey:[r[0]]});async function k(){if(!r)throw new Error;const b=h.getQueryData(r);if(!b)throw new Error;const j=Math.ceil((b==null?void 0:b.total)/L),y=[];for(let C=1;C<=j;C++){const g=r[1],F=/page=\d+/,B=g==null?void 0:g.replace(F,`page=${C}`),D=h.fetchQuery({queryKey:[r[0],B],queryFn:({queryKey:$})=>l($[1])});y.push(D)}return(await Promise.all(y)).flatMap(C=>o(C))}return e.jsx(O,{variant:"primary",color:"darkBlue",label:"Gerar relatório PDF",iconRight:"FileDownload",state:x?"loading":void 0,resource:"REPORTS",action:"CREATE","data-cy":"export-button",onClick:async()=>{const b=m({title:"O PDF está sendo gerado",actionBtnAction:"CREATE",actionBtnResource:"REPORTS"});try{const j=await k(),y=N({queryKey:r,formatFilters:f,formatFiltersValues:u}),T=await M(e.jsx(G,{data:j,formatColumns:c,title:t,appliedFilters:y})).toBlob();b.dismiss();const C=URL.createObjectURL(T),g=document.createElement("a");g.href=C;const F=`${t} ${R({date:new Date,format:"dd-MM-yyyy"})} ${R({date:new Date,format:"HH-mm"})}.pdf`;g.download=F,g.click(),URL.revokeObjectURL(C)}catch{b.dismiss(),i({description:"Ocorreu um erro ao gerar o PDF"})}}})}export{q as E};
