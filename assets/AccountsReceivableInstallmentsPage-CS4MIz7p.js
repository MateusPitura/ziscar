import{a as v,i as B,o as S,u as g,f as P,j as e,l as L,e as A,t as R,S as q,aO as D,b as I,c as V,d as O,aP as w,aQ as H,r as C,x as T,aR as c,B as U}from"./index-LO79eavt.js";import{u as _}from"./useIsFetching-DT0DLOnX.js";import{P as $}from"./PageHeader-C8ixiw9T.js";import{T as s}from"./Table-DGlZs8M8.js";import{A as K}from"./AccountStatus-Cejzuycb.js";import{D as j}from"./DataField-DvGceO3C.js";import{D as p,b as k}from"./useDialog-pT-Uqh-i.js";import{F as Q,I as G,u as z}from"./schemas-C0aL5P6j.js";import{C as N}from"./Choice-BGWichA8.js";import{a as J}from"./index-rewoCw4b.js";import"./Tag-CDvwg207.js";function W(a){return{...a,totalValue:v(a.totalValue,"money")??""}}function X({contextHelper:a}){const l=B(),{accountReceivableId:i}=S(),{safeFetch:d}=g();async function n(){return await d(`${A}/account-receivable/${i}`,{resource:"ACCOUNTS_RECEIVABLE",action:"READ"})}const{data:r}=P({queryKey:["account-receivable",i],queryFn:n,select:W});return e.jsx($,{title:r!=null&&r.description?`Detalhes do Pagamento "${r.description}"`:"Detalhes do Pagamento",contextHelper:a,children:e.jsx(L,{variant:"quaternary",label:"Voltar",iconLeft:"ArrowBack",onClick:()=>l("/accounts-receivable"),action:"READ",resource:"ACCOUNTS_RECEIVABLE","data-cy":"back-accounts-receivable-button",tooltipMessage:"Página anterior"})})}function Y(a){var i,d;const l=[];for(const n of a){const r=[];for(const u of n.paymentMethodReceivables)r.push({...u,paymentDate:u.paymentDate?R({date:(i=u.paymentDate)==null?void 0:i.split("T")[0],format:"dd/MM/yyyy"}):""});l.push({...n,dueDate:n.dueDate?R({date:(d=n.dueDate)==null?void 0:d.split("T")[0],format:"dd/MM/yyyy"}):"",value:v(n.value,"money")??"",paymentMethodReceivables:r})}return l}function Z({installment:a,handleInstallmentToPaymentMethodInfo:l}){if(!a.paymentMethodReceivables.length)return e.jsx(L,{tooltipMessage:"Adicionar método de pagamento",variant:"quaternary",iconLeft:"AddCard",onClick:()=>l(a),resource:"ACCOUNTS_RECEIVABLE",action:"READ",padding:"none","data-cy":`button-edit-addPaymentMethod-${a.id}`})}function ee(a){return{...a,paymentDate:R({date:a.paymentDate,format:"dd/MM/yyyy"})??""}}function ae({installment:a,...l}){const{safeFetch:i}=g();async function d(){var t;const u=await i(`${A}/account-receivable-installments/payment-method/${a==null?void 0:a.id}`,{resource:"ACCOUNTS_RECEIVABLE",action:"READ"});return(t=u==null?void 0:u.paymentMethodReceivables)==null?void 0:t[0]}const{data:n,isFetching:r}=P({queryKey:["accounts-receivable-payment-method",a.id],queryFn:d,select:ee});return e.jsxs(p,{...l,children:[e.jsx(p.Header,{title:"Detalhes do Método de Pagamento"}),e.jsx(p.Body,{children:e.jsx("div",{className:"flex flex-col gap-4 h-36 mb-8",children:r?e.jsx("div",{className:"flex justify-center items-center h-full w-full",children:e.jsx(q,{})}):e.jsxs(e.Fragment,{children:[e.jsx(j,{label:"Data do pagamento",value:n==null?void 0:n.paymentDate}),e.jsx(j,{label:"Forma de pagamento",value:n&&D[n==null?void 0:n.type]})]})})})]})}function te({installment:a,...l}){const{safeFetch:i}=g(),{showSuccessSnackbar:d}=I(),n=V(),{accountReceivableId:r}=S();async function u(b){await i(`${A}/account-receivable-installments/payment-method/${a.id}`,{method:"POST",body:b,resource:"ACCOUNTS_RECEIVABLE",action:"CREATE"})}const{mutate:t,isPending:E}=O({mutationFn:u,onSuccess:()=>{d({title:"Método de pagamento adicionado"}),n.invalidateQueries({queryKey:["accounts-receivable-installments",r]}),n.invalidateQueries({queryKey:["accounts-receivable-payment-method",String(a.id)]}),n.invalidateQueries({queryKey:["accounts-receivable"]}),l.closeDialog()}});return e.jsxs(p,{...l,children:[e.jsx(p.Header,{title:"Adicionar Método de Pagamento"}),e.jsx(p.Body,{children:e.jsxs(Q,{schema:J,defaultValues:w,onSubmit:t,className:"flex flex-col gap-4",children:[e.jsx(G,{name:"paymentDate",label:"Data do pagamento",required:!0,type:"date"}),e.jsx(z,{label:"Forma de pagamento",required:!0}),e.jsx("div",{className:"flex flex-col gap-2",children:e.jsx(N,{required:!0,children:Object.values(H).map(b=>e.jsx(N.Radio,{label:D[b],name:"type",value:b},b))})}),e.jsx(p.Footer,{labelPrimaryBtn:"Adicionar",className:"px-0",dirty:!1,primaryBtnState:E?"loading":void 0,primaryBtnResource:"ACCOUNTS_RECEIVABLE",primaryBtnAction:"CREATE"})]})})]})}function ne({installment:a,...l}){if(a)return a.paymentMethodReceivables.length?e.jsx(ae,{installment:a,...l}):e.jsx(te,{installment:a,...l})}const F=11;function le(){const{safeFetch:a}=g(),{accountReceivableId:l}=S(),[i,d]=C.useState(null),n=k();function r(o){n.openDialog(),d(o)}async function u(){return await a(`${A}/account-receivable-installments/by-account/${l}`,{resource:"ACCOUNTS_RECEIVABLE",action:"READ"})}const{data:t,isFetching:E}=P({queryKey:["accounts-receivable-installments",l],queryFn:u,select:Y}),b=C.useMemo(()=>t!=null&&t.length?Math.max(...t.map(o=>o.value.length)):0,[t]),m=C.useMemo(()=>{var f,x;if(!(t!=null&&t.length))return{totalOverall:0,totalPaid:0,totalPending:0};const o=((f=t.filter(y=>y.status==="PAID"))==null?void 0:f.reduce((y,M)=>y+Number(T(M.value)),0))??0,h=((x=t.filter(y=>y.status==="PENDING"))==null?void 0:x.reduce((y,M)=>y+Number(T(M.value)),0))??0;return{totalOverall:o+h,totalPaid:o,totalPending:h}},[t]);return e.jsxs(e.Fragment,{children:[e.jsx(ne,{installment:i,...n}),e.jsxs("div",{className:"w-fit flex gap-4",children:[e.jsx(j,{label:"Total",value:v(m==null?void 0:m.totalOverall,"money")}),e.jsx(j,{label:"Total Pago",value:v(m==null?void 0:m.totalPaid,"money")}),e.jsx(j,{label:"Total Pendente",value:v(m==null?void 0:m.totalPending,"money")})]}),e.jsxs(s,{children:[e.jsxs(s.Header,{gridColumns:F,children:[e.jsx(s.Head,{label:c.installmentSequence.label,colSpan:c.installmentSequence.colSpan}),e.jsx(s.Head,{label:c.dueDate.label}),e.jsx(s.Head,{label:c.paymentDate.label}),e.jsx(s.Head,{label:c.paymentMethod.label}),e.jsx(s.Head,{label:c.status.label}),e.jsx(s.Head,{label:c.value.label,colSpan:c.installmentSequence.colSpan}),e.jsx(s.Head,{action:!0})]}),e.jsx(s.Body,{isLoading:E,isEmpty:!(t!=null&&t.length),resource:"ACCOUNTS_RECEIVABLE",action:"READ",children:t==null?void 0:t.map(o=>{var h,f,x;return e.jsxs(s.Row,{gridColumns:F,children:[e.jsx(s.Cell,{columnLabel:c.installmentSequence.label,colSpan:c.installmentSequence.colSpan,label:o.isUpfront?"Entrada":`${o.installmentSequence}/${(h=t.filter(y=>!y.isUpfront))==null?void 0:h.length}`}),e.jsx(s.Cell,{columnLabel:c.dueDate.label,label:o.dueDate}),e.jsx(s.Cell,{columnLabel:c.paymentDate.label,label:(f=o.paymentMethodReceivables)!=null&&f.length?o.paymentMethodReceivables[0].paymentDate:""}),e.jsx(s.Cell,{columnLabel:c.paymentMethod.label,label:(x=o.paymentMethodReceivables)!=null&&x.length?D[o.paymentMethodReceivables[0].type]:""}),e.jsx(s.Cell,{columnLabel:c.status.label,label:e.jsx(K,{status:o.status})}),e.jsx(s.Cell,{columnLabel:c.value.label,label:o.value.padStart(b,U),className:"font-mono whitespace-pre",colSpan:c.value.colSpan}),e.jsx(s.Action,{children:e.jsx(Z,{installment:o,handleInstallmentToPaymentMethodInfo:r})})]},o.id)})})]})]})}function he({contextHelper:a}){return _({queryKey:["account-receivable"]})?e.jsx("div",{className:"flex justify-center items-center h-full w-full",children:e.jsx(q,{})}):e.jsxs("div",{className:"flex flex-col gap-4 h-full w-full",children:[e.jsx(X,{contextHelper:a}),e.jsx(le,{})]})}export{he as default};
