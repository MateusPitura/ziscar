import{r as u,j as e,t as v,a as C,a4 as p,aJ as h,i as E,T as b,k as g,u as F,f as L,aK as n,B as N,e as P}from"./index-C8Hi2I9-.js";import{P as V}from"./PageHeader-C3bsmlao.js";import{S,T as s}from"./Table-DwjZzqAC.js";import{A as R}from"./AccountStatus-CW7qdCgu.js";import{u as f,f as B}from"./react-pdf.browser-BXhLJome.js";import{E as T}from"./ExportButton-zBvyv4kA.js";import{F as I,I as m,u as M}from"./schemas-ARZMo_di.js";import{u as H}from"./useButtonState-D8nv53KZ.js";import{u as y}from"./useDialogContext-C__WYHYu.js";import{S as _}from"./index-Be_rqggP.js";import{C as x}from"./Choice-DK2qdk0A.js";import"./DialogContext-DTkaQtxz.js";import"./dialog-DBF6ydzz.js";import"./useIsFetching-B7K5de3P.js";const $=u.createContext(null);function k({children:a}){const[t,l]=u.useState("");function i(d){l(d)}const c=u.useMemo(()=>({example:t,handleExample:i}),[t]);return e.jsx($.Provider,{value:c,children:a})}function q(a){const t=[];for(const l of a.data)t.push({...l,totalValue:C(l.totalValue,"money")??"",date:l.date?v({date:l.date.split("T")[0],format:"dd/MM/yyyy"}):""});return{total:a.total,data:t}}function w(a){const t=[];for(const l of a.data)t.push({...l,totalValue:C(l.totalValue,"money")??"",overallStatus:l.overallStatus==="PAID"?"Pago":"Pendente",date:l.date?v({date:l.date.split("T")[0],format:"dd/MM/yyyy"}):""});return t}function K(){const{accountsReceivableFilter:a,handleAccountsReceivableFilter:t}=f(),{closeDialog:l}=y();function i(c){t({page:1,...c}),l()}return e.jsx(I,{schema:_,onSubmit:i,className:"flex-1 flex flex-col min-h-0",defaultValues:{startDate:(a==null?void 0:a.startDate)||"",endDate:(a==null?void 0:a.endDate)||"",description:(a==null?void 0:a.description)||"",overallStatus:(a==null?void 0:a.overallStatus)||p.PAID},replaceEmptyStringToNull:!1,children:e.jsx(U,{})})}function U(){const{reset:a}=H(),{handleAccountsReceivableFilter:t}=f(),{closeDialog:l}=y();function i(){t(h),a(h),l()}return e.jsxs(e.Fragment,{children:[e.jsxs(S.Body,{className:"flex flex-col gap-4",children:[e.jsx(m,{label:"Descrição",name:"description"}),e.jsx(m,{name:"startDate",label:"Data inicial de criação",type:"date"}),e.jsx(m,{name:"endDate",label:"Data final de criação",type:"date"}),e.jsx(M,{label:"Status geral"}),e.jsx("div",{className:"flex flex-col gap-2",children:e.jsxs(x,{hideErrorLabel:!0,children:[e.jsx(x.Radio,{name:"overallStatus",label:"Pago",value:p.PAID}),e.jsx(x.Radio,{name:"overallStatus",label:"Pendente",value:p.PENDING})]})})]}),e.jsx(S.Footer,{primaryLabel:"Aplicar",secondaryLabel:"Limpar",onSecondaryCallback:i,dirty:!0})]})}const O=u.memo(K);function G({accountReceivableId:a,vehicleSaleId:t}){const l=E();return e.jsxs(e.Fragment,{children:[e.jsx(b,{content:"Detalhes da venda",children:e.jsx(g,{variant:"quaternary",iconLeft:"CurrencyExchange",onClick:()=>l(`/vehicle-sale/view/${t}`),resource:"VEHICLE_SALE",action:"READ",padding:"none","data-cy":`button-view-vehicleSale-${t}`})}),e.jsx(b,{content:"Detalhes do pagamento",children:e.jsx(g,{variant:"quaternary",iconLeft:"ReceiptLong",onClick:()=>l(`/accounts-receivable/${a}/installments`),resource:"ACCOUNTS_RECEIVABLE",action:"READ",padding:"none","data-cy":`button-edit-accountReceivable-${a}`})})]})}const A=10;function Q(){const{safeFetch:a}=F(),{accountsReceivableFilter:t,handleAccountsReceivableFilter:l}=f();function i(r){l({page:r})}const c=u.useMemo(()=>t?B(t):"",[t]);async function d(r){return await a(`${P}/account-receivable/search?${r}&orderBy=description`,{resource:"ACCOUNTS_RECEIVABLE",action:"READ"})}const{data:o,isFetching:j}=L({queryKey:["accounts-receivable",c],queryFn:({queryKey:r})=>d(r[1]),select:q}),D=u.useMemo(()=>o!=null&&o.data.length?Math.max(...o.data.map(r=>r.totalValue.length)):0,[o==null?void 0:o.data]);return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex gap-4 justify-end",children:[e.jsx(T,{fileName:"Relatório Contas a Receber",queryKey:["accounts-receivable",c],queryFn:d,selectQueryFn:w,formatFilters:{description:"Descrição",endDate:"Data final",startDate:"Data inicial",overallStatus:"Status geral"},formatFiltersValues:{overallStatus:{PAID:"Pago",PENDING:"Pendente"}},formatColumns:{description:"Descrição",date:"Data de venda",receivedFrom:"Recebido de",overallStatus:"Status geral",totalValue:"Valor total"}}),e.jsx(s.Filter,{form:e.jsx(O,{})})]}),e.jsxs(s,{children:[e.jsxs(s.Header,{gridColumns:A,children:[e.jsx(s.Head,{label:n.description.label}),e.jsx(s.Head,{label:n.date.label}),e.jsx(s.Head,{label:n.receivedFrom.label}),e.jsx(s.Head,{label:n.overallStatus.label,colSpan:n.overallStatus.colSpan}),e.jsx(s.Head,{label:n.totalValue.label}),e.jsx(s.Head,{action:!0})]}),e.jsx(s.Body,{isLoading:j,isEmpty:!(o!=null&&o.total),resource:"ACCOUNTS_RECEIVABLE",action:"READ",children:o==null?void 0:o.data.map(r=>e.jsxs(s.Row,{gridColumns:A,children:[e.jsx(s.Cell,{label:r.description,columnLabel:n.description.label}),e.jsx(s.Cell,{label:r.date,columnLabel:n.date.label}),e.jsx(s.Cell,{label:r.receivedFrom,columnLabel:n.receivedFrom.label}),e.jsx(s.Cell,{label:e.jsx(R,{status:r.overallStatus}),columnLabel:n.overallStatus.label,colSpan:n.overallStatus.colSpan}),e.jsx(s.Cell,{label:r.totalValue.padStart(D,N),className:"font-mono whitespace-pre",columnLabel:n.totalValue.label}),e.jsx(s.Action,{children:e.jsx(G,{accountReceivableId:String(r.id),vehicleSaleId:String(r.vehicleSaleId)})})]},r.id))}),e.jsx(s.Footer,{currentStartItem:t==null?void 0:t.page,totalItems:o==null?void 0:o.total,onClickNavigateBtn:i,isLoading:j})]})]})}function z(){return e.jsxs("div",{className:"flex flex-col gap-4 h-full w-full",children:[e.jsx(V,{title:"Vendas"}),e.jsx(Q,{})]})}function ce(){return e.jsx(k,{children:e.jsx(z,{})})}export{ce as default};
