import{r as m,j as e,u as D,a as V,b as C,c as S,B as N,d as v,e as F,T as E,f as h,v as b,g as A,V as H}from"./index-CwQymCQa.js";import{P as T}from"./PageHeader-ciO4E3wM.js";import{u as I}from"./DialogContext-qdOZWBM2.js";import{u as j,f as B}from"./react-pdf.browser-IDMxSf8g.js";import{E as P}from"./ExportButton-CPuXLC1o.js";import{S as g,T as s}from"./Table-C7F72B_O.js";import{D as p}from"./Dialog-D_sfX160.js";import{F as $,u as q,I as y}from"./schemas-BL4SC9at.js";import{S as k}from"./index-DIacthnF.js";import{u as L}from"./useDialogContext-CYt-LWKG.js";import"./useIsFetching-DbLUeXt5.js";const R=m.createContext(null);function w({children:t}){const[a,o]=m.useState("");function i(c){o(c)}const r=m.useMemo(()=>({example:a,handleExample:i}),[a]);return e.jsx(R.Provider,{value:r,children:t})}function M(t){const a=[];for(const o of t.data)a.push({...o});return{total:t.total,data:a}}function K(t){const a=[];for(const o of t.data)a.push({...o});return a}function Y({vehicleId:t,plateNumber:a,...o}){const{safeFetch:i}=D(),{showSuccessSnackbar:r}=V(),c=C(),{handleVehiclesFilter:x}=j();async function d(){await i(`${v}/vehicle/${t}`,{method:"DELETE",body:{archivedAt:new Date().toISOString()},resource:"VEHICLES",action:"DELETE"})}const{mutate:u,isPending:l}=S({mutationFn:d,onSuccess:()=>{x({page:1}),c.invalidateQueries({queryKey:["vehicles"]}),r({title:`Veículo ${a} desativado com sucesso`}),o.closeDialog()}});return e.jsxs(p,{...o,children:[e.jsx(p.Header,{title:"Desativar veículo"}),e.jsx(p.Body,{children:e.jsxs("span",{className:"text-body-medium text-neutral-700",children:["Tem certeza que deseja desativar o veículo",e.jsxs("span",{className:"font-bold",children:[N,a]}),"? Ao desativar os registros relacionados a ele não serão mais acessíveis"]})}),e.jsx(p.Footer,{labelPrimaryBtn:"Desativar",onClickPrimaryBtn:u,primaryBtnState:l?"loading":void 0,primaryBtnColor:"red",primaryBtnResource:"VEHICLES",primaryBtnAction:"DELETE"})]})}function Q({vehicleId:t,plateNumber:a,isActive:o,handleDisableVehicleInfo:i}){const r=F(),{safeFetch:c}=D(),{showSuccessSnackbar:x}=V(),d=C();async function u(){await c(`${v}/vehicle/${t}`,{method:"DELETE",body:{archivedAt:null},resource:"VEHICLES",action:"DELETE"})}const{mutate:l,isPending:f}=S({mutationFn:u,onSuccess:()=>{d.invalidateQueries({queryKey:["vehicles"]}),x({title:`Veículo ${a} ativado com sucesso`})}});return o?e.jsxs(e.Fragment,{children:[e.jsx(E,{content:"Editar",children:e.jsx(h,{variant:"quaternary",iconLeft:"Edit",onClick:()=>r(`/vehicles/edit/${t}`),resource:"VEHICLES",action:"UPDATE",padding:"none","data-cy":`button-edit-vehicle-${t}`})}),e.jsx(E,{content:"Histórico",children:e.jsx(h,{variant:"quaternary",iconLeft:"History",onClick:()=>r(`/vehicles/expense/${t}`),resource:"VEHICLES",action:"READ",padding:"none","data-cy":`button-vehicle-expense-${t}`})}),e.jsx(E,{content:"Desativar",children:e.jsx(h,{variant:"primary",iconLeft:"Delete",color:"red",padding:"none",onClick:()=>i({plateNumber:a,vehicleId:t}),resource:"VEHICLES",action:"DELETE","data-cy":`button-disable-vehicle-${t}`})})]}):e.jsx(E,{content:"Ativar",children:e.jsx(h,{variant:"quaternary",onClick:l,state:f?"loading":void 0,resource:"VEHICLES",action:"DELETE",padding:"none",iconLeft:"ToggleOn","data-cy":`button-enable-vehicle-${t}`})})}function O(){const{vehiclesFilter:t,handleVehiclesFilter:a}=j(),{closeDialog:o}=L();function i(r){a({page:1,...r}),o()}return e.jsx($,{schema:k,onSubmit:i,className:"flex-1 flex flex-col",defaultValues:{startDate:(t==null?void 0:t.startDate)||"",endDate:(t==null?void 0:t.endDate)||""},replaceEmptyStringToNull:!1,children:e.jsx(z,{})})}function z(){const{reset:t}=q(),{handleVehiclesFilter:a}=j(),{closeDialog:o}=L();function i(){a(b),t(b),o()}return e.jsxs(e.Fragment,{children:[e.jsxs(g.Body,{className:"flex flex-col gap-4",children:[e.jsx(y,{name:"startDate",label:"Data inicial",type:"date"}),e.jsx(y,{name:"endDate",label:"Data final",type:"date"})]}),e.jsx(g.Footer,{primaryLabel:"Aplicar",secondaryLabel:"Limpar",onSecondaryCallback:i,dirty:!0})]})}const U=m.memo(O);function _(){const[t,a]=m.useState({plateNumber:"",vehicleId:""}),o=I(),{vehiclesFilter:i,handleVehiclesFilter:r}=j();function c(n){o.openDialog(),a(n)}function x(n){r({page:n})}const d=m.useMemo(()=>i?B(i):"",[i]);async function u(n){return console.log("filter: ",n),{total:3,data:[{id:1,modelName:"Fusca",plateNumber:"ABC-1234",modelYear:"1970",status:"DELIVERED",archivedAt:void 0},{id:2,modelName:"Civic",plateNumber:"XYZ-5678",modelYear:"2020",status:"IN_STOCK",archivedAt:void 0},{id:3,modelName:"Corolla",plateNumber:"LMN-9101",modelYear:"2021",status:"MAINTENANCE",archivedAt:void 0}]}}const{data:l,isFetching:f}=A({queryKey:["vehicles",d],queryFn:({queryKey:n})=>u(n[1]),select:M});return e.jsxs(e.Fragment,{children:[e.jsx(Y,{...t,...o}),e.jsxs("div",{className:"flex gap-4 justify-end",children:[e.jsx(P,{fileName:"Relatório Veículos",resource:"VEHICLES",queryKey:["vehicles",d],queryFn:u,selectQueryFn:K,formatFilters:{endDate:"Data final",startDate:"Data inicial"},formatFiltersValues:{},formatColumns:{id:"ID",modelName:"Modelo",plateNumber:"Placa",modelYear:"Ano do modelo",status:"Status"}}),e.jsx(s.Filter,{form:e.jsx(U,{})})]}),e.jsxs(s,{children:[e.jsxs(s.Header,{children:[e.jsx(s.Head,{label:"ID"}),e.jsx(s.Head,{label:"Modelo"}),e.jsx(s.Head,{label:"Placa"}),e.jsx(s.Head,{label:"Ano do modelo"}),e.jsx(s.Head,{label:"Status"}),e.jsx(s.Head,{action:!0})]}),e.jsx(s.Body,{isLoading:f,isEmpty:!(l!=null&&l.total),resource:"VEHICLES",action:"READ",children:l==null?void 0:l.data.map(n=>e.jsxs(s.Row,{children:[e.jsx(s.Cell,{label:String(n.id)}),e.jsx(s.Cell,{label:n.modelName}),e.jsx(s.Cell,{label:n.plateNumber}),e.jsx(s.Cell,{label:n.modelYear}),e.jsx(s.Cell,{label:H[n.status]}),e.jsx(s.Action,{children:e.jsx(Q,{isActive:!n.archivedAt,vehicleId:String(n.id),plateNumber:n.plateNumber,handleDisableVehicleInfo:c})})]},n.id))}),e.jsx(s.Footer,{currentStartItem:i==null?void 0:i.page,totalItems:l==null?void 0:l.total,onClickNavigateBtn:x,isLoading:f})]})]})}function X(){const t=F();return e.jsxs("div",{className:"flex flex-col gap-4 h-full w-full",children:[e.jsx(T,{title:"Veículos Disponíveis",children:e.jsx(h,{label:"Adicionar veículo",iconLeft:"Add",onClick:()=>t("/vehicles/new"),resource:"VEHICLES",action:"CREATE",color:"green","data-cy":"new-vehicle-button"})}),e.jsx(_,{})]})}function le(){return e.jsx(w,{children:e.jsx(X,{})})}export{le as default};
