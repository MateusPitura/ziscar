import{r as C,h as v,i as D,s as S,j as e,w as k,B as g,x as A,l as q,m as R,g as I,y as N,z as V,P as L}from"./index-Ch3bubzI.js";import{e as _,f as i,F as U}from"./schemas-Cd82lAeS.js";import{P as H,C as b}from"./Choice-BI-6q2Kf.js";import{F as G,S as F,a as s,P as O}from"./PageFooter-CEkJ7fPp.js";import{a as p,u as T,b as K}from"./Dialog-rg_VNm6h.js";function M(){const[n,l]=C.useState(""),{setValue:t,trigger:d,getValues:o,watch:c}=_(),{safeFetch:u}=v(),{showErrorSnackbar:m}=D();async function f(a){return await u(`https://viacep.com.br/ws/${a}/json/`,{enableCookie:!1})}const{data:r,isFetching:x}=S({queryKey:["cepApi",n],queryFn:({queryKey:a})=>f(a[1]),enabled:!!n});C.useEffect(()=>{if(r!=null&&r.erro){m({description:"CEP não encontrado"});return}r&&(t("address.0.street",r.logradouro,{shouldDirty:!0}),t("address.0.neighborhood",r.bairro,{shouldDirty:!0}),t("address.0.cityIbgeCode",r.ibge,{shouldDirty:!0}),t("address.0.state",r.uf,{shouldDirty:!0}))},[r,t,m]);async function E(a){return a?await u(`https://servicodados.ibge.gov.br/api/v1/localidades/estados/${a}/municipios`,{enableCookie:!1}):[]}const j=c("address.0.state"),{data:P,isFetching:B}=S({queryKey:["ibgeApi",j],queryFn:({queryKey:a})=>E(a[1]),enabled:!!j,select:a=>a==null?void 0:a.map(h=>({value:String(h.id),label:h.nome}))});async function y(){if(await d("address.0.cep")){const h=o("address.0.cep");l(h)}}function w(a){a.key==="Enter"&&(a.preventDefault(),y())}return e.jsx(G,{name:"address",appendText:"Adicionar endereço",removeText:"Remover endereço",maxLength:1,appendDefaultValues:k,render:()=>e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center justify-between gap-1",onKeyDown:w,children:[e.jsx(i,{label:"CEP",name:"address.0.cep",mask:"cep",maxLength:9,required:!0,forceUnselect:!0}),e.jsx(g,{variant:"quaternary",label:"Preencher automaticamente",onClick:y,padding:"none",state:x?"loading":void 0})]}),e.jsx(i,{label:"Número",name:"address.0.number",required:!0}),e.jsx(i,{label:"Rua",name:"address.0.street"}),e.jsx(i,{label:"Bairro",name:"address.0.neighborhood"}),e.jsx(F,{label:"Estado",name:"address.0.state",options:A,onChange:()=>t("address.0.cityIbgeCode","",{shouldDirty:!0})}),e.jsx(F,{label:"Cidade",name:"address.0.cityIbgeCode",options:P||[],loading:B,disabled:!j})]})})}function $({...n}){const{safeFetch:l}=v(),{showSuccessSnackbar:t}=D();async function d(){await l(`${R}/auth/request-change-password`,{method:"POST"})}const{mutate:o,isPending:c}=q({mutationFn:d,onSuccess:()=>{t({title:"Um email será enviado",description:"Confira também a caixa de spam"}),n.closeDialog()}});return e.jsxs(p,{...n,children:[e.jsx(p.Header,{title:"Alteração de senha"}),e.jsx(p.Body,{children:"Caso deseje alterar a senha, clique no botão abaixo e siga as instruções enviadas para seu email"}),e.jsx(p.Footer,{labelSecondaryBtn:"Cancelar",onClickPrimaryBtn:o,labelPrimaryBtn:"Solicitar alteração",onClickSecondaryBtn:n.closeDialog,primaryBtnState:c?"loading":void 0})]})}function Y({defaultValues:n,onSubmit:l,isPending:t,headerTitle:d,isEdit:o=!1,resource:c,action:u,allowEditRole:m=!1,allowChangePassword:f=!1}){const r=I(),x=T();return e.jsxs(e.Fragment,{children:[e.jsx($,{...x}),e.jsx("div",{className:"flex flex-col gap-4 w-full",children:e.jsxs(U,{schema:K,defaultValues:n,onSubmit:l,className:"gap-4 flex flex-col flex-1",onlyDirty:o,children:[e.jsx(H,{title:d}),e.jsx("div",{className:"flex justify-center flex-1",children:e.jsxs(s,{children:[e.jsxs(s.Group,{children:[e.jsx(s.Header,{title:"Dados"}),e.jsxs(s.Body,{children:[e.jsx(i,{name:"fullName",label:"Nome completo",required:!0,autoFocus:!0}),e.jsx(i,{name:"email",label:"Email",required:!0,disabled:o,type:"email"}),e.jsx(i,{name:"phone",label:"Celular",mask:"phone",maxLength:15,type:"tel"}),e.jsx(i,{name:"cpf",label:"CPF",mask:"cpf",maxLength:14})]})]}),e.jsxs(s.Group,{children:[e.jsx(s.Header,{title:"Endereço"}),e.jsx(s.Body,{children:e.jsx(M,{})})]}),m&&e.jsxs(s.Group,{children:[e.jsx(s.Header,{title:"Categoria"}),e.jsx(s.Body,{children:e.jsxs(b,{children:[e.jsx(b.Radio,{name:"roleId",label:"Administrador",value:String(N)}),e.jsx(b.Radio,{name:"roleId",label:"Vendedor",value:String(V)})]})})]}),f&&e.jsxs(s.Group,{children:[e.jsx(s.Header,{title:"Segurança"}),e.jsx(s.Body,{children:e.jsx(g,{label:"Alterar senha",onClick:()=>x.openDialog()})})]})]})}),e.jsxs(O,{primaryBtnState:t?"loading":void 0,dirty:!0,children:[e.jsx(g,{color:"lightBlue",iconRight:"Save",label:"Salvar",resource:c,action:u}),e.jsx(g,{color:"red",iconRight:"Close",label:"Cancelar",onClick:()=>r(L)})]})]})})]})}export{Y as U};
