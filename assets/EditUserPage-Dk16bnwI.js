import{r as o,j as n,h as g,i as P,g as A,k as v,v as j,s as C,l as F,S as R,m as d}from"./index-Ch3bubzI.js";import{u as q}from"./useIsFetching-aSquAk6R.js";import{U as w}from"./UserForm-DgJbaBZX.js";import{d as m}from"./schemas-Cd82lAeS.js";import{s as I,p as N}from"./parseAddressPayload--LgIBwYN.js";import"./Choice-BI-6q2Kf.js";import"./PageFooter-CEkJ7fPp.js";import"./Dialog-rg_VNm6h.js";const K=o.createContext(null);function $({children:e}){const[r,i]=o.useState(!1);function u(t){i(t)}const a=o.useMemo(()=>({example:r,handleExample:u}),[r]);return n.jsx(K.Provider,{value:a,children:e})}function b(e){var r;return{fullName:e.fullName,email:e.email,phone:m(e.phone,"phone")??"",cpf:m(e.cpf,"cpf")??"",roleId:((r=e.roleId)==null?void 0:r.toString())??"",address:I(e.address)}}function k(){const{safeFetch:e}=g(),{showSuccessSnackbar:r}=P(),i=q({queryKey:["cepApi"]}),u=A(),a=v(),{userId:t}=j();async function f(){return await e(`${d}/user/${t}`,{resource:"USERS",action:"READ"})}const{data:s,isFetching:p}=C({queryKey:["user",t],queryFn:f,select:b});async function y(h){const{address:x,...U}=h,l=N({newAddress:x,oldAddress:s==null?void 0:s.address});await e(`${d}/user/${t}`,{method:"PATCH",body:{...U,...l&&{address:l}},resource:"USERS",action:"UPDATE"})}const{mutate:E,isPending:S,isSuccess:c}=F({mutationFn:y,onSuccess:async()=>{r({title:`Usuário ${s==null?void 0:s.fullName} atualizado com sucesso`}),a.invalidateQueries({queryKey:["users"]}),u("/users")}});return o.useEffect(()=>()=>{c&&a.invalidateQueries({queryKey:["user",t]})},[c,a,t]),p?n.jsx("div",{className:"flex justify-center items-center h-full w-full",children:n.jsx(R,{})}):s&&n.jsx(w,{defaultValues:s,onSubmit:E,isPending:S||!!i,headerTitle:"Alterar usuário",isEdit:!0,resource:"USERS",action:"UPDATE",allowEditRole:!0})}function V(){return n.jsx($,{children:n.jsx(k,{})})}export{V as default};
