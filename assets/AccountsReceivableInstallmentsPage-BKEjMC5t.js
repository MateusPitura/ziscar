import{a as D,i as P,n as x,u as p,f as j,j as e,k as T,e as b,t as f,T as I,S as F,aO as v,b as q,c as B,d as N,aP as V,aQ as w,r as E,aR as c,B as H}from"./index-CrVTpVTI.js";import{P as O}from"./PageHeader-DARJqnt5.js";import{T as o}from"./Table-CQjU_dFI.js";import{A as U}from"./AccountStatus-BNzGywzN.js";import{u as _}from"./DialogContext-3LqbYYdn.js";import{D as y}from"./Dialog-BHTFXl4K.js";import{D as R}from"./DataField-CmnNFbKB.js";import{F as $,I as K,u as k}from"./schemas-B7gcU9vp.js";import{C as M}from"./Choice-LKCp7m0f.js";import{a as Q}from"./index-CSTR5eNx.js";import{u as z}from"./useIsFetching-Dh2N-bBa.js";import"./useButtonState-C7TXS9Jx.js";import"./dialog-Ct9-qcrh.js";function G(a){return{...a,totalValue:D(a.totalValue,"money")??""}}function J(){const a=P(),{accountReceivableId:n}=x(),{safeFetch:i}=p();async function u(){return await i(`${b}/account-receivable/${n}`,{resource:"ACCOUNTS_RECEIVABLE",action:"READ"})}const{data:t}=j({queryKey:["account-receivable",n],queryFn:u,select:G});return e.jsx(O,{title:t!=null&&t.description?`Detalhes do Pagamento "${t.description}"`:"Detalhes do Pagamento",children:e.jsx(T,{variant:"quaternary",label:"Voltar",iconLeft:"ArrowBack",onClick:()=>a("/accounts-receivable"),action:"READ",resource:"ACCOUNTS_RECEIVABLE","data-cy":"back-accounts-receivable-button"})})}function W(a){var i,u;const n=[];for(const t of a){const d=[];for(const r of t.paymentMethodReceivables)d.push({...r,paymentDate:r.paymentDate?f({date:(i=r.paymentDate)==null?void 0:i.split("T")[0],format:"dd/MM/yyyy"}):""});n.push({...t,dueDate:t.dueDate?f({date:(u=t.dueDate)==null?void 0:u.split("T")[0],format:"dd/MM/yyyy"}):"",value:D(t.value,"money")??"",paymentMethodReceivables:d})}return n}function X({installment:a,handleInstallmentToPaymentMethodInfo:n}){if(!a.paymentMethodReceivables.length)return e.jsx(I,{content:"Adicionar método de pagamento",children:e.jsx(T,{variant:"quaternary",iconLeft:"AddCard",onClick:()=>n(a),resource:"ACCOUNTS_RECEIVABLE",action:"READ",padding:"none","data-cy":`button-edit-addPaymentMethod-${a.id}`})})}function Y(a){return{...a,paymentDate:f({date:a.paymentDate,format:"dd/MM/yyyy"})??""}}function Z({installment:a,...n}){const{safeFetch:i}=p();async function u(){var s;const r=await i(`${b}/account-receivable-installments/payment-method/${a==null?void 0:a.id}`,{resource:"ACCOUNTS_RECEIVABLE",action:"READ"});return(s=r==null?void 0:r.paymentMethodReceivables)==null?void 0:s[0]}const{data:t,isFetching:d}=j({queryKey:["accounts-receivable-payment-method",a.id],queryFn:u,select:Y});return e.jsxs(y,{...n,children:[e.jsx(y.Header,{title:"Detalhes do Método de Pagamento"}),e.jsx(y.Body,{children:e.jsx("div",{className:"flex flex-col gap-4 h-36 mb-8",children:d?e.jsx("div",{className:"flex justify-center items-center h-full w-full",children:e.jsx(F,{})}):e.jsxs(e.Fragment,{children:[e.jsx(R,{label:"Data do pagamento",value:t==null?void 0:t.paymentDate}),e.jsx(R,{label:"Forma de pagamento",value:t&&v[t==null?void 0:t.type]})]})})})]})}function ee({installment:a,...n}){const{safeFetch:i}=p(),{showSuccessSnackbar:u}=q(),t=B(),{accountReceivableId:d}=x();async function r(m){await i(`${b}/account-receivable-installments/payment-method/${a.id}`,{method:"POST",body:m,resource:"ACCOUNTS_RECEIVABLE",action:"CREATE"})}const{mutate:s,isPending:h}=N({mutationFn:r,onSuccess:()=>{u({title:"Método de pagamento adicionado"}),t.invalidateQueries({queryKey:["accounts-receivable-installments",d]}),t.invalidateQueries({queryKey:["accounts-receivable-payment-method",String(a.id)]}),t.invalidateQueries({queryKey:["accounts-receivable"]}),n.closeDialog()}});return e.jsxs(y,{...n,children:[e.jsx(y.Header,{title:"Adicionar Método de Pagamento"}),e.jsx(y.Body,{children:e.jsxs($,{schema:Q,defaultValues:V,onSubmit:s,className:"flex flex-col gap-4",children:[e.jsx(K,{name:"paymentDate",label:"Data do pagamento",required:!0,type:"date"}),e.jsx(k,{label:"Forma de pagamento",required:!0}),e.jsx("div",{className:"flex flex-col gap-2",children:e.jsx(M,{required:!0,children:Object.values(w).map(m=>e.jsx(M.Radio,{label:v[m],name:"type",value:m},m))})}),e.jsx(y.Footer,{labelPrimaryBtn:"Adicionar",className:"px-0",dirty:!1,primaryBtnState:h?"loading":void 0,primaryBtnResource:"ACCOUNTS_RECEIVABLE",primaryBtnAction:"CREATE"})]})})]})}function ae({installment:a,...n}){if(a)return a.paymentMethodReceivables.length?e.jsx(Z,{installment:a,...n}):e.jsx(ee,{installment:a,...n})}const S=11;function te(){const{safeFetch:a}=p(),{accountReceivableId:n}=x(),[i,u]=E.useState(null),t=_();function d(l){t.openDialog(),u(l)}async function r(){return await a(`${b}/account-receivable-installments/by-account/${n}`,{resource:"ACCOUNTS_RECEIVABLE",action:"READ"})}const{data:s,isFetching:h}=j({queryKey:["accounts-receivable-installments",n],queryFn:r,select:W}),m=E.useMemo(()=>s!=null&&s.length?Math.max(...s.map(l=>l.value.length)):0,[s]);return e.jsxs(e.Fragment,{children:[e.jsx(ae,{installment:i,...t}),e.jsxs(o,{children:[e.jsxs(o.Header,{gridColumns:S,children:[e.jsx(o.Head,{label:c.installmentSequence.label,colSpan:c.installmentSequence.colSpan}),e.jsx(o.Head,{label:c.dueDate.label}),e.jsx(o.Head,{label:c.paymentDate.label}),e.jsx(o.Head,{label:c.paymentMethod.label}),e.jsx(o.Head,{label:c.status.label}),e.jsx(o.Head,{label:c.value.label,colSpan:c.installmentSequence.colSpan}),e.jsx(o.Head,{action:!0})]}),e.jsx(o.Body,{isLoading:h,isEmpty:!(s!=null&&s.length),resource:"ACCOUNTS_RECEIVABLE",action:"READ",children:s==null?void 0:s.map(l=>{var A,g,C;return e.jsxs(o.Row,{gridColumns:S,children:[e.jsx(o.Cell,{columnLabel:c.installmentSequence.label,colSpan:c.installmentSequence.colSpan,label:l.isUpfront?"Entrada":`${l.installmentSequence}/${(A=s.filter(L=>!L.isUpfront))==null?void 0:A.length}`}),e.jsx(o.Cell,{columnLabel:c.dueDate.label,label:l.dueDate}),e.jsx(o.Cell,{columnLabel:c.paymentDate.label,label:(g=l.paymentMethodReceivables)!=null&&g.length?l.paymentMethodReceivables[0].paymentDate:""}),e.jsx(o.Cell,{columnLabel:c.paymentMethod.label,label:(C=l.paymentMethodReceivables)!=null&&C.length?v[l.paymentMethodReceivables[0].type]:""}),e.jsx(o.Cell,{columnLabel:c.status.label,label:e.jsx(U,{status:l.status})}),e.jsx(o.Cell,{columnLabel:c.value.label,label:l.value.padStart(m,H),className:"font-mono whitespace-pre",colSpan:c.value.colSpan}),e.jsx(o.Action,{children:e.jsx(X,{installment:l,handleInstallmentToPaymentMethodInfo:d})})]},l.id)})})]})]})}function ne(){return z({queryKey:["account-receivable"]})?e.jsx("div",{className:"flex justify-center items-center h-full w-full",children:e.jsx(F,{})}):e.jsxs("div",{className:"flex flex-col gap-4 h-full w-full",children:[e.jsx(J,{}),e.jsx(te,{})]})}function fe(){return e.jsx(ne,{})}export{fe as default};
