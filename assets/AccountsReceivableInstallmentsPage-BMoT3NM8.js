import{a as E,f as P,k as x,u as y,h as b,j as e,g as M,e as h,t as f,T,S as D,aC as S,b as I,c as B,d as N,aD as q,aE as V,r as A,aF as L,B as w}from"./index-DLLA1f-v.js";import{P as H}from"./PageHeader-Bs9TDp09.js";import{T as o}from"./Table-By5z5vhx.js";import{a as $,A as U}from"./index-Bn4EDnu-.js";import{u as O}from"./useDialog-DlT6EUiq.js";import{D as d}from"./Dialog-D33IGNgm.js";import{D as C}from"./DataField-whfLL2N4.js";import{F as K,I as _,u as k}from"./schemas-Bhi0Dh6I.js";import{C as R}from"./Choice-BxW3kVCA.js";import{u as Q}from"./useIsFetching-Ce26lW8Z.js";import"./useButtonState-3b0McXTU.js";import"./dialog-BH6A_dKB.js";function z(a){return{...a,totalValue:E(a.totalValue,"money")??""}}function G(){const a=P(),{accountReceivableId:n}=x(),{safeFetch:r}=y();async function l(){return await r(`${h}/account-receivable/${n}`,{resource:"ACCOUNTS_RECEIVABLE",action:"READ"})}const{data:t}=b({queryKey:["account-receivable",n],queryFn:l,select:z});return e.jsx(H,{title:t!=null&&t.description?`Detalhes do Pagamento "${t.description}"`:"Detalhes do Pagamento",children:e.jsx(M,{variant:"quaternary",label:"Voltar",iconLeft:"ArrowBack",onClick:()=>a("/accounts-receivable"),action:"READ",resource:"ACCOUNTS_RECEIVABLE","data-cy":"back-accounts-receivable-button"})})}function J(a){const n=[];for(const r of a){const l=[];for(const t of r.paymentMethodReceivables)l.push({...t,paymentDate:t.paymentDate?f({date:t.paymentDate,format:"dd/MM/yyyy"}):""});n.push({...r,dueDate:r.dueDate?f({date:r.dueDate,format:"dd/MM/yyyy"}):"",value:E(r.value,"money")??"",paymentMethodReceivables:l})}return n}function W({installment:a,handleInstallmentToPaymentMethodInfo:n}){if(!a.paymentMethodReceivables.length)return e.jsx(T,{content:"Adicionar método de pagamento",children:e.jsx(M,{variant:"quaternary",iconLeft:"AddCard",onClick:()=>n(a),resource:"ACCOUNTS_RECEIVABLE",action:"READ",padding:"none","data-cy":`button-edit-addPaymentMethod-${a.id}`})})}function X(a){return{...a,paymentDate:f({date:a.paymentDate,format:"dd/MM/yyyy"})??""}}function Y({installment:a,...n}){const{safeFetch:r}=y();async function l(){var s;const i=await r(`${h}/account-receivable-installments/payment-method/${a==null?void 0:a.id}`,{resource:"ACCOUNTS_RECEIVABLE",action:"READ"});return(s=i==null?void 0:i.paymentMethodReceivables)==null?void 0:s[0]}const{data:t,isFetching:m}=b({queryKey:["accounts-receivable-payment-method",a.id],queryFn:l,select:X});return e.jsxs(d,{...n,children:[e.jsx(d.Header,{title:"Detalhes do Método de Pagamento"}),e.jsx(d.Body,{children:e.jsx("div",{className:"flex flex-col gap-4 h-36 mb-8",children:m?e.jsx("div",{className:"flex justify-center items-center h-full w-full",children:e.jsx(D,{})}):e.jsxs(e.Fragment,{children:[e.jsx(C,{label:"Data do pagamento",value:t==null?void 0:t.paymentDate}),e.jsx(C,{label:"Forma de pagamento",value:t&&S[t==null?void 0:t.type]})]})})})]})}function Z({installment:a,...n}){const{safeFetch:r}=y(),{showSuccessSnackbar:l}=I(),t=B(),{accountReceivableId:m}=x();async function i(u){await r(`${h}/account-receivable-installments/payment-method/${a.id}`,{method:"POST",body:u,resource:"ACCOUNTS_RECEIVABLE",action:"CREATE"})}const{mutate:s,isPending:p}=N({mutationFn:i,onSuccess:()=>{l({title:"Método de pagamento adicionado"}),t.invalidateQueries({queryKey:["accounts-receivable-installments",m]}),t.invalidateQueries({queryKey:["accounts-receivable-payment-method",String(a.id)]}),t.invalidateQueries({queryKey:["accounts-receivable"]}),n.closeDialog()}});return e.jsxs(d,{...n,children:[e.jsx(d.Header,{title:"Adicionar Método de Pagamento"}),e.jsx(d.Body,{children:e.jsxs(K,{schema:$,defaultValues:q,onSubmit:s,className:"flex flex-col gap-4",children:[e.jsx(_,{name:"paymentDate",label:"Data do pagamento",required:!0,type:"date"}),e.jsx(k,{label:"Forma de pagamento",required:!0}),e.jsx("div",{className:"flex flex-col gap-2",children:e.jsx(R,{required:!0,children:Object.values(V).map(u=>e.jsx(R.Radio,{label:S[u],name:"type",value:u},u))})}),e.jsx(d.Footer,{labelPrimaryBtn:"Adicionar",className:"px-0",dirty:!1,primaryBtnState:p?"loading":void 0,primaryBtnResource:"ACCOUNTS_RECEIVABLE",primaryBtnAction:"CREATE"})]})})]})}function ee({installment:a,...n}){if(a)return a.paymentMethodReceivables.length?e.jsx(Y,{installment:a,...n}):e.jsx(Z,{installment:a,...n})}function ae(){const{safeFetch:a}=y(),{accountReceivableId:n}=x(),[r,l]=A.useState(null),t=O();function m(c){t.openDialog(),l(c)}async function i(){return await a(`${h}/account-receivable-installments/by-account/${n}`,{resource:"ACCOUNTS_RECEIVABLE",action:"READ"})}const{data:s,isFetching:p}=b({queryKey:["accounts-receivable-installments",n],queryFn:i,select:J}),u=A.useMemo(()=>s!=null&&s.length?Math.max(...s.map(c=>c.value.length)):0,[s]);return e.jsxs(e.Fragment,{children:[e.jsx(ee,{installment:r,...t}),e.jsxs(o,{children:[e.jsxs(o.Header,{gridColumns:11,children:[e.jsx(o.Head,{label:"Sequência",colSpan:1}),e.jsx(o.Head,{label:"Data de vencimento "}),e.jsx(o.Head,{label:"Data de pagamento"}),e.jsx(o.Head,{label:"Método de pagamento"}),e.jsx(o.Head,{label:"Status do pagamento"}),e.jsx(o.Head,{label:"Valor",colSpan:1}),e.jsx(o.Head,{action:!0})]}),e.jsx(o.Body,{isLoading:p,isEmpty:!(s!=null&&s.length),resource:"ACCOUNTS_RECEIVABLE",action:"READ",children:s==null?void 0:s.map(c=>{var j,v,g;return e.jsxs(o.Row,{gridColumns:11,children:[e.jsx(o.Cell,{colSpan:1,label:c.isUpfront?"Entrada":`${c.installmentSequence}/${(j=s.filter(F=>!F.isUpfront))==null?void 0:j.length}`}),e.jsx(o.Cell,{label:c.dueDate}),e.jsx(o.Cell,{label:(v=c.paymentMethodReceivables)!=null&&v.length?c.paymentMethodReceivables[0].paymentDate:""}),e.jsx(o.Cell,{label:(g=c.paymentMethodReceivables)!=null&&g.length?L[c.paymentMethodReceivables[0].type]:""}),e.jsx(o.Cell,{label:e.jsx(U,{status:c.status})}),e.jsx(o.Cell,{label:c.value.padStart(u,w),className:"font-mono whitespace-pre",colSpan:1}),e.jsx(o.Action,{children:e.jsx(W,{installment:c,handleInstallmentToPaymentMethodInfo:m})})]},c.id)})})]})]})}function te(){return Q({queryKey:["account-receivable"]})?e.jsx("div",{className:"flex justify-center items-center h-full w-full",children:e.jsx(D,{})}):e.jsxs("div",{className:"flex flex-col gap-4 h-full w-full",children:[e.jsx(G,{}),e.jsx(ae,{})]})}function pe(){return e.jsx(te,{})}export{pe as default};
