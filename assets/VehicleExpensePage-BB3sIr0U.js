import{u as y,b as g,c as f,d as j,j as e,B as b,e as v,f as L,s as A,T as E,g as m,t as N,a as V,r as x,h as T,E as p,w as h,S as F}from"./index-DLLA1f-v.js";import{V as H}from"./VehicleExpenseHeader-Dswyw1GN.js";import{T as s}from"./Table-By5z5vhx.js";import{u as P}from"./useDialog-DlT6EUiq.js";import{D as u}from"./Dialog-D33IGNgm.js";import{D as w}from"./DataField-whfLL2N4.js";import{u as B}from"./useIsFetching-Ce26lW8Z.js";import"./PageHeader-Bs9TDp09.js";import"./useButtonState-3b0McXTU.js";import"./selectVehicleInfo-ycdfHdPz.js";import"./dialog-BH6A_dKB.js";function q({vehicleExpenseId:n,vehicleCategory:i,...o}){const{safeFetch:r}=y(),{showSuccessSnackbar:c}=g(),a=f();async function l(){await r(`${v}/vehicle-expense/${n}`,{method:"DELETE",body:{archivedAt:new Date().toISOString()},resource:"VEHICLE_EXPENSE",action:"DELETE"})}const{mutate:d,isPending:t}=j({mutationFn:l,onSuccess:()=>{a.invalidateQueries({queryKey:["vehicle-expenses"]}),c({title:"Gasto removido com sucesso"}),o.closeDialog()}});return e.jsxs(u,{...o,children:[e.jsx(u.Header,{title:"Remover gasto"}),e.jsx(u.Body,{children:e.jsxs("span",{className:"text-body-medium text-neutral-700",children:["Tem certeza que deseja remover o gasto de",e.jsxs("span",{className:"font-bold",children:[b,i]}),"? Ao remover ele não será mais acessível"]})}),e.jsx(u.Footer,{labelPrimaryBtn:"Remover",onClickPrimaryBtn:d,primaryBtnState:t?"loading":void 0,primaryBtnColor:"red",primaryBtnResource:"VEHICLE_EXPENSE",primaryBtnAction:"DELETE"})]})}function $({vehicleExpenseId:n,vehicleCategory:i,isActive:o,handleDisableVehicleExpenseInfo:r}){const c=L(),{pathname:a}=A(),{safeFetch:l}=y(),d=f(),{showSuccessSnackbar:t}=g();async function D(){await l(`${v}/vehicle-expense/${n}`,{method:"DELETE",body:{archivedAt:null},resource:"VEHICLE_EXPENSE",action:"DELETE"})}const{mutate:C,isPending:S}=j({mutationFn:D,onSuccess:()=>{d.invalidateQueries({queryKey:["vehicle-expenses"]}),t({title:`Gasto de ${i} ativado com sucesso`})}});return o?e.jsxs(e.Fragment,{children:[e.jsx(E,{content:"Editar",children:e.jsx(m,{variant:"quaternary",iconLeft:"Edit",onClick:()=>c(`${a}/edit/${n}`),resource:"VEHICLE_EXPENSE",action:"UPDATE",padding:"none","data-cy":`button-edit-vehicle-expense-${n}`})}),e.jsx(E,{content:"Desativar",children:e.jsx(m,{variant:"primary",iconLeft:"Delete",color:"red",padding:"none",onClick:()=>{r({vehicleExpenseId:n,vehicleCategory:i})},resource:"VEHICLE_EXPENSE",action:"DELETE","data-cy":`button-disable-vehicle-expense-${n}`})})]}):e.jsx(E,{content:"Ativar",children:e.jsx(m,{variant:"quaternary",onClick:C,state:S?"loading":void 0,resource:"VEHICLE_EXPENSE",action:"DELETE",padding:"none",iconLeft:"ToggleOn","data-cy":`button-enable-vehicle-expense-${n}`})})}function I(n){const i=[];for(const o of n)i.push({...o,totalValue:V(o.totalValue,"money")??"",competencyDate:N({date:o.competencyDate,format:"dd/MM/yyyy"})});return i}function k(){const[n,i]=x.useState({vehicleExpenseId:"",vehicleCategory:""}),o=P();function r(t){o.openDialog(),i(t)}async function c(){return[{id:1,category:h.MAINTENANCE,observations:"Troca de óleo",archivedAt:void 0,totalValue:"1500",competencyDate:"2023-10-01"},{id:2,category:h.FUEL,observations:"Abastecimento",archivedAt:void 0,totalValue:"300",competencyDate:"2023-10-05"},{id:3,category:h.INSURANCE,observations:"Seguro anual",archivedAt:void 0,totalValue:"1200",competencyDate:"2023-10-10"}]}const{data:a,isFetching:l}=T({queryKey:["vehicle-expenses"],queryFn:c,select:I}),d=x.useMemo(()=>a!=null&&a.length?Math.max(...a.map(t=>t.totalValue.length)):0,[a]);return e.jsxs(e.Fragment,{children:[e.jsx(q,{...n,...o}),e.jsx("div",{className:"w-fit",children:e.jsx(w,{label:"Total de gastos",value:V("1000000","money")})}),e.jsxs(s,{children:[e.jsxs(s.Header,{gridColumns:8,children:[e.jsx(s.Head,{label:"Data de competência"}),e.jsx(s.Head,{label:"Observações"}),e.jsx(s.Head,{label:"Categoria"}),e.jsx(s.Head,{label:"Valor",colSpan:1}),e.jsx(s.Head,{action:!0})]}),e.jsx(s.Body,{isLoading:l,isEmpty:!(a!=null&&a.length),resource:"VEHICLE_EXPENSE",action:"READ",children:a==null?void 0:a.map(t=>e.jsxs(s.Row,{gridColumns:8,children:[e.jsx(s.Cell,{label:t.competencyDate}),e.jsx(s.Cell,{label:t.observations}),e.jsx(s.Cell,{label:p[t.category]}),e.jsx(s.Cell,{label:t.totalValue.padStart(d,b),className:"font-mono whitespace-pre",colSpan:1}),e.jsx(s.Action,{children:e.jsx($,{vehicleExpenseId:String(t.id),vehicleCategory:p[t.category],handleDisableVehicleExpenseInfo:r,isActive:!t.archivedAt})})]},t.id))})]})]})}function M(){return B({queryKey:["vehicle"]})?e.jsx("div",{className:"flex justify-center items-center h-full w-full",children:e.jsx(F,{})}):e.jsxs("div",{className:"flex flex-col gap-4 h-full w-full",children:[e.jsx(H,{title:"Gastos do Veículo",showActions:!0}),e.jsx(k,{})]})}function Y(){return e.jsx(M,{})}export{Y as default};
