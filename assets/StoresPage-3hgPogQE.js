import{r as u,j as e,u as E,a as F,b as L,c as R,B as N,d as y,e as A,T as p,f as h,H as D,g as P}from"./index-CwQymCQa.js";import{P as $}from"./PageHeader-ciO4E3wM.js";import{S as C,T as t}from"./Table-C7F72B_O.js";import{u as b,f as O}from"./react-pdf.browser-IDMxSf8g.js";import{u as k}from"./DialogContext-qdOZWBM2.js";import{D as f}from"./Dialog-D_sfX160.js";import{s as w}from"./selectStoresInfo-KV0O_9jG.js";import{F as H,u as q,I as g,i as T}from"./schemas-BL4SC9at.js";import{C as d}from"./Choice-DMQtnXq8.js";import{S as I}from"./index-CPcyGKKl.js";import{u as B}from"./useDialogContext-CYt-LWKG.js";import"./index-DTctZbkD.js";const K=u.createContext(null);function M({children:a}){const[n,r]=u.useState("");function i(c){r(c)}const o=u.useMemo(()=>({example:n,handleExample:i}),[n]);return e.jsx(K.Provider,{value:o,children:a})}function Q({storeId:a,storeName:n,...r}){const{safeFetch:i}=E(),{showSuccessSnackbar:o}=F(),c=L(),{handleStoresFilter:m}=b();async function x(){await i(`${y}/store/${a}`,{method:"DELETE",body:{archivedAt:new Date().toISOString()},resource:"STORES",action:"DELETE"})}const{mutate:j,isPending:S}=R({mutationFn:x,onSuccess:()=>{m({page:1}),c.invalidateQueries({queryKey:["stores"]}),o({title:`Loja ${n} desativada com sucesso`}),r.closeDialog()}});return e.jsxs(f,{...r,children:[e.jsx(f.Header,{title:"Desativar loja"}),e.jsx(f.Body,{children:e.jsxs("span",{className:"text-body-medium text-neutral-700",children:["Tem certeza que deseja desativar a loja",e.jsxs("span",{className:"font-bold",children:[N,n]}),"? Ao desativar os registros relacionados a ela não serão mais acessíveis"]})}),e.jsx(f.Footer,{labelPrimaryBtn:"Desativar",onClickPrimaryBtn:j,primaryBtnState:S?"loading":void 0,primaryBtnColor:"red",primaryBtnResource:"STORES",primaryBtnAction:"DELETE"})]})}function z({storeId:a,name:n,isActive:r,handleDisableStoreInfo:i}){const o=A(),{safeFetch:c}=E(),{showSuccessSnackbar:m}=F(),x=L();async function j(){await c(`${y}/store/${a}`,{method:"DELETE",body:{archivedAt:null},resource:"STORES",action:"DELETE"})}const{mutate:S,isPending:l}=R({mutationFn:j,onSuccess:()=>{x.invalidateQueries({queryKey:["stores"]}),m({title:`Loja ${n} ativada com sucesso`})}});return r?e.jsxs(e.Fragment,{children:[e.jsx(p,{content:"Editar",children:e.jsx(h,{variant:"quaternary",iconLeft:"Edit",onClick:()=>o(`/stores/edit/${a}`),resource:"STORES",action:"UPDATE",padding:"none","data-cy":`button-edit-store-${a}`})}),e.jsx(p,{content:"Desativar",children:e.jsx(h,{variant:"primary",iconLeft:"Delete",color:"red",padding:"none",onClick:()=>i({storeName:n,storeId:a}),resource:"STORES",action:"DELETE","data-cy":`button-disable-store-${a}`})})]}):e.jsx(p,{content:"Ativar",children:e.jsx(h,{variant:"quaternary",onClick:S,state:l?"loading":void 0,resource:"STORES",action:"DELETE",padding:"none",iconLeft:"ToggleOn","data-cy":`button-enable-store-${a}`})})}function U(){const{storesFilter:a,handleStoresFilter:n}=b(),{closeDialog:r}=B();function i(o){n({page:1,...o}),r()}return e.jsx(H,{schema:I,onSubmit:i,className:"flex-1 flex flex-col",defaultValues:{name:(a==null?void 0:a.name)||"",orderBy:(a==null?void 0:a.orderBy)||"name",status:(a==null?void 0:a.status)||"active",startDate:(a==null?void 0:a.startDate)||"",endDate:(a==null?void 0:a.endDate)||""},replaceEmptyStringToNull:!1,children:e.jsx(V,{})})}function V(){const{reset:a}=q(),{handleStoresFilter:n}=b(),{closeDialog:r}=B();function i(){n(D),a(D),r()}return e.jsxs(e.Fragment,{children:[e.jsxs(C.Body,{className:"flex flex-col gap-4",children:[e.jsx(g,{name:"name",label:"Nome"}),e.jsx(T,{label:"Status"}),e.jsx("div",{className:"flex flex-col gap-2",children:e.jsxs(d,{hideErrorLabel:!0,children:[e.jsx(d.Radio,{name:"status",label:"Ativo",value:"active"}),e.jsx(d.Radio,{name:"status",label:"Inativo",value:"inactive"})]})}),e.jsx(g,{name:"startDate",label:"Data inicial",type:"date"}),e.jsx(g,{name:"endDate",label:"Data final",type:"date"}),e.jsx(T,{label:"Ordenar por"}),e.jsx("div",{className:"flex flex-col gap-2",children:e.jsxs(d,{hideErrorLabel:!0,children:[e.jsx(d.Radio,{name:"orderBy",label:"Nome",value:"name"}),e.jsx(d.Radio,{name:"orderBy",label:"Email",value:"email"})]})})]}),e.jsx(C.Footer,{primaryLabel:"Aplicar",secondaryLabel:"Limpar",onSecondaryCallback:i,dirty:!0})]})}const _=u.memo(U),G=!1;function J(){const[a,n]=u.useState({storeName:"",storeId:""}),r=k(),{safeFetch:i}=E(),{storesFilter:o,handleStoresFilter:c}=b();function m(s){r.openDialog(),n(s)}function x(s){c({page:s})}const j=u.useMemo(()=>o?O(o):"",[o]);async function S(s){return await i(`${y}/store?${s}`,{resource:"STORES",action:"READ"})}const{data:l,isFetching:v}=P({queryKey:["stores",j],queryFn:({queryKey:s})=>S(s[1]),select:w});return e.jsxs(e.Fragment,{children:[e.jsx(Q,{...a,...r}),e.jsxs("div",{className:"flex gap-4 justify-end",children:[G,e.jsx(t.Filter,{form:e.jsx(_,{})})]}),e.jsxs(t,{children:[e.jsxs(t.Header,{children:[e.jsx(t.Head,{label:"ID"}),e.jsx(t.Head,{label:"Nome"}),e.jsx(t.Head,{label:"Email"}),e.jsx(t.Head,{label:"Celular"}),e.jsx(t.Head,{label:"Status"}),e.jsx(t.Head,{action:!0})]}),e.jsx(t.Body,{isLoading:v,isEmpty:!(l!=null&&l.total),resource:"STORES",action:"READ",children:l==null?void 0:l.data.map(s=>e.jsxs(t.Row,{children:[e.jsx(t.Cell,{label:String(s.id)}),e.jsx(t.Cell,{label:s.name}),e.jsx(t.Cell,{label:s.email}),e.jsx(t.Cell,{label:s.phone}),e.jsx(t.Cell,{label:s.archivedAt?"Inativo":"Ativo"}),e.jsx(t.Action,{children:e.jsx(z,{isActive:!s.archivedAt,storeId:String(s.id),name:s.name,handleDisableStoreInfo:m})})]},s.id))}),e.jsx(t.Footer,{currentStartItem:o==null?void 0:o.page,totalItems:l==null?void 0:l.total,onClickNavigateBtn:x,isLoading:v})]})]})}function W(){const a=A();return e.jsxs("div",{className:"flex flex-col gap-4 h-full w-full",children:[e.jsx($,{title:"Lojas",children:e.jsx(h,{label:"Adicionar loja",iconLeft:"Add",onClick:()=>a("/stores/new"),resource:"STORES",action:"CREATE",color:"green","data-cy":"new-store-button"})}),e.jsx(J,{})]})}function ce(){return e.jsx(M,{children:e.jsx(W,{})})}export{ce as default};
