import{r as d,j as e,a as v,u as E,b as T,c as L,d as A,B as N,e as S,Z as D,i as R,l as C,f as B,_ as c}from"./index-BaodxefT.js";import{P}from"./PageHeader-BvWMz3kB.js";import{S as F,T as n}from"./Table-BxNCMX2w.js";import{D as p,u as $,b as O}from"./useDialog-B00w_pfZ.js";import{u as h,f as U}from"./react-pdf.browser-1tYw-4Ca.js";import{F as k,I as j,u as w}from"./schemas-C9qoDM_Y.js";import{u as M}from"./useDialogContext-DcEUxhEZ.js";import{C as g}from"./Choice-DG1qq5-b.js";import{S as q}from"./index-4BU45cC_.js";import"./index-CZBX8443.js";const H=d.createContext(null);function I({children:a}){const[s,t]=d.useState("");function i(u){t(u)}const o=d.useMemo(()=>({example:s,handleExample:i}),[s]);return e.jsx(H.Provider,{value:o,children:a})}function K(a){const s=[];for(const t of a.data)s.push({...t,phone:v(t==null?void 0:t.phone,"phone")??"",cpf:v(t==null?void 0:t.cpf,"cpf")??""});return{total:a.total,data:s}}function Q({customerId:a,customerFullName:s,...t}){const{safeFetch:i}=E(),{showSuccessSnackbar:o}=T(),u=L(),{handleCustomersFilter:m}=h();async function x(){await i(`${S}/customer/${a}`,{method:"DELETE",body:{archivedAt:new Date().toISOString()},resource:"CUSTOMERS",action:"DELETE"})}const{mutate:f,isPending:b}=A({mutationFn:x,onSuccess:()=>{m({page:1}),u.invalidateQueries({queryKey:["customers"]}),o({title:`Cliente ${s} desativado com sucesso`}),t.closeDialog()}});return e.jsxs(p,{...t,children:[e.jsx(p.Header,{title:"Desativar cliente"}),e.jsx(p.Body,{children:e.jsxs("span",{className:"text-body-medium text-neutral-700",children:["Tem certeza que deseja desativar o cliente",e.jsxs("span",{className:"font-bold",children:[N,s]}),"? Ao desativar os registros relacionados a ele não serão mais acessíveis"]})}),e.jsx(p.Footer,{labelPrimaryBtn:"Desativar",onClickPrimaryBtn:f,primaryBtnState:b?"loading":void 0,primaryBtnColor:"red",primaryBtnResource:"CUSTOMERS",primaryBtnAction:"DELETE"})]})}function _(){const{customersFilter:a,handleCustomersFilter:s}=h(),{closeDialog:t}=M();function i(o){s({page:1,...o}),t()}return e.jsx(k,{schema:q,onSubmit:i,className:"flex-1 flex flex-col min-h-0",defaultValues:{fullName:(a==null?void 0:a.fullName)||"",status:(a==null?void 0:a.status)||"active",startDate:(a==null?void 0:a.startDate)||"",endDate:(a==null?void 0:a.endDate)||""},replaceEmptyStringToNull:!1,children:e.jsx(z,{})})}function z(){const{reset:a}=$(),{handleCustomersFilter:s}=h(),{closeDialog:t}=M();function i(){s(D),a(D),t()}return e.jsxs(e.Fragment,{children:[e.jsxs(F.Body,{className:"flex flex-col gap-4",children:[e.jsx(j,{name:"fullName",label:"Nome completo"}),e.jsx(w,{label:"Status"}),e.jsx("div",{className:"flex flex-col gap-2",children:e.jsxs(g,{hideErrorLabel:!0,children:[e.jsx(g.Radio,{name:"status",label:"Ativo",value:"active"}),e.jsx(g.Radio,{name:"status",label:"Inativo",value:"inactive"})]})}),e.jsx(j,{name:"startDate",label:"Data inicial de criação",type:"date"}),e.jsx(j,{name:"endDate",label:"Data final de criação",type:"date"})]}),e.jsx(F.Footer,{primaryLabel:"Aplicar",secondaryLabel:"Limpar",onSecondaryCallback:i,dirty:!0})]})}const V=d.memo(_);function Z({customerId:a,fullName:s,isActive:t,handleDisableCustomerInfo:i}){const o=R(),{safeFetch:u}=E(),{showSuccessSnackbar:m}=T(),x=L();async function f(){await u(`${S}/customer/${a}`,{method:"DELETE",body:{archivedAt:null},resource:"CUSTOMERS",action:"DELETE"})}const{mutate:b,isPending:r}=A({mutationFn:f,onSuccess:()=>{x.invalidateQueries({queryKey:["customers"]}),m({title:`Cliente ${s} ativado com sucesso`})}});return t?e.jsxs(e.Fragment,{children:[e.jsx(C,{tooltipMessage:"Editar",variant:"quaternary",iconLeft:"Edit",onClick:()=>o(`/customers/edit/${a}`),resource:"CUSTOMERS",action:"UPDATE",padding:"none","data-cy":`button-edit-customer-${a}`}),e.jsx(C,{tooltipMessage:"Desativar",variant:"primary",iconLeft:"Delete",color:"red",padding:"none",onClick:()=>i({customerFullName:s,customerId:a}),resource:"CUSTOMERS",action:"DELETE","data-cy":`button-disable-customer-${a}`})]}):e.jsx(C,{tooltipMessage:"Ativar",variant:"quaternary",onClick:b,state:r?"loading":void 0,resource:"CUSTOMERS",action:"DELETE",padding:"none",iconLeft:"ToggleOn","data-cy":`button-enable-customer-${a}`})}const G=!1;function J(){const[a,s]=d.useState({customerFullName:"",customerId:""}),t=O(),{safeFetch:i}=E(),{customersFilter:o,handleCustomersFilter:u}=h();function m(l){t.openDialog(),s(l)}function x(l){u({page:l})}const f=d.useMemo(()=>o?U(o):"",[o]);async function b(l){return await i(`${S}/customer?${l}&orderBy=fullName`,{resource:"CUSTOMERS",action:"READ"})}const{data:r,isFetching:y}=B({queryKey:["customers",f],queryFn:({queryKey:l})=>b(l[1]),select:K});return e.jsxs(e.Fragment,{children:[e.jsx(Q,{...a,...t}),e.jsxs("div",{className:"flex gap-4 justify-end",children:[G,e.jsx(n.Filter,{form:e.jsx(V,{})})]}),e.jsxs(n,{children:[e.jsxs(n.Header,{children:[e.jsx(n.Head,{label:c.name.label}),e.jsx(n.Head,{label:c.cpf.label}),e.jsx(n.Head,{label:c.email.label}),e.jsx(n.Head,{label:c.phone.label}),e.jsx(n.Head,{label:c.status.label}),e.jsx(n.Head,{action:!0})]}),e.jsx(n.Body,{isLoading:y,isEmpty:!(r!=null&&r.total),resource:"CUSTOMERS",action:"READ",children:r==null?void 0:r.data.map(l=>e.jsxs(n.Row,{children:[e.jsx(n.Cell,{label:l.fullName,columnLabel:c.name.label}),e.jsx(n.Cell,{label:l.cpf,columnLabel:c.cpf.label}),e.jsx(n.Cell,{label:l.email,columnLabel:c.email.label}),e.jsx(n.Cell,{label:l.phone,columnLabel:c.phone.label}),e.jsx(n.Cell,{label:l.archivedAt?"Inativo":"Ativo",columnLabel:c.status.label}),e.jsx(n.Action,{children:e.jsx(Z,{isActive:!l.archivedAt,customerId:String(l.id),fullName:l.fullName,handleDisableCustomerInfo:m})})]},l.id))}),e.jsx(n.Footer,{currentStartItem:o==null?void 0:o.page,totalItems:r==null?void 0:r.total,onClickNavigateBtn:x,isLoading:y})]})]})}function ie({contextHelper:a}){const s=R();return e.jsx(I,{children:e.jsxs("div",{className:"flex flex-col gap-4 h-full w-full",children:[e.jsx(P,{title:"Clientes",contextHelper:a,children:e.jsx(C,{label:"Adicionar cliente",iconLeft:"Add",onClick:()=>s("/customers/new"),resource:"CUSTOMERS",action:"CREATE",color:"green","data-cy":"new-customer-button",tooltipMessage:"Adicionar cliente"})}),e.jsx(J,{})]})})}export{ie as default};
