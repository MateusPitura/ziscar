import{r as d,j as e,t as m,a as c,a3 as h,aI as C,i as N,l as b,u as V,f as M,aJ as n,B as T,e as B}from"./index-LO79eavt.js";import{P as w}from"./PageHeader-C8ixiw9T.js";import{S as H}from"./Switch-CcXLo5Fk.js";import{S as E,T as o}from"./Table-DGlZs8M8.js";import{A as k}from"./AccountStatus-Cejzuycb.js";import{D as p}from"./DataField-DvGceO3C.js";import{u as j,f as I}from"./react-pdf.browser-BkjHwKfS.js";import{E as _}from"./ExportButton-DYkkwfNM.js";import{F as $,I as f,u as q}from"./schemas-C0aL5P6j.js";import{u as U}from"./useDialog-pT-Uqh-i.js";import{u as F}from"./useDialogContext-oL-r0D91.js";import{S as O}from"./index-rewoCw4b.js";import{C as y}from"./Choice-BGWichA8.js";import"./Tag-CDvwg207.js";import"./useIsFetching-DT0DLOnX.js";const K=d.createContext(null);function G({children:t}){const[a,s]=d.useState("");function i(x){s(x)}const u=d.useMemo(()=>({example:a,handleExample:i}),[a]);return e.jsx(K.Provider,{value:u,children:t})}function Q(t){const a=[];for(const s of t.data)a.push({...s,totalValue:c(s.totalValue,"money")??"",date:s.date?m({date:s.date.split("T")[0],format:"dd/MM/yyyy"}):""});return{total:t.total,data:a,summary:t.summary}}function z(t){const a=[];for(const s of t.data)a.push({...s,totalValue:c(s.totalValue,"money")??"",overallStatus:s.overallStatus==="PAID"?"Pago":"Pendente",date:s.date?m({date:s.date.split("T")[0],format:"dd/MM/yyyy"}):""});return a}function J(){const{accountsReceivableFilter:t,handleAccountsReceivableFilter:a}=j(),{closeDialog:s}=F();function i(u){a({page:1,...u}),s()}return e.jsx($,{schema:O,onSubmit:i,className:"flex-1 flex flex-col min-h-0",defaultValues:{startDate:(t==null?void 0:t.startDate)||"",endDate:(t==null?void 0:t.endDate)||"",description:(t==null?void 0:t.description)||"",overallStatus:(t==null?void 0:t.overallStatus)||h.PAID},replaceEmptyStringToNull:!1,children:e.jsx(R,{})})}function R(){const{reset:t}=U(),{handleAccountsReceivableFilter:a}=j(),{closeDialog:s}=F();function i(){a(C),t(C),s()}return e.jsxs(e.Fragment,{children:[e.jsxs(E.Body,{className:"flex flex-col gap-4",children:[e.jsx(f,{label:"Descrição",name:"description"}),e.jsx(f,{name:"startDate",label:"Data inicial de criação",type:"date"}),e.jsx(f,{name:"endDate",label:"Data final de criação",type:"date"}),e.jsx(q,{label:"Status geral"}),e.jsx("div",{className:"flex flex-col gap-2",children:e.jsxs(y,{hideErrorLabel:!0,children:[e.jsx(y.Radio,{name:"overallStatus",label:"Pago",value:h.PAID}),e.jsx(y.Radio,{name:"overallStatus",label:"Pendente",value:h.PENDING})]})})]}),e.jsx(E.Footer,{primaryLabel:"Aplicar",secondaryLabel:"Limpar",onSecondaryCallback:i,dirty:!0})]})}const W=d.memo(J);function X({accountReceivableId:t,vehicleSaleId:a}){const s=N();return e.jsxs(e.Fragment,{children:[e.jsx(b,{tooltipMessage:"Detalhes da venda",variant:"quaternary",iconLeft:"CurrencyExchange",onClick:()=>s(`/vehicle-sale/view/${a}`),resource:"VEHICLE_SALE",action:"READ",padding:"none","data-cy":`button-view-vehicleSale-${a}`}),e.jsx(b,{tooltipMessage:"Detalhes do pagamento",variant:"quaternary",iconLeft:"ReceiptLong",onClick:()=>s(`/accounts-receivable/${t}/installments`),resource:"ACCOUNTS_RECEIVABLE",action:"READ",padding:"none","data-cy":`button-edit-accountReceivable-${t}`})]})}const v=10;function Y(){var D,S,A;const{safeFetch:t}=V(),{accountsReceivableFilter:a,handleAccountsReceivableFilter:s}=j();function i(r){s({page:r})}const u=d.useMemo(()=>a?I(a):"",[a]);async function x(r){return await t(`${B}/account-receivable/search?${r}&orderBy=description`,{resource:"ACCOUNTS_RECEIVABLE",action:"READ"})}const{data:l,isFetching:g}=M({queryKey:["accounts-receivable",u],queryFn:({queryKey:r})=>x(r[1]),select:Q}),L=d.useMemo(()=>l!=null&&l.data.length?Math.max(...l.data.map(r=>r.totalValue.length)):0,[l==null?void 0:l.data]),P=d.useMemo(()=>{if(!(a!=null&&a.startDate)||!(a!=null&&a.endDate))return!1;const r=m({date:new Date,format:"yyyy-MM-dd"});return a.startDate===r&&a.endDate===r},[a==null?void 0:a.startDate,a==null?void 0:a.endDate]);return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex gap-4 justify-between",children:[e.jsx(_,{fileName:"Relatório Vendas",queryKey:["accounts-receivable",u],queryFn:x,selectQueryFn:z,formatFilters:{description:"Descrição",endDate:"Data final",startDate:"Data inicial",overallStatus:"Status geral"},formatFiltersValues:{overallStatus:{PAID:"Pago",PENDING:"Pendente"}},formatColumns:{description:"Descrição",date:"Data de venda",receivedFrom:"Recebido de",overallStatus:"Status geral",totalValue:"Valor total"}}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx(H,{checked:P,label:"Contas de hoje",onCheck:()=>s({startDate:m({date:new Date,format:"yyyy-MM-dd"}),endDate:m({date:new Date,format:"yyyy-MM-dd"})}),onUncheck:()=>s({startDate:"",endDate:""})}),e.jsx(o.Filter,{form:e.jsx(W,{})})]})]}),e.jsxs("div",{className:"w-fit flex gap-4",children:[e.jsx(p,{label:"Total",value:c((D=l==null?void 0:l.summary)==null?void 0:D.totalOverall,"money")}),e.jsx(p,{label:"Total Pago",value:c((S=l==null?void 0:l.summary)==null?void 0:S.totalPaid,"money")}),e.jsx(p,{label:"Total Pendente",value:c((A=l==null?void 0:l.summary)==null?void 0:A.totalPending,"money")})]}),e.jsxs(o,{children:[e.jsxs(o.Header,{gridColumns:v,children:[e.jsx(o.Head,{label:n.description.label}),e.jsx(o.Head,{label:n.date.label}),e.jsx(o.Head,{label:n.receivedFrom.label}),e.jsx(o.Head,{label:n.overallStatus.label,colSpan:n.overallStatus.colSpan}),e.jsx(o.Head,{label:n.totalValue.label}),e.jsx(o.Head,{action:!0})]}),e.jsx(o.Body,{isLoading:g,isEmpty:!(l!=null&&l.total),resource:"ACCOUNTS_RECEIVABLE",action:"READ",children:l==null?void 0:l.data.map(r=>e.jsxs(o.Row,{gridColumns:v,children:[e.jsx(o.Cell,{label:r.description,columnLabel:n.description.label}),e.jsx(o.Cell,{label:r.date,columnLabel:n.date.label}),e.jsx(o.Cell,{label:r.receivedFrom,columnLabel:n.receivedFrom.label}),e.jsx(o.Cell,{label:e.jsx(k,{status:r.overallStatus}),columnLabel:n.overallStatus.label,colSpan:n.overallStatus.colSpan}),e.jsx(o.Cell,{label:r.totalValue.padStart(L,T),className:"font-mono whitespace-pre",columnLabel:n.totalValue.label}),e.jsx(o.Action,{children:e.jsx(X,{accountReceivableId:String(r.id),vehicleSaleId:String(r.vehicleSaleId)})})]},r.id))}),e.jsx(o.Footer,{currentStartItem:a==null?void 0:a.page,totalItems:l==null?void 0:l.total,onClickNavigateBtn:i,isLoading:g})]})]})}function pe({contextHelper:t}){return e.jsx(G,{children:e.jsxs("div",{className:"flex flex-col gap-4 h-full w-full",children:[e.jsx(w,{title:"Vendas",contextHelper:t}),e.jsx(Y,{})]})})}export{pe as default};
