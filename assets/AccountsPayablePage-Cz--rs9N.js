import{r as c,j as e,w as p,a as m,a3 as S,aE as v,i as L,l as T,u as M,f as V,a4 as P,aF as n,B,e as R}from"./index-PgcJxcI8.js";import{P as w}from"./PageHeader-D5LdL7k-.js";import{S as H}from"./Switch-FdvrPx3I.js";import{S as b,T as r}from"./Table-BekIIB6O.js";import{i as k,A as U}from"./AccountExpired-C6rEsZ_I.js";import{A as _}from"./AccountStatus-BpaywdVD.js";import{D as x}from"./DataField-DBVDlCWD.js";import{u as g,f as q}from"./react-pdf.browser-C5RSsOmp.js";import{E as O}from"./ExportButton-C1aJ9ZMa.js";import{F as $,I as f,u as K}from"./schemas-C0lewGoY.js";import{C as j}from"./Choice-D0Rlvujn.js";import{u as E}from"./useDialogContext-BiKj66N1.js";import{u as Y}from"./useDialog-BsfWsbN7.js";import{S as G}from"./index--Z_so9zz.js";import"./Tag-CNBfIfxT.js";import"./useIsFetching-D-bzNACg.js";const I=c.createContext(null);function Q({children:a}){const[t,o]=c.useState("");function i(u){o(u)}const d=c.useMemo(()=>({example:t,handleExample:i}),[t]);return e.jsx(I.Provider,{value:d,children:a})}function z(a){var o;const t=[];for(const i of a.data){const d=(o=i.date)==null?void 0:o.split("T")[0];t.push({...i,totalValue:m(i.totalValue,"money")??"",date:i.date?p({date:d,format:"dd/MM/yyyy"}):"",isExpired:i.overallStatus==="PENDING"&&!!d&&k(new Date(d))})}return{total:a.total,data:t,summary:a.summary}}function J(a){const t=[];for(const o of a.data)t.push({...o,totalValue:m(o.totalValue,"money")??"",overallStatus:o.overallStatus==="PAID"?"Pago":"Pendente",date:o.date?p({date:o.date.split("T")[0],format:"dd/MM/yyyy"}):""});return t}function W(){const{accountsPayableFilter:a,handleAccountsPayableFilter:t}=g(),{closeDialog:o}=E();function i(d){t({page:1,...d}),o()}return e.jsx($,{schema:G,onSubmit:i,className:"flex-1 flex flex-col min-h-0",defaultValues:{startDate:(a==null?void 0:a.startDate)||"",endDate:(a==null?void 0:a.endDate)||"",description:(a==null?void 0:a.description)||"",overallStatus:(a==null?void 0:a.overallStatus)||S.PAID},replaceEmptyStringToNull:!1,children:e.jsx(X,{})})}function X(){const{reset:a}=Y(),{handleAccountsPayableFilter:t}=g(),{closeDialog:o}=E();function i(){t(v),a(v),o()}return e.jsxs(e.Fragment,{children:[e.jsxs(b.Body,{className:"flex flex-col gap-4",children:[e.jsx(f,{label:"Descrição",name:"description"}),e.jsx(f,{name:"startDate",label:"Data inicial de criação",type:"date"}),e.jsx(f,{name:"endDate",label:"Data final de criação",type:"date"}),e.jsx(K,{label:"Status geral"}),e.jsx("div",{className:"flex flex-col gap-2",children:e.jsxs(j,{hideErrorLabel:!0,children:[e.jsx(j.Radio,{name:"overallStatus",label:"Pago",value:S.PAID}),e.jsx(j.Radio,{name:"overallStatus",label:"Pendente",value:S.PENDING})]})})]}),e.jsx(b.Footer,{primaryLabel:"Aplicar",secondaryLabel:"Limpar",onSecondaryCallback:i,dirty:!0})]})}const Z=c.memo(W);function ee({accountPayableId:a}){const t=L();return e.jsx(T,{variant:"quaternary",iconLeft:"ReceiptLong",onClick:()=>t(`/accounts-payable/${a}/installments`),resource:"ACCOUNTS_PAYABLE",action:"READ",padding:"none","data-cy":`button-edit-accountPayable-${a}`,tooltipMessage:"Detalhes do pagamento"})}const C=10;function te(){var D,A,y;const{safeFetch:a}=M(),{accountsPayableFilter:t,handleAccountsPayableFilter:o}=g();function i(s){o({page:s})}const d=c.useMemo(()=>t?q(t):"",[t]);async function u(s){return await a(`${R}/account-payable/search?${s}&orderBy=description`,{resource:"ACCOUNTS_PAYABLE",action:"READ"})}const{data:l,isFetching:h}=V({queryKey:["accounts-payable",d],queryFn:({queryKey:s})=>u(s[1]),select:z}),N=c.useMemo(()=>l!=null&&l.data.length?Math.max(...l.data.map(s=>s.totalValue.length)):0,[l==null?void 0:l.data]),F=c.useMemo(()=>{if(!(t!=null&&t.startDate)||!(t!=null&&t.endDate))return!1;const s=P();return t.startDate===s&&t.endDate===s},[t==null?void 0:t.startDate,t==null?void 0:t.endDate]);return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex gap-4 justify-between",children:[e.jsx(O,{fileName:"Relatório Pagamentos",queryKey:["accounts-payable",d],queryFn:u,selectQueryFn:J,formatFilters:{endDate:"Data final",startDate:"Data inicial",overallStatus:"Status geral",description:"Descrição"},formatFiltersValues:{overallStatus:{PAID:"Pago",PENDING:"Pendente"}},formatColumns:{description:"Descrição",date:"Data de vencimento",paidTo:"Pago a",overallStatus:"Status geral",totalValue:"Valor total"}}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx(H,{checked:F,label:"Contas de hoje",onCheck:()=>o({startDate:p({date:new Date,format:"yyyy-MM-dd"}),endDate:p({date:new Date,format:"yyyy-MM-dd"})}),onUncheck:()=>o({startDate:"",endDate:""})}),e.jsx(r.Filter,{form:e.jsx(Z,{})})]})]}),e.jsxs("div",{className:"w-fit flex gap-4",children:[e.jsx(x,{label:"Total",value:m((D=l==null?void 0:l.summary)==null?void 0:D.totalOverall,"money")}),e.jsx(x,{label:"Total Pago",value:m((A=l==null?void 0:l.summary)==null?void 0:A.totalPaid,"money")}),e.jsx(x,{label:"Total Pendente",value:m((y=l==null?void 0:l.summary)==null?void 0:y.totalPending,"money")})]}),e.jsxs(r,{children:[e.jsxs(r.Header,{gridColumns:C,children:[e.jsx(r.Head,{label:n.description.label,colSpan:n.description.colSpan}),e.jsx(r.Head,{label:n.date.label}),e.jsx(r.Head,{label:n.paidTo.label}),e.jsx(r.Head,{label:n.overallStatus.label,colSpan:n.overallStatus.colSpan}),e.jsx(r.Head,{label:n.totalValue.label,colSpan:n.totalValue.colSpan}),e.jsx(r.Head,{action:!0})]}),e.jsx(r.Body,{isLoading:h,isEmpty:!(l!=null&&l.total),resource:"ACCOUNTS_PAYABLE",action:"READ",children:l==null?void 0:l.data.map(s=>e.jsxs(r.Row,{gridColumns:C,children:[e.jsx(r.Cell,{label:s.description,colSpan:n.description.colSpan,columnLabel:n.description.label}),e.jsx(r.Cell,{label:e.jsxs("div",{className:"flex gap-1 text-center",children:[s.date," ",s.isExpired&&e.jsx(U,{})]}),columnLabel:n.date.label}),e.jsx(r.Cell,{label:s.paidTo,columnLabel:n.paidTo.label}),e.jsx(r.Cell,{label:e.jsx(_,{status:s.overallStatus}),columnLabel:n.overallStatus.label,colSpan:n.overallStatus.colSpan}),e.jsx(r.Cell,{label:s.totalValue.padStart(N,B),className:"font-mono whitespace-pre",colSpan:n.totalValue.colSpan,columnLabel:n.totalValue.label}),e.jsx(r.Action,{children:e.jsx(ee,{accountPayableId:String(s.id)})})]},s.id))}),e.jsx(r.Footer,{currentStartItem:t==null?void 0:t.page,totalItems:l==null?void 0:l.total,onClickNavigateBtn:i,isLoading:h})]})]})}function ge({contextHelper:a}){return e.jsx(Q,{children:e.jsxs("div",{className:"flex flex-col gap-4 h-full w-full",children:[e.jsx(w,{title:"Pagamentos",contextHelper:a}),e.jsx(te,{})]})})}export{ge as default};
