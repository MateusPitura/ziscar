import{r as d,j as e,a as D,u as S,b as L,c as A,d as R,B as M,e as y,_ as F,i as N,T as j,k as C,f as $,$ as c}from"./index-UdT0GBA4.js";import{P}from"./PageHeader-BWgTwsAh.js";import{S as T,T as s}from"./Table-C3pX6aIK.js";import{u as k}from"./DialogContext-BXF1n5N_.js";import{u as h,f as O}from"./react-pdf.browser--VWKIJ9j.js";import{D as b}from"./Dialog-EaJkbypX.js";import{F as U,I as E,u as w}from"./schemas-BggDEbt9.js";import{u as q}from"./useButtonState-N-GWfCKe.js";import{u as B}from"./useDialogContext-3ywhn9HH.js";import{C as g}from"./Choice-Dg5X3hHC.js";import{S as H}from"./index-0BP1_nT6.js";import"./dialog-Cf7DmMJZ.js";import"./index-Bc_KExWn.js";const I=d.createContext(null);function K({children:a}){const[n,t]=d.useState("");function i(u){t(u)}const l=d.useMemo(()=>({example:n,handleExample:i}),[n]);return e.jsx(I.Provider,{value:l,children:a})}function Q(a){const n=[];for(const t of a.data)n.push({...t,phone:D(t==null?void 0:t.phone,"phone")??"",cpf:D(t==null?void 0:t.cpf,"cpf")??""});return{total:a.total,data:n}}function _({customerId:a,customerFullName:n,...t}){const{safeFetch:i}=S(),{showSuccessSnackbar:l}=L(),u=A(),{handleCustomersFilter:m}=h();async function x(){await i(`${y}/customer/${a}`,{method:"DELETE",body:{archivedAt:new Date().toISOString()},resource:"CUSTOMERS",action:"DELETE"})}const{mutate:f,isPending:p}=R({mutationFn:x,onSuccess:()=>{m({page:1}),u.invalidateQueries({queryKey:["customers"]}),l({title:`Cliente ${n} desativado com sucesso`}),t.closeDialog()}});return e.jsxs(b,{...t,children:[e.jsx(b.Header,{title:"Desativar cliente"}),e.jsx(b.Body,{children:e.jsxs("span",{className:"text-body-medium text-neutral-700",children:["Tem certeza que deseja desativar o cliente",e.jsxs("span",{className:"font-bold",children:[M,n]}),"? Ao desativar os registros relacionados a ele não serão mais acessíveis"]})}),e.jsx(b.Footer,{labelPrimaryBtn:"Desativar",onClickPrimaryBtn:f,primaryBtnState:p?"loading":void 0,primaryBtnColor:"red",primaryBtnResource:"CUSTOMERS",primaryBtnAction:"DELETE"})]})}function z(){const{customersFilter:a,handleCustomersFilter:n}=h(),{closeDialog:t}=B();function i(l){n({page:1,...l}),t()}return e.jsx(U,{schema:H,onSubmit:i,className:"flex-1 flex flex-col min-h-0",defaultValues:{fullName:(a==null?void 0:a.fullName)||"",status:(a==null?void 0:a.status)||"active",startDate:(a==null?void 0:a.startDate)||"",endDate:(a==null?void 0:a.endDate)||""},replaceEmptyStringToNull:!1,children:e.jsx(V,{})})}function V(){const{reset:a}=q(),{handleCustomersFilter:n}=h(),{closeDialog:t}=B();function i(){n(F),a(F),t()}return e.jsxs(e.Fragment,{children:[e.jsxs(T.Body,{className:"flex flex-col gap-4",children:[e.jsx(E,{name:"fullName",label:"Nome completo"}),e.jsx(w,{label:"Status"}),e.jsx("div",{className:"flex flex-col gap-2",children:e.jsxs(g,{hideErrorLabel:!0,children:[e.jsx(g.Radio,{name:"status",label:"Ativo",value:"active"}),e.jsx(g.Radio,{name:"status",label:"Inativo",value:"inactive"})]})}),e.jsx(E,{name:"startDate",label:"Data inicial de criação",type:"date"}),e.jsx(E,{name:"endDate",label:"Data final de criação",type:"date"})]}),e.jsx(T.Footer,{primaryLabel:"Aplicar",secondaryLabel:"Limpar",onSecondaryCallback:i,dirty:!0})]})}const G=d.memo(z);function J({customerId:a,fullName:n,isActive:t,handleDisableCustomerInfo:i}){const l=N(),{safeFetch:u}=S(),{showSuccessSnackbar:m}=L(),x=A();async function f(){await u(`${y}/customer/${a}`,{method:"DELETE",body:{archivedAt:null},resource:"CUSTOMERS",action:"DELETE"})}const{mutate:p,isPending:r}=R({mutationFn:f,onSuccess:()=>{x.invalidateQueries({queryKey:["customers"]}),m({title:`Cliente ${n} ativado com sucesso`})}});return t?e.jsxs(e.Fragment,{children:[e.jsx(j,{content:"Editar",children:e.jsx(C,{variant:"quaternary",iconLeft:"Edit",onClick:()=>l(`/customers/edit/${a}`),resource:"CUSTOMERS",action:"UPDATE",padding:"none","data-cy":`button-edit-customer-${a}`})}),e.jsx(j,{content:"Desativar",children:e.jsx(C,{variant:"primary",iconLeft:"Delete",color:"red",padding:"none",onClick:()=>i({customerFullName:n,customerId:a}),resource:"CUSTOMERS",action:"DELETE","data-cy":`button-disable-customer-${a}`})})]}):e.jsx(j,{content:"Ativar",children:e.jsx(C,{variant:"quaternary",onClick:p,state:r?"loading":void 0,resource:"CUSTOMERS",action:"DELETE",padding:"none",iconLeft:"ToggleOn","data-cy":`button-enable-customer-${a}`})})}const W=!1;function X(){const[a,n]=d.useState({customerFullName:"",customerId:""}),t=k(),{safeFetch:i}=S(),{customersFilter:l,handleCustomersFilter:u}=h();function m(o){t.openDialog(),n(o)}function x(o){u({page:o})}const f=d.useMemo(()=>l?O(l):"",[l]);async function p(o){return await i(`${y}/customer?${o}&orderBy=fullName`,{resource:"CUSTOMERS",action:"READ"})}const{data:r,isFetching:v}=$({queryKey:["customers",f],queryFn:({queryKey:o})=>p(o[1]),select:Q});return e.jsxs(e.Fragment,{children:[e.jsx(_,{...a,...t}),e.jsxs("div",{className:"flex gap-4 justify-end",children:[W,e.jsx(s.Filter,{form:e.jsx(G,{})})]}),e.jsxs(s,{children:[e.jsxs(s.Header,{children:[e.jsx(s.Head,{label:c.name.label}),e.jsx(s.Head,{label:c.cpf.label}),e.jsx(s.Head,{label:c.email.label}),e.jsx(s.Head,{label:c.phone.label}),e.jsx(s.Head,{label:c.status.label}),e.jsx(s.Head,{action:!0})]}),e.jsx(s.Body,{isLoading:v,isEmpty:!(r!=null&&r.total),resource:"CUSTOMERS",action:"READ",children:r==null?void 0:r.data.map(o=>e.jsxs(s.Row,{children:[e.jsx(s.Cell,{label:o.fullName,columnLabel:c.name.label}),e.jsx(s.Cell,{label:o.cpf,columnLabel:c.cpf.label}),e.jsx(s.Cell,{label:o.email,columnLabel:c.email.label}),e.jsx(s.Cell,{label:o.phone,columnLabel:c.phone.label}),e.jsx(s.Cell,{label:o.archivedAt?"Inativo":"Ativo",columnLabel:c.status.label}),e.jsx(s.Action,{children:e.jsx(J,{isActive:!o.archivedAt,customerId:String(o.id),fullName:o.fullName,handleDisableCustomerInfo:m})})]},o.id))}),e.jsx(s.Footer,{currentStartItem:l==null?void 0:l.page,totalItems:r==null?void 0:r.total,onClickNavigateBtn:x,isLoading:v})]})]})}function Y(){const a=N();return e.jsxs("div",{className:"flex flex-col gap-4 h-full w-full",children:[e.jsx(P,{title:"Clientes",children:e.jsx(C,{label:"Adicionar cliente",iconLeft:"Add",onClick:()=>a("/customers/new"),resource:"CUSTOMERS",action:"CREATE",color:"green","data-cy":"new-customer-button"})}),e.jsx(X,{})]})}function me(){return e.jsx(K,{children:e.jsx(Y,{})})}export{me as default};
