import{w as N,a as v,u as y,b as S,c as D,d as C,j as e,B as L,e as g,i as H,x as P,l as x,r as b,o as T,f as A,y as F,z as c,E as j,S as B}from"./index-BaodxefT.js";import{u as w}from"./useGetVehicleInfo-DbygBEfI.js";import{s as M}from"./selectVehicleInfo-CI4Tagry.js";import{V as $}from"./VehicleExpenseHeader-Br2wyGu2.js";import{T as o}from"./Table-BxNCMX2w.js";import{D as _}from"./DataField-ClarmWOb.js";import{D as m,b as k}from"./useDialog-B00w_pfZ.js";import"./formatVehicleCharacteristics-BEECkIz-.js";import"./PageHeader-BvWMz3kB.js";function q(s){var l,r;const n=[];for(const i of s)n.push({...i,totalValue:v(i.totalValue,"money")??"",competencyDate:N({date:(r=(l=i.competencyDate)==null?void 0:l.split("T"))==null?void 0:r[0],format:"dd/MM/yyyy"})});return n}function X({vehicleExpenseId:s,vehicleCategory:n,...l}){const{safeFetch:r}=y(),{showSuccessSnackbar:i}=S(),u=D();async function d(){await r(`${g}/vehicle-expense/${s}/archive`,{method:"PATCH",resource:"VEHICLE_EXPENSE",action:"DELETE"})}const{mutate:a,isPending:E}=C({mutationFn:d,onSuccess:()=>{u.invalidateQueries({queryKey:["vehicle-expenses"]}),i({title:"Gasto desativado com sucesso"}),l.closeDialog()}});return e.jsxs(m,{...l,children:[e.jsx(m.Header,{title:"Desativar gasto"}),e.jsx(m.Body,{children:e.jsxs("span",{className:"text-body-medium text-neutral-700",children:["Tem certeza que deseja desativar o gasto de",e.jsxs("span",{className:"font-bold",children:[L,n]}),"? Ao desativar ele não será mais acessível"]})}),e.jsx(m.Footer,{labelPrimaryBtn:"Desativar",onClickPrimaryBtn:a,primaryBtnState:E?"loading":void 0,primaryBtnColor:"red",primaryBtnResource:"VEHICLE_EXPENSE",primaryBtnAction:"DELETE"})]})}function I({vehicleExpenseId:s,vehicleCategory:n,isActive:l,handleDisableVehicleExpenseInfo:r}){const i=H(),{pathname:u}=P(),{safeFetch:d}=y(),a=D(),{showSuccessSnackbar:E}=S();async function h(){await d(`${g}/vehicle-expense/${s}/unarchive`,{method:"PATCH",resource:"VEHICLE_EXPENSE",action:"DELETE"})}const{mutate:p,isPending:t}=C({mutationFn:h,onSuccess:()=>{a.invalidateQueries({queryKey:["vehicle-expenses"]}),E({title:`Gasto de ${n} ativado com sucesso`})}});return l?e.jsxs(e.Fragment,{children:[e.jsx(x,{variant:"quaternary",tooltipMessage:"Editar",iconLeft:"Edit",onClick:()=>i(`${u}/edit/${s}`),resource:"VEHICLE_EXPENSE",action:"UPDATE",padding:"none","data-cy":`button-edit-vehicle-expense-${s}`}),e.jsx(x,{tooltipMessage:"Desativar",variant:"primary",iconLeft:"Delete",color:"red",padding:"none",onClick:()=>{r({vehicleExpenseId:s,vehicleCategory:n})},resource:"VEHICLE_EXPENSE",action:"DELETE","data-cy":`button-disable-vehicle-expense-${s}`})]}):e.jsx(x,{tooltipMessage:"Ativar",variant:"quaternary",onClick:p,state:t?"loading":void 0,resource:"VEHICLE_EXPENSE",action:"DELETE",padding:"none",iconLeft:"ToggleOn","data-cy":`button-enable-vehicle-expense-${s}`})}const V=8;function R(){const[s,n]=b.useState({vehicleExpenseId:"",vehicleCategory:""}),l=k(),{safeFetch:r}=y(),{vehicleId:i}=T();function u(t){l.openDialog(),n(t)}async function d(){return await r(`${g}/vehicle-expense/${i}`,{resource:"VEHICLE_EXPENSE",action:"READ"})}const{data:a,isFetching:E}=A({queryKey:["vehicle-expenses",i],queryFn:d,select:q}),h=b.useMemo(()=>a!=null&&a.length?Math.max(...a.map(t=>String(t.totalValue).length)):0,[a]),p=b.useMemo(()=>{if(!(a!=null&&a.length))return"0";let t=0;for(const f of a)f.archivedAt||(t+=Number(F(f.totalValue)));return String(t)},[a]);return e.jsxs(e.Fragment,{children:[e.jsx(X,{...s,...l}),e.jsx("div",{className:"w-fit",children:e.jsx(_,{label:"Total de gastos",value:v(p,"money")})}),e.jsxs(o,{children:[e.jsxs(o.Header,{gridColumns:V,children:[e.jsx(o.Head,{label:c.competencyDate.label}),e.jsx(o.Head,{label:c.observations.label}),e.jsx(o.Head,{label:c.category.label}),e.jsx(o.Head,{label:c.totalValue.label,colSpan:c.totalValue.colSpan}),e.jsx(o.Head,{action:!0})]}),e.jsx(o.Body,{isLoading:E,isEmpty:!(a!=null&&a.length),resource:"VEHICLE_EXPENSE",action:"READ",children:a==null?void 0:a.map(t=>e.jsxs(o.Row,{gridColumns:V,children:[e.jsx(o.Cell,{label:t.competencyDate,columnLabel:c.competencyDate.label}),e.jsx(o.Cell,{label:t.observations,columnLabel:c.observations.label}),e.jsx(o.Cell,{label:j[t.category],columnLabel:c.category.label}),e.jsx(o.Cell,{id:String(t.id),label:t.totalValue.padStart(h,L),className:"font-mono whitespace-pre",colSpan:c.totalValue.colSpan,columnLabel:c.totalValue.label}),e.jsx(o.Action,{children:e.jsx(I,{vehicleExpenseId:String(t.id),vehicleCategory:j[t.category],handleDisableVehicleExpenseInfo:u,isActive:!t.archivedAt})})]},t.id))})]})]})}function Z({contextHelper:s}){const{data:n,isFetching:l}=w({select:M});return l?e.jsx("div",{className:"flex justify-center items-center h-full w-full",children:e.jsx(B,{})}):e.jsxs("div",{className:"flex flex-col gap-4 h-full w-full",children:[e.jsx($,{title:"Gastos do Veículo",showActions:!0,contextHelper:s,plateNumber:n==null?void 0:n.vehicle.plateNumber}),e.jsx(R,{})]})}export{Z as default};
