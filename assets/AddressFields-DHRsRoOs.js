import{r as l,u as D,b as V,h as f,a1 as g,j as s,a2 as w,a3 as I,e as q}from"./index-CDuUmDit.js";import{F as T,S as h}from"./FieldArray-Dw98_Trr.js";import{I as i}from"./schemas-CxmGnStq.js";import{u as k}from"./useButtonState-DJFFoANO.js";function _(){const[u,y]=l.useState(""),{setValue:a,trigger:C,getValues:x,watch:c}=k(),{safeFetch:p}=D(),{showErrorSnackbar:b}=V();async function F(e){return await p(`https://viacep.com.br/ws/${e}/json/`,{enableCookie:!1})}const{data:r,isFetching:n}=f({queryKey:["cepApi",u],queryFn:({queryKey:e})=>F(e[1]),enabled:!!u});l.useEffect(()=>{if(r!=null&&r.erro){b({description:"CEP nÃ£o encontrado"});return}r&&(a("address.0.street",r.logradouro,{shouldDirty:!0}),a("address.0.neighborhood",r.bairro,{shouldDirty:!0}),a("address.0.cityIbgeCode",r.ibge,{shouldDirty:!0}),a("address.0.state",r.uf,{shouldDirty:!0}))},[r,a,b]);async function E(e){if(!e)return[];const t=await p(`${q}/city/${e}`);return console.log("ðŸŒ  result: ",t),t}const o=c("address.0.state"),{data:S,isFetching:j}=f({queryKey:["ibgeApi",o],queryFn:({queryKey:e})=>E(e[1]),enabled:!!o,select:e=>e==null?void 0:e.map(t=>({value:String(t.ibgeCode),label:t.name}))});async function m(){if(await C("address.0.cep")){const t=x("address.0.cep");y(t)}}const d=c("address.0.cep");l.useEffect(()=>{(d==null?void 0:d.length)===g&&m()},[d]);function A(e){e.key==="Enter"&&(e.preventDefault(),m())}return s.jsx(T,{name:"address",appendText:"Adicionar endereÃ§o",removeText:"Remover endereÃ§o",maxLength:1,appendDefaultValues:w,render:()=>s.jsxs(s.Fragment,{children:[s.jsx("div",{onKeyDown:A,children:s.jsx(i,{label:"CEP",name:"address.0.cep",mask:"cep",maxLength:g,required:!0,forceUnselect:!0,disabled:n})}),s.jsx(i,{label:"NÃºmero",name:"address.0.number",required:!0}),s.jsx(i,{label:"Rua",name:"address.0.street",disabled:n}),s.jsx(i,{label:"Bairro",name:"address.0.neighborhood",disabled:n}),s.jsx(h,{label:"Estado",name:"address.0.state",options:I,onChange:()=>a("address.0.cityIbgeCode","",{shouldDirty:!0}),disabled:n}),s.jsx(h,{label:"Cidade",name:"address.0.cityIbgeCode",options:S||[],loading:j,disabled:!o})]})})}export{_ as A};
