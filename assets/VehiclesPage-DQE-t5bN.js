import{r as u,j as e,a as j,V as F,u as b,b as v,c as L,d as P,B as A,e as y,v as C,f as N,T as f,g as x,h as $,I as B}from"./index-DLLA1f-v.js";import{P as k}from"./PageHeader-Bs9TDp09.js";import{S as V,T as r}from"./Table-By5z5vhx.js";import{u as q}from"./useDialog-DlT6EUiq.js";import{u as g,f as R}from"./react-pdf.browser-s4H9466t.js";import{E as w}from"./ExportButton-CgGi4N55.js";import{D as E}from"./Dialog-D33IGNgm.js";import{F as M,I as D}from"./schemas-Bhi0Dh6I.js";import{u as I}from"./useButtonState-3b0McXTU.js";import{S as K}from"./index-ORUOFCuk.js";import{u as H}from"./useDialogContext-BXiPHqkt.js";import"./dialog-BH6A_dKB.js";import"./useIsFetching-Ce26lW8Z.js";import"./index-2Ad1AATz.js";const Q=u.createContext(null);function Y({children:a}){const[n,t]=u.useState("");function l(c){t(c)}const i=u.useMemo(()=>({example:n,handleExample:l}),[n]);return e.jsx(Q.Provider,{value:i,children:a})}function _(a){const n=[];for(const t of a.data)n.push({...t,announcedPrice:j(t.announcedPrice,"money")??"",plateNumber:j(t.plateNumber,"plateNumber")??"",modelYear:t.modelYear?String(t.modelYear):""});return{total:a.total,data:n}}function z(a){const n=[];for(const t of a.data)n.push({...t,announcedPrice:j(t.announcedPrice,"money")??"",plateNumber:j(t.plateNumber,"plateNumber")??"",status:F[t.status]});return n}function G({vehicleId:a,plateNumber:n,...t}){const{safeFetch:l}=b(),{showSuccessSnackbar:i}=v(),c=L(),{handleVehiclesFilter:p}=g();async function h(){await l(`${y}/vehicles/${a}/archive`,{method:"PATCH",resource:"VEHICLES",action:"DELETE"})}const{mutate:d,isPending:m}=P({mutationFn:h,onSuccess:()=>{p({page:1}),c.invalidateQueries({queryKey:["vehicles"]}),i({title:`Veículo ${n} desativado com sucesso`}),t.closeDialog()}});return e.jsxs(E,{...t,children:[e.jsx(E.Header,{title:"Desativar veículo"}),e.jsx(E.Body,{children:e.jsxs("span",{className:"text-body-medium text-neutral-700",children:["Tem certeza que deseja desativar o veículo",e.jsxs("span",{className:"font-bold",children:[A,n]}),"? Ao desativar os registros relacionados a ele não serão mais acessíveis"]})}),e.jsx(E.Footer,{labelPrimaryBtn:"Desativar",onClickPrimaryBtn:d,primaryBtnState:m?"loading":void 0,primaryBtnColor:"red",primaryBtnResource:"VEHICLES",primaryBtnAction:"DELETE"})]})}function U(){const{vehiclesFilter:a,handleVehiclesFilter:n}=g(),{closeDialog:t}=H();function l(i){n({page:1,...i}),t()}return e.jsx(M,{schema:K,onSubmit:l,className:"flex-1 flex flex-col",defaultValues:{startDate:(a==null?void 0:a.startDate)||"",endDate:(a==null?void 0:a.endDate)||""},replaceEmptyStringToNull:!1,children:e.jsx(O,{})})}function O(){const{reset:a}=I(),{handleVehiclesFilter:n}=g(),{closeDialog:t}=H();function l(){n(C),a(C),t()}return e.jsxs(e.Fragment,{children:[e.jsxs(V.Body,{className:"flex flex-col gap-4",children:[e.jsx(D,{name:"startDate",label:"Data inicial de criação",type:"date"}),e.jsx(D,{name:"endDate",label:"Data final de criação",type:"date"})]}),e.jsx(V.Footer,{primaryLabel:"Aplicar",secondaryLabel:"Limpar",onSecondaryCallback:l,dirty:!0})]})}const X=u.memo(U);function J({vehicleId:a,plateNumber:n,isActive:t,handleDisableVehicleInfo:l}){const i=N(),{safeFetch:c}=b(),{showSuccessSnackbar:p}=v(),h=L();async function d(){await c(`${y}/vehicles/${a}/unarchive`,{method:"PATCH",resource:"VEHICLES",action:"DELETE"})}const{mutate:m,isPending:s}=P({mutationFn:d,onSuccess:()=>{h.invalidateQueries({queryKey:["vehicles"]}),p({title:`Veículo ${n} ativado com sucesso`})}});return t?e.jsxs(e.Fragment,{children:[e.jsx(f,{content:"Vender",children:e.jsx(x,{variant:"quaternary",iconLeft:"CurrencyExchange",onClick:()=>i(`/vehicle-sale/new/${a}`),resource:"VEHICLE_SALE",action:"CREATE",padding:"none","data-cy":`button-vehicleSale-${a}`})}),e.jsx(f,{content:"Editar",children:e.jsx(x,{variant:"quaternary",iconLeft:"Edit",onClick:()=>i(`/vehicles/edit/${a}`),resource:"VEHICLES",action:"UPDATE",padding:"none","data-cy":`button-edit-vehicle-${a}`})}),e.jsx(f,{content:"Gastos",children:e.jsx(x,{variant:"quaternary",iconLeft:"History",onClick:()=>i(`/vehicles/expense/${a}`),resource:"VEHICLE_EXPENSE",action:"READ",padding:"none","data-cy":`button-vehicle-expense-${a}`})}),e.jsx(f,{content:"Desativar",children:e.jsx(x,{variant:"primary",iconLeft:"Delete",color:"red",padding:"none",onClick:()=>l({plateNumber:n,vehicleId:a}),resource:"VEHICLES",action:"DELETE","data-cy":`button-disable-vehicle-${a}`})})]}):e.jsx(f,{content:"Ativar",children:e.jsx(x,{variant:"quaternary",onClick:m,state:s?"loading":void 0,resource:"VEHICLES",action:"DELETE",padding:"none",iconLeft:"ToggleOn","data-cy":`button-enable-vehicle-${a}`})})}function W(){const[a,n]=u.useState({plateNumber:"",vehicleId:""}),t=q(),{safeFetch:l}=b(),{vehiclesFilter:i,handleVehiclesFilter:c}=g();function p(o){t.openDialog(),n(o)}function h(o){c({page:o})}const d=u.useMemo(()=>i?R(i):"",[i]);async function m(o){return await l(`${y}/vehicles?${o}&limit=${B}`,{resource:"VEHICLES",action:"READ"})}const{data:s,isFetching:S}=$({queryKey:["vehicles",d],queryFn:({queryKey:o})=>m(o[1]),select:_}),T=u.useMemo(()=>s!=null&&s.data.length?Math.max(...s.data.map(o=>o.announcedPrice.length)):0,[s==null?void 0:s.data]);return e.jsxs(e.Fragment,{children:[e.jsx(G,{...a,...t}),e.jsxs("div",{className:"flex gap-4 justify-end",children:[e.jsx(w,{fileName:"Relatório Veículos",queryKey:["vehicles",d],queryFn:m,selectQueryFn:z,formatFilters:{endDate:"Data final",startDate:"Data inicial"},formatFiltersValues:{},formatColumns:{announcedPrice:"Preço anunciado",modelName:"Modelo",plateNumber:"Placa",modelYear:"Ano do modelo",status:"Status",archivedAt:"Ativo"}}),e.jsx(r.Filter,{form:e.jsx(X,{})})]}),e.jsxs(r,{children:[e.jsxs(r.Header,{gridColumns:7,children:[e.jsx(r.Head,{label:"Modelo"}),e.jsx(r.Head,{label:"Placa",colSpan:1}),e.jsx(r.Head,{label:"Ano do modelo",colSpan:1}),e.jsx(r.Head,{label:"Preço anunciado",colSpan:1}),e.jsx(r.Head,{label:"Status",colSpan:1}),e.jsx(r.Head,{action:!0})]}),e.jsx(r.Body,{isLoading:S,isEmpty:!(s!=null&&s.total),resource:"VEHICLES",action:"READ",children:s==null?void 0:s.data.map(o=>e.jsxs(r.Row,{gridColumns:7,children:[e.jsx(r.Cell,{label:o.modelName}),e.jsx(r.Cell,{label:o.plateNumber,colSpan:1}),e.jsx(r.Cell,{label:o.modelYear,colSpan:1}),e.jsx(r.Cell,{label:o.announcedPrice.padStart(T,A),className:"font-mono whitespace-pre",colSpan:1}),e.jsx(r.Cell,{label:o.archivedAt?"Inativo":F[o.status],colSpan:1}),e.jsx(r.Action,{children:e.jsx(J,{isActive:!o.archivedAt,vehicleId:String(o.id),plateNumber:o.plateNumber,handleDisableVehicleInfo:p})})]},o.id))}),e.jsx(r.Footer,{currentStartItem:i==null?void 0:i.page,totalItems:s==null?void 0:s.total,onClickNavigateBtn:h,isLoading:S})]})]})}function Z(){const a=N();return e.jsxs("div",{className:"flex flex-col gap-4 h-full w-full",children:[e.jsx(k,{title:"Veículos Disponíveis",children:e.jsx(x,{label:"Adicionar veículo",iconLeft:"Add",onClick:()=>a("/vehicles/new"),resource:"VEHICLES",action:"CREATE",color:"green","data-cy":"new-vehicle-button"})}),e.jsx(W,{})]})}function pe(){return e.jsx(Y,{children:e.jsx(Z,{})})}export{pe as default};
