import{r as u,j as e,t as A,a as C,a4 as x,aI as h,i as E,T as j,k as b,u as D,f as L,aJ as n,B as N,e as P}from"./index-UdT0GBA4.js";import{P as V}from"./PageHeader-BWgTwsAh.js";import{S as g,T as s}from"./Table-C3pX6aIK.js";import{A as R}from"./AccountStatus-DnDD6nA6.js";import{u as f,f as B}from"./react-pdf.browser--VWKIJ9j.js";import{E as I}from"./ExportButton-DAnF1PU8.js";import{F as T,I as S,u as M}from"./schemas-BggDEbt9.js";import{u as H}from"./useButtonState-N-GWfCKe.js";import{u as y}from"./useDialogContext-3ywhn9HH.js";import{S as _}from"./index-BQjn9P7k.js";import{C as m}from"./Choice-Dg5X3hHC.js";import"./DialogContext-BXF1n5N_.js";import"./dialog-Cf7DmMJZ.js";import"./useIsFetching-DpNHUXZr.js";const $=u.createContext(null);function k({children:a}){const[t,l]=u.useState("");function i(d){l(d)}const c=u.useMemo(()=>({example:t,handleExample:i}),[t]);return e.jsx($.Provider,{value:c,children:a})}function q(a){const t=[];for(const l of a.data)t.push({...l,totalValue:C(l.totalValue,"money")??"",date:l.date?A({date:l.date.split("T")[0],format:"dd/MM/yyyy"}):""});return{total:a.total,data:t}}function w(a){const t=[];for(const l of a.data)t.push({...l,totalValue:C(l.totalValue,"money")??"",overallStatus:l.overallStatus==="PAID"?"Pago":"Pendente",date:l.date?A({date:l.date.split("T")[0],format:"dd/MM/yyyy"}):""});return t}function U(){const{accountsReceivableFilter:a,handleAccountsReceivableFilter:t}=f(),{closeDialog:l}=y();function i(c){t({page:1,...c}),l()}return e.jsx(T,{schema:_,onSubmit:i,className:"flex-1 flex flex-col min-h-0",defaultValues:{startDate:(a==null?void 0:a.startDate)||"",endDate:(a==null?void 0:a.endDate)||"",overallStatus:(a==null?void 0:a.overallStatus)||x.PAID},replaceEmptyStringToNull:!1,children:e.jsx(K,{})})}function K(){const{reset:a}=H(),{handleAccountsReceivableFilter:t}=f(),{closeDialog:l}=y();function i(){t(h),a(h),l()}return e.jsxs(e.Fragment,{children:[e.jsxs(g.Body,{className:"flex flex-col gap-4",children:[e.jsx(S,{name:"startDate",label:"Data inicial de criação",type:"date"}),e.jsx(S,{name:"endDate",label:"Data final de criação",type:"date"}),e.jsx(M,{label:"Status geral"}),e.jsx("div",{className:"flex flex-col gap-2",children:e.jsxs(m,{hideErrorLabel:!0,children:[e.jsx(m.Radio,{name:"overallStatus",label:"Pago",value:x.PAID}),e.jsx(m.Radio,{name:"overallStatus",label:"Pendente",value:x.PENDING})]})})]}),e.jsx(g.Footer,{primaryLabel:"Aplicar",secondaryLabel:"Limpar",onSecondaryCallback:i,dirty:!0})]})}const O=u.memo(U);function G({accountReceivableId:a,vehicleSaleId:t}){const l=E();return e.jsxs(e.Fragment,{children:[e.jsx(j,{content:"Detalhes da venda",children:e.jsx(b,{variant:"quaternary",iconLeft:"CurrencyExchange",onClick:()=>l(`/vehicle-sale/view/${t}`),resource:"VEHICLE_SALE",action:"READ",padding:"none","data-cy":`button-view-vehicleSale-${t}`})}),e.jsx(j,{content:"Detalhes do pagamento",children:e.jsx(b,{variant:"quaternary",iconLeft:"ReceiptLong",onClick:()=>l(`/accounts-receivable/${a}/installments`),resource:"ACCOUNTS_RECEIVABLE",action:"READ",padding:"none","data-cy":`button-edit-accountReceivable-${a}`})})]})}const v=10;function Q(){const{safeFetch:a}=D(),{accountsReceivableFilter:t,handleAccountsReceivableFilter:l}=f();function i(r){l({page:r})}const c=u.useMemo(()=>t?B(t):"",[t]);async function d(r){return await a(`${P}/account-receivable/search?${r}&orderBy=description`,{resource:"ACCOUNTS_RECEIVABLE",action:"READ"})}const{data:o,isFetching:p}=L({queryKey:["accounts-receivable",c],queryFn:({queryKey:r})=>d(r[1]),select:q}),F=u.useMemo(()=>o!=null&&o.data.length?Math.max(...o.data.map(r=>r.totalValue.length)):0,[o==null?void 0:o.data]);return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex gap-4 justify-end",children:[e.jsx(I,{fileName:"Relatório Contas a Receber",queryKey:["accounts-receivable",c],queryFn:d,selectQueryFn:w,formatFilters:{endDate:"Data final",startDate:"Data inicial",overallStatus:"Status geral"},formatFiltersValues:{overallStatus:{PAID:"Pago",PENDING:"Pendente"}},formatColumns:{description:"Descrição",date:"Data de venda",receivedFrom:"Recebido de",overallStatus:"Status geral",totalValue:"Valor total"}}),e.jsx(s.Filter,{form:e.jsx(O,{})})]}),e.jsxs(s,{children:[e.jsxs(s.Header,{gridColumns:v,children:[e.jsx(s.Head,{label:n.description.label}),e.jsx(s.Head,{label:n.date.label}),e.jsx(s.Head,{label:n.receivedFrom.label}),e.jsx(s.Head,{label:n.overallStatus.label,colSpan:n.overallStatus.colSpan}),e.jsx(s.Head,{label:n.totalValue.label}),e.jsx(s.Head,{action:!0})]}),e.jsx(s.Body,{isLoading:p,isEmpty:!(o!=null&&o.total),resource:"ACCOUNTS_RECEIVABLE",action:"READ",children:o==null?void 0:o.data.map(r=>e.jsxs(s.Row,{gridColumns:v,children:[e.jsx(s.Cell,{label:r.description,columnLabel:n.description.label}),e.jsx(s.Cell,{label:r.date,columnLabel:n.date.label}),e.jsx(s.Cell,{label:r.receivedFrom,columnLabel:n.receivedFrom.label}),e.jsx(s.Cell,{label:e.jsx(R,{status:r.overallStatus}),columnLabel:n.overallStatus.label,colSpan:n.overallStatus.colSpan}),e.jsx(s.Cell,{label:r.totalValue.padStart(F,N),className:"font-mono whitespace-pre",columnLabel:n.totalValue.label}),e.jsx(s.Action,{children:e.jsx(G,{accountReceivableId:String(r.id),vehicleSaleId:String(r.vehicleSaleId)})})]},r.id))}),e.jsx(s.Footer,{currentStartItem:t==null?void 0:t.page,totalItems:o==null?void 0:o.total,onClickNavigateBtn:i,isLoading:p})]})]})}function z(){return e.jsxs("div",{className:"flex flex-col gap-4 h-full w-full",children:[e.jsx(V,{title:"Vendas"}),e.jsx(Q,{})]})}function ce(){return e.jsx(k,{children:e.jsx(z,{})})}export{ce as default};
