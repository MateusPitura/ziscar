import{j as e,t as S,c as z,b as O,k as L,I as M}from"./index-UdT0GBA4.js";import{V as i,S as j,T as f,D as E,P,p as N}from"./react-pdf.browser--VWKIJ9j.js";import{u as I}from"./useIsFetching-DpNHUXZr.js";function W({formatFilters:t,formatFiltersValues:r,queryKey:s}){const o={};for(const c of s[1].split("&")){const[m,y]=c.split("=");if(m==="page")continue;const g=t[m],n=r[m];n?o[g]=n[y]:o[g]=y}return o}function V(t){return[/price/i,/value/i,/amount/i,/cost/i,/total/i,/^r\$/i].some(s=>s.test(t))}const l=j.create({header:{height:60,flexDirection:"row",marginBottom:10,paddingBottom:10,backgroundColor:"#FFFFFF"},gridColumn:{flex:1,minHeight:40},logoContainer:{height:50,backgroundColor:"#F8F9FA",borderRadius:3,justifyContent:"center",alignItems:"center",marginRight:8},logoText:{fontSize:7,color:"#9CA3AF"},centerContainer:{alignItems:"center",justifyContent:"center"},title:{fontSize:14,fontWeight:"bold",marginBottom:2,textAlign:"center"},subtitle:{fontSize:9,color:"#666666",textAlign:"center"},filtersContainer:{flexDirection:"row",flexWrap:"wrap",justifyContent:"flex-end",alignContent:"flex-start",marginLeft:8},filterChip:{backgroundColor:"#F8F9FA",borderRadius:10,paddingHorizontal:6,paddingVertical:2,marginBottom:2,marginLeft:2,borderWidth:.5,borderColor:"#E5E7EB"},filterText:{fontSize:7,color:"#374151"}});function T({appliedFilters:t,title:r}){return e.jsxs(i,{style:l.header,fixed:!0,children:[e.jsx(i,{style:l.gridColumn,children:e.jsx(i,{style:l.logoContainer,children:e.jsx(f,{style:l.logoText,children:"LOGO"})})}),e.jsx(i,{style:l.gridColumn,children:e.jsxs(i,{style:l.centerContainer,children:[e.jsx(f,{style:l.title,children:r}),e.jsxs(f,{style:l.subtitle,children:["Gerado em"," ",S({date:new Date,format:"dd/MM/yyyy HH:mm"})]})]})}),e.jsx(i,{style:l.gridColumn,children:t&&Object.keys(t).length>0&&e.jsx(i,{style:l.filtersContainer,children:Object.entries(t).map(([s,o])=>e.jsx(i,{style:l.filterChip,children:e.jsxs(f,{style:l.filterText,children:[s,": ",o]})},s))})})]})}const D=j.create({tableRow:{flexDirection:"row",minHeight:20,marginTop:3,backgroundColor:"#F8F9FA"},tableColHeader:{borderStyle:"solid",borderLeftWidth:.5,borderBottomWidth:.5,borderColor:"#DDDDDD",padding:4,justifyContent:"center",alignItems:"center"},tableCellHeader:{fontSize:11,fontWeight:"bold"}});function G({keys:t,formatColumns:r,columnWidth:s}){return e.jsx(i,{style:D.tableRow,fixed:!0,children:t.map(o=>e.jsx(i,{style:[D.tableColHeader,{width:s}],children:e.jsx(f,{style:D.tableCellHeader,children:r[o]})},o))})}const R=j.create({footer:{position:"absolute",bottom:15,left:15,right:15,flexDirection:"row",justifyContent:"space-between",alignItems:"center",paddingTop:8},recordsCounter:{fontSize:10,color:"#666666",flex:1,textAlign:"center"},pageNumber:{fontSize:10,color:"#666666"}});function $({totalRecords:t,itemsPerPage:r}){return e.jsxs(i,{style:R.footer,fixed:!0,children:[e.jsx(i,{style:{width:50}}),e.jsx(f,{style:R.recordsCounter,render:({pageNumber:s})=>{if(!t)return;const o=(s-1)*r,c=Math.min(o+r,t);return`${o+1} a ${c} de ${t} itens`}}),e.jsx(f,{style:R.pageNumber,render:({pageNumber:s,totalPages:o})=>`Página ${s}/${o}`})]})}const a=j.create({page:{flexDirection:"column",backgroundColor:"#FFFFFF",padding:15,paddingBottom:25},content:{flex:1},emptyState:{textAlign:"center",marginTop:30},emptyText:{fontSize:16,color:"#666666"},tableContainer:{marginTop:0},tableRow:{flexDirection:"row",minHeight:20},tableRowAlternate:{backgroundColor:"#F0F0F0"},tableCol:{borderStyle:"solid",borderLeftWidth:.25,borderColor:"#DDDDDD",padding:4,justifyContent:"center"},tableColNumeric:{alignItems:"flex-end"},tableCell:{fontSize:10,color:"#000000"}});function U({data:t,formatColumns:r,title:s,appliedFilters:o}){if(!t||t.length===0)return e.jsx(E,{children:e.jsxs(P,{size:"A4",orientation:"landscape",style:a.page,children:[e.jsx(T,{appliedFilters:o,title:s}),e.jsx(i,{style:a.content,children:e.jsx(i,{style:a.emptyState,children:e.jsx(f,{style:a.emptyText,children:"Nenhum dado encontrado"})})}),e.jsx($,{totalRecords:0,itemsPerPage:16})]})});const c=Object.keys(r).filter(n=>{var d;return r[n]&&((d=t[0])==null?void 0:d[n])!==void 0}),m=`${100/c.length}%`,y=22,g=(n,d)=>d==="archivedAt"?n?"Não":"Sim":n==null?"-":typeof n=="boolean"?n?"Sim":"Não":typeof n=="object"?JSON.stringify(n):String(n);return e.jsx(E,{children:e.jsxs(P,{size:"A4",orientation:"landscape",style:a.page,children:[e.jsx(T,{appliedFilters:o,title:s}),e.jsx(G,{keys:c,formatColumns:r,columnWidth:m}),e.jsx(i,{style:a.content,children:e.jsx(i,{style:a.tableContainer,children:t.map((n,d)=>e.jsx(i,{style:[a.tableRow,...d%2===1?[a.tableRowAlternate]:[]],wrap:!1,minPresenceAhead:8,children:c.map(b=>{const C=V(b);return e.jsx(i,{style:[a.tableCol,{width:m},...C?[a.tableColNumeric]:[]],children:e.jsx(f,{style:a.tableCell,children:g(n[b],b)})},b)})},`row-${d}`))})}),e.jsx($,{totalRecords:t.length,itemsPerPage:y})]})})}function v({fileName:t,queryKey:r,queryFn:s,selectQueryFn:o,formatColumns:c,formatFilters:m,formatFiltersValues:y}){const g=z(),{showErrorSnackbar:n,showSuccessSnackbar:d}=O(),b=I({queryKey:[r[0]]});async function C(){if(!r)throw new Error;const h=g.getQueryData(r);if(!h)throw new Error;const F=Math.ceil((h==null?void 0:h.total)/M),p=[];for(let u=1;u<=F;u++){const x=r[1],w=/page=\d+/,k=x==null?void 0:x.replace(w,`page=${u}`),H=g.fetchQuery({queryKey:[r[0],k],queryFn:({queryKey:B})=>s(B[1])});p.push(H)}return(await Promise.all(p)).flatMap(u=>o(u))}return e.jsx(L,{variant:"primary",color:"darkBlue",label:"Gerar relatório PDF",iconRight:"FileDownload",state:b?"loading":void 0,resource:"REPORTS",action:"CREATE","data-cy":"export-button",onClick:async()=>{const h=d({title:"O PDF está sendo gerado",actionBtnAction:"CREATE",actionBtnResource:"REPORTS"});try{const F=await C(),p=W({queryKey:r,formatFilters:m,formatFiltersValues:y}),A=await N(e.jsx(U,{data:F,formatColumns:c,title:t,appliedFilters:p})).toBlob();h.dismiss();const u=URL.createObjectURL(A),x=document.createElement("a");x.href=u;const w=`${t} ${S({date:new Date,format:"dd-MM-yyyy"})} ${S({date:new Date,format:"HH-mm"})}.pdf`;x.download=w,x.click(),URL.revokeObjectURL(u)}catch{h.dismiss(),n({description:"Ocorreu um erro ao gerar o PDF"})}}})}export{v as E};
