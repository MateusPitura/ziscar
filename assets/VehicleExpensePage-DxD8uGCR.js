import{u as V,a as D,b as P,c as S,j as e,B as A,d as I,r as m,T as g,f as x,s as N,E as u,o as j,I as h,P as F,g as H,e as L}from"./index-CwQymCQa.js";import{P as T}from"./PageHeader-ciO4E3wM.js";import{T as n}from"./Table-C7F72B_O.js";import{u as f}from"./DialogContext-qdOZWBM2.js";import{D as i}from"./Dialog-D_sfX160.js";import{b as B,u as q,I as d,F as M}from"./schemas-BL4SC9at.js";import{b as k}from"./index-DIacthnF.js";import{S as c,a as y}from"./Select-D2QyUKl8.js";function w({vehicleExpenseId:a,vehicleCategory:t,...s}){const{safeFetch:l}=V(),{showSuccessSnackbar:E}=D(),r=P();async function p(){await l(`${I}/vehicle-expense/${a}`,{method:"DELETE",body:{archivedAt:new Date().toISOString()},resource:"VEHICLE_EXPENSE",action:"DELETE"})}const{mutate:o,isPending:C}=S({mutationFn:p,onSuccess:()=>{r.invalidateQueries({queryKey:["vehicle-expenses"]}),E({title:"Gasto removido com sucesso"}),s.closeDialog()}});return e.jsxs(i,{...s,children:[e.jsx(i.Header,{title:"Remover gasto"}),e.jsx(i.Body,{children:e.jsxs("span",{className:"text-body-medium text-neutral-700",children:["Tem certeza que deseja remover o gasto de",e.jsxs("span",{className:"font-bold",children:[A,t]}),"? Ao remover ele não será mais acessível"]})}),e.jsx(i.Footer,{labelPrimaryBtn:"Desativar",onClickPrimaryBtn:o,primaryBtnState:C?"loading":void 0,primaryBtnColor:"red",primaryBtnResource:"VEHICLE_EXPENSE",primaryBtnAction:"DELETE"})]})}const v=m.createContext(null);function R({children:a}){const t=f(),s=m.useMemo(()=>({vehicleExpenseDialog:t}),[t]);return e.jsx(v.Provider,{value:s,children:a})}function b(){const a=m.useContext(v);if(!a)throw new Error("useVehicleExpensesPageContext must be used within a VehicleExpensesPageContextProvider");return a}function _({vehicleExpenseId:a,vehicleCategory:t,handleDisableVehicleExpenseInfo:s}){const{vehicleExpenseDialog:l}=b();return e.jsxs(e.Fragment,{children:[e.jsx(g,{content:"Editar",children:e.jsx(x,{variant:"quaternary",iconLeft:"Edit",onClick:()=>l==null?void 0:l.openDialog(),resource:"VEHICLE_EXPENSE",action:"UPDATE",padding:"none","data-cy":`button-edit-vehicle-expense-${a}`})}),e.jsx(g,{content:"Desativar",children:e.jsx(x,{variant:"primary",iconLeft:"Delete",color:"red",padding:"none",onClick:()=>{s({vehicleExpenseId:a,vehicleCategory:t})},resource:"VEHICLE_EXPENSE",action:"DELETE","data-cy":`button-disable-vehicle-expense-${a}`})})]})}function X(a){const t=[];for(const s of a)t.push({...s,totalValue:B(s.totalValue,"money")??"",competencyDate:N({date:s.competencyDate,format:"dd/MM/yyyy"})});return t}function G(){const{watch:a}=q(),t=a("payment.status");return e.jsxs(e.Fragment,{children:[e.jsxs(c.Group,{children:[e.jsx(c.Header,{title:"Informações do gasto"}),e.jsxs(c.Body,{children:[e.jsx(y,{label:"Categoria",name:"category",required:!0,options:Object.values(u).map(s=>({label:j[s],value:s}))}),e.jsx(d,{label:"Detalhes",name:"observations",required:!0})]})]}),e.jsxs(c.Group,{children:[e.jsx(c.Header,{title:"Informações do pagamento"}),e.jsxs(c.Body,{children:[e.jsx(d,{label:"Valor",name:"payment.value",mask:"money",required:!0}),e.jsx(y,{label:"Status",name:"payment.status",options:[{label:"Pago",value:h.PAID},{label:"Pendente",value:h.PENDING}],required:!0}),t===h.PAID?e.jsxs(e.Fragment,{children:[e.jsx(d,{label:"Data de pagamento",name:"payment.dueDate",type:"date",required:!0}),e.jsx(y,{label:"Forma de pagamento",name:"payment.paymentMethod",options:F,required:!0})]}):e.jsx(d,{label:"Data de vencimento",name:"payment.paymentDate",type:"date",required:!0})]})]})]})}function K(){const{vehicleExpenseDialog:a}=b();if(a)return e.jsxs(i,{...a,children:[e.jsx(i.Header,{title:"Adicionar gasto"}),e.jsx(i.Body,{children:e.jsxs(M,{schema:k,onSubmit:t=>{console.log("data: ",t)},defaultValues:{},children:[e.jsx(c,{children:e.jsx(G,{})}),e.jsx(i.Footer,{labelPrimaryBtn:"Adicionar",className:"px-0",primaryBtnResource:"VEHICLE_EXPENSE",primaryBtnAction:"CREATE"})]})})]})}function O(){const[a,t]=m.useState({vehicleExpenseId:"",vehicleCategory:""}),s=f();function l(o){s.openDialog(),t(o)}async function E(){return[{id:1,category:u.MAINTENANCE,observations:"Troca de óleo",archivedAt:void 0,totalValue:"1500",competencyDate:"2023-10-01"},{id:2,category:u.FUEL,observations:"Abastecimento",archivedAt:void 0,totalValue:"300",competencyDate:"2023-10-05"},{id:3,category:u.INSURANCE,observations:"Seguro anual",archivedAt:void 0,totalValue:"1200",competencyDate:"2023-10-10"}]}const{data:r,isFetching:p}=H({queryKey:["vehicle-expenses"],queryFn:E,select:X});return e.jsxs(e.Fragment,{children:[e.jsx(K,{}),e.jsx(w,{...a,...s}),e.jsxs(n,{children:[e.jsxs(n.Header,{children:[e.jsx(n.Head,{label:"ID"}),e.jsx(n.Head,{label:"Observações"}),e.jsx(n.Head,{label:"Categoria"}),e.jsx(n.Head,{label:"Valor"}),e.jsx(n.Head,{label:"Data"}),e.jsx(n.Head,{action:!0})]}),e.jsx(n.Body,{isLoading:p,isEmpty:!(r!=null&&r.length),resource:"VEHICLE_EXPENSE",action:"READ",children:r==null?void 0:r.map(o=>e.jsxs(n.Row,{children:[e.jsx(n.Cell,{label:String(o.id)}),e.jsx(n.Cell,{label:o.observations}),e.jsx(n.Cell,{label:j[o.category]}),e.jsx(n.Cell,{label:o.totalValue}),e.jsx(n.Cell,{label:o.competencyDate}),e.jsx(n.Action,{children:e.jsx(_,{vehicleExpenseId:String(o.id),vehicleCategory:j[o.category],handleDisableVehicleExpenseInfo:l})})]},o.id))})]})]})}function U(){const a=L(),{vehicleExpenseDialog:t}=b();return e.jsxs("div",{className:"flex flex-col gap-4 h-full w-full",children:[e.jsxs(T,{title:"Gastos do Veículo",children:[e.jsx(x,{label:"Voltar",iconLeft:"ArrowBack",onClick:()=>a("/vehicles"),resource:"VEHICLE_EXPENSE",action:"CREATE",variant:"quaternary","data-cy":"back-vehicle-expense-button"}),e.jsx(x,{label:"Adicionar gasto",iconLeft:"Add",onClick:()=>t==null?void 0:t.openDialog(),resource:"VEHICLE_EXPENSE",action:"CREATE",color:"green","data-cy":"new-vehicle-expense-button"})]}),e.jsx(O,{})]})}function ae(){return e.jsx(R,{children:e.jsx(U,{})})}export{ae as default};
