import{a as E,i as q,n as x,u as p,f as A,j as e,k as T,e as b,t as f,T as B,b as N,c as I,d as H,aF as R,a5 as w,aG as j,S as L,r as S,aH as l,B as U}from"./index-UdT0GBA4.js";import{u as _}from"./useIsFetching-DpNHUXZr.js";import{P as $}from"./PageHeader-BWgTwsAh.js";import{T as o}from"./Table-C3pX6aIK.js";import{A as O}from"./AccountStatus-DnDD6nA6.js";import{u as K}from"./DialogContext-BXF1n5N_.js";import{D as y}from"./Dialog-EaJkbypX.js";import{F as Y,I as k,u as V}from"./schemas-BggDEbt9.js";import{C}from"./Choice-Dg5X3hHC.js";import{a as Q}from"./index-CxZ92SaG.js";import{D}from"./DataField-C0EWm-gj.js";import"./useButtonState-N-GWfCKe.js";import"./dialog-Cf7DmMJZ.js";function G(a){return{...a,totalValue:E(a.totalValue,"money")??""}}function z(){const a=q(),{accountPayableId:n}=x(),{safeFetch:r}=p();async function u(){return await r(`${b}/account-payable/${n}`,{resource:"ACCOUNTS_PAYABLE",action:"READ"})}const{data:t}=A({queryKey:["account-payable",n],queryFn:u,select:G});return e.jsx($,{title:t!=null&&t.description?`Detalhes do Pagamento "${t.description}"`:"Detalhes do Pagamento",children:e.jsx(T,{variant:"quaternary",label:"Voltar",iconLeft:"ArrowBack",onClick:()=>a("/accounts-payable"),action:"READ",resource:"ACCOUNTS_PAYABLE","data-cy":"back-accounts-payable-button"})})}function J(a){const n=[];for(const r of a){const u=[];for(const t of r.paymentMethodPayables)u.push({...t,paymentDate:t.paymentDate?f({date:t.paymentDate,format:"dd/MM/yyyy"}):""});n.push({...r,dueDate:r.dueDate?f({date:r.dueDate,format:"dd/MM/yyyy"}):"",value:E(r.value,"money")??"",paymentMethodPayables:u})}return n}function W({installment:a,handleInstallmentToPaymentMethodInfo:n}){if(!a.paymentMethodPayables.length)return e.jsx(B,{content:"Adicionar método de pagamento",children:e.jsx(T,{variant:"quaternary",iconLeft:"AddCard",onClick:()=>n(a),resource:"ACCOUNTS_PAYABLE",action:"READ",padding:"none","data-cy":`button-edit-addPaymentMethod-${a.id}`})})}function X({installment:a,...n}){const{safeFetch:r}=p(),{showSuccessSnackbar:u}=N(),t=I(),{accountPayableId:m}=x();async function i(d){await r(`${b}/account-payable-installments/payment-method/${a.id}`,{method:"POST",body:d,resource:"ACCOUNTS_PAYABLE",action:"CREATE"})}const{mutate:s,isPending:h}=H({mutationFn:i,onSuccess:()=>{u({title:"Método de pagamento adicionado"}),t.invalidateQueries({queryKey:["accounts-payable-installments",m]}),t.invalidateQueries({queryKey:["accounts-payable-payment-method",String(a.id)]}),t.invalidateQueries({queryKey:["accounts-payable"]}),n.closeDialog()}});return e.jsxs(y,{...n,children:[e.jsx(y.Header,{title:"Adicionar Método de Pagamento"}),e.jsx(y.Body,{children:e.jsxs(Y,{schema:Q,defaultValues:R,onSubmit:s,className:"flex flex-col gap-4",children:[e.jsx(k,{name:"paymentDate",label:"Data do pagamento",required:!0,type:"date"}),e.jsx(V,{label:"Forma de pagamento",required:!0}),e.jsx("div",{className:"flex flex-col gap-2",children:e.jsx(C,{required:!0,children:Object.values(w).map(d=>e.jsx(C.Radio,{label:j[d],name:"type",value:d},d))})}),e.jsx(y.Footer,{labelPrimaryBtn:"Adicionar",className:"px-0",dirty:!1,primaryBtnState:h?"loading":void 0,primaryBtnResource:"ACCOUNTS_PAYABLE",primaryBtnAction:"CREATE"})]})})]})}function Z(a){return{...a,paymentDate:f({date:a.paymentDate,format:"dd/MM/yyyy"})??""}}function ee({installment:a,...n}){const{safeFetch:r}=p();async function u(){var s;const i=await r(`${b}/account-payable-installments/payment-method/${a==null?void 0:a.id}`,{resource:"ACCOUNTS_PAYABLE",action:"READ"});return(s=i==null?void 0:i.paymentMethodPayables)==null?void 0:s[0]}const{data:t,isFetching:m}=A({queryKey:["accounts-payable-payment-method",a.id],queryFn:u,select:Z});return e.jsxs(y,{...n,children:[e.jsx(y.Header,{title:"Detalhes do Método de Pagamento"}),e.jsx(y.Body,{children:e.jsx("div",{className:"flex flex-col gap-4 h-36 mb-8",children:m?e.jsx("div",{className:"flex justify-center items-center h-full w-full",children:e.jsx(L,{})}):e.jsxs(e.Fragment,{children:[e.jsx(D,{label:"Data do pagamento",value:t==null?void 0:t.paymentDate}),e.jsx(D,{label:"Forma de pagamento",value:t&&j[t==null?void 0:t.type]})]})})})]})}function ae({installment:a,...n}){if(a)return a.paymentMethodPayables.length?e.jsx(ee,{installment:a,...n}):e.jsx(X,{installment:a,...n})}const F=11;function te(){const{safeFetch:a}=p(),{accountPayableId:n}=x(),[r,u]=S.useState(null),t=K();function m(c){t.openDialog(),u(c)}async function i(){return await a(`${b}/account-payable-installments/by-account-payable/${n}`,{resource:"ACCOUNTS_PAYABLE",action:"READ"})}const{data:s,isFetching:h}=A({queryKey:["accounts-payable-installments",n],queryFn:i,select:J}),d=S.useMemo(()=>s!=null&&s.length?Math.max(...s.map(c=>c.value.length)):0,[s]);return e.jsxs(e.Fragment,{children:[e.jsx(ae,{installment:r,...t}),e.jsxs(o,{children:[e.jsxs(o.Header,{gridColumns:F,children:[e.jsx(o.Head,{label:l.installmentSequence.label,colSpan:l.installmentSequence.colSpan}),e.jsx(o.Head,{label:l.dueDate.label}),e.jsx(o.Head,{label:l.paymentDate.label}),e.jsx(o.Head,{label:l.paymentMethod.label}),e.jsx(o.Head,{label:l.status.label}),e.jsx(o.Head,{label:l.value.label,colSpan:l.installmentSequence.colSpan}),e.jsx(o.Head,{action:!0})]}),e.jsx(o.Body,{isLoading:h,isEmpty:!(s!=null&&s.length),resource:"ACCOUNTS_PAYABLE",action:"READ",children:s==null?void 0:s.map(c=>{var P,g,M;return e.jsxs(o.Row,{gridColumns:F,children:[e.jsx(o.Cell,{columnLabel:l.installmentSequence.label,colSpan:l.installmentSequence.colSpan,label:c.isUpfront?"Entrada":`${c.installmentSequence}/${(P=s.filter(v=>!v.isUpfront))==null?void 0:P.length}`}),e.jsx(o.Cell,{columnLabel:l.dueDate.label,label:c.dueDate}),e.jsx(o.Cell,{columnLabel:l.paymentDate.label,label:(g=c.paymentMethodPayables)!=null&&g.length?c.paymentMethodPayables[0].paymentDate:""}),e.jsx(o.Cell,{columnLabel:l.paymentMethod.label,label:(M=c.paymentMethodPayables)!=null&&M.length?j[c.paymentMethodPayables[0].type]:""}),e.jsx(o.Cell,{columnLabel:l.status.label,label:e.jsx(O,{status:c.status})}),e.jsx(o.Cell,{columnLabel:l.value.label,label:c.value.padStart(d,U),className:"font-mono whitespace-pre",colSpan:l.value.colSpan}),e.jsx(o.Action,{children:e.jsx(W,{installment:c,handleInstallmentToPaymentMethodInfo:m})})]},c.id)})})]})]})}function ne(){return _({queryKey:["account-payable"]})?e.jsx("div",{className:"flex justify-center items-center h-full w-full",children:e.jsx(L,{})}):e.jsxs("div",{className:"flex flex-col gap-4 h-full w-full",children:[e.jsx(z,{}),e.jsx(te,{})]})}function fe(){return e.jsx(ne,{})}export{fe as default};
