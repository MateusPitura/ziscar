import{r as d,j as e,u as E,a as T,b as N,c as R,B,d as y,K as v,e as A,T as b,f as h,g as M}from"./index-CwQymCQa.js";import{P}from"./PageHeader-ciO4E3wM.js";import{S as D,T as s}from"./Table-C7F72B_O.js";import{u as $}from"./DialogContext-qdOZWBM2.js";import{u as p,f as O}from"./react-pdf.browser-IDMxSf8g.js";import{b as k,F as U,u as w,I as g,i as F}from"./schemas-BL4SC9at.js";import{D as C}from"./Dialog-D_sfX160.js";import{u as L}from"./useDialogContext-CYt-LWKG.js";import{C as u}from"./Choice-DMQtnXq8.js";import{S as q}from"./index-GSyrbZxr.js";import"./index-DTctZbkD.js";const H=d.createContext(null);function I({children:a}){const[n,t]=d.useState("");function r(c){t(c)}const l=d.useMemo(()=>({example:n,handleExample:r}),[n]);return e.jsx(H.Provider,{value:l,children:a})}function K(a){const n=[];for(const t of a.data)n.push({...t,phone:k(t==null?void 0:t.phone,"phone")??""});return{total:a.total,data:n}}function Q({customerId:a,customerFullName:n,...t}){const{safeFetch:r}=E(),{showSuccessSnackbar:l}=T(),c=N(),{handleCustomersFilter:m}=p();async function x(){await r(`${y}/customer/${a}`,{method:"DELETE",body:{archivedAt:new Date().toISOString()},resource:"CUSTOMERS",action:"DELETE"})}const{mutate:f,isPending:j}=R({mutationFn:x,onSuccess:()=>{m({page:1}),c.invalidateQueries({queryKey:["customers"]}),l({title:`Cliente ${n} desativado com sucesso`}),t.closeDialog()}});return e.jsxs(C,{...t,children:[e.jsx(C.Header,{title:"Desativar cliente"}),e.jsx(C.Body,{children:e.jsxs("span",{className:"text-body-medium text-neutral-700",children:["Tem certeza que deseja desativar o cliente",e.jsxs("span",{className:"font-bold",children:[B,n]}),"? Ao desativar os registros relacionados a ele não serão mais acessíveis"]})}),e.jsx(C.Footer,{labelPrimaryBtn:"Desativar",onClickPrimaryBtn:f,primaryBtnState:j?"loading":void 0,primaryBtnColor:"red",primaryBtnResource:"CUSTOMERS",primaryBtnAction:"DELETE"})]})}function z(){const{customersFilter:a,handleCustomersFilter:n}=p(),{closeDialog:t}=L();function r(l){n({page:1,...l}),t()}return e.jsx(U,{schema:q,onSubmit:r,className:"flex-1 flex flex-col",defaultValues:{fullName:(a==null?void 0:a.fullName)||"",orderBy:(a==null?void 0:a.orderBy)||"fullName",status:(a==null?void 0:a.status)||"active",startDate:(a==null?void 0:a.startDate)||"",endDate:(a==null?void 0:a.endDate)||""},replaceEmptyStringToNull:!1,children:e.jsx(V,{})})}function V(){const{reset:a}=w(),{handleCustomersFilter:n}=p(),{closeDialog:t}=L();function r(){n(v),a(v),t()}return e.jsxs(e.Fragment,{children:[e.jsxs(D.Body,{className:"flex flex-col gap-4",children:[e.jsx(g,{name:"fullName",label:"Nome completo"}),e.jsx(F,{label:"Status"}),e.jsx("div",{className:"flex flex-col gap-2",children:e.jsxs(u,{hideErrorLabel:!0,children:[e.jsx(u.Radio,{name:"status",label:"Ativo",value:"active"}),e.jsx(u.Radio,{name:"status",label:"Inativo",value:"inactive"})]})}),e.jsx(g,{name:"startDate",label:"Data inicial",type:"date"}),e.jsx(g,{name:"endDate",label:"Data final",type:"date"}),e.jsx(F,{label:"Ordenar por"}),e.jsx("div",{className:"flex flex-col gap-2",children:e.jsxs(u,{hideErrorLabel:!0,children:[e.jsx(u.Radio,{name:"orderBy",label:"Nome",value:"fullName"}),e.jsx(u.Radio,{name:"orderBy",label:"Email",value:"email"})]})})]}),e.jsx(D.Footer,{primaryLabel:"Aplicar",secondaryLabel:"Limpar",onSecondaryCallback:r,dirty:!0})]})}const _=d.memo(z);function G({customerId:a,fullName:n,isActive:t,handleDisableCustomerInfo:r}){const l=A(),{safeFetch:c}=E(),{showSuccessSnackbar:m}=T(),x=N();async function f(){await c(`${y}/customer/${a}`,{method:"DELETE",body:{archivedAt:null},resource:"CUSTOMERS",action:"DELETE"})}const{mutate:j,isPending:i}=R({mutationFn:f,onSuccess:()=>{x.invalidateQueries({queryKey:["customers"]}),m({title:`Cliente ${n} ativado com sucesso`})}});return t?e.jsxs(e.Fragment,{children:[e.jsx(b,{content:"Editar",children:e.jsx(h,{variant:"quaternary",iconLeft:"Edit",onClick:()=>l(`/customers/edit/${a}`),resource:"CUSTOMERS",action:"UPDATE",padding:"none","data-cy":`button-edit-customer-${a}`})}),e.jsx(b,{content:"Desativar",children:e.jsx(h,{variant:"primary",iconLeft:"Delete",color:"red",padding:"none",onClick:()=>r({customerFullName:n,customerId:a}),resource:"CUSTOMERS",action:"DELETE","data-cy":`button-disable-customer-${a}`})})]}):e.jsx(b,{content:"Ativar",children:e.jsx(h,{variant:"quaternary",onClick:j,state:i?"loading":void 0,resource:"CUSTOMERS",action:"DELETE",padding:"none",iconLeft:"ToggleOn","data-cy":`button-enable-customer-${a}`})})}const J=!1;function W(){const[a,n]=d.useState({customerFullName:"",customerId:""}),t=$(),{safeFetch:r}=E(),{customersFilter:l,handleCustomersFilter:c}=p();function m(o){t.openDialog(),n(o)}function x(o){c({page:o})}const f=d.useMemo(()=>l?O(l):"",[l]);async function j(o){return await r(`${y}/customer?${o}`,{resource:"CUSTOMERS",action:"READ"})}const{data:i,isFetching:S}=M({queryKey:["customers",f],queryFn:({queryKey:o})=>j(o[1]),select:K});return e.jsxs(e.Fragment,{children:[e.jsx(Q,{...a,...t}),e.jsxs("div",{className:"flex gap-4 justify-end",children:[J,e.jsx(s.Filter,{form:e.jsx(_,{})})]}),e.jsxs(s,{children:[e.jsxs(s.Header,{children:[e.jsx(s.Head,{label:"ID"}),e.jsx(s.Head,{label:"Nome completo"}),e.jsx(s.Head,{label:"Email"}),e.jsx(s.Head,{label:"Celular"}),e.jsx(s.Head,{label:"Status"}),e.jsx(s.Head,{action:!0})]}),e.jsx(s.Body,{isLoading:S,isEmpty:!(i!=null&&i.total),resource:"CUSTOMERS",action:"READ",children:i==null?void 0:i.data.map(o=>e.jsxs(s.Row,{children:[e.jsx(s.Cell,{label:String(o.id)}),e.jsx(s.Cell,{label:o.fullName}),e.jsx(s.Cell,{label:o.email}),e.jsx(s.Cell,{label:o.phone}),e.jsx(s.Cell,{label:o.archivedAt?"Inativo":"Ativo"}),e.jsx(s.Action,{children:e.jsx(G,{isActive:!o.archivedAt,customerId:String(o.id),fullName:o.fullName,handleDisableCustomerInfo:m})})]},o.id))}),e.jsx(s.Footer,{currentStartItem:l==null?void 0:l.page,totalItems:i==null?void 0:i.total,onClickNavigateBtn:x,isLoading:S})]})]})}function X(){const a=A();return e.jsxs("div",{className:"flex flex-col gap-4 h-full w-full",children:[e.jsx(P,{title:"Clientes",children:e.jsx(h,{label:"Adicionar cliente",iconLeft:"Add",onClick:()=>a("/customers/new"),resource:"CUSTOMERS",action:"CREATE",color:"green","data-cy":"new-customer-button"})}),e.jsx(W,{})]})}function ce(){return e.jsx(I,{children:e.jsx(X,{})})}export{ce as default};
