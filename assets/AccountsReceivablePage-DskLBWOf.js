import{r as d,j as e,w as p,a as m,a3 as h,aJ as b,i as V,l as C,u as N,f as M,a4 as T,aK as n,B,e as w}from"./index-PgcJxcI8.js";import{P as H}from"./PageHeader-D5LdL7k-.js";import{S as k}from"./Switch-FdvrPx3I.js";import{S as E,T as r}from"./Table-BekIIB6O.js";import{A as I}from"./AccountStatus-BpaywdVD.js";import{D as x}from"./DataField-DBVDlCWD.js";import{u as j,f as _}from"./react-pdf.browser-C5RSsOmp.js";import{E as $}from"./ExportButton-C1aJ9ZMa.js";import{F as q,I as f,u as U}from"./schemas-C0lewGoY.js";import{u as K}from"./useDialog-BsfWsbN7.js";import{u as F}from"./useDialogContext-BiKj66N1.js";import{S as O}from"./index-BT1i9xUF.js";import{C as S}from"./Choice-D0Rlvujn.js";import"./Tag-CNBfIfxT.js";import"./useIsFetching-D-bzNACg.js";const G=d.createContext(null);function Q({children:t}){const[a,s]=d.useState("");function i(c){s(c)}const u=d.useMemo(()=>({example:a,handleExample:i}),[a]);return e.jsx(G.Provider,{value:u,children:t})}function z(t){const a=[];for(const s of t.data)a.push({...s,totalValue:m(s.totalValue,"money")??"",date:s.date?p({date:s.date.split("T")[0],format:"dd/MM/yyyy"}):""});return{total:t.total,data:a,summary:t.summary}}function J(t){const a=[];for(const s of t.data)a.push({...s,totalValue:m(s.totalValue,"money")??"",overallStatus:s.overallStatus==="PAID"?"Pago":"Pendente",date:s.date?p({date:s.date.split("T")[0],format:"dd/MM/yyyy"}):""});return a}function R(){const{accountsReceivableFilter:t,handleAccountsReceivableFilter:a}=j(),{closeDialog:s}=F();function i(u){a({page:1,...u}),s()}return e.jsx(q,{schema:O,onSubmit:i,className:"flex-1 flex flex-col min-h-0",defaultValues:{startDate:(t==null?void 0:t.startDate)||"",endDate:(t==null?void 0:t.endDate)||"",description:(t==null?void 0:t.description)||"",overallStatus:(t==null?void 0:t.overallStatus)||h.PAID},replaceEmptyStringToNull:!1,children:e.jsx(W,{})})}function W(){const{reset:t}=K(),{handleAccountsReceivableFilter:a}=j(),{closeDialog:s}=F();function i(){a(b),t(b),s()}return e.jsxs(e.Fragment,{children:[e.jsxs(E.Body,{className:"flex flex-col gap-4",children:[e.jsx(f,{label:"Descrição",name:"description"}),e.jsx(f,{name:"startDate",label:"Data inicial de criação",type:"date"}),e.jsx(f,{name:"endDate",label:"Data final de criação",type:"date"}),e.jsx(U,{label:"Status geral"}),e.jsx("div",{className:"flex flex-col gap-2",children:e.jsxs(S,{hideErrorLabel:!0,children:[e.jsx(S.Radio,{name:"overallStatus",label:"Pago",value:h.PAID}),e.jsx(S.Radio,{name:"overallStatus",label:"Pendente",value:h.PENDING})]})})]}),e.jsx(E.Footer,{primaryLabel:"Aplicar",secondaryLabel:"Limpar",onSecondaryCallback:i,dirty:!0})]})}const X=d.memo(R);function Y({accountReceivableId:t,vehicleSaleId:a}){const s=V();return e.jsxs(e.Fragment,{children:[e.jsx(C,{tooltipMessage:"Detalhes da venda",variant:"quaternary",iconLeft:"CurrencyExchange",onClick:()=>s(`/vehicle-sale/view/${a}`),resource:"VEHICLE_SALE",action:"READ",padding:"none","data-cy":`button-view-vehicleSale-${a}`}),e.jsx(C,{tooltipMessage:"Detalhes do pagamento",variant:"quaternary",iconLeft:"ReceiptLong",onClick:()=>s(`/accounts-receivable/${t}/installments`),resource:"ACCOUNTS_RECEIVABLE",action:"READ",padding:"none","data-cy":`button-edit-accountReceivable-${t}`})]})}const v=10;function Z(){var g,D,A;const{safeFetch:t}=N(),{accountsReceivableFilter:a,handleAccountsReceivableFilter:s}=j();function i(o){s({page:o})}const u=d.useMemo(()=>a?_(a):"",[a]);async function c(o){return await t(`${w}/account-receivable/search?${o}&orderBy=description`,{resource:"ACCOUNTS_RECEIVABLE",action:"READ"})}const{data:l,isFetching:y}=M({queryKey:["accounts-receivable",u],queryFn:({queryKey:o})=>c(o[1]),select:z}),L=d.useMemo(()=>l!=null&&l.data.length?Math.max(...l.data.map(o=>o.totalValue.length)):0,[l==null?void 0:l.data]),P=d.useMemo(()=>{if(!(a!=null&&a.startDate)||!(a!=null&&a.endDate))return!1;const o=T();return a.startDate===o&&a.endDate===o},[a==null?void 0:a.startDate,a==null?void 0:a.endDate]);return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex gap-4 justify-between",children:[e.jsx($,{fileName:"Relatório Vendas",queryKey:["accounts-receivable",u],queryFn:c,selectQueryFn:J,formatFilters:{description:"Descrição",endDate:"Data final",startDate:"Data inicial",overallStatus:"Status geral"},formatFiltersValues:{overallStatus:{PAID:"Pago",PENDING:"Pendente"}},formatColumns:{description:"Descrição",date:"Data de venda",receivedFrom:"Recebido de",overallStatus:"Status geral",totalValue:"Valor total"}}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx(k,{checked:P,label:"Vendas de hoje",onCheck:()=>s({startDate:p({date:new Date,format:"yyyy-MM-dd"}),endDate:p({date:new Date,format:"yyyy-MM-dd"})}),onUncheck:()=>s({startDate:"",endDate:""})}),e.jsx(r.Filter,{form:e.jsx(X,{})})]})]}),e.jsxs("div",{className:"w-fit flex gap-4",children:[e.jsx(x,{label:"Total",value:m((g=l==null?void 0:l.summary)==null?void 0:g.totalOverall,"money")}),e.jsx(x,{label:"Total Pago",value:m((D=l==null?void 0:l.summary)==null?void 0:D.totalPaid,"money")}),e.jsx(x,{label:"Total Pendente",value:m((A=l==null?void 0:l.summary)==null?void 0:A.totalPending,"money")})]}),e.jsxs(r,{children:[e.jsxs(r.Header,{gridColumns:v,children:[e.jsx(r.Head,{label:n.description.label,colSpan:n.description.colSpan}),e.jsx(r.Head,{label:n.date.label}),e.jsx(r.Head,{label:n.receivedFrom.label}),e.jsx(r.Head,{label:n.overallStatus.label,colSpan:n.overallStatus.colSpan}),e.jsx(r.Head,{label:n.totalValue.label,colSpan:n.totalValue.colSpan}),e.jsx(r.Head,{action:!0})]}),e.jsx(r.Body,{isLoading:y,isEmpty:!(l!=null&&l.total),resource:"ACCOUNTS_RECEIVABLE",action:"READ",children:l==null?void 0:l.data.map(o=>e.jsxs(r.Row,{gridColumns:v,children:[e.jsx(r.Cell,{label:o.description,columnLabel:n.description.label,colSpan:n.description.colSpan}),e.jsx(r.Cell,{label:o.date,columnLabel:n.date.label}),e.jsx(r.Cell,{label:o.receivedFrom,columnLabel:n.receivedFrom.label}),e.jsx(r.Cell,{label:e.jsx(I,{status:o.overallStatus}),columnLabel:n.overallStatus.label,colSpan:n.overallStatus.colSpan}),e.jsx(r.Cell,{label:o.totalValue.padStart(L,B),className:"font-mono whitespace-pre",columnLabel:n.totalValue.label,colSpan:n.totalValue.colSpan}),e.jsx(r.Action,{children:e.jsx(Y,{accountReceivableId:String(o.id),vehicleSaleId:String(o.vehicleSaleId)})})]},o.id))}),e.jsx(r.Footer,{currentStartItem:a==null?void 0:a.page,totalItems:l==null?void 0:l.total,onClickNavigateBtn:i,isLoading:y})]})]})}function fe({contextHelper:t}){return e.jsx(Q,{children:e.jsxs("div",{className:"flex flex-col gap-4 h-full w-full",children:[e.jsx(H,{title:"Vendas",contextHelper:t}),e.jsx(Z,{})]})})}export{fe as default};
